!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="bb9dabb4-5cc9-30ba-ab00-88dae20e6004")}catch(e){}}();
define(["exports","react","./e_ui_page_files_router","./c_core_i18n","./c_src_bindings_provider","./c_src_utils_initials","./c_inband-screen_internals_share-modal-share","./c_common_components_buttons","./c_lib_logging","./c_common_logging-contexts_desktop-platform-logging-metadata","./c_content-member-list_internals_content-member-list","./c_react_query_api_helpers_queries_seen_state_info","./c_dig-components_tabs_index","./c_flux_action_type","./c_action_bar_action_bar_constants","./c_dig-components_banner_index","./c_dig-components_card_index","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_sharing_settings_utils_link_metadata_types","./c_datepicker-react_hooks_index","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_sharing_sharing_pap_logging_copy_shared_link_util","./c_sharing_ui_notifications_util","./c_sharing_ui_util","./c_sharing_sharing_pap_logging_shared_link_util","./c_dig-icons_assets_ui-icon_line_video","./c_dig-icons_assets_ui-icon_line_show","./c_dig-icons_assets_ui-icon_line_link","./c_src_bindings_api-context"],(function(e,t,a,n,i,s,o,l,r,d,c,m,g,u,p,_,f,h,E,y,M,b,S,k,C,L,v,T,I,w){"use strict";function P(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var A=P(t);const N="require_password";class O extends A.Component{render(){const e=this.props.optionsDict[this.props.currentValue].label;return A.createElement(a.Menu.Wrapper,{className:"sharing-settings-dropdown",onSelection:e=>{e!==this.props.currentValue&&this.props.onValueSelected(e)}},(({getContentProps:t,getTriggerProps:n})=>A.createElement(A.Fragment,null,A.createElement(a.Button,{...n(),withDropdownIcon:!0,variant:"opacity",disabled:this.props.disabled,"aria-label":`${e}, ${this.props.ariaLabel}`,"data-testid":"sharing-settings-dropdown"},A.createElement(a.Truncate,{maxWidth:180},e)),A.createElement(a.Menu.Content,{"data-sharing-sdk":"1",...t()},A.createElement(a.Menu.Segment,null,this.props.valuesList.map((e=>A.createElement(a.Menu.ActionItem,{key:e,value:e,"aria-label":this.props.optionsDict[e].label,className:e===this.props.currentValue?"selected":""},A.createElement("div",{style:{width:"250px",marginBottom:"8px"}},A.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},e===this.props.currentValue?A.createElement(h.IconDropdownSelected,{className:"scl-sharing-dropdown-menu-item-dig__path-color"}):null,A.createElement(a.Text,{isBold:!0,className:e===this.props.currentValue?"scl-sharing-dropdown-menu-item-dig__selected-color":"",style:{marginLeft:e===this.props.currentValue?"12px":"24px"}},this.props.optionsDict[e].label)),A.createElement("div",{style:{marginLeft:"24px",marginTop:"4px"}},A.createElement(a.Text,{color:"faint",size:"small",tagName:"div",style:{lineHeight:"18px"}},this.props.optionsDict[e].description)))))))))))}}O.displayName="SettingDropdown";class x extends A.PureComponent{constructor(){super(...arguments),this.handleLinkClicked=e=>{e.preventDefault(),this.props.descriptionLinkOnClicked&&this.props.descriptionLinkUrl&&this.props.descriptionLinkOnClicked(this.props.descriptionLinkUrl)}}render(){const{policyFieldName:e,className:t,rightSideElement:n,bottomElement:i}=this.props,s=a.cx("scl-sharing-modal-settings-row",t);return A.createElement("div",{className:s,"data-testid":e},A.createElement("div",{className:"scl-sharing-modal-settings-row-outer"},A.createElement("div",{className:"scl-sharing-modal-settings-row-info"},A.createElement("div",{className:"scl-sharing-modal-settings-row-display-name"},A.createElement("span",{className:"scl-sharing-modal-settings-row-info-display-name-title",title:this.props.displayNameTitle},this.props.displayName)),A.createElement("div",{className:"scl-sharing-modal-settings-row-details"},A.createElement("span",{className:"scl-sharing-modal-settings-row-details-span",title:this.props.description},this.props.description,this.props.descriptionLinkUrl&&this.props.descriptionLinkText&&A.createElement("span",null," ",A.createElement("a",{className:"scl-sharing-modal-settings-row-description-link",href:"#",onClick:this.handleLinkClicked},this.props.descriptionLinkText))))),n&&A.createElement("div",{className:"scl-sharing-modal-settings-right-element"},n)),i&&A.createElement("div",{className:"scl-sharing-modal-settings-bottom-element"},i))}}x.displayName="SharingModalSettingsRow";const $=e=>{const{policyName:t,policyDict:a,selector:n,onLinkClicked:i,extra:s,className:o}=e;return A.createElement(x,{policyFieldName:t,key:a.title,displayName:a.title,displayNameTitle:a.title,description:a.description,descriptionLinkUrl:a.descriptionLinkUrl,descriptionLinkText:a.descriptionLinkText,descriptionLinkOnClicked:i,rightSideElement:n,bottomElement:s,className:o})};let D=0;const R=e=>{const t=A.useMemo((()=>(D++,`settings-toggle-id-${D}`)),[]),{currentValue:n,optionsDict:i,disabled:s,ariaLabel:o}=e,l=i[n].label;return A.createElement(A.Fragment,null,A.createElement("p",{style:{display:"flex",justifyContent:"flex-end"}},A.createElement(a.Text,{tagName:"label",color:"faint",style:{marginRight:"8px"},htmlFor:t},l),A.createElement(a.Toggle,{id:t,"aria-label":o,className:"sharing-settings-modal__toggle",isToggled:i[n].value,disabled:s,onChange:t=>{s||e.onOptionChange(!i[n].value,t)}})))},U=(e,t)=>o.isPasswordPolicyEnforcedByAdmin(e)&&o.isExternalAudience(t);function F(e,t){return t.link_password||""===t.link_password?t.link_password:o.hasLinkPassword(e)?"123456":""}const B=e=>{const{intl:t,linkPolicy:n,linkPermissions:i,onPolicyUpdate:s}=e;return A.createElement("div",{className:"sharing-settings-modal__input_spacing"},A.createElement(a.TextInput,{role:"textbox",autoFocus:!0,className:"password-input__input",disabled:!o.canModifyPassword(i)||e.readOnlyPolicy,placeholder:t.formatMessage({id:"um5odk",defaultMessage:"Set password"}),name:"link_password",onChange:e=>{s({[e.target.name]:e.target.value})},type:"password",isInvalid:""===n.link_password,value:F(i,n)}))};class j extends A.Component{render(){const e=this.props.linkPermissions.resolved_visibility,t=this.props.linkPermissions.audience_options[0].disallowed_reason;return t!==y.LinkAudienceDisallowedReason.RestrictedBySharedFolder&&t!==y.LinkAudienceDisallowedReason.DeleteAndRecreate?null:A.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:A.createElement("span",null,A.createElement("span",{className:"shared-link-settings-modal__audience-disallowed-text"},this.audienceDisallowedText(e))," ",A.createElement("span",{className:"shared-link-settings-modal__audience-disallowed-advice u-font-meta"},this.audienceDisallowedAdviceText(t)))})}audienceDisallowedText(e){if(e===y.ResolvedVisibilityPolicy.shared_folder_only){let e=this.props.linkPermissions.restricting_shared_folder_path;return void 0!==e?(e=s.Emstring.em_snippet(e,a.SNIPPET_SIZES.FILENAME),this.props.intl.formatMessage({id:"Wzk4tW",defaultMessage:"Only members of the shared folder “{shared_folder_name}” can view this link."},{shared_folder_name:e})):void 0}return e===y.ResolvedVisibilityPolicy.only_you?this.props.intl.formatMessage({id:"kp9e20",defaultMessage:"Only you can view this link."}):void 0}audienceDisallowedAdviceText(e){return e===y.LinkAudienceDisallowedReason.RestrictedBySharedFolder?this.props.intl.formatMessage({id:"D2VN2I",defaultMessage:"To change who can access the link, go to the shared folder options."}):e===y.LinkAudienceDisallowedReason.DeleteAndRecreate?this.props.intl.formatMessage({id:"HbDkss",defaultMessage:"To change who can access the link, delete this link and create a new one."}):void 0}}j.displayName="RestrictedVisibilityBanner";const V=({className:e,...t})=>A.createElement("div",{className:a.cx("scl-scooter-loader",e),...t},A.createElement("div",{className:"scl-scooter-loader-animation"}));V.displayName="ScooterLoader",V.displayName="ScooterLoader";const G="scl-sharing-modal-downgrade-banner",H=e=>{const{subheader:t,header:i,onClickCloseButton:s,onClickOutlineButton:o,onClickTransparentButton:l,outlineButtonLabel:r,transparentButtonLabel:d,showCloseButton:c}=e,m=n.useIntl();return A.createElement("div",{className:`${G} dig-Theme---VIS`,"data-testid":"sharing-modal-downgrade-banner"},A.createElement("div",{className:`${G}__header`},A.createElement(a.Text,{isBold:!0,size:"large"},i),c&&A.createElement(a.IconButton,{variant:"transparent","aria-label":m.formatMessage({id:"hhAj2K",defaultMessage:"Close"}),className:`${G}__close`,onClick:s,size:"standard"},A.createElement(a.UIIcon,{src:a.CloseLine}))),A.createElement("div",{className:`${G}__subheader`},A.createElement(a.Text,null,t)),A.createElement("div",{className:`${G}__buttons`},A.createElement(a.Button,{variant:"outline",onClick:o},r),A.createElement(a.Button,{variant:"transparent",onClick:l},d)))};H.displayName="SharingModalDowngradeBanner";const W=e=>e.formatMessage({id:"b0sjjf",defaultMessage:"Learn more"}),q=e=>e.formatMessage({id:"O1FxvA",defaultMessage:"This folder can only be shared as a link."}),Y=e=>e.formatMessage({id:"QpEuIr",defaultMessage:"You can view this folder, but you’ll need to ask the folder owner to give you permission to share it."}),K=e=>e.formatMessage({id:"/8sefF",defaultMessage:"You can view this folder, but only the folder owner can share it."});function z(e){return{class:"sharing_sender",action:"hover",object:"flexible_sharing_entrypoint_action",properties:e}}function X(e){return{class:"sharing_sender",action:"log",object:"flexible_sharing_entrypoint_action_dwell_time",properties:e}}const Z=Symbol("ON_CLICK_PROGRESSIVE"),J=Symbol("ON_MOUSE_ENTER_PROGRESSIVE"),Q=Symbol("ON_MOUSE_LEAVE_PROGRESSIVE"),{useEmitter:ee,defaultEmitter:te}=r.defineLogger((async({event:e,getContextValue:t})=>{const n=t(d.Context),i=t(d.Context$1),s=t(d.Context$2),l=t(d.Context$3),r={...d.getTags(n),...d.getTags$1(i),...d.getTags$2(s),...d.getTags$3(l)},c={...d.getProperties(n),...d.getProperties$1(i),...d.getProperties$2(s),...d.getProperties$3(l)};if(e.key===Z)return a.UDCL.logEvent(o.PAP_Select_FlexibleSharingEntrypointAction({...c,flexibleSharingEntryPointAction:"inband_progressive",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...r,action:"inband_progressive"}}),void a.UDCL.logEvent(X({...c,flexibleSharingEntryPointAction:"inband_progressive",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...r,action:"inband_progressive"}});if(e.key!==J){if(e.key!==Q)return a.exhausts(e,void 0);a.UDCL.logEvent(X({...c,flexibleSharingEntryPointAction:"inband_progressive",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...r,action:"inband_progressive"}})}else a.UDCL.logEvent(z({...c,flexibleSharingEntryPointAction:"inband_progressive"}),{tags:{...r,action:"inband_progressive"}})})),ae=({accountMetadata:e})=>{const t=n.useIntl(),o=i.useOpenUrl(),l=s.getIsTeamAdmin(e),r=l?(e=>e.formatMessage({id:"QV0fMP",defaultMessage:"To share this folder, manage access in the admin console."}))(t):(e=>e.formatMessage({id:"C87Oa/",defaultMessage:"Only admins can directly share this content. Reach out and ask them to share it."}))(t),d=l?(e=>e.formatMessage({id:"S839MU",defaultMessage:"Go to admin console"}))(t):(e=>e.formatMessage({id:"0KHhX0",defaultMessage:"Find admin"}))(t);return A.createElement(a.Box,null,A.createElement(a.Text,{size:"medium","data-testid":"tmr-team-folder-subtitle"},r),A.createElement(a.Box,{marginTop:"Micro Large"},A.createElement(a.Button,{variant:"transparent",onClick:()=>{o(l?"/team/admin/content/home":"/team?_tk=left_nav_team")}},d)))};ae.displayName="TmrTeamFolder";const ne=e=>{var t;const{objectMetadata:r,accountMetadata:d,onInbandButtonClicked:c,componentViewTime:m}=e,g=a.isNewApiMetadata(r),[u,p]=A.useState(!1),[_,f]=A.useState(!1),[h,E]=A.useState(0),y=A.useRef(null),M=ee(),b=a.getCanInvite(r,o.VIEWER),S=a.getCanInvite(r,o.EDITOR)||b,k=a.getIsLinkOnlyMode(r),C=a.getIsNSLinkOnlyMode(r),L=a.getIsFolder(r),v=s.isUserOnSameTeamAsObject(d,r),T=s.isUserOnSameTeamAsTmrTeamFolder(d,r),I=!!a.getOwnerTeam(r),w=null!==(t=a.getOwnerTeamName(r))&&void 0!==t?t:"",P=a.getIsTeamSharedFolder(r),N="https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",O=i.useOpenUrl(),x=A.useCallback((e=>{O(e)}),[O]),$=()=>{switch(a.getInviteDeniedReason(r)){case"mount_exceeded":return A.createElement(a.Text,null,((e,t)=>{if(!t.metadata_response||!a.getIsFolder(t))return;const n=t.metadata_response;if(n.invite_viewer_folder_perm.invite_viewer_folder_denied_reason&&"mount_exceeded"===n.invite_viewer_folder_perm.invite_viewer_folder_denied_reason[".tag"]){const t=n.invite_viewer_folder_perm.invite_viewer_folder_denied_reason,a=t.limit,i=t.new_count-a;return e.formatMessage({id:"f3Mx9B",defaultMessage:"This folder can only be shared as a link because your Dropbox folder is {number, plural, one{1 shared folder} other {{number} shared folders}} over limit."},{number:i})}})(n.intl,r),A.createElement(a.Link,{style:{marginLeft:3},hasNoUnderline:!0,onClick:()=>x(N),href:"",isBold:!0,display:"inline"},W(n.intl)));case"contains_app_folder":case"inside_app_folder":case"is_app_folder":case"is_family_folder":return A.createElement(a.Text,null,q(n.intl));default:return A.createElement(a.Text,null,v?Y(n.intl):K(n.intl))}},D=A.useCallback((()=>{const e=_?Date.now()-h:void 0,t=Date.now()-m;M.select(Z).emit({dwellTime:e,timeSinceView:t}),c()}),[m,M,_,c,h]),R=A.useCallback((()=>{E(Date.now()),f(!0),M.select(J).emit(null),p(!0)}),[M]),U=A.useCallback((()=>{const e=_?Date.now()-h:void 0;f(!1),M.select(Q).emit({dwellTime:e}),p(!1)}),[M,_,h]),F=g?!S:k||!S;return A.createElement(A.Fragment,null,A.createElement(l.ButtonWrapper,{ref:y,onMouseEnter:R,onMouseLeave:U,"data-uxa-log":"sm24-inband-button."+(F?"disabled":"loaded"),"data-uxa-interactions":"shown click"},A.createElement(l.HorizontalButton,{onClick:D,disabled:F,"data-testid":"inband-sharing-entry-button"},A.createElement(l.ButtonIconContainer,null,A.createElement(a.UIIcon,{src:a.ShareLine,size:"medium"})),A.createElement(l.ButtonInnerColumn,null,A.createElement(l.ButtonTitle,{content:(B=n.intl,B.formatMessage({id:"SC4EWs",defaultMessage:"Add people"}))})))),(()=>{let e=null;return g?T&&!S?e=A.createElement(ae,{accountMetadata:d}):S||(e=$()):k?e=(()=>{switch(k?C?"isNSLinkOnlyMode":"isFamily":"isLimitedPermissions"){case"isNSLinkOnlyMode":return A.createElement(a.Text,null,((e,t)=>{if(t.tooManyMountsError&&("total_mounts_exceeded"===t.tooManyMountsError[".tag"]||"home_mounts_exceeded"===t.tooManyMountsError[".tag"]||"tree_size_exceeded"===t.tooManyMountsError[".tag"])){const a=t.tooManyMountsError.limits_info;if(a){const t=a.limit,n=a.new_count-t;return e.formatMessage({id:"f3Mx9B",defaultMessage:"This folder can only be shared as a link because your Dropbox folder is {number, plural, one{1 shared folder} other {{number} shared folders}} over limit."},{number:n})}}})(n.intl,r),A.createElement(a.Link,{style:{marginLeft:3},hasNoUnderline:!0,onClick:()=>x(N),href:"",isBold:!0,display:"inline"},W(n.intl)));case"isLimitedPermissions":return I&&!v?P?A.createElement(a.Text,null,(e=n.intl,void 0!==(t=w)?e.formatMessage({id:"ToMYBy",defaultMessage:"This folder can only be managed by the {ownerTeamName} team."},{ownerTeamName:t}):e.formatMessage({id:"ReqZ5Y",defaultMessage:"This folder can only be managed by the owner team."}))):L?A.createElement(a.Text,null,(e=>e.formatMessage({id:"5iJXBE",defaultMessage:"You don’t have permission to manage membership of this folder"}))(n.intl)):A.createElement(a.Text,null,(e=>e.formatMessage({id:"WVaUHn",defaultMessage:"You don’t have permission to manage membership of this file"}))(n.intl)):A.createElement(a.Text,null,(e=>e.formatMessage({id:"TnTBTY",defaultMessage:"This can only be shared with the link."}))(n.intl));case"isFamily":return A.createElement(a.Text,null,q(n.intl))}var e,t})():T&&!S?e=A.createElement(ae,{accountMetadata:d}):S||(e=A.createElement(a.Text,null,v?Y(n.intl):K(n.intl))),e?A.createElement(a.Tooltip.Control,{open:u,placement:"top",auto:!0,triggerRef:y,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)},e):null})());var B};ne.displayName="InbandEntryButtonInner";const ie=e=>{const{oid:t,onInbandButtonClicked:n,componentViewTime:i}=e,o=s.useSharingObjectMetadata(t.fileId),r=s.useSharingAccountInfo(),d=o.isLoading,c=!o.isLoading&&o.isError,m=d||c?void 0:o.output,g=r.isLoading,u=!r.isLoading&&r.isError,p=g||u?void 0:r.output;return d||g?A.createElement(l.ButtonWrapper,{"data-uxa-log":"sm24-inband-button.loading","data-uxa-interactions":"shown click"},A.createElement(l.HorizontalButton,{disabled:!0},A.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),A.createElement(a.Skeleton.Text,{size:"large",width:200}))):m&&p?A.createElement(ne,{accountMetadata:p,objectMetadata:m,onInbandButtonClicked:n,componentViewTime:i}):null};ie.displayName="InbandEntryButton";const se=({objectMetadata:e,accountMetadata:t,canInvite:i,handleButtonClick:o,componentViewTime:r})=>{const[d,c]=A.useState(!1),[m,g]=A.useState(0),[u,p]=A.useState(!1),_=A.useRef(null),f=ee(),h=s.isUserOnSameTeamAsTmrTeamFolder(t,e),E=A.useCallback((()=>{const e=d?Date.now()-m:void 0,t=Date.now()-r;f.select(Z).emit({dwellTime:e,timeSinceView:t}),o()}),[r,f,o,d,m]),y=A.useCallback((()=>{g(Date.now()),c(!0),f.select(J).emit(null),p(!0)}),[f]),M=A.useCallback((()=>{const e=d?Date.now()-m:void 0;c(!1),f.select(Q).emit({dwellTime:e}),p(!1)}),[f,d,m]),b=s.getIsTeam(t);return A.createElement(A.Fragment,null,A.createElement(l.ButtonWrapper,{ref:_,onMouseEnter:y,onMouseLeave:M},A.createElement(l.HorizontalFlatButton,{onClick:E,disabled:!i,"data-testid":"inband-sharing-entry-button",autoFocus:!0},A.createElement(l.ButtonIconContainer,null,A.createElement(a.UIIcon,{src:a.ShareLine,size:"small"})),A.createElement(l.ButtonInnerColumn,null,A.createElement(a.Text,{color:"subtle",style:{marginLeft:-3,marginTop:4}},A.createElement(a.Truncate,{lines:2},b?n.intl.formatMessage({id:"I1N8uC",defaultMessage:"Add an email, name, or group"}):(e=>e.formatMessage({id:"RynZbM",defaultMessage:"Add an email or name"}))(n.intl)))))),(()=>{let o=null;if(h&&!i)o=A.createElement(ae,{accountMetadata:t});else if(!i){const i=s.isUserOnSameTeamAsObject(t,e);o=A.createElement(a.Text,null,i?Y(n.intl):K(n.intl))}return o?A.createElement(a.Tooltip.Control,{open:u,placement:"top",auto:!0,triggerRef:_,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)},o):null})())};se.displayName="Inner";const oe=({oid:e,onTokenizerButtonClick:t,componentViewTime:n})=>{const i=s.useSharingObjectMetadata(e.fileId),r=s.useSharingAccountInfo(),d=i.isLoading,c=!i.isLoading&&i.isError,m=d||c?void 0:i.output,g=r.isLoading,u=!r.isLoading&&r.isError,p=g||u?void 0:r.output,_=d||g,f=!_&&m&&p;if(_)return A.createElement(l.ButtonWrapper,null,A.createElement(l.HorizontalButton,{disabled:!0},A.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),A.createElement(a.Skeleton.Text,{size:"large",width:200})));if(f){const e=a.getCanInvite(m,o.VIEWER)||a.getCanInvite(m,o.EDITOR);return A.createElement(se,{accountMetadata:p,objectMetadata:m,canInvite:e,handleButtonClick:t,componentViewTime:n})}return null};oe.displayName="TokenizerButton";const le=i.define({name:"sharing.modifySharedLinksettings"},(e=>t=>i.handler(e.sharingAlphaModifySharedLinkSettings(t)))),re=e=>{switch(e){case"public":return a.PUBLIC;case"team":return a.TEAM;case"password":return a.PASSWORD;case"no_one":return a.NO_ONE;default:return a.OTHER}},de=(e,t,a,n)=>{const i=o.SharingSettingsUtil(e).getModifiedSettings(t,n,a);return void 0===i?null:i},ce=e=>{var t,a,n,i,s,o,l,r;const d=null===(t=e.link_permissions.link_access_level)||void 0===t?void 0:t[".tag"],c=null===(a=e.link_permissions.resolved_visibility)||void 0===a?void 0:a[".tag"],m=null===(n=e.link_permissions.effective_audience)||void 0===n?void 0:n[".tag"];return{allow_comments:e.link_permissions.allow_comments,can_revoke:e.link_permissions.can_revoke,allow_download:e.link_permissions.allow_download,can_allow_download:e.link_permissions.can_allow_download,can_disallow_download:e.link_permissions.can_disallow_download,can_set_expiry:e.link_permissions.can_set_expiry,can_remove_expiry:e.link_permissions.can_remove_expiry,can_set_password:Boolean(e.link_permissions.can_set_password),can_remove_password:Boolean(e.link_permissions.can_remove_password),require_password:Boolean(e.link_permissions.require_password),link_access_level:"other"===d||void 0===d?"viewer":d,team_restricts_comments:e.link_permissions.team_restricts_comments,can_use_extended_sharing_controls:e.link_permissions.can_use_extended_sharing_controls,resolved_visibility:"other"===c||void 0===c?"no_one":c,effective_audience:"other"===m||"members"===m?void 0:m,requested_visibility:(null===(i=e.link_permissions.requested_visibility)||void 0===i?void 0:i[".tag"])||"public",revoke_failure_reason:null===(s=e.link_permissions.revoke_failure_reason)||void 0===s?void 0:s[".tag"],restricting_shared_folder_path:e.link_permissions.restricting_shared_folder_path,audience_options:(e.link_permissions.audience_options||[]).filter((e=>"other"!==e.audience[".tag"])).map((e=>{var t;return{audience:e.audience[".tag"],allowed:e.allowed,disallowed_reason:null===(t=e.disallowed_reason)||void 0===t?void 0:t[".tag"]}})),visibility_policies:e.link_permissions.visibility_policies.map((e=>({policy:e.policy[".tag"],resolved_policy:e.resolved_policy[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason}))),days_to_expire_policy:null===(o=e.link_permissions.days_to_expire_policy)||void 0===o?void 0:o[".tag"],change_shared_link_expiration_policy:null===(l=e.link_permissions.change_shared_link_expiration_policy)||void 0===l?void 0:l[".tag"],enforce_shared_link_password_policy:null===(r=e.link_permissions.enforce_shared_link_password_policy)||void 0===r?void 0:r[".tag"]}},me=(e,t)=>null===t?null:{url:t.url,content_owner_team_info:t.content_owner_team_info,expires:t.expires?new Date(t.expires):void 0,require_password:t.link_permissions.require_password,file_type:a.getIsFile(e)?"file":a.getIsCollection(e)?"collection":"folder",id:t.id,link_permissions:ce(t),name:t.name,path_lower:t.path_lower,rev:void 0,server_modified:void 0,team_member_info:t.team_member_info?{...t.team_member_info,member_id:t.team_member_info.member_id||""}:void 0,preview_type:t.preview_type},ge=(e,t)=>null===t?null:o.SharingSettingsUtil(e).getLinkPolicy(t),ue=(e,t)=>"edit_link_settings"===e?u.SettingsTabName.EditLinkSettingsTab:"view_link_settings"===e?u.SettingsTabName.ViewLinkSettingsTab:t?u.SettingsTabName.FileSettingsTab:u.SettingsTabName.FolderSettingsTab,pe=e=>e.formatMessage({id:"pTINM6",defaultMessage:"Cancel"}),_e=e=>e.formatMessage({id:"qIDtpl",defaultMessage:"Saving..."}),fe=e=>e.formatMessage({id:"rQzKcA",defaultMessage:"Save"}),he=e=>e.formatMessage({id:"9P9QP9",defaultMessage:"Delete link"}),Ee=e=>e.formatMessage({id:"98ues2",defaultMessage:"Create link"}),ye=e=>e.formatMessage({id:"5c/Fw9",defaultMessage:"There was a problem completing this request."}),Me=e=>e.formatMessage({id:"thZih0",defaultMessage:"File settings updated."}),be=e=>e.formatMessage({id:"y/SwCN",defaultMessage:"Updating folder settings…"}),Se=e=>e.formatMessage({id:"9KbrAJ",defaultMessage:"You don`t have permission to perform this action."}),ke=e=>e.formatMessage({id:"/KMAtq",defaultMessage:"Folder settings updated."}),Ce=e=>e.formatMessage({id:"xbSGM1",defaultMessage:"This setting is turned off for all files in this folder."}),Le=e=>e.formatMessage({id:"BUD+SU",defaultMessage:"Your admin has disabled this setting."}),ve=e=>e.formatMessage({id:"hIM/KB",defaultMessage:"You don’t have permission to change the settings on this file."}),Te=e=>e.formatMessage({id:"PLkx47",defaultMessage:"Anyone with edit access can change these settings."}),Ie=(e,t,n)=>e.formatMessage({id:"7Lpr6B",defaultMessage:"Deleting link to <st>{name}</st>..."},{st:e=>A.createElement("strong",null,e),name:s.Emstring.em_snippet(t,n?a.SNIPPET_SIZES.DESKTOP_FILENAME:a.SNIPPET_SIZES.FILENAME)}),we=(e,t,n)=>e.formatMessage({id:"fghTgF",defaultMessage:"Deleted link to <st>{name}</st>."},{st:e=>A.createElement("strong",null,e),name:s.Emstring.em_snippet(t,n?a.SNIPPET_SIZES.DESKTOP_FILENAME:a.SNIPPET_SIZES.FILENAME)}),Pe=e=>e.formatMessage({id:"oW3nlu",defaultMessage:"Link deletion failed. Please retry."}),Ae=e=>e.formatMessage({id:"eqpbc5",defaultMessage:"Who still has access?"}),Ne=(e,t)=>"editor"===t[".tag"]?e.formatMessage({id:"OvEApa",defaultMessage:"Creating edit link..."}):e.formatMessage({id:"8PPImn",defaultMessage:"Creating view link..."}),Oe=(e,t)=>t?e.formatMessage({id:"p1EB+W",defaultMessage:"You don’t have permission to create a link to this file"}):e.formatMessage({id:"/ivxG2",defaultMessage:"You don’t have permission to create a link to this folder"}),xe=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),$e=(e,t)=>"editor"===t[".tag"]?e.formatMessage({id:"1+z1aQ",defaultMessage:"Edit link created"}):e.formatMessage({id:"IalA6p",defaultMessage:"View link created"}),De=e=>e.formatMessage({id:"V2Zurn",defaultMessage:"People who have used this link might still have access"}),Re=e=>e.formatMessage({id:"rqdCog",defaultMessage:"You can check the list of people with access and remove them."}),Ue=e=>e.formatMessage({id:"YCTkuR",defaultMessage:"Got It"}),Fe=e=>e.formatMessage({id:"UBFEXr",defaultMessage:"Who still has access?"}),Be=e=>e.formatMessage({id:"OMkgF4",defaultMessage:"Settings saved."}),je=(e,t)=>e.formatMessage({id:"SuyTXe",defaultMessage:"Unsharing <st>{name}</st>..."},{st:e=>A.createElement("strong",null,e),name:s.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)}),Ve=(e,t)=>e.formatMessage({id:"K7TiCS",defaultMessage:"Unshared <st>{name}</st>."},{st:e=>A.createElement("strong",null,e),name:s.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)}),Ge=e=>e.formatMessage({id:"sL/c0K",defaultMessage:"Unshare failed. Please retry."}),He=(e,t)=>a.getIsFile(t)?(e=>e.formatMessage({id:"px+mde",defaultMessage:"Unshare file"}))(e):a.getIsInsideTeamFolderTree(t)?(e=>e.formatMessage({id:"11dNm1",defaultMessage:"Reset membership"}))(e):(e=>e.formatMessage({id:"qyAR1S",defaultMessage:"Unshare folder"}))(e),We=(e,t)=>e.formatMessage({id:"AvoJhZ",defaultMessage:"These settings will apply to all folders inside <st>“{folder_name}.”</st>"},{folder_name:t,st:e=>A.createElement("strong",null,e)}),qe=(e,t)=>e.formatMessage({id:"W4bv7f",defaultMessage:"These settings will apply to all folders inside <st>“{folder_name}.”</st> You can change these settings or manage access in the Admin Console."},{folder_name:t,st:e=>A.createElement("strong",null,e)}),Ye=(e,t)=>e.formatMessage({id:"M+bKji",defaultMessage:"<adminLink>Go to admin console</adminLink>"},{adminLink:e=>A.createElement(a.Button,{variant:"transparent",size:"small",onClick:()=>t("/team/admin/content/home")},e)}),Ke=(e,t)=>e.formatMessage({id:"kBmOrE",defaultMessage:"These settings will apply to all folders inside <st>“{folder_name}.”</st> To edit, ask your admin."},{folder_name:t,st:e=>A.createElement("strong",null,e)}),ze=(e,t)=>e.formatMessage({id:"FAe8j7",defaultMessage:"<findAdminLink>Find admin</findAdminLink>"},{findAdminLink:e=>A.createElement(a.Button,{variant:"transparent",size:"small",onClick:()=>t("/team?_tk=left_nav_team")},e)}),Xe=e=>e.formatMessage({id:"CKlNWd",defaultMessage:"We’ll let the owner know whenever you change these settings"}),Ze=(e,t)=>e.formatMessage({id:"5Aqtnn",defaultMessage:"Only the owner (you) can change these settings. Settings apply to all folders in <st>“{folder_name}.”</st>"},{folder_name:s.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME),st:e=>A.createElement("strong",null,e)}),Je=(e,t)=>e.formatMessage({id:"o9IXBs",defaultMessage:"Only the owner can change these settings. Settings apply to all folders in <st>“{folder_name}.”</st>"},{folder_name:s.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME),st:e=>A.createElement("strong",null,e)}),Qe=e=>e.formatMessage({id:"iQBMyq",defaultMessage:"Only team admins can change these settings."}),et=e=>e.formatMessage({id:"6K7VUR",defaultMessage:"Close"}),tt=e=>e.formatMessage({id:"RCQdy7",defaultMessage:"This file hasn’t been shared yet"}),at=e=>e.formatMessage({id:"+hXlVB",defaultMessage:"Can’t unshare a folder that is within multiple shared folders."}),nt="member_policy",it="viewer_info_policy",st="shared_link_policy",ot="expires",lt="allow_download",rt="audience",dt="require_password",ct="acl_update_policy",mt="dropdown",gt="toggle",ut=e=>{const{policyFieldName:t,rightSideElement:n,bottomElement:i}=e;return A.createElement("div",{"data-testid":t,style:{marginTop:"20px"}},A.createElement("div",{style:{display:"flex",paddingLeft:"8px",paddingRight:"8px",paddingTop:"4px",paddingBottom:"4px"}},A.createElement("div",{style:{marginRight:"16px"}},A.createElement("div",null,A.createElement("span",{title:e.displayNameTitle},A.createElement(a.Text,{size:"medium",isBold:!0},e.displayName))),A.createElement("div",null,A.createElement("span",{title:e.description},A.createElement(a.Text,{size:"small",color:"subtle"},e.description),e.descriptionLinkUrl&&e.descriptionLinkText&&A.createElement("span",null," ",A.createElement(a.Button,{variant:"transparent",hasNoUnderline:!0,onClick:t=>{t.preventDefault(),e.descriptionLinkOnClicked&&e.descriptionLinkUrl&&e.descriptionLinkOnClicked(e.descriptionLinkUrl)},size:"small"},e.descriptionLinkText))))),n&&A.createElement("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto"}},n)),i&&A.createElement("div",null,i))},pt=e=>{const{policyName:t,policyDict:a,selector:n,onLinkClicked:i,extra:s,className:o}=e;return A.createElement(ut,{policyFieldName:t,key:a.title,displayName:a.title,displayNameTitle:a.title,description:a.description,descriptionLinkUrl:a.descriptionLinkUrl,descriptionLinkText:a.descriptionLinkText,descriptionLinkOnClicked:i,rightSideElement:n,bottomElement:s,className:o})};let _t=0;const ft=e=>{const t=A.useMemo((()=>(_t++,`settings-toggle-id-${_t}`)),[]),{currentValue:n,optionsDict:i,disabled:s,ariaLabel:o}=e,l=i[n].label;return A.createElement(A.Fragment,null,A.createElement("p",{style:{display:"flex",justifyContent:"flex-end"}},A.createElement(a.Text,{tagName:"label",color:"faint",style:{marginRight:"8px"},htmlFor:t},l),A.createElement(a.Toggle,{id:t,"aria-label":o,className:"sharing-settings-modal__toggle",isToggled:i[n].value,disabled:s,onChange:t=>{s||e.onOptionChange(!i[n].value,t)}})))};function ht({intl:e,linkPermissions:t,linkPolicy:n,getPolicyDict:i,onPolicyUpdate:s,readOnlyPolicy:l}){const r=t.audience_options.filter((e=>!((e,t)=>"public"===e&&o.isPasswordPolicyEnforcedByAdmin(t)&&!a.isRighteousLink(t))(e.audience,t)&&e.allowed)).map((e=>e.audience)),d=i(rt),c=n.audience||"",m=r.length>0,g="password"===n.audience;let u;m||(u=A.createElement(j,{intl:e,linkPermissions:t}));const p=A.createElement("div",null,A.createElement(O,{currentValue:c,valuesList:r,optionsDict:d.optionsDict,onValueSelected:e=>{const a={audience:e};!function(e,t,a,n){if(o.isExternalAudience(e)){if(o.isExpirationPolicySetByAdmin(t)){const e=new Date,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+o.daysExpirationPolicyToNumber[t.days_to_expire_policy]);(!a.expires||a.expires>i)&&(n.expires=i,n.display_expiration_warning=!0)}o.isPasswordPolicyEnforcedByAdmin(t)&&!a.require_password&&(n.require_password=!0,"public"===e&&(n.display_password_warning=!0))}else n.display_expiration_warning=!1,n.display_password_warning=!1}(e,t,n,a),s(a)},disabled:!m||l,ariaLabel:d.title}),g&&A.createElement(B,{intl:e,linkPermissions:t,linkPolicy:n,getPolicyDict:i,onPolicyUpdate:s,readOnlyPolicy:l}));return A.createElement(pt,{policyName:rt,policyDict:d,selector:p,extra:u})}const Et=({intl:e,getPolicyDict:t,linkMetadata:a,linkPolicy:n,onPolicyUpdate:i,readOnlyPolicy:s})=>{const l=t(ot),r=e=>{e&&e.expires instanceof Date&&e.expires.setHours(23,59,59),i(e)},d=(e=>{const{linkMetadata:t,linkPolicy:a}=e,n=new Date;let i;if(o.isExternalAudience(a.audience)){const{days_to_expire_policy:e}=t.link_permissions;o.isExpirationPolicyEnforcedByAdmin(t.link_permissions)&&(i=new Date(n.getFullYear(),n.getMonth(),n.getDate()+o.daysExpirationPolicyToNumber[e]))}return{before:new Date(n.getFullYear(),n.getMonth(),n.getDate()+1),after:i}})({intl:e,getPolicyDict:t,linkMetadata:a,linkPolicy:n,onPolicyUpdate:i,readOnlyPolicy:s}),c=null!=n.expires,m=A.useCallback((t=>e.formatDate(t,{day:"2-digit"})),[e]),g=A.createElement("div",null,A.createElement(ft,{currentValue:null!=n.expires?"enabled":"disabled",optionsDict:l.optionsDict,onOptionChange:e=>{let t=null;e&&(t=n.expires||o.daysAfterToday(o.isExternalAudience(n.audience)&&o.isExpirationPolicySetByAdmin(a.link_permissions)?o.daysExpirationPolicyToNumber[a.link_permissions.days_to_expire_policy]:30)),r({expires:t||void 0,display_expiration_warning:!1})},disabled:!(o.isExternalAudience(n.audience)&&o.isExpirationPolicyEnforcedByAdmin(a.link_permissions))&&!o.canModifyExpire(a)||s,ariaLabel:l.title}),c&&A.createElement("div",{className:"sharing-settings-modal__input_spacing"},A.createElement(M.DatePickerInput,{value:n.expires||new Date,disabled:!o.canModifyExpire(a)||s,isDateBlocked:e=>e<d.before||!!(d.after&&e>d.after),onChange:e=>e&&r({expires:e,display_expiration_warning:!1}),dayLabelFormat:m,monthLabelFormat:t=>e.formatDate(t,{month:"long",year:"numeric"}),weekdayLabelFormat:t=>e.formatDate(t,{weekday:"narrow"}),placement:"left"})));return A.createElement(pt,{policyName:ot,policyDict:l,selector:g})};Et.displayName="SettingsExpire";const yt=(e,t)=>o.isPasswordPolicyEnforcedByAdmin(e)&&o.isExternalAudience(t),Mt=({linkPolicy:e,linkPermissions:t,getPolicyDict:a,onPolicyUpdate:n,readOnlyPolicy:i})=>{const s=a(dt),l=e.require_password?"enabled":"disabled";return A.createElement(ft,{currentValue:l,optionsDict:s.optionsDict,onOptionChange:e=>{n({require_password:e})},disabled:!o.canTogglePassword(t)||yt(t,e.audience)||i,ariaLabel:s.title})};Mt.displayName="PasswordToggle";function bt(e,t){return t.link_password||""===t.link_password?t.link_password:o.hasLinkPassword(e)?"123456":""}const St=e=>{const{intl:t,linkPolicy:n,linkPermissions:i,onPolicyUpdate:s}=e;return A.createElement("div",{className:"sharing-settings-modal__input_spacing"},A.createElement(a.TextInput,{role:"textbox",className:"password-input__input",disabled:!o.canModifyPassword(i)||e.readOnlyPolicy,placeholder:t.formatMessage({id:"um5odk",defaultMessage:"Set password"}),name:"link_password",onChange:e=>{s({[e.target.name]:e.target.value})},type:"password",isInvalid:""===n.link_password,value:bt(i,n)}))},kt=e=>{const{getPolicyDict:t,linkPolicy:a,linkPermissions:n,readOnlyPolicy:i}=e,s=t(dt),o=a.require_password||yt(n,a.audience)&&!i,l=A.createElement("div",null,A.createElement(Mt,{...e}),o&&A.createElement(St,{...e}));return A.createElement(pt,{policyName:dt,policyDict:s,selector:l})};kt.displayName="SettingsPassword";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/settings-page/internals/settings-row/settings-download.module.out-vflCxuipZ.css",(e=>"._banner_1ih4z_4{align-items:center;background-color:var(--dig-color__opacity__surface);gap:var(--dig-spacing__micro__medium)}"));function Ct(e){return Boolean(e&&e.allow_download?e.can_disallow_download:e.can_allow_download)}const Lt=e=>{const{intl:t,linkPolicy:n,linkPermissions:i}=e;return!n.allow_download&&i.can_disallow_download?A.createElement(_.Banner,{className:"_banner_1ih4z_4","data-testid":"sharing-settings-modal__banner",withLeftIcon:A.createElement(a.UIIcon,{src:a.InfoLine})},A.createElement(_.Banner.Message,null,A.createElement(a.Text,{size:"small",isBold:!0},(e=>e.formatMessage({id:"QdaCYw",defaultMessage:"This applies only within Dropbox."}))(t)))):null},vt=({linkPermissions:e,linkPolicy:t,getPolicyDict:a,onPolicyUpdate:n,onLinkClicked:i,banner:s,readOnlyPolicy:o,isEditFolderLink:l,isPaperDoc:r})=>{const d=a(lt),c=t.allow_download?"enabled":"disabled",m=l||r?void 0:A.createElement(ft,{currentValue:c,optionsDict:d.optionsDict,onOptionChange:e=>{n(lt,e)},disabled:!Ct(e)||o,ariaLabel:d.title}),g=l||r?"setting-disabled":"";return A.createElement(pt,{policyName:lt,policyDict:d,selector:m,onLinkClicked:i,extra:s,className:g})};vt.displayName="SettingsDownload";class Tt extends A.Component{constructor(e){super(e),this.handleMultiplePolicyUpdate=e=>{const t={...this.props.linkPolicy,...e};this.props.onPolicyUpdate(this.props.linkMetadata,t)},this.handlePolicyUpdate=(e,t)=>{const a={...this.props.linkPolicy,[e]:t};this.props.onPolicyUpdate(this.props.linkMetadata,a)};const{getRLPolicyDict:t}=(a=this.props.intl,{getRLPolicyDict(e,t,n,i=!1){const s="editor"===t;switch(e){case rt:return{title:s?a.formatMessage({id:"nct28+",defaultMessage:"Who has access to edit"}):a.formatMessage({id:"UPYB+9",defaultMessage:"Who has access to view"}),optionsDict:{public:{label:a.formatMessage({id:"/zG9EQ",defaultMessage:"Anyone with link"}),description:s?n?a.formatMessage({id:"Zu3WQt",defaultMessage:"Anyone with this link can edit the folder."}):i?a.formatMessage({id:"w90q8W",defaultMessage:"Anyone with this link can edit the collection."}):a.formatMessage({id:"mFcDVj",defaultMessage:"Anyone with this link can edit the file."}):n?a.formatMessage({id:"ezaRwK",defaultMessage:"Anyone with this link can view the folder."}):i?a.formatMessage({id:"uINLfI",defaultMessage:"Anyone with this link can view the collection."}):a.formatMessage({id:"plWhaX",defaultMessage:"Anyone with this link can view the file."})},team:{label:a.formatMessage({id:"Abe4xf",defaultMessage:"Team members"}),description:s?n?a.formatMessage({id:"Mug0JF",defaultMessage:"Team members with this link can edit the folder."}):i?a.formatMessage({id:"6NeGPn",defaultMessage:"Team members with this link can edit the collection."}):a.formatMessage({id:"d0xPAZ",defaultMessage:"Team members with this link can edit the file."}):n?a.formatMessage({id:"XG/OYV",defaultMessage:"Team members with this link can view the folder."}):i?a.formatMessage({id:"+fXeLg",defaultMessage:"Team members with this link can view the collection."}):a.formatMessage({id:"ErXPpA",defaultMessage:"Team members with this link can view the file."})},no_one:{label:a.formatMessage({id:"70iNCa",defaultMessage:"Only people invited"}),description:a.formatMessage({id:"CyXDsT",defaultMessage:"The link is off and does not grant additional access to anyone."})}},type:mt};case dt:return{title:a.formatMessage({id:"LqPx8N",defaultMessage:"Require password"}),optionsDict:{enabled:{label:a.formatMessage({id:"oUP+qL",defaultMessage:"On"}),value:!0},disabled:{label:a.formatMessage({id:"h58mvf",defaultMessage:"Off"}),value:!1}},type:gt};case lt:return{title:a.formatMessage({id:"7V5NRy",defaultMessage:"Allow downloads on dropbox.com"}),optionsDict:{enabled:{label:a.formatMessage({id:"EeYSnq",defaultMessage:"On"}),value:!0},disabled:{label:a.formatMessage({id:"5pmKhs",defaultMessage:"Off"}),value:!1}},type:gt};case ot:return{title:a.formatMessage({id:"hnzZgk",defaultMessage:"Set expiration"}),optionsDict:{enabled:{label:a.formatMessage({id:"J8zY2i",defaultMessage:"On"}),value:!0},disabled:{label:a.formatMessage({id:"w6dVgn",defaultMessage:"Off"}),value:!1}},type:gt};case"default":return{title:a.formatMessage({id:"LtXXzz",defaultMessage:"Default sharing settings"}),description:a.formatMessage({id:"dVXrDR",defaultMessage:"Go to account settings to set a default sharing permission"}),optionsDict:{},type:"button"};default:throw new Error("Policy name not found")}}});var a;const{link_permissions:n}=e.linkMetadata,i="folder"===e.linkMetadata.file_type,s="collection"===e.linkMetadata.file_type;this.getPolicyDict=e=>t(e,n.link_access_level,i,s)}render(){const{linkMetadata:e,linkPolicy:t,onPolicyUpdate:a,intl:n,readOnlyPolicy:i,onLinkClicked:s,...o}=this.props;return A.createElement("div",{...o},A.createElement(ht,{intl:this.props.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:i}),A.createElement(Et,{intl:this.props.intl,linkMetadata:this.props.linkMetadata,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:i}),A.createElement(kt,{intl:this.props.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:i}),A.createElement(vt,{linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handlePolicyUpdate,onLinkClicked:this.props.onLinkClicked,readOnlyPolicy:i,isPaperDoc:this.props.isPaperDoc,banner:A.createElement(Lt,{intl:this.props.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy})}))}}Tt.displayName="SettingsRighteousLinkPolicyView";const It=i.define({name:"sharing.create_shared_link_with_settings"},(e=>t=>i.handler(e.sharingAlphaCreateSharedLinkWithSettings(t)))),wt=i.define({name:"sharing.revokeSharedLink"},(e=>t=>i.handler(e.sharingRevokeSharedLink(t))));a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/settings-page/internals/link-settings/link-settings.module.out-vflNvoD_1.css",(e=>"._bannerWithRightActions_9s35h_4{align-items:center;display:flex;gap:var(--dig-spacing__micro__medium)}._bannerWithRightActions_9s35h_4>span:last-child{align-items:center;display:flex!important;justify-content:space-between;width:100%}._bannerUpsell_9s35h_17{align-items:center;border:1px solid var(--dig-color__identity__green);gap:var(--dig-spacing__micro__medium);text-align:center}._bannerMessage_9s35h_24{flex:1;margin-right:auto}._bannerActions_9s35h_29{align-items:center;display:flex!important;margin-left:auto;padding-top:0}._bannerForWarning_9s35h_36{align-items:center;background-color:var(--dig-color__warning__surface);border-radius:8px;padding:8px 12px}"));const Pt=Symbol("ON_COPY_SHARED_LINK_START"),At=Symbol("ON_COPY_SHARED_LINK_SUCCESS"),Nt=Symbol("ON_COPY_SHARED_LINK_ERROR"),Ot=Symbol("ON_VIEW_SETTINGS_PAGE"),{useEmitter:xt,defaultEmitter:$t}=r.defineLogger((async({event:e,getContextValue:t})=>{var n,i,s,o,l;const r=t(d.Context),c=t(d.Context$1),m=t(d.Context$2),g=d.getProperties(r),u=d.getProperties$1(c),p=d.getProperties$2(m),_=null!==(n=g.actionSurface)&&void 0!==n?n:"share_modal_settings",f=null!==(i=g.actionElement)&&void 0!==i?i:"copy_link_button",h=null!==(s=g.contentAction)&&void 0!==s?s:"copy_link",E="settings_screen",y={isDir:null!==(o=u.isDir)&&void 0!==o&&o,type:u.fileType,fileId:p.contentIdentifier,ext:u.fileExtension},M=null!==(l=p.contentIdentifier)&&void 0!==l?l:"unknown";if(e.key!==Pt)if(e.key!==At)if(e.key!==Nt)if(e.key!==Ot);else a.UDCL.logEvent({class:"share",action:"view",object:"share_modal_settings",properties:{actionSurface:_,actionElement:f}},{tags:{actionSurface:_,actionElement:f}});else await S.logPAPCopySharedLinkEvent({eventState:"failed",screen:E,actionSurface:_,actionElement:f,contentAction:h,requestedAccessLevel:e.payload.requestedAccessLevel,fileIdOrPath:M,content:y,hasCachedLink:e.payload.hasCachedLink,metadata:e.payload.linkMetadata,httpCode:e.payload.httpCode,exception:e.payload.exception});else await S.logPAPCopySharedLinkEvent({eventState:"success",screen:E,actionSurface:_,actionElement:f,contentAction:h,requestedAccessLevel:e.payload.requestedAccessLevel,fileIdOrPath:M,content:y,hasCachedLink:e.payload.hasCachedLink,metadata:e.payload.linkMetadata,httpCode:e.payload.httpCode});else await S.logPAPCopySharedLinkEvent({eventState:"start",screen:E,actionSurface:_,actionElement:f,contentAction:h,requestedAccessLevel:e.payload.requestedAccessLevel,fileIdOrPath:M,content:y,hasCachedLink:e.payload.hasCachedLink,metadata:e.payload.linkMetadata})})),Dt=i.define({name:"sharing.unshareFile"},(e=>t=>i.handler(e.sharingUnshareFile(t)))),Rt=i.define({name:"sharing.unshareFolder"},(e=>t=>i.handler(e.sharingUnshareFolder(t)))),Ut=({objectMetadata:e,objectIdentifier:t,contentName:o,open:l,onCancel:r,onConfirm:d,onClose:g,onObjectIdentifierChanged:u,onConfirmationModalShownChange:p,onUnshareCompleted:_})=>{const f=n.useIntl(),h=i.useEndpoint(Rt),E=i.useEndpoint(Dt),y=i.useEndpoint(c.sharingCheckJobStatus),M=i.useLogger(),[b,S]=A.useState(!1),k=i.usePlatform(),C=k!==i.Platforms.DESKTOP,L=s.useShowSharingNotifcation(),v=a.getIsFile(e)?(e=>e.formatMessage({id:"+HG1Rr",defaultMessage:"Everyone will be removed from this file. You’ll still keep a copy of this file in your Dropbox."}))(f):(e=>e.formatMessage({id:"SO6vAJ",defaultMessage:"Everyone will be removed from this folder. You’ll still keep a copy of this folder in your Dropbox."}))(f),T=A.useCallback((async n=>{var o,l;if(d(n),k!==i.Platforms.DESKTOP&&g(),L({type:s.SharingNotificationType.IN_PROGRESS,message:je(f,a.getName(e))}),"file"===t[".tag"]){M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_START",null);const n=await E({file:t.fileId});"SUCCESS"===n.status?(M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_SUCCESS",{response:n}),L({type:s.SharingNotificationType.COMPLETED,message:Ve(f,a.getName(e))})):("ERROR"===n.status?M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_ERROR",{response:n}):M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_FATAL",{response:n}),L({type:s.SharingNotificationType.FAILURE,message:Ge(f)}))}else if("shared_folder"===t[".tag"]){M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_START",null);const i=await h({shared_folder_id:t.sharedFolderId,leave_a_copy:n});if("SUCCESS"===i.status){if("complete"===i.output[".tag"])L({type:s.SharingNotificationType.COMPLETED,message:Ve(f,a.getName(e))}),M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_SUCCESS",{response:i}),await u({".tag":"file_folder",path:a.isNewApiMetadata(e)?"":null!==(o=e.path_lower)&&void 0!==o?o:"",name:a.getName(e)});else if("async_job_id"===i.output[".tag"]){const t=i.output.async_job_id;"COMPLETE"===(await s.poll((async()=>{const n={async_job_id:t},i=await y(n);return"SUCCESS"===i.status&&"in_progress"===i.output[".tag"]?{status:"RETRY"}:(L({type:s.SharingNotificationType.COMPLETED,message:Ve(f,a.getName(e))}),{status:"COMPLETE",output:i})}),{interval:1e3,timeout:18e4})).status&&(L({type:s.SharingNotificationType.COMPLETED,message:Ve(f,a.getName(e))}),M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_SUCCESS",{response:i}),await u({".tag":"file_folder",path:a.isNewApiMetadata(e)?"":null!==(l=e.path_lower)&&void 0!==l?l:"",name:a.getName(e)}))}}else"ERROR"===i.status?M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_ERROR",{response:i}):(L({type:s.SharingNotificationType.FAILURE,message:Ge(f)}),M("SHARE_MODAL_SETTINGS__UNSHARE_OBJECT_API_FATAL",{response:i}))}_(),await Promise.all([c.invalidateListSharedLinks(t),m.invalidateObjectMembers(t),s.invalidateSharingObjectMetadata(t),s.invalidateNewApiObjectMetadata(t)])}),[d,k,L,f,e,t,g,M,E,h,u,y,_]);return A.useEffect((()=>{p(l)}),[l,p]),A.createElement(a.Modal$1,{open:l,isCentered:!0,withCloseButton:C?et(f):void 0,onRequestClose:r,overlayStyles:k===i.Platforms.DESKTOP?{maxHeight:"331px"}:void 0},A.createElement(a.Modal$1.Header,{"data-sharing-sdk":"1",hasBottomSpacing:"title-standard"},A.createElement(a.Modal$1.Title,null,((e,t)=>e.formatMessage({id:"C6YnHl",defaultMessage:"Unshare “{content_name}”?"},{content_name:s.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)}))(f,o))),A.createElement(a.Modal$1.Body,{"data-sharing-sdk":"1",hasVerticalSpacing:!1},v,a.getIsSharedFolder(e)&&A.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"24px"}},A.createElement(a.Checkbox,{checked:b,onChange:()=>S(!b),style:{marginRight:"8px"}}),(e=>e.formatMessage({id:"N3y1Hr",defaultMessage:"Let removed members keep a copy of this shared folder."}))(f))),A.createElement(a.Modal$1.Footer,{"data-sharing-sdk":"1"},A.createElement(a.Button,{variant:"opacity",onClick:r,autoFocus:!0},f.formatMessage({id:"nSbXzb",defaultMessage:"Cancel"})),A.createElement(a.Button,{variant:"primary",onClick:()=>T(b)},f.formatMessage({id:"obuuKH",defaultMessage:"Unshare"}))))};Ut.displayName="UnshareConfirmationModal";const Ft=e=>i.useInitStore(e,(e=>{const t=i.proxy((()=>e.get().accessLevel)),n=i.proxy((()=>e.get().accountMetadata)),l=i.proxy((()=>e.get().compatLinkMetadata)),r=i.proxy((()=>e.get().compatLinkPolicy)),d=i.proxy((()=>e.get().linkMetadata)),c=i.proxy((()=>e.get().objectIdentifier)),m=i.proxy((()=>e.get().objectMetadata)),g=i.proxy((()=>e.get().originalCompatLinkPolicy)),u=i.proxy((()=>e.get().sharingPrefs)),p=i.proxy((()=>e.get().isSavable)),_=i.proxy((()=>e.get().isSaving)),f=i.proxy((()=>{const e=m.get(),i=t.get();return a.getCanCreateLink(e,i,n.get().is_tmr_member)})),h=i.proxy((()=>a.getCanDeleteLink(d.get()))),E=i.proxy((()=>{const e=l.get(),t=g.get();return null!==e&&null!==t&&((e,t)=>o.isReadOnlyPolicy(t,e.link_permissions))(e,t)})),y=i.proxy((()=>{const e=l.get();return null===e?null:(t=e,a.isRighteousLink(t.link_permissions));var t})),M=i.proxy((()=>n.get().is_family_user||!1)),b=i.proxy((()=>s.getIsTeam(n.get()))),S=i.proxy((()=>{var e;return null!==(e=n.get().is_freemium_team_member)&&void 0!==e&&e})),k=i.store(!1),C=i.store(!1),L=i.store(!1),v=i.store(!1),T=i.store(!1),I=i.proxy((()=>{const e=m.get(),t=d.get(),n=a.getIsFolder(e),i=a.getIsSharedFolder(e),s=a.getIsCollection(e);return a.getCanUnshareObject(e)&&(!n||i)&&null!==t&&!s}));return{$accessLevel:t,$accountMetadata:n,$compatLinkPolicy:r,$compatLinkMetadata:l,$linkMetadata:d,$objectIdentifier:c,$objectMetadata:m,$originalCompatLinkPolicy:g,$sharingPrefs:u,$isSavable:p,$isSaving:_,$canCreateLink:f,$canDeleteLink:h,$isFamilyUser:M,$isReadOnlyPolicy:E,$isRighteousLink:y,$isTeamUser:b,$isFreemiumTeamMember:S,$isConfirmationModalOpen:k,$isCreatingLink:C,$isDeletingLink:L,$isDowngradeBannerVisible:v,$shouldShowUnshare:I,$isUnshareConfirmationModalOpen:T,$props:e}})),Bt=({store:e})=>{const t=n.useIntl(),s=i.useStore(e.$isSavable),o=i.useStore(e.$isSaving),l=i.useStore(e.$isReadOnlyPolicy),r=i.useStore(e.$shouldShowUnshare),d=i.useStore(e.$objectMetadata),c=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!0)}),[e]))(e),m=(e=>A.useCallback((()=>{e.$props.get().onSave()}),[e]))(e),g=(e=>A.useCallback((()=>{e.$props.get().onCancel()}),[e]))(e);return A.createElement(A.Fragment,null,r?A.createElement(A.Fragment,null,A.createElement(a.Button,{variant:"transparent",onClick:c,"data-uxa-log":"sm24_link_settings_unshare_button"},He(t,d)),A.createElement("div",{style:{flex:1}})):null,A.createElement(a.Button,{variant:"opacity",onClick:g,"data-uxa-log":"sm24_link_settings_cancel_button"},pe(t)),A.createElement(a.Button,{variant:"primary",onClick:m,disabled:o||!s||l,"data-uxa-log":"sm24_link_settings_save_button"},o?_e(t):fe(t)))};Bt.displayName="LinkSettingsActions";const jt=({store:e})=>{const t=i.useStore(e.$objectMetadata),n=i.useStore(e.$objectIdentifier),s=i.useStore(e.$isUnshareConfirmationModalOpen),o=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!1)}),[e]))(e),l=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!1)}),[e]))(e),r=(e=>A.useCallback((()=>{e.$props.get().onUnshareCompleted()}),[e]))(e),d=(e=>A.useCallback((()=>{e.$props.get().onClose()}),[e]))(e),c=(e=>A.useCallback((async t=>{await e.$props.get().onObjectIdentifierChanged(t)}),[e]))(e),m=(e=>A.useCallback((t=>{e.$props.get().onConfirmationModalShownChange(t)}),[e]))(e);return A.createElement(Ut,{objectMetadata:t,objectIdentifier:n,contentName:a.getName(t),onConfirm:l,onCancel:o,open:s,onUnshareCompleted:r,onClose:d,onObjectIdentifierChanged:c,onConfirmationModalShownChange:m})};jt.displayName="UnshareConfirmationModalWrapper";const Vt=({store:e})=>{const t=n.useIntl(),o="editor"===i.useStore(e.$accessLevel)[".tag"]?(e=>e.formatMessage({id:"0daJiL",defaultMessage:"There isn’t a link for editing."}))(t):(e=>e.formatMessage({id:"TEAu9g",defaultMessage:"There isn’t a link for viewing."}))(t),l=i.useStore(e.$canCreateLink),r=(e=>{const t=i.useEndpoint(It),a=i.useLogger(),o=n.useIntl(),l=i.usePlatform()===i.Platforms.METASERVER,r=s.useShowSharingNotifcation();return A.useCallback((async()=>{const n=e.$accessLevel.get(),i=e.$linkMetadata.get(),d=e.$isCreatingLink.get(),c=e.$isDeletingLink.get();if(null!==i||d||c)return;a("SHARE_MODAL_SETTINGS__CREATE_LINK__CLICK",null);const m=async()=>{e.$isCreatingLink.set(!0),r({type:s.SharingNotificationType.IN_PROGRESS,message:Ne(o,n)}),a("SHARE_MODAL_SETTINGS__CREATE_LINK_API_START",null);const i=e.$objectIdentifier.get(),l=y.getContentIdOrPathFromObjectIdentifier(i),d=await t({path:l,settings:{access:n}});return await e.$props.get().onRefreshLinksMetadata(),"ERROR"===d.status?(e.$isCreatingLink.set(!1),a("SHARE_MODAL_SETTINGS__CREATE_LINK_API_ERROR",{response:d}),"shared_link_already_exists"===d.error[".tag"]?void s.close():"access_denied"===d.error[".tag"]?void r({type:s.SharingNotificationType.FAILURE,message:Oe(o,"file"===i[".tag"])}):void r({type:s.SharingNotificationType.FAILURE,message:xe(o)})):"FATAL"===d.status?(e.$isCreatingLink.set(!1),a("SHARE_MODAL_SETTINGS__CREATE_LINK_API_FATAL",{response:d}),void r({type:s.SharingNotificationType.FAILURE,message:xe(o)})):(a("SHARE_MODAL_SETTINGS__CREATE_LINK_API_SUCCESS",{response:d}),r({type:s.SharingNotificationType.COMPLETED,message:$e(o,n)}),void e.$isCreatingLink.set(!1))};l?b.showOQModalOrContinue({action:"share_link",continueCallback:m,abortCallback:()=>{e.$props.get().onClose()}}):await m()}),[e,t,o,a,l])})(e);return l?A.createElement("span",null,o,"  ",A.createElement(a.Link,{href:"#",onClick:r,"aria-label":Ee(t),display:"inline"},Ee(t))):A.createElement("span",null,(e=>e.formatMessage({id:"ZMB2hv",defaultMessage:"Link not available."}))(t))};Vt.displayName="CreateLinkSection";const Gt=({store:e})=>{const t=n.useIntl();return i.useStore(e.$isCreatingLink)?A.createElement("div",{style:{fontSize:"12px",textAlign:"center"}},(e=>e.formatMessage({id:"6WeHGE",defaultMessage:"Creating link"}))(t),"  ",A.createElement("span",{style:{display:"inline-block"}},A.createElement(V,null))):A.createElement("div",{style:{fontSize:"12px",paddingTop:"20px",paddingBottom:"20px",lineHeight:"22px",textAlign:"center"}},A.createElement(Vt,{store:e}))};Gt.displayName="EmptyLinkPolicy";const Ht=({store:e})=>{const t=n.useIntl(),o=i.useStore(e.$isConfirmationModalOpen),l=(e=>A.useCallback((()=>{e.$isConfirmationModalOpen.set(!1)}),[e]))(e),r=i.useStore(e.$objectMetadata),d=(e=>{const t=n.useIntl(),o=i.useEndpoint(wt),l=i.useLogger(),r=i.usePlatform(),d=s.useShowSharingNotifcation(),c=A.useCallback((()=>{e.$props.get().onOpenManageAccess()}),[e]);return A.useCallback((async()=>{const n=e.$linkMetadata.get(),m=e.$objectMetadata.get(),g=e.$isDeletingLink.get(),u=r===i.Platforms.DESKTOP;if(g||null===n)return;i.batch((()=>{e.$isConfirmationModalOpen.set(!1),e.$isDeletingLink.set(!0)})),d({type:s.SharingNotificationType.IN_PROGRESS,message:Ie(t,a.getName(m),u)}),l("SHARE_MODAL_SETTINGS__DELETE_LINK_API_START",null);const p=await o({url:n.url});await e.$props.get().onRefreshLinksMetadata(),"SUCCESS"===p.status?(l("SHARE_MODAL_SETTINGS__DELETE_LINK_API_SUCCESS",{response:p}),d({type:s.SharingNotificationType.COMPLETED_WITH_ACTION,message:we(t,a.getName(m),u),actionMessage:Ae(t),actionOnClick:c})):("ERROR"===p.status?l("SHARE_MODAL_SETTINGS__DELETE_LINK_API_ERROR",{response:p}):l("SHARE_MODAL_SETTINGS__DELETE_LINK_API_FATAL",{response:p}),d({type:s.SharingNotificationType.FAILURE,message:Pe(t)})),e.$isDeletingLink.set(!1)}),[e,o,l,t,r,c,d])})(e),c=i.usePlatform(),m=c!==i.Platforms.DESKTOP;return A.useEffect((()=>{e.$props.get().onConfirmationModalShownChange(o)}),[o,e.$props]),A.createElement(a.Modal$1,{open:o,isCentered:!0,withCloseButton:m?et(t):void 0,onRequestClose:l,"data-testid":"delete-confirmation-modal",overlayStyles:c===i.Platforms.DESKTOP?{maxHeight:"331px"}:void 0},A.createElement(a.Modal$1.Header,{"data-sharing-sdk":"1",hasBottomSpacing:"title-standard"},A.createElement(a.Modal$1.Title,null,t.formatMessage({id:"hAG2ph",defaultMessage:"Delete link to “{object_name}”?"},{object_name:s.Emstring.em_snippet(a.getName(r),a.SNIPPET_SIZES.FILENAME)}))),A.createElement(a.Modal$1.Body,{"data-sharing-sdk":"1",hasVerticalSpacing:!1},(e=>e.formatMessage({id:"poEviS",defaultMessage:"If you want to further restrict access, check the list of people who still have access."}))(t)),A.createElement(a.Modal$1.Footer,{"data-sharing-sdk":"1"},A.createElement(a.Button,{variant:"opacity",onClick:l,autoFocus:!0},pe(t)),A.createElement(a.Button,{variant:"primary",onClick:d},(e=>e.formatMessage({id:"2xr+8c",defaultMessage:"Delete"}))(t))))};Ht.displayName="DeleteLinkConfirmationModal";const Wt=({store:e})=>{const t=n.useIntl(),s=(e=>{const t=i.useStore(e.$accountMetadata),a=i.useStore(e.$isFamilyUser),n=i.useStore(e.$isTeamUser);return t.can_use_extended_sharing_controls||a?null:n?"/team/upgrade":t.is_paid?"/buy/professional?_tk=sg_pro_bundle_header":"/pro/try?_tk=sg_pro_bundle_header"})(e),o=((e,t)=>{const a=i.useLogger(),n=i.useOpenUrl();return A.useCallback((()=>{null!==t&&(n(t),a("SHARE_MODAL_SETTINGS__UPSELL_LINK__CLICKED",{href:t}))}),[t,a,n])})(0,s),l=i.useStore(e.$isTeamUser),r=i.useStore(e.$sharingPrefs),d=i.useStore(e.$isFreemiumTeamMember),c=i.useStore(e.$compatLinkMetadata),m=i.useStore(e.$compatLinkPolicy),g=i.useStore(e.$isRighteousLink);if(((e,t)=>{const a=i.useLogger();A.useEffect((()=>{null!==t&&a("SHARE_MODAL_SETTINGS__UPSELL_LINK__EXPOSED",{href:t})}),[t,a])})(0,s),i.usePlatform()===i.Platforms.MS_TEAMS_MOBILE)return null;if(null===s&&!d)return null;if(null===c||null===m||null===g)return null;const u=d?(e=>e.formatMessage({id:"Ujf2E1",defaultMessage:"These settings aren’t available in your current plan."}))(t):A.createElement(a.Link,{onClick:o,href:s,target:"_blank",rel:"noopener noreferrer",display:"inline"},((e,t,a)=>{const i=t?a.product_standard:a.product_professional;if("string"==typeof i){const t=n.defineMessage({id:"gh2r5j",defaultMessage:"Upgrade to {product_name} to enable all link settings."});return e.formatMessage(t,{product_name:i})}return e.formatMessage({id:"QYqjgv",defaultMessage:"Upgrade to enable all link settings."})})(t,l,r));return A.createElement("div",{style:{margin:"24px 0px",overflow:"hidden"}},A.createElement(_.Banner,{className:"_bannerUpsell_9s35h_17",withLeftIcon:A.createElement(a.UIIcon,{src:a.UpsellLine})},A.createElement(_.Banner.Message,null,A.createElement(a.Text,{size:"small",isBold:!0},u))))};Wt.displayName="LinkSettingsUpsellBanner";const qt=({store:e})=>{const t=n.useIntl(),s=i.useStore(e.$compatLinkMetadata),o=i.useStore(e.$compatLinkPolicy),l=(e=>A.useCallback(((t,n)=>{const i=e.$compatLinkPolicy.get();n.audience&&(null==i?void 0:i.audience)&&a.isLinkAudienceLowerAccess(n.audience,null==i?void 0:i.audience)&&e.$isDowngradeBannerVisible.set(!0),e.$props.get().onCompatLinkPolicyChange(n)}),[e]))(e),r=(e=>A.useCallback((t=>{e.$props.get().onLinkClicked(t)}),[e]))(e),d=i.useStore(e.$isReadOnlyPolicy),c=i.useStore(e.$isRighteousLink),m=a.getIsPaperDoc(e.$objectMetadata.get());return null===s||null===o||null===c?A.createElement(Gt,{store:e}):A.createElement(Tt,{isPaperDoc:m,linkMetadata:s,linkPolicy:o,onPolicyUpdate:l,intl:t,onLinkClicked:r,readOnlyPolicy:d,"data-testid":"righteous-link-policy"})};qt.displayName="LinkSettingsPolicies";const Yt=({store:e})=>{const t=n.useIntl(),a=i.useStore(e.$isDowngradeBannerVisible),s=(e=>A.useCallback((()=>{e.$isDowngradeBannerVisible.set(!1)}),[e]))(e),o=(e=>A.useCallback((()=>{e.$props.get().onOpenManageAccess()}),[e]))(e);return a?A.createElement("div",{style:{marginTop:"16px"}},A.createElement(H,{header:De(t),subheader:Re(t),outlineButtonLabel:Ue(t),transparentButtonLabel:Fe(t),onClickOutlineButton:s,onClickCloseButton:s,onClickTransparentButton:o,showCloseButton:!0})):null};Yt.displayName="DowngradeAudienceBanner";const Kt=({store:e})=>{const t=n.useIntl(),a=i.useStore(e.$compatLinkPolicy),s=i.useStore(e.$originalCompatLinkPolicy),l=i.useStore(e.$compatLinkMetadata);if(null===l||null===a||null===s)return null;const r=o.getLinkControlPolicyWarningText(s,a,l.link_permissions,t);return r?A.createElement("div",{style:{margin:"24px 0px",overflow:"hidden"}},A.createElement(_.Banner,{className:"_bannerForWarning_9s35h_36"},A.createElement(_.Banner.Message,null,r))):null};Kt.displayName="LinkControlPolicyWarning";const zt=({store:e})=>{const t=i.useStore(e.$linkMetadata),o=i.useStore(e.$isSavable),{onClick:l,copySuccess:r}=(e=>{const[t,n]=A.useState(!1),o=i.useLogger(),l=xt(),r=i.usePlatform()===i.Platforms.METASERVER,d=i.useStore(e.$accessLevel),c=s.useShowSharingNotifcation(),m=A.useCallback((()=>{const t=e.$linkMetadata.get(),i=e.$compatLinkMetadata.get();t&&(n(!0),c({type:s.SharingNotificationType.COMPLETED,message:k.formatSuccessMessageForUrl(t.url,d[".tag"])}),C.trackUserLeapEvent(C.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,a.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL),l.select(At).emit({requestedAccessLevel:d[".tag"],createdNewLink:!1,hasCachedLink:!0,linkMetadata:null!=i?i:void 0}),o("SHARE_MODAL_SETTINGS__COPY_LINK__COPY_SUCCESS",{linkMetadata:t}),setTimeout((()=>{n(!1)}),5e3))}),[e,l,o,d,c]),g=A.useCallback((()=>{const t=e.$linkMetadata.get(),a=e.$compatLinkMetadata.get();t&&(c({type:s.SharingNotificationType.FAILURE,message:k.formatFailErrorMessageForUrl(t.url)}),l.select(Nt).emit({requestedAccessLevel:d[".tag"],exception:L.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,hasCachedLink:!0,linkMetadata:null!=a?a:void 0}))}),[e.$linkMetadata,e.$compatLinkMetadata,c,l,d]);return{onClick:A.useCallback((t=>{t.preventDefault();const a=e.$linkMetadata.get();if(!a)return;const n=()=>{const t=e.$compatLinkMetadata.get();l.select(Pt).emit({requestedAccessLevel:d[".tag"],hasCachedLink:!0,linkMetadata:null!=t?t:void 0}),navigator.clipboard.writeText(a.url).then(m,g)};r?b.showOQModalOrContinue({action:"share_link",continueCallback:n,abortCallback:()=>{e.$props.get().onClose()}}):n()}),[e,l,d,m,g,r]),copySuccess:t}})(e),d=n.useIntl(),c=p.is_mobile_or_tablet();if(!t)return null;if(r)return A.createElement("span",{style:{display:"flex",alignItems:"center"}},A.createElement(a.Text,{variant:"label",size:"small",isBold:!0},d.formatMessage({id:"KiS7vb",defaultMessage:"Link copied!"})));const m=A.createElement(a.Text,{size:"small"},A.createElement(a.Link,{href:"#",onClick:l,style:{fontSize:"12px",display:"flex",alignItems:"center",gap:"4px",margin:c?"8px":"0px"},"aria-label":d.formatMessage({id:"D/HxHm",defaultMessage:"Copy link"}),hasNoUnderline:!0,isBold:!0,display:"inline"},A.createElement(a.UIIcon,{src:I.LinkLine,size:"medium","aria-hidden":!0}),c?void 0:d.formatMessage({id:"D/HxHm",defaultMessage:"Copy link"})));return o?A.createElement(a.Tooltip,{title:d.formatMessage({id:"Nwdnda",defaultMessage:"Save your changes to copy a link with these settings."}),placement:"bottom"},A.createElement("span",{style:{fontSize:"12px"}},m)):m};zt.displayName="CopyLinkAction";const Xt=({store:e})=>{const t=i.useStore(e.$linkMetadata),s=(e=>A.useCallback((()=>{e.$isConfirmationModalOpen.set(!0),e.$props.get().onConfirmationModalShownChange(!0)}),[e]))(e),o=n.useIntl(),l=e.$canDeleteLink.get(),r=p.is_mobile_or_tablet();return t&&l?A.createElement(a.Button,{variant:"transparent",style:{margin:r?"8px":"0px",display:"flex",alignItems:"center",gap:"4px"},size:"small",onClick:s,"aria-label":he(o),hasNoUnderline:r,"data-uxa-log":"sm24_link_settings_delete_link_button"},r?A.createElement(a.UIIcon,{src:a.DeleteLine,size:"medium","aria-hidden":!0,color:"var(--dig-color__alert__base)"}):he(o)):null};Xt.displayName="DeleteLinkAction";const Zt=({store:e})=>{const t=n.useIntl(),s=i.useStore(e.$accessLevel),o=i.useStore(e.$linkMetadata),l=p.is_mobile_or_tablet();return A.createElement("div",{style:{marginTop:"2em",marginBottom:"24px"}},A.createElement(f.CardNamespace,{hasBorders:!1},o?A.createElement(_.Banner,{className:"_bannerWithRightActions_9s35h_4",withLeftIcon:"editor"===s[".tag"]?A.createElement(a.UIIcon,{src:v.EditLine,"aria-label":"Edit link icon","aria-hidden":!0}):A.createElement(a.UIIcon,{src:T.ShowLine,"aria-label":"View link icon","aria-hidden":!0})},A.createElement(_.Banner.Message,{className:"_bannerMessage_9s35h_24"},A.createElement(a.Box,{display:"flex",alignItems:"center",style:{gap:"8px"}},A.createElement(a.Text,{size:"small",isBold:!0},"editor"===s[".tag"]?(e=>e.formatMessage({id:"s5wejr",defaultMessage:"People with this link can edit"}))(t):(e=>e.formatMessage({id:"OrDD0F",defaultMessage:"People with this link can view"}))(t)),l?void 0:A.createElement(zt,{store:e}))),A.createElement(_.Banner.Actions,{className:"_bannerActions_9s35h_29"},l?A.createElement(zt,{store:e}):void 0,A.createElement(Xt,{store:e}))):void 0,A.createElement(qt,{store:e})))};Zt.displayName="LinkSettingsBody";const Jt=e=>{const t=Ft(e),n=i.usePlatform()===i.Platforms.DESKTOP;return A.createElement(A.Fragment,null,A.createElement(a.Modal$1.Body,null,A.createElement("div",{style:n?{minHeight:"130px"}:void 0},A.createElement(Wt,{store:t}),A.createElement(Kt,{store:t}),A.createElement(Yt,{store:t}),A.createElement(Zt,{store:t}),A.createElement(Ht,{store:t}),A.createElement(jt,{store:t}))),A.createElement(a.Modal$1.Footer,null,A.createElement(Bt,{store:t})))};Jt.displayName="LinkSettings";const Qt=i.define({name:"sharing.updateFilePolicy"},(e=>t=>i.handler(e.sharingAlphaUpdateFilePolicy(t)))),ea=i.define({name:"sharing.updateFolderPolicy"},(e=>t=>i.handler(e.sharingAlphaUpdateFolderPolicyV2(t)))),ta=(e,t)=>t?e.formatMessage({id:"/YIKIw",defaultMessage:"Show who can view to team members and people who can edit."}):e.formatMessage({id:"gwtTsq",defaultMessage:"Show who can view to people who can edit."}),aa=e=>({getPolicyDict(t,n){switch(t){case nt:return{title:e.formatMessage({id:"sqWIHr",defaultMessage:"Who can be added as a member"}),optionsDict:{anyone:{label:e.formatMessage({id:"fCoK4r",defaultMessage:"Anyone"})},team_and_approved:{label:e.formatMessage({id:"iUy29B",defaultMessage:"Team + approved"})},team:{label:e.formatMessage({id:"7OP28A",defaultMessage:"Only team members"})}},type:mt};case it:return{title:e.formatMessage({id:"FNEmDZ",defaultMessage:"Viewer info"}),description:ta(e,a.getOwnerTeam(n)),optionsDict:{enabled:{label:e.formatMessage({id:"2QJJN/",defaultMessage:"On"}),value:!0},disabled:{label:e.formatMessage({id:"bxF53X",defaultMessage:"Off"}),value:!1}},type:gt};case ct:return{title:e.formatMessage({id:"eX+ViB",defaultMessage:"Manage who can add people"}),optionsDict:{editors:{label:a.getIsTeamFolderTree(n)||a.getIsTeamMemberFolder(n)?e.formatMessage({id:"FSMn0f",defaultMessage:"Team members who can edit"}):e.formatMessage({id:"Y/OGdX",defaultMessage:"Folder members"}),description:a.getIsTeamFolderTree(n)||a.getIsTeamMemberFolder(n)?e.formatMessage({id:"uIRufc",defaultMessage:"Team members with edit access can add people."}):e.formatMessage({id:"fFxXXV",defaultMessage:"Members with edit access can add people."})},owner:{label:a.getIsTeamFolderTree(n)?e.formatMessage({id:"WFlZYD",defaultMessage:"Only Team Admins"}):e.formatMessage({id:"S2dbUj",defaultMessage:"Only the owner"}),description:a.getIsTeamFolderTree(n)?e.formatMessage({id:"SQ8IGZ",defaultMessage:"Only Team Admins."}):e.formatMessage({id:"FXj04X",defaultMessage:"Only the owner can add people."})}},type:mt};case st:if(!a.getOwnerTeam(n))throw new Error("Policy only valid for teams");return"team"===a.getLinkAudiencePolicy(n)?((e,t)=>{if(!t)throw new Error("Policy only valid for teams");return{title:e.formatMessage({id:"2/keN+",defaultMessage:"Link restrictions"}),description:e.formatMessage({id:"hQVplF",defaultMessage:"Limits who can access this folder via a link."}),optionsDict:{anyone:{label:e.formatMessage({id:"M2hohn",defaultMessage:"No restrictions"}),description:e.formatMessage({id:"VWGUB4",defaultMessage:"Show all access options for links."})},members:{label:e.formatMessage({id:"fJsIEz",defaultMessage:"Invite-only"}),description:e.formatMessage({id:"w/Er4c",defaultMessage:"Show “Only invited members” only."})},team:{label:e.formatMessage({id:"BhDP0/",defaultMessage:"Team only"}),description:e.formatMessage({id:"p/lywD",defaultMessage:"Show “Only people at {team_name}”."},{team_name:s.Emstring.em_snippet(t.name,12)})}},type:mt}})(e,a.getOwnerTeam(n)):{title:e.formatMessage({id:"rAsVLm",defaultMessage:"Link restrictions"}),description:e.formatMessage({id:"dto0Cn",defaultMessage:"Prevent non-members from accessing this folder by link."}),optionsDict:{members:{label:e.formatMessage({id:"Vz90Vu",defaultMessage:"On"}),value:!0},anyone:{label:e.formatMessage({id:"lcDiuF",defaultMessage:"Off"}),value:!1}},type:gt};default:throw new Error("Policy name not found")}}}),na=({intl:e,currentPolicy:t,resolvedMemberPolicy:a,onPolicyChange:n,disabled:i,objectMetadata:s})=>{const o=aa(e).getPolicyDict(st,s),l=o.optionsDict,r="team"===a?A.createElement(O,{currentValue:t,optionsDict:l,valuesList:Object.keys(l),onValueSelected:e=>{n(e)},disabled:i,ariaLabel:o.title}):A.createElement(ft,{currentValue:t,optionsDict:l,onOptionChange:e=>{n(e?"members":"anyone")},disabled:i,ariaLabel:o.title});return A.createElement(pt,{policyName:st,policyDict:o,selector:r})};na.displayName="SettingsLinkAudiencePolicy";const ia=({intl:e,currentPolicy:t,onPolicyChange:n,objectMetadata:i,disabled:s})=>{let o=aa(e).getPolicyDict(nt,i);const l=a.getOwnerTeamPolicies(i),r=null==l?void 0:l.shared_folder_member_policy;o={...o,optionsDict:Object.fromEntries(Object.entries(o.optionsDict).filter((([e])=>(e=>{const a=["anyone","team_and_approved","team"];if(t===e)return!0;if(r){const t=r[".tag"];return a.indexOf(e)>=a.indexOf(t)}return!1})(e)&&(e=>"team_and_approved"!==e||"team_and_approved"===t||"team_and_approved"===(null==r?void 0:r[".tag"]))(e))))};const d=A.createElement(O,{currentValue:t,optionsDict:o.optionsDict,valuesList:Object.keys(o.optionsDict),onValueSelected:e=>{const t=a.create(e);n(t)},disabled:s,ariaLabel:o.title});return A.createElement(pt,{policyName:nt,policyDict:o,selector:d})};ia.displayName="SettingsMemberPolicy";const sa=({intl:e,currentPolicy:t,onPolicyChange:n,objectMetadata:i,disabled:s})=>{const o=aa(e).getPolicyDict(ct,i),l=A.createElement(O,{currentValue:t,optionsDict:o.optionsDict,valuesList:Object.keys(o.optionsDict),onValueSelected:e=>{const t=a.create(e);n(t)},disabled:s,ariaLabel:o.title});return A.createElement(pt,{policyName:ct,policyDict:o,selector:l})};sa.displayName="SettingsACLUpdatePolicy";const oa=({intl:e,isPolicyEnabled:t,canDisableViewerInfo:a,canEnableViewerInfo:n,onPolicyChange:i,objectMetadata:s})=>{const o=aa(e).getPolicyDict(it,s),l=t?"enabled":"disabled",r=t?a:n,d=A.createElement(ft,{currentValue:l,optionsDict:o.optionsDict,onOptionChange:e=>{i(e)},disabled:!r,ariaLabel:o.title});return A.createElement(pt,{policyName:it,policyDict:o,selector:d})};oa.displayName="SettingsViewerInfo";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/settings-page/internals/object-settings/object-settings.module.out-vfl-QU6B_.css",(e=>"._banner_wevur_4{align-items:center;background-color:var(--dig-color__opacity__surface);gap:var(--dig-spacing__micro__medium)}"));const la="_banner_wevur_4",ra=({store:e})=>{const{msg:t,bannerType:s}=(e=>{const t=n.useIntl(),s=i.useStore(e.$canChangeOptions),o=i.useStore(e.$viewerInfoPolicyEnabled),l=i.useStore(e.$objectMetadata);return A.useMemo((()=>{if(s)return{msg:Te(t),bannerType:"default"};let e;if(o){const t=a.getPermissionInfo(l,a.DISABLE_VIEWER_INFO_TAG);e=t?t.reason:""}else{const t=a.getPermissionInfo(l,a.ENABLE_VIEWER_INFO_TAG);e=t?t.reason:""}switch(e){case"restricted_by_parent_folder":return{msg:Ce(t),bannerType:"error"};case"restricted_by_team":return{msg:Le(t),bannerType:"error"};default:return{msg:ve(t),bannerType:"error"}}}),[s,o,l,t])})(e);return A.createElement("div",{style:{margin:"24px 0px",overflow:"hidden"}},A.createElement(_.Banner,{className:la,"data-testid":"file-settings-banner",withLeftIcon:"error"===s?A.createElement(a.UIIcon,{src:a.FailLine}):A.createElement(a.UIIcon,{src:a.InfoLine})},A.createElement(_.Banner.Message,null,A.createElement(a.Text,{size:"small",isBold:!0},t))))};ra.displayName="FileSettingsBanner";const da=({store:e})=>{const t=(e=>{const t=n.useIntl(),o=i.useStore(e.$canChangeOptions),l=i.useStore(e.$objectMetadata),r=i.useStore(e.$accountMetadata),d=i.useOpenUrl(),{isNonUserRelativeContext:c}=w.useSharingApiContext();return A.useMemo((()=>{const e=r.team_id===a.getOwnerTeamId(l);return c&&a.getIsInsideTeamFolderTree(l)?{msg:We(t,a.getName(l))}:a.getIsTeamSharedFolder(l)&&e?s.getIsTeamAdmin(r)?{msg:qe(t,a.getName(l)),actionMsg:Ye(t,d)}:{msg:Ke(t,a.getName(l)),actionMsg:ze(t,d)}:a.getIsInsideTeamFolderTree(l)?s.getIsTeamAdmin(r)?{msg:We(t,a.getName(l))}:e?{msg:Ke(t,a.getName(l)),actionMsg:ze(t,d)}:{msg:Je(t,a.getName(l))}:o?c&&!a.getIsInsideTeamFolderTree(l)?{msg:Xe(t)}:void 0:{msg:Je(t,a.getName(l))}}),[r,l,c,o,t,d])})(e),o=(e=>{const t=n.useIntl(),o=i.useStore(e.$canChangeOptions),l=i.useStore(e.$objectMetadata),r=i.useStore(e.$accountMetadata),d=A.useMemo((()=>s.convertAccountMetadataToUser(r)),[r]);return A.useMemo((()=>{if(o&&!d.is_team_admin)return a.getIsInsideTeamFolderTree(l)?{msg:Qe(t),bannerType:"error"}:a.getIsOwner(l)?{msg:Ze(t,a.getName(l))}:{msg:Je(t,a.getName(l))}}),[o,d.is_team_admin,l,t])})(e);return A.createElement("div",{style:{margin:"24px 0px",borderRadius:"12px",overflow:"hidden"}},t&&A.createElement(_.Banner,{className:la,"data-testid":"folder-settings-banner",withLeftIcon:A.createElement(a.UIIcon,{src:a.InfoLine})},A.createElement(_.Banner.Message,null,A.createElement(a.Text,{size:"small",isBold:!0},t.msg)),A.createElement(_.Banner.Actions,null,t.actionMsg)),o&&A.createElement(_.Banner,{className:la,"data-testid":"folder-settings-banner",withLeftIcon:"error"===(null==o?void 0:o.bannerType)?A.createElement(a.UIIcon,{src:a.FailLine}):A.createElement(a.UIIcon,{src:a.InfoLine})},A.createElement(_.Banner.Message,null,A.createElement(a.Text,{size:"small",isBold:!0},o.msg))))};da.displayName="FolderSettingsBanner";const ca=e=>A.useCallback((t=>{e.$viewerInfoPolicyEnabledUpdated.set(t)}),[e]),ma=({store:e})=>{const t=n.useIntl(),s=i.useStore(e.$objectMetadata),o=i.useStore(e.$viewerInfoPolicyEnabledUpdated),l=i.useStore(e.$memberPolicyUpdated),r=i.useStore(e.$aclUpdatePolicyUpdated),d=i.useStore(e.$linkAudiencePolicyUpdated),c=i.useStore(e.$resolvedMemberPolicy),m=i.useStore(e.$canDisableViewerInfo),g=i.useStore(e.$canEnableViewerInfo),u=i.useStore(e.$canChangeOptions),p="members"===i.useStore(e.$blanketLinkRestrictionsPolicy),_=i.useStore(e.$isFreemiumTeamMember),f=ca(e),h=(e=>A.useCallback((t=>{e.$memberPolicyUpdated.set(t[".tag"])}),[e]))(e),E=(e=>A.useCallback((t=>{e.$aclUpdatePolicyUpdated.set(t[".tag"])}),[e]))(e),y=(e=>A.useCallback((t=>{e.$linkAudiencePolicyUpdated.set(t)}),[e]))(e);return A.createElement("div",{style:{marginTop:"24px",marginBottom:"24px"}},a.getOwnerTeam(s)&&A.createElement(ia,{intl:t,currentPolicy:l,objectMetadata:s,onPolicyChange:h,disabled:!u}),A.createElement(sa,{intl:t,currentPolicy:r,objectMetadata:s,onPolicyChange:E,disabled:!u}),a.getOwnerTeam(s)&&A.createElement(na,{intl:t,currentPolicy:d,resolvedMemberPolicy:c,onPolicyChange:y,disabled:!u||p||_,objectMetadata:s}),A.createElement(oa,{intl:t,isPolicyEnabled:o,canDisableViewerInfo:m,canEnableViewerInfo:g,onPolicyChange:f,objectMetadata:s}))};ma.displayName="FolderSettingsPolicies";const ga=({store:e})=>{const t=n.useIntl(),a=i.useStore(e.$objectMetadata),s=i.useStore(e.$viewerInfoPolicyEnabledUpdated),o=i.useStore(e.$canDisableViewerInfo),l=i.useStore(e.$canEnableViewerInfo),r=ca(e);return A.createElement("div",{style:{marginTop:"24px",marginBottom:"24px"}},A.createElement(oa,{intl:t,isPolicyEnabled:s,canDisableViewerInfo:o,canEnableViewerInfo:l,objectMetadata:a,onPolicyChange:r}))};ga.displayName="FileSettingsPolicies";const ua=e=>A.useCallback((()=>e.$props.get().onRefreshModal()),[e]),pa=({store:e})=>{const t=n.useIntl(),o=(e=>A.useCallback((()=>{e.$props.get().onCancelled()}),[e]))(e),l=i.useStore(e.$isSubmitting),r=i.useStore(e.$hasPolicyChanged),d=i.useStore(e.$shouldShowUnshare),c=i.useStore(e.$objectMetadata),m=i.useStore(e.$isUnshareDisabled),g=a.getIsFolder(c),u=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!0)}),[e]))(e),p=(e=>{const t=n.useIntl(),o=i.useEndpoint(Qt),l=i.useEndpoint(ea),r=i.useEndpoint(s.shareFolder),d=i.useEndpoint(s.checkShareInternalJobStatus),c=i.useLogger(),m=ua(e),g=s.useShowSharingNotifcation();return A.useCallback((async()=>{var n;if(e.$hasPolicyChanged.get()){const i=e.$objectMetadata.get();let u=e.$objectIdentifier.get();if("file_folder"===u[".tag"]){e.$isSubmitting.set(!0);const a={path:u.path};g({type:s.SharingNotificationType.IN_PROGRESS,message:be(t)});const i=await r(a);let o=u;if("SUCCESS"===i.status){if("complete"===i.output[".tag"])o={".tag":"shared_folder",sharedFolderId:i.output.shared_folder_id},await e.$props.get().onObjectIdentifierChanged(o);else if("async_job_id"===i.output[".tag"]){const t=i.output.async_job_id,a=await s.poll((async()=>{const e={async_job_id:t},a=await d(e);return"SUCCESS"===a.status&&"in_progress"===a.output[".tag"]?{status:"RETRY"}:{status:"COMPLETE",output:a}}),{interval:1e3,timeout:3e4});"COMPLETE"===a.status&&"SUCCESS"===(null===(n=a.output)||void 0===n?void 0:n.status)&&"complete"===a.output.output[".tag"]&&(o={".tag":"shared_folder",sharedFolderId:a.output.output.shared_folder_id},await e.$props.get().onObjectIdentifierChanged(o))}}else"ERROR"===i.status&&("bad_path"===i.error[".tag"]&&"already_shared"===i.error.bad_path[".tag"]?(o={".tag":"shared_folder",sharedFolderId:i.error.bad_path.shared_folder_id},await e.$props.get().onObjectIdentifierChanged(o)):"no_permission"===i.error[".tag"]&&(e.$isSubmitting.set(!1),g({type:s.SharingNotificationType.FAILURE,message:Se(t)})));await s.invalidateSharingObjectMetadata(o),await s.invalidateNewApiObjectMetadata(o),u=o}if(a.getIsFile(i)){e.$isSubmitting.set(!0),c("SHARE_MODAL_SETTINGS__FILE_POLICY_UPDATE_API_START",null);const n=await o({file:a.isNewApiMetadata(i)?"":i.id,actions:[a.CHANGE_OPTIONS_TAG,a.CREATE_VIEW_LINK_TAG,a.CREATE_EDIT_LINK_TAG,a.DISABLE_VIEWER_INFO_TAG,a.ENABLE_VIEWER_INFO_TAG,a.INVITE_VIEWER_TAG,a.INVITE_EDITOR_TAG,a.INVITE_VIEWER_NO_COMMENT_TAG,a.RELINQUISH_MEMBERSHIP_TAG,a.REMOVE_DOWNLOAD_POLICY_TAG,a.SET_DOWNLOAD_POLICY_TAG,a.UNSHARE_TAG,a.SHARE_MESSAGE_AS_COMMENT_TAG],viewer_info_policy:e.$viewerInfoPolicyEnabledUpdated.get()?{".tag":"enabled"}:{".tag":"disabled"}});await Promise.resolve(e.$props.get().onRefreshObjectMetadata()),"SUCCESS"===n.status?(c("SHARE_MODAL_SETTINGS__FILE_POLICY_UPDATE_API_SUCCESS",null),g({type:s.SharingNotificationType.COMPLETED,message:Me(t)}),e.$isSubmitting.set(!1),e.$props.get().onSaved()):("ERROR"===n.status?c("SHARE_MODAL_SETTINGS__FILE_POLICY_UPDATE_API_ERROR",{error:n.error}):c("SHARE_MODAL_SETTINGS__FILE_POLICY_UPDATE_API_FATAL",{error:n.error}),g({type:s.SharingNotificationType.FAILURE,message:ye(t)}),e.$isSubmitting.set(!1))}else if("shared_folder"===u[".tag"]){e.$isSubmitting.set(!0),c("SHARE_MODAL_SETTINGS__FOLDER_POLICY_UPDATE_API_START",null);const n=await l({shared_folder_id:u.sharedFolderId,actions:[a.CHANGE_OPTIONS_TAG,a.DISABLE_VIEWER_INFO_TAG,a.ENABLE_VIEWER_INFO_TAG,a.INVITE_VIEWER_TAG,a.INVITE_EDITOR_TAG,a.INVITE_VIEWER_NO_COMMENT_TAG,a.RELINQUISH_MEMBERSHIP_TAG,a.REMOVE_DOWNLOAD_POLICY_TAG,a.SET_DOWNLOAD_POLICY_TAG,a.UNSHARE_TAG],viewer_info_policy:e.$viewerInfoPolicyEnabledUpdated.get()?{".tag":"enabled"}:{".tag":"disabled"},member_policy:a.getOwnerTeam(i)?{".tag":e.$memberPolicyUpdated.get()}:void 0,shared_link_policy:{".tag":e.$linkAudiencePolicyUpdated.get()},acl_update_policy:{".tag":e.$aclUpdatePolicyUpdated.get()}});await s.invalidateSharingObjectMetadata(u),await s.invalidateNewApiObjectMetadata(u),"SUCCESS"===n.status?(c("SHARE_MODAL_SETTINGS__FOLDER_POLICY_UPDATE_API_SUCCESS",null),g({type:s.SharingNotificationType.COMPLETED,message:ke(t)}),e.$isSubmitting.set(!1),e.$props.get().onSaved(),await Promise.resolve(m())):("ERROR"===n.status?c("SHARE_MODAL_SETTINGS__FOLDER_POLICY_UPDATE_API_ERROR",{error:n.error}):c("SHARE_MODAL_SETTINGS__FOLDER_POLICY_UPDATE_API_FATAL",{error:n.error}),g({type:s.SharingNotificationType.FAILURE,message:ye(t)}),e.$isSubmitting.set(!1))}}}),[e,o,l,c,t,m,r,d,g])})(e);return A.createElement(A.Fragment,null,d?A.createElement(A.Fragment,null,m?A.createElement(a.Tooltip,{title:g?at(t):tt(t),placement:"right",maxWidth:125,"data-testid":"unshare-tooltip"},A.createElement(a.Box,{style:{marginLeft:0,marginRight:"auto"}},A.createElement(a.Button,{variant:"transparent",onClick:u,disabled:m,"data-uxa-log":"sm24_object_settings_unshare_button"},He(t,c)))):A.createElement(a.Button,{variant:"transparent",onClick:u,disabled:m,"data-uxa-log":"sm24_object_settings_unshare_button"},He(t,c)),A.createElement("div",{style:{flex:1}})):null,A.createElement(a.Button,{variant:"opacity",onClick:o,"data-uxa-log":"sm24_object_settings_cancel_button"},pe(t)),A.createElement(a.Button,{variant:"primary",disabled:!r||l,onClick:p,"data-uxa-log":"sm24_object_settings_save_button"},l?_e(t):fe(t)))};pa.displayName="ObjectSettingsActions";const _a=({store:e})=>{const t=i.useStore(e.$objectMetadata),n=i.useStore(e.$objectIdentifier),s=i.useStore(e.$isUnshareConfirmationModalOpen),o=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!1)}),[e]))(e),l=(e=>A.useCallback((()=>{e.$isUnshareConfirmationModalOpen.set(!1)}),[e]))(e),r=(e=>A.useCallback((()=>{e.$props.get().onUnshareCompleted()}),[e]))(e),d=(e=>A.useCallback((()=>{e.$props.get().onClose()}),[e]))(e),c=(e=>A.useCallback((async t=>{await e.$props.get().onObjectIdentifierChanged(t)}),[e]))(e),m=(e=>A.useCallback((t=>{e.$props.get().onConfirmationModalShownChange(t)}),[e]))(e);return A.createElement(Ut,{objectMetadata:t,objectIdentifier:n,contentName:a.getName(t),onConfirm:l,onCancel:o,open:s,onUnshareCompleted:r,onClose:d,onObjectIdentifierChanged:c,onConfirmationModalShownChange:m})};_a.displayName="UnshareConfirmationModalWrapper";const fa=e=>{const t=(e=>i.useInitStore(e,(e=>{const t=i.proxy((()=>e.get().objectIdentifier)),n=i.proxy((()=>e.get().objectMetadata)),s=i.proxy((()=>e.get().accountMetadata)),o=i.proxy((()=>e.get().linksMetadata)),l=i.proxy((()=>e.get().members)),r=i.proxy((()=>a.getIsFolder(n.get()))),d=i.store(!1),c=i.proxy((()=>a.getCanChangeOptions(n.get()))),m=i.proxy((()=>a.getCanEnableViewerInfo(n.get()))),g=i.proxy((()=>a.getCanDisableViewerInfo(n.get()))),u=i.proxy((()=>a.getLinkAudiencePolicy(n.get()))),p=i.proxy((()=>a.getViewerInfoPolicyEnabled(n.get()))),_=i.store(p.get()),f=i.proxy((()=>a.getOwnerTeamPolicies(n.get()))),h=i.proxy((()=>{var e;return null===(e=f.get())||void 0===e?void 0:e.shared_folder_link_restriction_policy[".tag"]})),E=i.proxy((()=>"members"===h.get()?"members":a.getLinkAudiencePolicy(n.get()))),y=i.store(E.get()),M=i.proxy((()=>a.getMemberPolicy(n.get()))),b=i.store(M.get()),S=i.proxy((()=>a.getAclUpdatePolicy(n.get()))),k=i.store(S.get()),C=i.proxy((()=>p.get()!==_.get()||M.get()!==b.get()||S.get()!==k.get()||E.get()!==y.get())),L=i.proxy((()=>{var e;const t=n.get(),i=a.getPermissionInfo(t,a.UNSHARE_TAG),s=a.getIsFolder(t),o=a.getIsSharedFolder(t),l=a.getIsCollection(t),r=a.getCanUnshareObject(t),d=s&&!r&&"folder_is_inside_shared_folder"===(null===(e=null==i?void 0:i.reason)||void 0===e?void 0:e[".tag"]);return r&&(!s||o)&&!l||d})),v=i.proxy((()=>{var e;const t=o.get(),i=l.get(),r=n.get(),d=a.getIsFolder(r),c=0!==t.links.length;if(!d&&!c){const e=i.invitees.length+i.groups.length+i.users.length;if(!e)return!0;if(1===e&&1===i.users.length){const e=i.users[0],t=s.get();return e.user.account_id===t.account_id}return!1}if(d){const t=a.getPermissionInfo(r,a.UNSHARE_TAG);return"folder_is_inside_shared_folder"===(null===(e=null==t?void 0:t.reason)||void 0===e?void 0:e[".tag"])}return!1})),T=i.store(!1),I=i.proxy((()=>{var e;return null!==(e=s.get().is_freemium_team_member)&&void 0!==e&&e}));return{$objectIdentifier:t,$objectMetadata:n,$accountMetadata:s,$linksMetadata:o,$members:l,$canChangeOptions:c,$isSubmitting:d,$resolvedMemberPolicy:u,$viewerInfoPolicyEnabled:p,$isFolder:r,$viewerInfoPolicyEnabledUpdated:_,$memberPolicy:M,$memberPolicyUpdated:b,$aclUpdatePolicy:S,$aclUpdatePolicyUpdated:k,$linkAudiencePolicy:E,$linkAudiencePolicyUpdated:y,$canEnableViewerInfo:m,$canDisableViewerInfo:g,$hasPolicyChanged:C,$isUnshareConfirmationModalOpen:T,$shouldShowUnshare:L,$blanketLinkRestrictionsPolicy:h,$isUnshareDisabled:v,$isFreemiumTeamMember:I,$props:e}})))(e),n=t.$isFolder.get(),s=i.usePlatform()===i.Platforms.DESKTOP;return A.createElement(A.Fragment,null,A.createElement(a.Modal$1.Body,null,A.createElement("div",{style:s?{minHeight:"130px"}:void 0},n?A.createElement(A.Fragment,null,A.createElement(da,{store:t}),A.createElement(ma,{store:t})):A.createElement(A.Fragment,null,A.createElement(ra,{store:t}),A.createElement(ga,{store:t})))),A.createElement(a.Modal$1.Footer,null,A.createElement(pa,{store:t})),A.createElement(_a,{store:t}))};fa.displayName="ObjectSettings";const ha={".tag":"editor"},Ea={".tag":"viewer"},ya="object_settings",Ma="edit_link_settings",ba="view_link_settings",Sa=e=>{const t=n.useIntl(),a=i.useLogger(),o=i.useEndpoint(le),l=s.useShowSharingNotifcation();return A.useCallback((async()=>{if(!e.$hasUnsavedLinkChanges.get())return!0;let n=null;const i=e.$viewLinkCompatMetadata.get(),r=e.$viewLinkCompatPolicy.get(),d=e.$viewLinkCompatPolicyDraft.get();null!==i&&null!==r&&null!==d&&(n=de(t,i,r,d));let c=null;const m=e.$editLinkCompatMetadata.get(),g=e.$editLinkCompatPolicy.get(),u=e.$editLinkCompatPolicyDraft.get();if(null!==m&&null!==g&&null!==u&&(c=de(t,m,g,u)),n&&"error"in n)return l({type:s.SharingNotificationType.FAILURE,message:n.error}),!1;if(c&&"error"in c)return l({type:s.SharingNotificationType.FAILURE,message:c.error}),!1;const p=[...null===n?[]:[n],...null===c?[]:[c]];if(0===p.length)return e.$editLinkCompatPolicyDraft.set(null),e.$viewLinkCompatPolicyDraft.set(null),!0;e.$isUpdatingLinkSettings.set(!0),n&&r&&d&&r.audience&&d.audience&&r.audience!==d.audience&&a("SHARE_MODAL_SETTINGS__LINK_AUDIENCE_CHANGE",{link_access_level:Ea,previous:re(r.audience),next:re(d.audience)}),c&&g&&u&&g.audience&&u.audience&&g.audience!==u.audience&&a("SHARE_MODAL_SETTINGS__LINK_AUDIENCE_CHANGE",{link_access_level:ha,previous:re(g.audience),next:re(u.audience)});const _=await Promise.all([...p.map((e=>o((e=>{const t={url:e.url,remove_expiration:e.remove_expiration,settings:{}};return e.settings.access&&(t.settings.access={".tag":e.settings.access}),void 0!==e.settings.allow_download&&(t.settings.allow_download=e.settings.allow_download),e.settings.audience&&(t.settings.audience={".tag":e.settings.audience}),e.settings.expires&&(t.settings.expires=e.settings.expires),e.settings.link_password&&(t.settings.link_password=e.settings.link_password),void 0!==e.settings.require_password&&(t.settings.require_password=e.settings.require_password),t})(e))))]);return await e.$props.get().onRefreshLinksMetadata(),e.$isUpdatingLinkSettings.set(!1),_.every((e=>"SUCCESS"===e.status))?(e.$editLinkCompatPolicyDraft.set(null),e.$viewLinkCompatPolicyDraft.set(null),l({type:s.SharingNotificationType.COMPLETED,message:Be(t)}),!0):(l({type:s.SharingNotificationType.FAILURE,message:xe(t)}),!1)}),[e,t,o,a,l])},ka=e=>A.useCallback((async()=>{await e.$props.get().onRefreshObjectMetadata()}),[e]),Ca=e=>A.useCallback((async()=>{await e.$props.get().onRefreshModal()}),[e]),La=e=>A.useCallback((async t=>{await e.$props.get().onObjectIdentifierChanged(t)}),[e]),va=e=>A.useCallback((async()=>{e.$editLinkCompatPolicyDraft.set(null),e.$viewLinkCompatPolicyDraft.set(null),await e.$props.get().onRefreshLinksMetadata()}),[e]),Ta=e=>{const t=Sa(e);return A.useCallback((async()=>{await t()&&e.$props.get().onManageLinkAccess()}),[e,t])},Ia=e=>{const t=Sa(e);return A.useCallback((async()=>{await t()}),[t])},wa=e=>A.useCallback((()=>{e.$props.get().onCancel(!0)}),[e]),Pa=e=>A.useCallback((t=>{e.$props.get().onConfirmationModalShownChange(t)}),[e]),Aa=e=>{const t=i.useOpenUrl();return A.useCallback((e=>{t(e)}),[t])},Na=e=>A.useCallback((()=>{e.$props.get().onClose()}),[e]),Oa=e=>A.useCallback((()=>{e.$props.get().onUnshareCompleted()}),[e]),xa=(e,t)=>A.useCallback((a=>{"editor"===t[".tag"]?e.$editLinkCompatPolicyDraft.set(a):"viewer"===t[".tag"]&&e.$viewLinkCompatPolicyDraft.set(a)}),[e,t]),$a=({store:e})=>{const t=i.useStore(e.$objectIdentifier),a=i.useStore(e.$objectMetadata),n=i.useStore(e.$accountMetadata),s=i.useStore(e.$linksMetadata),o=i.useStore(e.$members),l=Oa(e),r=(e=>A.useCallback((()=>{e.$props.get().onCancel(!1)}),[e]))(e),d=(e=>A.useCallback((()=>{e.$props.get().onComplete(!1)}),[e]))(e),c=ka(e),m=La(e),g=(e=>A.useCallback((()=>{e.$props.get().onClose()}),[e]))(e),u=Ca(e),p=Pa(e);return A.createElement(fa,{objectIdentifier:t,objectMetadata:a,accountMetadata:n,linksMetadata:s,members:o,onClose:g,onSaved:d,onCancelled:r,onRefreshObjectMetadata:c,onObjectIdentifierChanged:m,onRefreshModal:u,onConfirmationModalShownChange:p,onUnshareCompleted:l})};$a.displayName="ObjectSettingsWrapper";const Da=({store:e})=>{const t=ha,a=i.useStore(e.$accountMetadata),n=i.useStore(e.$editLinkCompatMetadata),s=i.useStore(e.$editLinkCompatPolicy),o=i.useStore(e.$editLinkCompatPolicyDraft),l=i.useStore(e.$editLinkMetadata),r=i.useStore(e.$objectIdentifier),d=i.useStore(e.$objectMetadata),c=i.useStore(e.$sharingPrefs),m=i.useStore(e.$hasUnsavedLinkChanges),g=i.useStore(e.$isUpdatingLinkSettings),u=Ia(e),p=wa(e),_=Aa(),f=va(e),h=xa(e,ha),E=Ta(e),y=ka(e),M=La(e),b=Pa(e),S=Ca(e),k=Na(e),C=Oa(e);return A.createElement(i.MetadataProvider,{sharingAccessLevel:ha},A.createElement(Jt,{accountMetadata:a,accessLevel:t,compatLinkMetadata:n,compatLinkPolicy:o||s,originalCompatLinkPolicy:s,linkMetadata:l,objectIdentifier:r,objectMetadata:d,sharingPrefs:c,isSavable:m,isSaving:g,onSave:u,onCancel:p,onOpenManageAccess:E,onLinkClicked:_,onRefreshLinksMetadata:f,onCompatLinkPolicyChange:h,onObjectIdentifierChanged:M,onRefreshObjectMetadata:y,onRefreshModal:S,onClose:k,onConfirmationModalShownChange:b,onUnshareCompleted:C}))};Da.displayName="EditLinkSettingsWrapper";const Ra=({store:e})=>{const t=Ea,a=i.useStore(e.$accountMetadata),n=i.useStore(e.$viewLinkCompatMetadata),s=i.useStore(e.$viewLinkCompatPolicy),o=i.useStore(e.$viewLinkCompatPolicyDraft),l=i.useStore(e.$viewLinkMetadata),r=i.useStore(e.$objectMetadata),d=i.useStore(e.$objectIdentifier),c=i.useStore(e.$sharingPrefs),m=i.useStore(e.$hasUnsavedLinkChanges),g=i.useStore(e.$isUpdatingLinkSettings),u=Ia(e),p=wa(e),_=Aa(),f=va(e),h=xa(e,Ea),E=Ta(e),y=ka(e),M=La(e),b=Ca(e),S=Na(e),k=Pa(e),C=Oa(e);return A.createElement(i.MetadataProvider,{sharingAccessLevel:Ea},A.createElement(Jt,{accountMetadata:a,accessLevel:t,compatLinkMetadata:n,compatLinkPolicy:o||s,originalCompatLinkPolicy:s,linkMetadata:l,objectIdentifier:d,objectMetadata:r,sharingPrefs:c,isSavable:m,isSaving:g,onSave:u,onCancel:p,onLinkClicked:_,onOpenManageAccess:E,onRefreshLinksMetadata:f,onCompatLinkPolicyChange:h,onObjectIdentifierChanged:M,onRefreshObjectMetadata:y,onRefreshModal:b,onClose:S,onConfirmationModalShownChange:k,onUnshareCompleted:C}))};Ra.displayName="ViewLinkSettingsWrapper";const Ua=({store:e})=>{const t=n.useIntl(),s=i.useStore(e.$currentTab),o=i.useStore(e.$objectMetadata),l=i.useStore(e.$linksMetadata),r=i.useStore(e.$shouldShowViewLinkTab),d=i.useStore(e.$shouldShowEditLinkTab),c=i.useStore(e.$shouldShowObjectSettingsTab),m=(e=>{const t=i.useLogger();return A.useCallback((n=>{e.$currentTab.set(n),t("SHARE_MODAL_SETTINGS__TAB_CHANGE",{selected_tab:ue(n,a.getIsFile(e.$objectMetadata.get()))})}),[e,t])})(e),u=a.getIsFile(o),p=i.useLogger(),_=xt();return A.useEffect((()=>{const t=ue(s,a.getIsFile(e.$objectMetadata.get()));p("SHARE_MODAL_SETTINGS__PAGE_VIEW",{selected_tab:t}),_.select(Ot).emit(null)}),[]),A.createElement(i.MetadataProvider,{sharingLinksMetadata:l},A.createElement(g.Tabs,{selectedTab:s,onSelection:m},A.createElement(g.Tabs.Group,{variant:"justified"},c?A.createElement(g.Tabs.Tab,{id:ya,key:ya},u?t.formatMessage({id:"TdlC4Q",defaultMessage:"File settings"}):t.formatMessage({id:"jR9e/q",defaultMessage:"Folder settings"})):null,d?A.createElement(g.Tabs.Tab,{id:Ma,key:Ma},t.formatMessage({id:"DIbS2E",defaultMessage:"Link for editing"})):null,r?A.createElement(g.Tabs.Tab,{id:ba,key:ba},t.formatMessage({id:"rvYosE",defaultMessage:"Link for viewing"})):null),A.createElement(A.Fragment,null,c?A.createElement(g.Tabs.Panel,{tabId:ya,key:ya},A.createElement($a,{store:e})):null,d?A.createElement(g.Tabs.Panel,{tabId:Ma,key:Ma},A.createElement(Da,{store:e})):null,r?A.createElement(g.Tabs.Panel,{tabId:ba,key:ba},A.createElement(Ra,{store:e})):null)))};Ua.displayName="ShareModalSettingsInner";const Fa=e=>{const t=(e=>{const t=n.useIntl(),{isNonUserRelativeContext:s}=w.useSharingApiContext();return i.useInitStore(e,(e=>{const n=i.proxy((()=>e.get().accountMetadata)),o=i.proxy((()=>e.get().linksMetadata)),l=i.proxy((()=>e.get().objectMetadata)),r=i.proxy((()=>e.get().objectIdentifier)),d=i.proxy((()=>e.get().sharingPrefs)),c=i.proxy((()=>e.get().members)),m=i.atom(a.vendSenderTrackey()),g=i.proxy((()=>{const t=a.getByAccessLevel(e.get().linksMetadata,{".tag":"editor"});return t&&(t.url=a.appendTrackeyToSharedLinkAndSortParams(t.url,m.get())),t})),u=i.proxy((()=>me(l.get(),g.get()))),p=i.proxy((()=>ge(t,u.get()))),_=i.store(null),f=i.proxy((()=>{const t=a.getByAccessLevel(e.get().linksMetadata,{".tag":"viewer"});return t&&(t.url=a.appendTrackeyToSharedLinkAndSortParams(t.url,m.get())),t})),h=i.proxy((()=>me(l.get(),f.get()))),E=i.proxy((()=>ge(t,h.get()))),y=i.store(null),M=i.proxy((()=>null!==y.get()||null!==_.get())),b=e=>{let t;if(e===ha)t=g;else{if(e!==Ea)return!1;t=f}const i=null!==t.get(),s=a.getCanCreateLink(l.get(),e,n.get().is_tmr_member);return a.getIsConfidentialFolder(l.get())||i||s},S=a.getIsLinkOnlyMode(l.get()),k=i.proxy((()=>!S&&b(ha)&&!s)),C=i.proxy((()=>b(Ea)&&!s)),L=i.proxy((()=>!(a.getIsCollection(l.get())||a.getIsLinkOnlyMode(l.get())))),v=i.store(!1),T=i.store(ya);return e.get().initialTab!==ya||L.get()?e.get().initialTab===Ma&&k.get()?T.set(Ma):e.get().initialTab===ba&&C.get()&&T.set(ba):T.set(k.get()?Ma:ba),{$accountMetadata:n,$linksMetadata:o,$objectMetadata:l,$objectIdentifier:r,$sharingPrefs:d,$members:c,$editLinkMetadata:g,$editLinkCompatMetadata:u,$editLinkCompatPolicy:p,$editLinkCompatPolicyDraft:_,$viewLinkMetadata:f,$viewLinkCompatMetadata:h,$viewLinkCompatPolicy:E,$viewLinkCompatPolicyDraft:y,$hasUnsavedLinkChanges:M,$shouldShowEditLinkTab:k,$shouldShowViewLinkTab:C,$shouldShowObjectSettingsTab:L,$isUpdatingLinkSettings:v,$currentTab:T,$props:e}}))})(e);return A.createElement(Ua,{store:t})};Fa.displayName="ShareModalSettings";const Ba=()=>A.createElement("div",{style:{minHeight:"200px",padding:"64px 0px 64px 0px"}},A.createElement(a.Interstitial,{in:!0,isIndeterminate:!0,onComplete:()=>{}}));Ba.displayName="LoadingState";const ja=({error:e,onFallback:t,onRetry:i})=>{const s=n.useIntl();return A.createElement("div",{style:{padding:"24px",textAlign:"center"}},A.createElement("div",{style:{marginBottom:"16px"}},s.formatMessage({id:"mR7o5t",defaultMessage:"We couldn‘t load the sharing settings."})),A.createElement("div",{style:{display:"flex",gap:"8px",justifyContent:"center"}},i&&A.createElement(a.Button,{onClick:i,variant:"primary"},s.formatMessage({id:"3T2tjL",defaultMessage:"Try again"})),t&&A.createElement(a.Button,{onClick:t,variant:"opacity"},s.formatMessage({id:"tcMLuN",defaultMessage:"Use classic version"}))),e&&A.createElement("details",{style:{marginTop:"16px",fontSize:"12px",color:"#666"}},A.createElement("summary",null,"Technical Details"),A.createElement("pre",null,e.message)))};ja.displayName="ErrorState";const Va=e=>{const t=s.useLegacySharingObjectMetadata(e.objectIdentifier),i=m.useObjectMembers(e.objectIdentifier),l=c.useListSharedLinks(e.objectIdentifier,!0),r=o.useSharingPrefs(),d=s.useSharingAccountInfo(),g=n.useIntl(),u=!t.isLoading&&!t.isError,p=u?t.output:null,_=e.objectIdentifier,f=e.onObjectIdentifierChanged;A.useEffect((()=>{var e;if(p&&!a.isNewApiMetadata(p)&&"file_folder"===p[".tag"]&&p.folder_id!==_.fileId){const t={".tag":"file_folder",name:p.name,path:null!==(e=p.path_lower)&&void 0!==e?e:"",fileId:p.folder_id};f(t)}}),[u,_,p,f]);const h=A.useCallback((async()=>{await s.invalidateSharingObjectMetadata(e.objectIdentifier),await s.invalidateNewApiObjectMetadata(e.objectIdentifier)}),[e.objectIdentifier]),E=A.useCallback((()=>c.invalidateListSharedLinks(e.objectIdentifier)),[e.objectIdentifier]),y=A.useCallback((async()=>{await Promise.all([s.invalidateSharingObjectMetadata(e.objectIdentifier),s.invalidateNewApiObjectMetadata(e.objectIdentifier),c.invalidateListSharedLinks(e.objectIdentifier),m.invalidateObjectMembers(e.objectIdentifier),o.invalidateSharingPrefs(),s.invalidateSharingAccountInfo()])}),[e.objectIdentifier]);if(t.isLoading||!i.isFirstPageLoaded||!i.isFirstPageOnly&&i.isLoading||l.isLoading||r.isLoading||d.isLoading)return A.createElement(Ba,null);let M=null;if(t.isError?M=g.formatMessage({id:"Tym5Ts",defaultMessage:"We had trouble loading the sharing object metadata."}):i.hadContinuationError?M=g.formatMessage({id:"rTptgd",defaultMessage:"We couldn’t fetch the members of the sharing object."}):!l.isLoading&&l.isError?M=g.formatMessage({id:"AQ3NNq",defaultMessage:"We couldn‘t fetch the shared links."}):!r.isLoading&&r.isError&&!("output"in r)||!r.output?M=g.formatMessage({id:"grfK5U",defaultMessage:"We couldn‘t fetch the sharing preferences."}):!d.isLoading&&d.isError&&(M=g.formatMessage({id:"I6Q3Cy",defaultMessage:"We had trouble loading the sharing account information."})),M)return A.createElement(ja,{onFallback:e.onFallback,onRetry:y,error:{message:M}});if(!t.isError&&!l.isLoading&&!l.isError&&!d.isLoading&&!d.isError&&!r.isError&&"output"in r&&r.output){const a=t.output,n=i.isFirstPageOnly?i.firstPage:i.allMembers,s=l.output,o=r.output,c=d.output;return A.createElement(Fa,{accountMetadata:c,linksMetadata:s,objectMetadata:a,sharingPrefs:o,members:n,onRefreshObjectMetadata:h,onRefreshLinksMetadata:E,...e})}return A.createElement(ja,{onFallback:e.onFallback,onRetry:y})};Va.displayName="SettingsPageWithoutCss";const Ga=a.requireCssWithComponent(Va,["/static/typescript/component_libraries/spectrum-sharing/src/index.web-vflz7dTtC.css","/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/dig-illustrations/index.web-vflye-46V.css","/static/metaserver/static/css/maestro_layout-vflCdpQrA.css","/static/metaserver/static/css/foundation-vflH6wwwv.css"]);Ga.displayName="SettingsPage",e.ACL_UPDATE_POLICY="acl_update_policy",e.ALLOW_DOWNLOAD="allow_download",e.AUDIENCE="audience",e.BUTTON="button",e.DEFAULT="default",e.DROPDOWN="dropdown",e.EDIT_LINK_SETTINGS="edit_link_settings",e.EXPIRES="expires",e.FILE_SETTINGS="file_settings",e.FOLDER_LINK_AUDIENCE_POLICY="shared_link_policy",e.FOLDER_SETTINGS="folder_settings",e.InbandEntryButton=ie,e.MEMBER_POLICY="member_policy",e.PAP_Hover_FlexibleSharingEntrypointAction=z,e.PAP_Log_FlexibleSharingEntrypointActionDwellTime=X,e.PasswordInput=B,e.REQUIRE_PASSWORD=N,e.RestrictedVisibilityBanner=j,e.ScooterLoader=V,e.SettingDropdown=O,e.SettingPolicyRow=$,e.SettingsPage=Ga,e.SettingsToggle=R,e.SharingModalDowngradeBanner=H,e.SharingModalSettingsRow=x,e.SharingSettingsPassword=e=>{const{getPolicyDict:t,linkPolicy:a}=e,n=t(N),i=A.createElement("div",null,(e=>{const{linkPolicy:t,linkPermissions:a,getPolicyDict:n,onPolicyUpdate:i}=e,s=n(N),l=s.optionsDict,r=t.require_password?"enabled":"disabled";return A.createElement(R,{currentValue:r,optionsDict:l,onOptionChange:(e,t)=>{i({require_password:e})},disabled:!o.canTogglePassword(a)||U(a,t.audience)||e.readOnlyPolicy,ariaLabel:s.title})})(e),(a.require_password||U(e.linkPermissions,a.audience)&&!e.readOnlyPolicy)&&A.createElement(B,{...e}));return A.createElement($,{policyName:N,policyDict:n,selector:i})},e.TOGGLE="toggle",e.TokenizerButton=oe,e.VIEWER_INFO_POLICY="viewer_info_policy",e.VIEW_LINK_SETTINGS="view_link_settings"}));
//# sourceMappingURL=c_settings-page_internals_settings-page-wrapper.js-vflJ3IT7K.map

//# debugId=bb9dabb4-5cc9-30ba-ab00-88dae20e6004