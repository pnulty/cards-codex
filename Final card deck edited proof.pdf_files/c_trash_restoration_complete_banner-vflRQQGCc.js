!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="16226cd6-3590-3729-a535-2b881593fa6a")}catch(e){}}();
define(["exports","react","./c_trash_restoration_utils","./e_ui_page_files_router","./e_core_exception","./c_core_i18n","./c_pap-events_replay_shown_modal","./e_data_modules_stormcrow","./c_react_query_api_helpers_queries_restorations","./c_pap-events_pdf_edit_select_replace_original_confirmation","./c_trash_constants","react-dom","./c_bem","./c_ncct_manual_assist_util","./c_core_notify","./e_edison","./c_action_bar_action_bar_constants","./c__rollupPluginBabelHelpers","./c_lodash-es_lodash","./c_src_sink_index","./c_memoize-one","react/jsx-runtime","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_chat_chat_constants","metaserver/static/js/langpack"],(function(e,t,n,r,a,s,o,i,l,c,u,d,m,_,p,f,g,v,R,h,y,C,S,B,w,b){"use strict";function k(e){return e&&e.__esModule?e:{default:e}}var E=k(t);r.injectInternalStyle("/static/metaserver/static/js/trash/restoration_complete_banner.module.out-vfl0xHrkJ.css",(e=>"._snackbarContainer_db91u_1{bottom:40px;display:flex;justify-content:center;pointer-events:none;position:fixed;width:100%;z-index:10011}._snackbarContainer_db91u_1>*{pointer-events:all}"));const P="_snackbarContainer_db91u_1";function q(e){return{class:"deleted_files",action:"select",object:"restoration_banner",properties:e}}const F=({restorationsInfo:e,onClose:t,open:a})=>{const o=s.useIntl(),i=r.useCompatNavigate();if(!e)return null;const l=(e=>{var t,a,s,o;const i="overquota"===e.quotaStatus||"locked_state"===e.quotaStatus,l=!!(null===(t=e.failures)||void 0===t?void 0:t.length),c=!!(null===(a=e.successes)||void 0===a?void 0:a.length),u=(null===(s=e.successes)||void 0===s?void 0:s.reduce(((e,t)=>e+(t.numToRestore||0)),0))||0,d=(null===(o=e.failures)||void 0===o?void 0:o.reduce(((e,t)=>e+(t.numToRestore||0)),0))||0,m=u>1||d>1;if(l&&c)return{type:"partial_failure",variant:"multiple",messageKey:n.RestorationCompleteBannerStrings.multiplePartialRestorationFailed,icon:r.FailLine,showViewButton:!1,showRetryButton:!0,getMessageValues:(e,t)=>({commonParentPath:t})};if(l){const e=m?n.RestorationCompleteBannerStrings.multipleRestorationFailed:n.RestorationCompleteBannerStrings.restorationFailed;return{type:"failure",variant:m?"multiple":"single",messageKey:e,icon:r.FailLine,showViewButton:!1,showRetryButton:!0,getMessageValues:e=>{var t;const n=(null===(t=e.failures)||void 0===t?void 0:t.reduce(((e,t)=>e+(t.numToRestore||0)),0))||0;return{...m?{failures:n}:{representativeName:e.representative.name}}}}}{const t=m?i?"overquota"===e.quotaStatus?n.RestorationCompleteBannerStrings.multipleRestorationCompletedOverquota:n.RestorationCompleteBannerStrings.multipleRestorationCompletedLocked:n.RestorationCompleteBannerStrings.multipleRestorationCompletedWithDetails:i?"overquota"===e.quotaStatus?n.RestorationCompleteBannerStrings.restorationCompletedOverquota:n.RestorationCompleteBannerStrings.restorationCompletedLocked:n.RestorationCompleteBannerStrings.restorationCompletedWithDetails;return{type:"success",variant:m?"multiple":"single",messageKey:t,icon:i?r.WarningLine:r.CheckmarkCircleLine,showViewButton:!0,showRetryButton:!1,getMessageValues:(e,t)=>{var n;const a=(null===(n=e.successes)||void 0===n?void 0:n.reduce(((e,t)=>e+(t.numToRestore||0)),0))||0,s=m?{successes:a,commonParentPath:t}:{representativeName:e.representative.name,commonParentPath:t};return"locked_state"===e.quotaStatus?{...s,trademark_business:r.getTrademarkBusiness()}:s}}}})(e);let c=e.commonParentPath;"/"===e.commonParentPath&&(c=o.formatMessage(n.RestorationCompleteBannerStrings.dropbox));const u=l.getMessageValues(e,c),d=[...e.successes||[],...e.failures||[]].some((e=>e.restorationItems.some((e=>0!==e.csId))));return E.default.createElement("div",{className:P},E.default.createElement(r.Snackbar$1,{open:a,preferComposition:!0},E.default.createElement(r.Snackbar$1.Accessory,null,E.default.createElement(r.UIIcon,{src:l.icon})),E.default.createElement(r.Snackbar$1.Content,null,E.default.createElement(r.Snackbar$1.Message,null,o.formatMessage(l.messageKey,u)),E.default.createElement(r.Snackbar$1.Actions,null,l.showViewButton&&d&&E.default.createElement(r.Button,{variant:"transparent",onClick:()=>{const a=e.successes.length+e.failures.length;r.WebMiscActivityLogger.log("trash-restoration-banner-view-files",{restoration_count:a,variant:l.variant,banner_type:l.type}),r.UDCL.logEvent(q({deletedFilesRestorationAction:"view_files",deletedFilesRestorationCount:a,deletedFilesVariant:l.variant,deletedFilesBannerType:l.type})),(async(e,a)=>{const s=await r.fetchViewer();if(!s.active_user)return;let o,l;a?(o=e.commonParentPath,l=!0):(o=`/${e.commonParentPath.replace(/^\/+|\/+$/g,"")}/${e.representative.name.replace(/^\/+|\/+$/g,"")}`,l=e.representative.isDir);const c=n.getViewUrl(s,o,l);t(),i(c)})(e,"multiple"===l.variant)}},o.formatMessage(n.RestorationCompleteBannerStrings.view)),l.showRetryButton&&d&&E.default.createElement(r.Button,{variant:"transparent",onClick:async()=>{const a=e.successes.length+e.failures.length;r.WebMiscActivityLogger.log("trash-restoration-banner-retry",{restoration_count:a,banner_type:l.type}),r.UDCL.logEvent(q({deletedFilesRestorationAction:"retry",deletedFilesRestorationCount:a,deletedFilesVariant:l.variant,deletedFilesBannerType:l.type}));const s=(await r.fetchViewer()).active_user;s&&(n.retryFailedRestorations(s,e),t())}},o.formatMessage(n.RestorationCompleteBannerStrings.retry)),E.default.createElement(r.Button,{variant:"transparent",onClick:t},o.formatMessage(n.RestorationCompleteBannerStrings.close))))))};F.displayName="RestorationBanner";const N=({children:e})=>(()=>{try{return window.self!==window.top}catch(e){return!0}})()?null:E.default.createElement(E.default.Fragment,null,e);N.displayName="RestrictOutsideIframe";const I=({children:e})=>{const[s,c]=t.useState(!1),[u,d]=t.useState(void 0),[m,_]=t.useState(void 0),p=t.useRef(new Date),f=t.useRef(null);t.useEffect((()=>{const e=async()=>{try{if(!o.isAnyUserSignedIn())return;p.current=new Date;const t=await n.rpcGetRestoreProcessesBoltToken(),a=new r.SignedChannelState(t.channel_id.app_id,t.channel_id.unique_id,t.revision,t.token),s=async()=>{l.listRestoresRequestPackage.invalidateQueries(i.queryClient);const e=await n.getRestorationsUpToDate(p.current);e&&(e.successes.length>0||e.failures.length>0)&&(c(!1),d(e),_(e))},u=async()=>{f.current&&(f.current.unsubscribe(),f.current=null),e()};f.current=new r.MetaserverBoltClient([a],s,u),f.current.start()}catch(e){const t=JSON.stringify(e);if(a.NOISY_ERROR_SUBSTRINGS.some((e=>t.includes(e))))return}};return e(),()=>{f.current&&(f.current.unsubscribe(),f.current=null)}}),[]),t.useEffect((()=>{const e=()=>c(!0);return document.addEventListener(r.SNACKBAR_SHOWN,e),()=>{document.removeEventListener(r.SNACKBAR_SHOWN,e)}}),[]);if(e)return E.default.cloneElement(e,{restorationsInfo:u});const g=!!u&&!s;return E.default.createElement(F,{restorationsInfo:u||m,onClose:()=>{d(void 0),p.current=new Date},open:g})};I.displayName="BoltConnectedRestorationSnackbarBanner";const M=()=>E.default.createElement(N,null,E.default.createElement(I,null));M.displayName="RestorationCompleteBanner",e.BoltConnectedRestorationSnackbarBanner=I,e.RestorationCompleteBanner=M,e.RestrictOutsideIframe=N}));
//# sourceMappingURL=c_trash_restoration_complete_banner.js-vflweB2-c.map

//# debugId=16226cd6-3590-3729-a535-2b881593fa6a