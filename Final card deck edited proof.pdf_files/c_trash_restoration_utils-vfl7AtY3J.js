!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="19c9a73b-28bf-3cad-8877-4089bb50f16d")}catch(e){}}();
define(["exports","./c_react_query_api_helpers_queries_restorations","./e_ui_page_files_router","./c_pap-events_pdf_edit_select_replace_original_confirmation","./e_core_exception","./c_trash_constants","./c_core_i18n"],(function(e,t,s,a,o,r,i){"use strict";async function n(e,a){return t.GetDeletedFilesRoutes(new s.ActiveUserApiV2Client).rpc("list_restores",{cursor:e,filter:a},{})}const u=i.defineMessages({restorationCompletedWithDetails:{id:"v4dqMS",defaultMessage:"{representativeName} has been restored to {commonParentPath}."},restorationCompletedOverquota:{id:"hTjvJt",defaultMessage:"{representativeName} has been restored to {commonParentPath}, but can't sync until you free up space."},restorationCompletedLocked:{id:"WqypfM",defaultMessage:"{representativeName} has been restored to {commonParentPath}, but can't sync. Your team no longer has full use of {trademark_business} features."},multipleRestorationCompletedWithDetails:{id:"QbDlK1",defaultMessage:"{successes} items have been restored to {commonParentPath}."},multipleRestorationCompletedOverquota:{id:"EADKb/",defaultMessage:"{successes} items have been restored to {commonParentPath}, but can't sync until you free up space."},multipleRestorationCompletedLocked:{id:"WaO4k9",defaultMessage:"{successes} items have been restored to {commonParentPath}, but can't sync. Your team no longer has full use of {trademark_business} features."},restorationFailed:{id:"2G+NZ9",defaultMessage:"{representativeName} failed to restore."},multipleRestorationFailed:{id:"gV1EVw",defaultMessage:"{failures} items failed to restore."},multiplePartialRestorationFailed:{id:"EDjiZ+",defaultMessage:"Some files in {commonParentPath} failed to fully restore."},view:{id:"C9zFRV",defaultMessage:"View"},retry:{id:"8PfGvR",defaultMessage:"Retry"},close:{id:"oMUzwI",defaultMessage:"Close"},dropbox:{id:"TQEyhF",defaultMessage:"Dropbox"}}),l={getOverquotaNameUnknownItems:()=>i.intl.formatMessage({id:"QECGZu",defaultMessage:"Items over storage limit"},{}),getOverquotaNameSingleItem:()=>i.intl.formatMessage({id:"KxxOl6",defaultMessage:"1 item over storage limit"},{}),getOverquotaNameMultipleItems:e=>i.intl.formatMessage({id:"58ugqJ",defaultMessage:"{count} items over storage limit"},{count:e})},c=i.intl.formatMessage({id:"SociMV",defaultMessage:"Loading"});function d(e,t){return e===r.NameOverrides.overquota?0===t?l.getOverquotaNameUnknownItems():1===t?l.getOverquotaNameSingleItem():l.getOverquotaNameMultipleItems(t):e}e.RestorationCompleteBannerStrings=u,e.getRepresentativeNameForOverrides=d,e.getRestorationsUpToDate=async function(e){try{const{restores:a,quotaStatus:o}=await async function(e){const s=[];let a,o=!0,r="not_overquota";for(;o;){const t=await n(a,{status_codes:[{".tag":"done"},{".tag":"failed"}],last_modified_since:e.getTime()});s.push(...t.restores||[]),a=t.cursor,o=!0===t.has_more,t.quota_status&&"overquota"===t.quota_status[".tag"]?r="overquota":t.quota_status&&"locked_state"===t.quota_status[".tag"]&&(r="locked_state")}return{restores:t.deduplicateRestorations(s),quotaStatus:r}}(e),r=a.filter((t=>new Date(t.last_modified_time||0)>=e)),i=function(e){var t;const s=[],a=[];for(const o of e)if(o.namespace_id&&o.actioned_items){const e="done"===o.status_code[".tag"]?s:a,r={restorationItems:[],taskId:o.task_id,numToRestore:o.num_to_restore||0};e.push(r);for(const e of o.actioned_items)(e.changeset_id||e.name_override)&&r.restorationItems.push({csId:null!==(t=e.changeset_id)&&void 0!==t?t:0,nsId:o.namespace_id,nameOverride:e.name_override})}return{successes:s,failures:a}}(r),u=function(e){const t=e.flatMap((e=>e.actioned_items||[])).map((e=>e.mount_path)).filter((e=>void 0!==e));if(0===t.length)return"/";const s=t[0].split("/");s.pop();let a=s.join("/");""===a&&(a="/");const o=t.reduce(((e,t)=>function(e,t){const s=e.split("/"),a=t.split("/");return s.filter(((e,t)=>e===a[t])).join("/")}(e,t)),a);return o.startsWith("/")?o:"/"+o}(r),l=function(e){for(const t of e)if(t.actioned_items&&t.actioned_items.length>0)for(const e of t.actioned_items){const a=e.is_dir||!1;if(e.mount_path)return{name:s.filename(e.mount_path),isDir:a};if(e.name_override)return{name:`"${d(e.name_override,t.num_to_restore||0)}"`,isDir:a}}return{name:"",isDir:!0}}(r);return{...i,commonParentPath:u,representative:l,quotaStatus:o}}catch(t){throw o.reportException({err:t,tags:["trash","get_restorations"],severity:o.SEVERITY.NONCRITICAL,exc_extra:{cutoff_date:e.toISOString()}}),t}},e.getViewUrl=(e,t,a)=>{const o=null==e?void 0:e.active_user;return o&&t?a?s.browse_uri_for_fq_path(e,o,t).toString():s.preview_uri_for_fq_path(o,t).toString():""},e.loadingText=c,e.retryFailedRestorations=async function(e,t){if(0!==t.failures.length)try{const o=new s.DefaultUserApiV2Client(e),r=t.failures.filter((e=>void 0!==e.taskId));if(r.length>0){const t=e.is_team_admin;await Promise.all([r.flatMap((e=>a.GetRestorationsRoutes(o).rpc("retry",{task_id:e.taskId,allow_retry_for_team_members:t},{})))])}const i=t.failures.filter((e=>void 0===e.taskId));i.length>0&&await a.GetRestorationsRoutes(o).rpc("changeset/restore_true_deletions_batch",{ns_cs_ids:i.flatMap((e=>e.restorationItems.filter((e=>0!==e.csId)).map((e=>({cs_id:e.csId,ns_id:e.nsId}))))),initiation_location:{".tag":"restoration_banner"}},{})}catch(s){throw o.reportException({err:s,tags:["trash","retry_failed_restorations"],severity:o.SEVERITY.NONCRITICAL,exc_extra:{user_id:e.id,failure_count:t.failures.length}}),s}},e.rpcGetRestoreProcessesBoltToken=async function(){const e=t.GetDeletedFilesRoutes(new s.ActiveUserApiV2Client);return(await e.rpc("get_restore_processes_bolt_token",void 0,{})).token}}));
//# sourceMappingURL=c_trash_restoration_utils.js-vflTZjgPs.map

//# debugId=19c9a73b-28bf-3cad-8877-4089bb50f16d