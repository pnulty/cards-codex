!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9a97a37e-3ef4-342a-a6d7-167768734605")}catch(e){}}();
define(["exports","react","./e_ui_page_files_router","./c_action_bar_action_bar_constants","./c_dig-components_banner_index","./c_quota_use_query_quota_upsell_info","./c_over-quota_utils_use_get_plans","./c_quota_utils","./c_over-quota_utils_oq_price_decrease_helper","./c_over-quota_utils_logger","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_core_i18n","./e_data_modules_stormcrow","./c_src_common_format_bytes","./c_flux_action_type","./c_sharing_settings_utils_link_metadata_types","./c_src_bindings_provider","./c_common_components_layout","./c_react-hookz_web_useIntersectionObserver","./c_sharing_sharing_banned_modal","./c_content-member-list_internals_content-member-list","./c_extensions_data_selectors","./c_react_query_api_helpers_queries_seen_state_info","./c_inband-screen_internals_share-modal-share","./e_core_exception","./c_src_utils_initials","./c_src_bindings_api-context","./c_pap-events_folder_modal_select_create_folder_modal_create_button","./c_lib_logging","./c_common_logging-contexts_desktop-platform-logging-metadata","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_common_components_buttons","./c_settings-page_internals_settings-page-wrapper","./c_dig-icons_assets_ui-icon_line_link","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_rotate-right","./c_bem","./c_pap-events_replay_shown_modal","./e_edison","./c_src_sink_index","./c_shared-link-attribution-tracking_components_sender_trackey_vendor","./c_pap-events_share_copy_shared_link","./c_sharing_sharing_pap_logging_copy_shared_link_util","./c_sharing_sharing_pap_logging_common_util","./c_domain_restriction_utils_date_formatting","./c_continuous_onboarding_milestone_api","./c_sharing_ui_util","./c_dig-icons_assets_ui-icon_line_minus","./c_dig-icons_assets_ui-icon_line_quota-reached"],(function(e,t,a,n,o,i,r,s,l,c,d,u,g,m,_,p,E,f,S,y,C,b,v,h,k,L,A,T,I,N,$,M,w,R,x,O,P,D,U,B,V,j,F,q,H,K,G,Q,W){"use strict";function Y(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var z=Y(t);const X={".tag":"no_one"},Z={".tag":"password"},J={".tag":"team"},ee={".tag":"public"};const te={".tag":"viewer"},ae={".tag":"editor"},ne={".tag":"default"};a.injectInternalStyle("/static/metaserver/static/js/growth/ui/over-quota/over-quota-share-banner-component/over_quota_share_banner_component.module.out-vflEEG0ol.css",(e=>"._bannerSection_l7aro_1{margin-bottom:var(--dig-spacing__micro__medium);margin-top:var(--dig-spacing__micro__small)}"));const oe="_bannerSection_l7aro_1";const ie=({onUpgrade:e})=>{var t,n,d,u,g,m,_,p,E,f;const[S,y]=z.default.useState(!1),C=a.useExperimentVariant("end_state_web_overquota_restrictions"),b=C&&C.variant===a.Variant.V1,v="ON"===a.useExperimentVariant("overquota_glide_modal").variant,h=z.default.useRef(!1),k=(null==C?void 0:C.variant)?C.variant:a.Variant.OFF,{user:L}=a.useActiveUser(),{quotaUpsellInfo:A,isLoadingQuotaUpsellInfo:T,quotaUpsellInfoError:I}=i.useQuotaUpsellInfo(L,C.variant===a.Variant.OFF),N=!(C.isLoading||T||C.error||I),$=(null===(t=null==A?void 0:A.restrictions)||void 0===t?void 0:t.enforce_restrictions)||(null===(n=null==A?void 0:A.restrictions)||void 0===n?void 0:n.show_restrictions_warning),M=b&&$,w=(null===(g=null===(u=null===(d=null==A?void 0:A.quota)||void 0===d?void 0:d.allocation)||void 0===u?void 0:u.individual)||void 0===g?void 0:g.allocated)||0,R=(null===(m=null==A?void 0:A.quota)||void 0===m?void 0:m.used)||0,x=null===(_=null==A?void 0:A.restrictions)||void 0===_?void 0:_.overquota_start_time_utc_seconds,O=x?Date.now()/1e3-x:void 0,P=!!(null===(p=null==A?void 0:A.restrictions)||void 0===p?void 0:p.enforce_restrictions),D=s.getOverQuotaReason(null==A?void 0:A.overquota_reason),U=null!==(E=l.getOrganicOrChurnedFromString(D))&&void 0!==E?E:"unlabeled";if(z.default.useEffect((()=>{N&&$&&[a.Variant.V1,a.Variant.CONTROL,a.Variant.HOLDOUT].includes(k)&&(a.logExposure({feature:"end_state_web_overquota_restrictions",variant:k}),c.logAdditionalExposureDetails(k,"share_modal_banner",A))}),[k,$,N,A]),z.default.useEffect((()=>{N&&M&&!h.current&&(a.UDCL.logEvent({class:"quota",action:"shown",object:"overquota_share_modal_banner",properties:{quotaLimit:w,quotaUsed:R,secondsOverquota:O,hardblocked:P,organicOrChurned:U}},{tags:{hardblocked:P?"true":"false",organicOrChurned:U}}),h.current=!0)}),[N,M,w,R,O,P,U]),!N)return null;if(!M)return null;const B=(null===(f=null==A?void 0:A.restrictions)||void 0===f?void 0:f.show_restrictions_warning)||!1,V=function(e,t){var a;return e?(null===(a=null==t?void 0:t.restrictions)||void 0===a?void 0:a.restrictions_start_time_utc_seconds)?r.SHARING_RESTRICTION_WARNING(r.getRestrictionsDateString(t.restrictions.restrictions_start_time_utc_seconds)):r.SHARING_RESTRICTION_WARNING_NO_DATE:r.SHARING_ENFORCE_RESTRICTIONS}(B,A);return z.default.createElement(a.Box,{className:oe,"data-testid":"over-quota-share-banner-component"},z.default.createElement(o.Banner,{type:B?"warning":"alert",borderRadius:"Large"},z.default.createElement(a.Box,{display:"flex",justifyContent:"space-between",alignItems:"center"},z.default.createElement(o.Banner.Message,null,V),z.default.createElement(o.Banner.Actions,null,z.default.createElement(a.Button,{variant:"transparent",onClick:()=>{a.UDCL.logEvent({class:"quota",action:"select",object:"overquota_share_modal_banner",properties:{quotaLimit:w,quotaUsed:R,secondsOverquota:O,hardblocked:P,organicOrChurned:U,actionElement:"upgrade"}},{tags:{actionElement:"upgrade",hardblocked:P?"true":"false",organicOrChurned:U}}),v?(y(!0),a.openDoormanUpsellModal({modalVersion:"glide-upsell-modal-dp-only",trialCardsLocation:a.TrialCardsLocation.OVERQUOTA_SHARE_BANNER,reloadPageAfterPurchase:!0,onDisplayed:()=>{null==e||e()}})):(a.redirect("/out-of-space?_tk=oq_restrictions_modal"),null==e||e())},isLoading:S},r.UPGRADE)))))};ie.displayName="OverquotaShareBannerComponent";const re=u.defineMessage({id:"UaJBfk",defaultMessage:"QR code for sharing"}),se=u.defineMessage({id:"ZFsp0l",defaultMessage:"Download"}),le=u.defineMessage({id:"E89n5D",defaultMessage:"Download QR code"}),ce=u.defineMessage({id:"EQKjGC",defaultMessage:"Anyone with the code can view."}),de=u.defineMessage({id:"J8vTeR",defaultMessage:"Team members with the code can view."}),ue=u.defineMessage({id:"8JPLVJ",defaultMessage:"Manage link access"}),ge=u.defineMessage({id:"tllLrY",defaultMessage:"Only people invited can view."}),me=u.defineMessage({id:"bWq9cz",defaultMessage:"Couldn’t create QR code. You don’t have permission to create a QR code to this content."}),_e=u.defineMessage({id:"tpMKHD",defaultMessage:"We can’t find this file anymore. Try checking activity or folder history to see what happened."}),pe=u.defineMessage({id:"zGqflr",defaultMessage:"You can’t share until you verify your email address."}),Ee=u.defineMessage({id:"zM/n79",defaultMessage:"Couldn’t create QR code. Please try again later."}),fe=u.defineMessage({id:"s2Zxdl",defaultMessage:"Couldn’t create QR code."});var Se;!function(e){e.PATH_FORBIDDEN="path_forbidden",e.PATH_NOT_FOUND="path_not_found",e.EMAIL_NOT_VERIFIED="email_not_verified",e.SERVICE_UNAVAILABLE="service_unavailable",e.UNKNOWN="unknown"}(Se||(Se={}));const ye=e=>`data:image/png;base64,${e}`;a.injectInternalStyle("/static/metaserver/static/js/sharing/features/sharing_qr_code/get_qr_code_modal.module.out-vflNN1fVL.css",(e=>"._get-qr-code-modal_dbu8m_1>div{background-color:var(--dig-color__background__subtle);border:1px solid var(--dig-color__border__subtle)}._get-qr-code-modal-image_dbu8m_6{display:flex;width:100%}._get-qr-code-modal-spinner_dbu8m_11{align-items:center;aspect-ratio:1/1;display:flex;justify-content:center;width:100%}._get-qr-code-modal-body_dbu8m_19{padding-bottom:var(--spacing__unit--3);padding-top:calc(var(--spacing__unit--1)*6)}._get-qr-code-modal-filename_dbu8m_25{white-space:nowrap}@media (min-width:601px){._get-qr-code-modal-body_dbu8m_19{padding-top:var(--spacing__unit--3)}._get-qr-code-modal_dbu8m_1 button.dig-Modal-close-btn{display:none}}"));const Ce=({base64QrCode:e})=>z.default.createElement("img",{"data-testid":"qr-code-modal-image",className:"_get-qr-code-modal-image_dbu8m_6",src:ye(e),alt:u.intl.formatMessage(re)});Ce.displayName="GetQrCodeModalImage";const be=()=>z.default.createElement("div",{className:"_get-qr-code-modal-spinner_dbu8m_11"},z.default.createElement(a.Spinner,{size:"medium"}));const ve=a.createApiv2Query({nsClient:function(e){return e.ns("sharing_qr_code")},rpc:"get_qr_code"}),he=()=>{var e;const t="dark"===(null===(e=a.useTheme())||void 0===e?void 0:e.mode);return z.default.createElement(z.default.Fragment,null,z.default.createElement(a.Box,{padding:"Micro XLarge",marginTop:"Micro Small",borderWidth:"1",borderColor:"Border Subtle",borderStyle:"Solid",backgroundColor:t?"Secondary Surface - State 1":"Background Base",borderRadius:"XLarge"},z.default.createElement(be,null)),z.default.createElement(a.Box,{marginTop:"Micro Large"},z.default.createElement(a.Button,{size:"large",variant:"primary",fullWidth:!0,"data-uxa-log":"download_qr_code_modal_button","aria-label":u.intl.formatMessage(le),disabled:!0,autoFocus:!0},u.intl.formatMessage(se)),z.default.createElement(a.Box,{marginTop:"Micro Large"},z.default.createElement(a.Skeleton.Text,null)," ",z.default.createElement(a.Skeleton.Text,null))))};he.displayName="GetQrCodeLoading";const ke=({objectIdentifier:e,user:t,onSettingsClick:o,qrCodeResponse:i,fileName:r,filePath:s})=>{var l,c;const d=null!==(l=i.qrcode)&&void 0!==l?l:"",g=i.effective_audience,p=z.default.useCallback(((o,i)=>{const r=a.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,l=n.get_browser_info(),c=e.fileId;a.ShareTibEventLogger.log(t.id,o,r,{file_id:c,fq_path:s,is_folder:"file"!==e[".tag"],browser:l.browser,browser_version:l.version,...i})}),[e,s,t.id]);z.default.useEffect((()=>{const e=i.link_url;if(e){const t=m.parseLink(e),n=t.doesContainShmodelLink?a.ShareTibEventLogger.get_shmodel_extra_for_logging(void 0,m.getCleanedSharingUrl(t)):a.ShareTibEventLogger.get_scl_extra_for_logging(void 0,m.getCleanedSharingUrl(t)),o={sender_trackey:t.searchParams.get("st"),...n};p(_.TiburonEventName.CreateQrCode,o)}}),[p,i.link_url]);const E="dark"===(null===(c=a.useTheme())||void 0===c?void 0:c.mode),f=(e=>{switch(e){case"public":return ce;case"team":return de;case"no_one":return ge;default:return""}})(g);return z.default.createElement(z.default.Fragment,null,z.default.createElement(a.Box,{padding:"Micro XLarge",marginTop:"Micro Small",borderWidth:"1",borderColor:"Border Subtle",borderStyle:"Solid",backgroundColor:E?"Secondary Surface - State 1":"Background Base",borderRadius:"XLarge"},z.default.createElement(Ce,{base64QrCode:d})),z.default.createElement(a.Box,{marginTop:"Micro Large"},z.default.createElement(a.Button,{size:"large",variant:"primary",onClick:e=>{e.preventDefault(),((e,t)=>{const a=document.createElement("a");a.href=ye(e),a.download=`${t}_QR.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)})(d,r)},fullWidth:!0,"data-uxa-log":"download_qr_code_modal_button","aria-label":u.intl.formatMessage(le),autoFocus:!0},u.intl.formatMessage(se)),z.default.createElement(a.Box,{marginTop:"Micro Large"},f?z.default.createElement(a.Text,null,u.intl.formatMessage(f)):null,o?z.default.createElement(z.default.Fragment,null," ",z.default.createElement(a.Link,{hasNoUnderline:!0,href:"#",onClick:e=>{e.preventDefault(),o()},"data-uxa-log":"settings_qr_code_modal_button",display:"inline"},u.intl.formatMessage(ue))):null)))};ke.displayName="GetQrCodeLoaded";const Le=e=>{const{user:t,onGetQrCodeError:n,objectIdentifier:o,fileName:i,filePath:r}=e,s=(e=>{const t=ve.useQuery({apiArg:{read_path:e}},{staleTime:0});return z.useMemo((()=>t?t.isLoading?{isLoading:!0}:t.isError?{isLoading:!1,isError:!0,error:t.error.appError}:{output:t.data.apiData,isLoading:!1,isError:!1}:{isLoading:!0}),[t])})(p.getContentIdOrPathFromObjectIdentifier(o)),l=z.default.useRef(!1);return z.default.useEffect((()=>{var e;if(!1===l.current&&!s.isLoading&&(void 0===t||s.isError||void 0===s.output||void 0===s.output.qrcode||""===s.output.qrcode)){l.current=!0;const t=s.isError?null===(e=s.error)||void 0===e?void 0:e[".tag"]:void 0;a.Snackbar.warn(u.intl.formatMessage((e=>{switch(e){case Se.PATH_FORBIDDEN:return me;case Se.PATH_NOT_FOUND:return _e;case Se.EMAIL_NOT_VERIFIED:return pe;case Se.SERVICE_UNAVAILABLE:return Ee;default:return fe}})(t))),null==n||n()}}),[n,t,s]),s.isLoading?z.default.createElement(he,null):void 0===t||s.isError||void 0===s.output||void 0===s.output.qrcode||""===s.output.qrcode?null:z.default.createElement(ke,{...e,user:t,qrCodeResponse:s.output,fileName:i,filePath:r})};Le.displayName="GetQrCodeInner";const Ae=e=>{const{user:t,isLoading:n}=a.useActiveUser();return n?z.default.createElement(he,null):z.default.createElement(Le,{...e,user:t})};Ae.displayName="GetQrCode";var Te;!function(e){e.MAIN="main",e.QRCODE="qrcode",e.INBAND="inband",e.MANAGE_ACCESS="manage_access",e.COPY_LINK="copy_link",e.SETTINGS="settings",e.ERROR="error"}(Te||(Te={}));const Ie=e=>{const t=z.useRef(null),[n,o]=z.useState(-1),i=E.usePlatform()===E.Platforms.DESKTOP;z.useEffect((()=>{e.isOpen&&t.current&&"inband"!==e.currentScreen&&t.current.focus()}),[e.isOpen,e.currentScreen]);const r=e.onEscape,s=z.useCallback((e=>{if(!t.current)return;if("Shift"===e.key)return;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||t.isContentEditable)||(e.preventDefault(),e.nativeEvent.stopImmediatePropagation())}return"Escape"===e.key?(r(e),e.preventDefault(),void e.nativeEvent.stopImmediatePropagation()):void 0}),[r,n,o]),l="anchored_v1"===e.displayMode?e.onAnchorInvalid:void 0,c="anchored_v1"===e.displayMode?t:null,d=S.useIntersectionObserver(c,{threshold:[.99]});z.useLayoutEffect((()=>{d&&!d.isIntersecting&&l&&l()}),[d,null==d?void 0:d.isIntersecting,l]);const u="anchored_v1"===e.displayMode?e.anchorRef:null;if(z.useEffect((()=>{if("anchored_v1"!==e.displayMode||!l||null===u)return;const t=u.current;if(!t||"object"!=typeof t||!("nodeType"in t))return;const a=new MutationObserver((e=>{var a,n;for(const o of e)if("childList"===o.type)for(const e of Array.from(o.removedNodes))if(e===t||(null===(n=(a=e).contains)||void 0===n?void 0:n.call(a,t)))return void l()}));return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}}),[e.displayMode,l,u]),"centered_v1"===e.displayMode){const n=e.currentScreen===Te.SETTINGS?500:e.currentScreen===Te.COPY_LINK?400:380;return z.createElement(a.Modal$1,{open:e.isOpen,width:n,ariaHideApp:!1,onRequestClose:e.onClickOutside,overlayStyles:i?{overflow:"visible"}:void 0,contentStyles:i?{borderRadius:"unset"}:void 0,ref:t,isCentered:!0},z.createElement(E.FocusLock,{group:"share-modal"},z.createElement("div",{"data-testid":"shareme24-modal","data-uxa-log":"sm24-modal","data-uxa-interactions":"shown",className:a.cx(f.outerWrapper,{[f.outerWrapperDesktop]:i}),ref:e.modalCallbackRef,style:{width:n}},null!==e.header&&z.createElement(a.Modal$1.Header,{className:f.headerSection},e.header),z.createElement(a.Modal$1.Body,{className:a.cx(f.modalInnerWrapper,{[f.modalInnerWrapperMainExit]:e.isExitingMainToQr,[f.modalInnerWrapperSettings]:e.currentScreen===Te.SETTINGS}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children))))}if("drawer"===e.displayMode){const t="main"===e.currentScreen,n=t?"auto":"100%";return z.createElement(a.Drawer.ModalDrawer,{onRequestClose:e.onClickOutside,"aria-label":"sm24-drawer",isOpen:e.isOpen,alignment:"bottom",height:n,className:t?f.roundedCorner:void 0,"data-testid":"shareme24-drawer",shouldAnimate:!0,hasScrollLock:e.hasScrollLock},z.createElement(E.FocusLock,{group:"share-modal"},z.createElement("div",{className:a.cx(f.drawerOuterWrapper)},z.createElement(a.Drawer.Container,null,t?z.createElement("div",{className:f.handle}):void 0,z.createElement(a.Drawer.Header,{className:f.drawerHeader},z.createElement(a.Drawer.Layout,null,z.createElement(a.Drawer.LayoutItem,{width:"fill"},z.createElement(a.Drawer.Layout,null,e.header)))),z.createElement(a.Drawer.Body,{className:a.cx(f.modalInnerWrapper,f.drawerBody,{[f.drawerBodySettings]:e.currentScreen===Te.SETTINGS,[f.modalInnerWrapperMainExit]:e.isExitingMainToQr}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children)))))}return z.createElement(a.ClickOutside,{className:f.clickOutside,isActive:e.isOpen,onClickOutside:e.onClickOutside,shouldClickOutsideWhenDefaultPrevented:!1,"data-uxa-log":"sm24-clickaway","data-uxa-interactions":"click"},z.createElement(a.Overlay,{className:a.cx(f.overlay,{[f.overlayMainExit]:e.isExitingMainToQr}),offsetDistance:e.offsetDistance,anchorRef:e.anchorRef,placement:e.placement,auto:!0,onAnimationEnd:e.onOverlayOrModalAnimationEnd,elementResize:!0},z.createElement(E.FocusLock,{group:"share-modal"},z.createElement("div",{"data-testid":"shareme24-modal",className:a.cx(f.outerWrapper),style:{width:e.currentScreen===Te.SETTINGS?500:e.currentScreen===Te.COPY_LINK?400:380},onKeyDown:s,ref:a=>{t&&(t.current=a),"function"==typeof e.modalCallbackRef&&e.modalCallbackRef(a)},"data-uxa-log":"sm24-modal","data-uxa-interactions":"shown",tabIndex:0},null!==e.header&&z.createElement(a.Modal$1.Header,{className:f.headerSection},e.header),z.createElement(a.Modal$1.Body,{className:a.cx(f.modalInnerWrapper,{[f.modalInnerWrapperMainExit]:e.isExitingMainToQr,[f.modalInnerWrapperSettings]:e.currentScreen===Te.SETTINGS}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children)))))};Ie.displayName="Wrapper";const Ne=({styleName:e,...t})=>z.createElement("div",{className:`${f.buttonRow} ${e}`,"aria-hidden":t.hidden,...t},t.children);Ne.displayName="ButtonRow";const $e=({styleName:e,...t})=>z.createElement("div",{className:`${f.buttonRowButtonWrapper} ${e}`,"aria-hidden":t.hidden,...t},t.children);$e.displayName="ButtonRowButtonWrapper";const Me=e=>{(new Image).src=e},we=e=>({access_type:{".tag":"owner"},user:{account_id:e.account_id,email:e.email,display_name:e.display_name,same_team:!0,disabled:!1}}),Re=Symbol("ON_INITIAL_LOAD_START"),xe=Symbol("ON_INITIAL_LOAD_FAILURE"),Oe=Symbol("ON_INITIAL_LOAD_CANCEL"),Pe=Symbol("ON_INITIAL_LOAD_SUCCESS"),De=Symbol("ON_FOLDER_ALREADY_SHARED"),Ue=Symbol("ON_TEST_INITIAL_LOAD_START"),Be=Symbol("ON_TEST_INITIAL_LOAD_SUCCESS"),Ve=Symbol("ON_TEST_INITIAL_LOAD_CANCEL"),je=Symbol("ON_TEST_INITIAL_LOAD_FAILURE"),Fe=Symbol("ON_TEST_REFRESH_LOAD_START"),qe=Symbol("ON_TEST_REFRESH_LOAD_SUCCESS"),He=Symbol("ON_TEST_REFRESH_LOAD_CANCEL"),Ke=Symbol("ON_TEST_REFRESH_LOAD_FAILURE"),Ge=Symbol("ON_DOUBLE_READ_DIFF"),{useEmitter:Qe,defaultEmitter:We}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s=t(h.Context),l={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},c={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key!==Re){if(e.key===xe){let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response.error;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}const n={...l,errorType:e.payload.error.type,errorTag:t,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(T.PAP_Load_ShareModal({eventState:"failed",...c}),{key:s,tags:n}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"failed",key:s,tags:n})}if(e.key===Oe){const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(T.PAP_Load_ShareModal({eventState:"canceled",...c}),{eventState:"canceled",key:s,tags:t}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"canceled",key:s,tags:t})}if(e.key===Pe){const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(T.PAP_Load_ShareModal({eventState:"success",...c}),{key:s,tags:t}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"success",key:s,tags:t})}if(e.key!==De)if(e.key!==Ue)if(e.key!==Be)if(e.key!==Ve)if(e.key!==je)if(e.key!==Fe)if(e.key!==qe)if(e.key!==He)if(e.key!==Ke){if(e.key===Ge){const t=e.payload.diffs.reduce(((e,t)=>({...e,[`diff_${t.field}`]:"true"})),{});a.UDCL.logEvent("ops.sm24.double_read_diff",{tags:t,detail:{fileId:e.payload.fileId,diffs:e.payload.diffs}})}}else{let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"failed",key:s,tags:{...l,errorType:e.payload.error.type,errorTag:t}})}else a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"canceled",key:s,tags:l});else a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"success",key:s,tags:l});else a.UDCL.logStart("ops.sm24.test_refresh_data_load",{key:s,tags:l});else{let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"failed",key:s,tags:{...l,errorType:e.payload.error.type,errorTag:t}})}else a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"canceled",key:s,tags:l});else a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"success",key:s,tags:l});else a.UDCL.logStart("ops.sm24.test_initial_data_load",{key:s,tags:l});else a.UDCL.logEvent("ops.sm24.already_shared",{tags:l})}else{const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};a.UDCL.logStart("ops.sm24.initial_data_load",{key:s,tags:t})}})),Ye=e=>{const t=Qe(),{isNonUserRelativeContext:n}=A.useSharingApiContext();return z.useCallback((async()=>{const o=e.$nonce.get(),i=e.$options.get(),r=e.$state.get();let s=i.objectIdentifier;"loaded"===r.status&&(s=r.objectIdentifier);const l=i.objMetadataNewApiVariant,c="V1"===l&&s.fileId,d=!c,u="ON"===l&&s.fileId;t.select(Re).emit({objMetadataNewApiVariant:l});const m=a=>{e.$state.set({status:"error",errorType:"INITIAL_LOAD_ERROR",loadError:a}),t.select(xe).emit({error:a,objMetadataNewApiVariant:l})},_=await a.getSharingApiv2ResponseWithErrors(a.sharingPrefsPackage.fetchQuery(g.queryClient,{})),p=await a.getSharingApiv2ResponseWithErrors(a.sharingAccountInfoPackage.fetchQuery(g.queryClient,{},{staleTime:18e5}));let E,f,S,y;if(c?f=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(g.queryClient,{apiArg:{file_id:s.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})):E=await g.queryClient.fetchQuery(["object-metadata",i.objectIdentifier],(()=>L.getSharingObjectMetadata(s,n))),u&&(t.select(Ue).emit(null),S=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(g.queryClient,{apiArg:{file_id:s.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})),"SUCCESS"===S.status?t.select(Be).emit(null):"ERROR"===S.status?t.select(je).emit({error:{type:"METADATA_ERROR_V2",response:S.error}}):t.select(je).emit({error:{type:"METADATA_FATAL_V2",response:{status:a.Status$1.FATAL,error:S}}})),o!==e.$nonce.get())return t.select(Oe).emit({objMetadataNewApiVariant:l}),void(u&&t.select(Ve).emit(null));if(d){if(!E)return void m({type:"OTHER"});if("SUCCESS"!==E.status)return void("ERROR"===E.status?(k.reportStack("SM24 initial data loader error",{severity:k.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_error_V1"],exc_extra:{file_id:s.fileId,error:E},silent:!1}),m({type:"METADATA_ERROR",response:E})):(k.reportStack("SM24 initial data loader error",{severity:k.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_fatal_V1"],exc_extra:{file_id:s.fileId,error:E},silent:!1}),m({type:"METADATA_FATAL",response:E})));y=E.output}else{if(!f)return void m({type:"OTHER"});if("SUCCESS"!==f.status)return void("ERROR"===f.status?(k.reportStack("SM24 initial data loader error",{severity:k.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_error_V2"],exc_extra:{file_id:s.fileId,error:f},silent:!1}),m({type:"METADATA_ERROR_V2",response:f})):(k.reportStack("SM24 initial data loader error",{severity:k.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_fatal_V2"],exc_extra:{file_id:s.fileId,error:f},silent:!1}),m({type:"METADATA_FATAL_V2",response:f})));y=f.output}if(u&&"SUCCESS"===(null==S?void 0:S.status)){const e=a.normalizeNewApiMetadata(S.output),n=a.normalizeOldApiMetadata(y),{redactedDiffs:o,originalDiffs:i}=a.diffNormalizedMetadata(n,e);if(o.length>0){const e=S.output.common_metadata.file_id;if(t.select(Ge).emit({fileId:e,diffs:o}),i.length>0){const t=["sm24_metadata_diff",...i.map((e=>e.field)).map((e=>`diff_field_${e}`))];k.reportStack("SM24 metadata diff found",{severity:k.SEVERITY.NONCRITICAL,tags:t,exc_extra:{file_id:e,original_diffs:i},silent:!0})}}}if("SUCCESS"!==p.status||"SUCCESS"!==_.status)return void("SUCCESS"!==_.status?"ERROR"===_.status?m({type:"SHARING_PREFS_ERROR",response:_}):m({type:"SHARING_PREFS_FATAL",response:_}):"SUCCESS"!==p.status?m({type:"SHARING_ACCOUNT_INFO_ERROR"}):m({type:"OTHER"}));let C=s;"file_folder"===s[".tag"]&&a.getIsSharedFolder(y)&&(C={".tag":"shared_folder",sharedFolderId:a.getSharedFolderId(y),fileId:s.fileId}),e.$state.set({status:"loaded",objectIdentifier:C,memberActionsInProgress:{},memberAccountIdsAlreadyFetched:{},accountMetadata:p.output,memberAccounts:{},objectMetadata:y,sharingPrefs:_.output}),t.select(Pe).emit({objMetadataNewApiVariant:l})}),[e,t])},ze=e=>{const t=(e=>z.useCallback((t=>{(e.$options.get().onRefreshError||(()=>{}))(t)}),[e]))(e),{isNonUserRelativeContext:n}=A.useSharingApiContext(),o=Qe();return z.useCallback((async()=>{const i=e.$state.get();if("loaded"!==i.status)return;const r=e.$nonce.get(),s=e.$state.get(),l=e.$options.get().objMetadataNewApiVariant,c="V1"===l&&i.objectIdentifier.fileId,d=!c,u="ON"===l&&i.objectIdentifier.fileId;let m,_,p,E;if(c?_=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(g.queryClient,{apiArg:{file_id:i.objectIdentifier.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})):m=await L.getSharingObjectMetadata(i.objectIdentifier,n),u&&(o.select(Fe).emit(null),p=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(g.queryClient,{apiArg:{file_id:i.objectIdentifier.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})),"SUCCESS"===p.status?o.select(qe).emit(null):"ERROR"===p.status?o.select(Ke).emit({error:{type:"METADATA_ERROR_V2",response:p.error}}):o.select(Ke).emit({error:{type:"METADATA_FATAL_V2",response:{status:a.Status$1.FATAL,error:p}}})),e.$nonce.get()!==r||"loaded"!==s.status)return null;if(d){if(!m)return void t({type:"OTHER"});if("ERROR"===m.status)return t({type:"METADATA_ERROR",response:m}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"METADATA_ERROR",response:m}});if("FATAL"===m.status)return t({type:"FATAL",response:m}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"FATAL",response:m}});E=m.output}else{if(!_)return void t({type:"OTHER"});if("ERROR"===_.status)return t({type:"METADATA_ERROR_V2",response:_}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"METADATA_ERROR_V2",response:_}});if("FATAL"===_.status)return t({type:"FATAL",response:_}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"FATAL",response:_}});E=_.output}let f=s.objectIdentifier;return"file_folder"===s.objectIdentifier[".tag"]&&a.getIsSharedFolder(E)&&(f={".tag":"shared_folder",sharedFolderId:a.getSharedFolderId(E),fileId:s.objectIdentifier.fileId}),e.$state.set({...s,objectMetadata:E,objectIdentifier:f}),null}),[e,t,o])},Xe=e=>{const t=Ye(e),{variant:n,isLoading:o}=a.useExperimentVariant("sm24_obj_metadata_new_api"),i=!o,[r,s]=z.useState(null);z.useEffect((()=>{const o=null===(l=e.$options.get()).sessionId?null:"file"===l.objectIdentifier[".tag"]?`file:${l.sessionId}:${p.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`:"file_folder"===l.objectIdentifier[".tag"]?`folder:${l.sessionId}:${p.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`:`shared_folder:${l.sessionId}:${p.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`;var l;if(null===o)return null!==r&&s(null),void("unloaded"!==e.$state.get().status&&E.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"unloaded"})})));i&&(o===r&&"unloaded"!==e.$state.get().status||(E.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"loading"})})),s(o),e.$options.set({...e.$options.get(),objMetadataNewApiVariant:n}),a.logExposure({feature:"sm24_obj_metadata_new_api",variant:n}),t()))}))},Ze=e=>{const t=e.$state.get(),{user:n,isLoading:o}=a.useActiveUser(),i="loaded"===t.status&&!a.getIsLinkOnlyMode(t.objectMetadata)&&(a.getCanInvite(t.objectMetadata,h.VIEWER)||a.getCanInvite(t.objectMetadata,h.EDITOR)),r=e.$options.get().objectIdentifier;z.useEffect((()=>{i&&!o&&n&&(async(e,t)=>{b.prefetchListObjectMembersData(t),C.prefetchListSharedLinks(t),"file"===t[".tag"]&&b.prefetchSeenStateInfoData(t.fileId);const a=await v.fetchObjectMembers(t,!0);if(a){const{groups:t,users:n,invitees:o}={...a};0===n.length&&0===t.length&&0===o.length&&e&&(a.users=[we(e)]);const i=a.users.map((e=>e.user.account_id)),r=await C.getAccountBatch(i);if("SUCCESS"===r.status){const t=Object.values(r.output),a=t.find((t=>t.account_id===(null==e?void 0:e.account_id)));(null==a?void 0:a.profile_photo_url)&&Me(a.profile_photo_url),t.slice(0,2).forEach((e=>{e.profile_photo_url&&Me(e.profile_photo_url)}))}}})(n,r)}),[i,o,n,r])},Je=e=>{const t=ze(e),a=Ye(e),n=(e=>z.useCallback((t=>{const a=e.$state.get();"loaded"===a.status&&e.$state.set({...a,objectIdentifier:t})}),[e]))(e),o=E.useStore(e.$state);return z.useMemo((()=>({...o,refreshObjectMetadata:t,refreshModal:a,onObjectIdentifierChanged:n})),[o,t,a,n])},et=e=>{const t=(e=>E.useInitStore(e,(()=>({$nonce:E.store(0),$options:E.store(e),$state:E.store({status:"unloaded"})}))))(e);return Xe(t),Ze(t),(e=>{z.useEffect((()=>()=>{E.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"unloaded"})}))}),[])})(t),Je(t)},tt=({children:e,...t})=>{const a=et(t);return z.createElement(g.QueryClientProvider,{client:g.queryClient},z.createElement(z.Fragment,null,e(a)))};tt.displayName="ShareModalDataLoader";const at=z.createContext({status:"unloaded"}),nt=({children:e,...t})=>z.createElement(tt,{...t},(t=>z.createElement(at.Provider,{value:t},e)));nt.displayName="Provider";const ot=()=>z.useContext(at),it=Symbol("ON_CLICK_PROGRESSIVE"),rt=Symbol("ON_MOUSE_ENTER_PROGRESSIVE"),st=Symbol("ON_MOUSE_LEAVE_PROGRESSIVE"),{useEmitter:lt,defaultEmitter:ct}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===it)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"copy_link"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"copy_link"}});if(e.key!==rt){if(e.key!==st)return a.exhausts(e,void 0);a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"copy_link"}})}else a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link"}),{tags:{...s,action:"copy_link"}})})),dt=e=>{const{objectMetadata:t,accountMetadata:n,onCopyLinkButtonClicked:o,componentViewTime:i}=e,r=a.isNewApiMetadata(t),[s,l]=z.useState(!1),[c,d]=z.useState(!1),[g,m]=z.useState(0),_=z.useRef(null),p=lt(),E=L.isTmrMember(n),f=a.getCanCreateLink(t,a.VIEWER,E),S=a.getCanCreateLink(t,a.EDITOR,E)||f,y=z.useCallback((()=>{const e=c?Date.now()-g:void 0,t=Date.now()-i;p.select(it).emit({dwellTime:e,timeSinceView:t}),o()}),[i,p,c,o,g]),C=z.useCallback((()=>{m(Date.now()),d(!0),p.select(rt).emit(null),l(!0)}),[p]),b=z.useCallback((()=>{const e=c?Date.now()-g:void 0;d(!1),p.select(st).emit({dwellTime:e}),l(!1)}),[p,c,g]),v=z.useMemo((()=>!!r&&!S),[r,S]);return z.createElement(z.Fragment,null,z.createElement(M.ButtonWrapper,{ref:_,onMouseEnter:C,onMouseLeave:b,"data-uxa-log":"sharing-lego-copy_link-button.loaded","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{onClick:y,disabled:v,"data-testid":"copy-link-entry-button"},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:R.LinkLine,size:"medium","data-testid":"copy-link-entry-button-icon"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(M.ButtonTitle,{content:(h=u.intl,h.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))})))),(()=>{let e=null;return r&&!S&&(e=z.createElement(a.Text,null,u.intl.formatMessage({id:"wVml0u",defaultMessage:"You don’t have permission to copy this link."}))),e?z.createElement(a.Tooltip.Control,{open:s,placement:"top",auto:!0,triggerRef:_,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)},e):null})());var h};dt.displayName="CopyLinkEntryButtonInner";const ut=e=>{const{objectIdentifier:t,onCopyLinkButtonClicked:n,componentViewTime:o}=e,i=L.useSharingObjectMetadata(t.fileId),r=L.useSharingAccountInfo(),s=i.isLoading,l=!i.isLoading&&i.isError,c=s||l?void 0:i.output,d=r.isLoading,u=!r.isLoading&&r.isError,g=d||u?void 0:r.output;return s||d?z.createElement(M.ButtonWrapper,{"data-uxa-log":"sharing-lego-copy-link-button.loading","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{disabled:!0},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:R.LinkLine,size:"medium"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}})))):c&&g?z.createElement(dt,{accountMetadata:g,objectMetadata:c,onCopyLinkButtonClicked:n,componentViewTime:o}):null};ut.displayName="CopyLinkEntryButton";const gt=Symbol("ON_CLICK"),mt=Symbol("ON_MOUSE_ENTER"),_t=Symbol("ON_MOUSE_LEAVE"),{useEmitter:pt,defaultEmitter:Et}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===gt)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"copy_link"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"copy_link"}});e.key!==mt?e.key!==_t||a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"copy_link"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link"}),{tags:{...s,action:"copy_link"}})})),ft=({store:e,objectMetadata:t,isSimpleCopyLinkPending:n=!1})=>{const o=!!t&&a.isNewApiMetadata(t),[i,r]=z.useState(!1),s=z.useRef(null),l=pt(),c=!!t&&a.getCanCreateLink(t,a.VIEWER,!1),d=!!t&&a.getCanCreateLink(t,a.EDITOR,!1),g=c||d,m=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();l.select(gt).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickCopyLinkButton()}),[l,e]),_=z.useCallback((()=>{l.select(mt).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now()),r(!0)}),[l,e]),p=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;l.select(_t).emit({dwellTime:t}),e.$isHovered.set(!1),e.$hoverStartTime.set(0),r(!1)}),[l,e]);z.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const E=n||!!o&&!g;return z.createElement(z.Fragment,null,z.createElement(M.ButtonWrapper,{ref:s,onMouseEnter:_,onMouseLeave:p,"data-uxa-log":"sm24-copy_link-button.loaded","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{onClick:m,disabled:E,"data-testid":"copy-link-button"},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:R.LinkLine,size:"medium","data-testid":"copy-link-icon"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(M.ButtonTitle,{content:(f=u.intl,f.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))})))),(()=>{let e=null;return o&&!g&&(e=z.createElement(a.Text,null,u.intl.formatMessage({id:"wVml0u",defaultMessage:"You don’t have permission to copy this link."}))),e?z.createElement(a.Tooltip.Control,{open:i,placement:"top",auto:!0,triggerRef:s,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},e):null})());var f};ft.displayName="LoadedButton";const St=()=>z.createElement(M.ButtonWrapper,{"data-uxa-log":"sm24-copy-link-button.loading","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{disabled:!0},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:R.LinkLine,size:"medium"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}}))));St.displayName="LoadingButton";const yt=({store:e,isSimpleCopyLinkPending:t})=>{const{variant:n,isLoading:o}=a.useExperimentVariant("sm24_obj_metadata_new_api"),i=ot();return o||"V1"===n&&"loading"===i.status?z.createElement(St,null):"V1"===n&&"error"===i.status?null:"V1"===n&&"loaded"===i.status?z.createElement(ft,{store:e,objectMetadata:i.objectMetadata,isSimpleCopyLinkPending:t}):z.createElement(ft,{store:e})};yt.displayName="Inner";const Ct=e=>{const t=(e=>E.useInitStore(e,(e=>({$props:e,$isHovered:E.store(!1),$hoverStartTime:E.store(0),$componentViewTime:E.store(0)}))))(e);return z.createElement(yt,{store:t,isSimpleCopyLinkPending:e.isSimpleCopyLinkPending})};var bt;Ct.displayName="CopyLinkButton",function(e){e.MAIN="main",e.QRCODE="qrcode",e.INBAND="inband",e.MANAGE_ACCESS="manage_access",e.COPY_LINK="copy_link",e.SETTINGS="settings",e.ERROR="error"}(bt||(bt={}));const vt=({store:e})=>{const{objectIdentifier:t,shouldUseSimpleCopyLink:n,isSimpleCopyLinkPending:o}=E.useStore(e.$props),i=E.useStore(e.$componentViewTime),{variant:r,isLoading:s}=a.useExperimentVariant("sm24_copy_link"),l=z.useCallback((()=>{E.batch((()=>{e.$props.get().copyLinkHandler(),e.$props.get().onActionClicked(!0)}))}),[e]),c=E.usePlatform()===E.Platforms.METASERVER,d=z.useCallback((()=>{let t=()=>{};const a=new Promise((e=>{t=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":a});navigator.clipboard.write([e])}else a.then((e=>navigator.clipboard.writeText(e)));const n={write:e=>t(e)};c?(e.$clipboardWriter.set(n),e.$isClickawayLocked.set(!0),$.showOQModalOrContinue({action:"share_link",continueCallback:()=>{E.batch((()=>{e.$currentScreen.set(bt.COPY_LINK),e.$isClickawayLocked.set(!1)}))},abortCallback:()=>{e.$isClickawayLocked.set(!1)}})):E.batch((()=>{e.$clipboardWriter.set(n),e.$currentScreen.set(bt.COPY_LINK)}))}),[e,c]);return z.useMemo((()=>!n&&(a.logExposure({feature:"sm24_copy_link",variant:r}),!s&&"V3"===r)),[n,r,s])?z.createElement(ut,{onCopyLinkButtonClicked:d,objectIdentifier:t,componentViewTime:i}):z.createElement(Ct,{onClickCopyLinkButton:l,objectIdentifier:t,isSimpleCopyLinkPending:o})};vt.displayName="CopyLinkButton";const ht=e=>e.formatMessage({id:"LXsTaR",defaultMessage:"Share with Stacks"}),kt=e=>e.formatMessage({id:"Sk39rj",defaultMessage:"New"}),Lt=Symbol("ON_CLICK"),At=Symbol("ON_MOUSE_ENTER"),Tt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:It,defaultEmitter:Nt}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===Lt)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"stack"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"stack"}});e.key!==At?e.key!==Tt||a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"stack"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"stack"}),{tags:{...s,action:"stack"}})})),$t="stack-button",Mt="stack-icon",wt=({store:e,showStackNewFeatureBadge:t,user:n})=>{const o=It(),i=z.default.useCallback((()=>{const i=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,r=Date.now()-e.$componentViewTime.get();o.select(Lt).emit({dwellTime:i,timeSinceView:r}),e.$isHovered.set(!1),t&&a.setUserMetadata({FSS_STACKS_SM24_SEEN:!0},n),e.$props.get().onClickStackButton()}),[n,e,o,t]),r=z.default.useCallback((()=>{o.select(At).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,o]),s=z.default.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;o.select(Tt).emit({dwellTime:t}),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,o]);return z.default.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),z.default.createElement(z.default.Fragment,null,z.default.createElement(M.ButtonWrapper,{onMouseEnter:r,onMouseLeave:s,"data-uxa-log":"sm24-stack-button.loaded","data-uxa-interactions":"shown click"},z.default.createElement(M.HorizontalButton,{"data-testid":$t,onClick:i},z.default.createElement(M.ButtonIconContainer,null,z.default.createElement(a.UIIcon,{src:x.CreateStackLine,size:"medium","data-testid":Mt})),z.default.createElement(M.ButtonInnerRow,null,z.default.createElement(M.ButtonTitle,{content:ht(u.intl)}),t&&z.default.createElement(a.Box,{style:{height:"var(--dig-spacing__macro__small)"},color:"Identity On Yellow",borderRadius:"Small",backgroundColor:"Identity Yellow",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Action",fontSize:"Action Small",fontWeight:"Strong",letterSpacing:"Action",paddingLeft:"10",paddingRight:"10","data-testid":"stack-new-feature-badge","aria-label":kt(u.intl)},kt(u.intl))))))};wt.displayName="StackButton";const Rt=({store:e})=>{const t=It(),{isFolderFileCountOverLimit:n}=E.useStore(e.$props),[o,i]=z.default.useState(!1),r=z.default.useRef(null),s=z.default.useCallback((()=>{t.select(At).emit(null),i(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),l=z.default.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(Tt).emit({dwellTime:a}),i(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);return z.default.createElement(z.default.Fragment,null,z.default.createElement(M.ButtonWrapper,{ref:r,onMouseEnter:s,onMouseLeave:l,"data-uxa-log":"sm24-stack-button.disabled","data-uxa-interactions":"shown click"},z.default.createElement(M.HorizontalButton,{disabled:!0,"data-testid":$t},z.default.createElement(M.ButtonIconContainer,null,z.default.createElement(a.UIIcon,{src:x.CreateStackLine,size:"medium","data-testid":Mt})),z.default.createElement(M.ButtonInnerColumn,null,z.default.createElement(M.ButtonTitle,{content:ht(u.intl)})))),n&&z.default.createElement(a.Tooltip.Control,{open:o,placement:"left",auto:!0,triggerRef:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)},z.default.createElement(a.Text,null,u.intl.formatMessage({id:"uJJZGp",defaultMessage:"Can’t add more than 200 files to a Stack at a time"}))))};Rt.displayName="StackButtonDisabled";const xt=()=>z.default.createElement(M.ButtonWrapper,{"data-uxa-log":"sm24-stack-button.loading","data-uxa-interactions":"shown click"},z.default.createElement(M.HorizontalButton,{disabled:!0,"data-testid":$t},z.default.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),z.default.createElement(a.Skeleton.Text,{size:"large",width:200})));xt.displayName="LoadingButton";const Ot=({store:e})=>{const{isFolderFileCountOverLimit:n,contents:o}=E.useStore(e.$props),i=a.mustGetActiveUserApiV2Properties(),[r,s]=t.useState(null);return t.useEffect((()=>{a.getUserMetadata(["FSS_STACKS_SM24_SEEN"],i).then((e=>{s(!e.FSS_STACKS_SM24_SEEN)}))}),[i]),null===r?z.default.createElement(xt,null):o?z.default.createElement(wt,{store:e,showStackNewFeatureBadge:r,user:i}):null===n?z.default.createElement(xt,null):z.default.createElement(Rt,{store:e})};Ot.displayName="Inner";const Pt=e=>{const t=(e=>{const t=ot(),a=E.useInitStore(t,(e=>e));return E.useInitStore(e,(e=>{const t=E.store(!1),n=E.store(0),o=E.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return z.default.createElement(Ot,{store:t})};Pt.displayName="StacksButton";const Dt=({store:e})=>{const t=z.useCallback((()=>{e.$props.get().createStackHandler(),e.$props.get().onActionClicked()}),[e]),a=E.useStore(e.$isFolderFileCountOverLimit),n=E.useStore(e.$contents);return z.createElement(Pt,{onClickStackButton:t,isFolderFileCountOverLimit:a,contents:n})};Dt.displayName="DashStacksButton";const Ut=({store:e})=>{const{objectIdentifier:t}=E.useStore(e.$props),a=E.useStore(e.$componentViewTime),n=E.usePlatform()===E.Platforms.METASERVER,o=z.useCallback((()=>{E.batch((()=>{e.$isEnteringInband.set(!0),e.$currentScreen.set(bt.INBAND),e.$isInbandStarted.set(!0)}))}),[e]);return z.createElement(w.InbandEntryButton,{oid:t,onInbandButtonClicked:()=>{n?(e.$isInterstitialVisible.set(!0),$.showOQModalOrContinue({show:$.Show.WarningOnly,action:"share_add_people",continueCallback:()=>{o(),e.$isInterstitialVisible.set(!1)},abortCallback:()=>e.$isInterstitialVisible.set(!1)})):o()},componentViewTime:a})};Ut.displayName="InbandInviteButton";const Bt=e=>e.formatMessage({id:"O6jjXZ",defaultMessage:"Create a view-only QR code"}),Vt=Symbol("ON_CLICK"),jt=Symbol("ON_MOUSE_ENTER"),Ft=Symbol("ON_MOUSE_LEAVE"),{useEmitter:qt,defaultEmitter:Ht}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===Vt)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"qr_code"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"qr_code"}});e.key!==jt?e.key!==Ft||a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"qr_code"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"qr_code"}),{tags:{...s,action:"qr_code"}})})),Kt=({store:e})=>{const[t,n]=z.useState(!1),o=z.useRef(null),i=E.useStore(e.$data),r=qt(),s=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();r.select(Vt).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickQrCodeButton()}),[e,r]),l=z.useCallback((()=>{r.select(jt).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,r]),c=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;r.select(Ft).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,r]);z.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const d="loaded"===i.status?i.objectMetadata:void 0,g=!!d&&a.getCanCreateLink(d,a.VIEWER,!1),m=g?Bt(u.intl):u.intl.formatMessage({id:"8T+dAM",defaultMessage:"You don’t have permission to create a QR code."});return z.createElement(z.Fragment,null,z.createElement(a.Box,{ref:o,onMouseEnter:l,onMouseLeave:c,"data-uxa-log":"sm24-qrcode-button.loaded","data-uxa-interactions":"shown click"},z.createElement(M.UtilityIconButton,{"data-testid":"qr-code-button",onClick:s,variant:e.$props.get().buttonVariant,disabled:!g},z.createElement(a.UIIcon,{src:x.QrCodeLine,"aria-label":Bt(u.intl)})),z.createElement(a.Tooltip.Control,{open:t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},z.createElement(a.Text,null,m))))};Kt.displayName="LoadedButton";const Gt=({store:e})=>z.createElement(Kt,{store:e});Gt.displayName="Inner";const Qt=e=>{const t=(e=>{const t=ot(),a=E.useInitStore(t,(e=>e));return E.useInitStore(e,(e=>{const t=E.store(!1),n=E.store(0),o=E.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return z.createElement(Gt,{store:t})};Qt.displayName="QrCodeButton";const Wt=({store:e,buttonVariant:t,onRequestClose:a,shouldDisableQRCodeAnimation:n})=>{const o=E.usePlatform()===E.Platforms.METASERVER,i=z.useCallback((()=>{E.batch((()=>{n?e.$currentScreen.set(bt.QRCODE):(e.$isExitingMainToQr.set(!0),e.$isEnteringQr.set(!0))}))}),[e.$isExitingMainToQr,e.$isEnteringQr,e.$currentScreen,n]),r=z.useCallback((()=>{o?(e.$isInterstitialVisible.set(!0),$.showOQModalOrContinue({action:"share_qr_code",continueCallback:()=>{i(),e.$isInterstitialVisible.set(!1)},abortCallback:()=>{a(),e.$isInterstitialVisible.set(!1)}})):i()}),[o,i,a,e.$isInterstitialVisible]);return z.createElement(Qt,{onClickQrCodeButton:r,buttonVariant:t})};Wt.displayName="QrCodeButton";const Yt=e=>e.formatMessage({id:"8sEPDx",defaultMessage:"Settings"}),zt=Symbol("ON_CLICK"),Xt=Symbol("ON_MOUSE_ENTER"),Zt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:Jt,defaultEmitter:ea}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===zt)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"settings"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"settings"}});e.key!==Xt?e.key!==Zt||a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"settings"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"settings"}),{tags:{...s,action:"settings"}})})),ta=({store:e})=>{const[t,n]=z.useState(!1),o=z.useRef(null),i=Jt(),r=z.useCallback((()=>{const t=e.$data.get(),n=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,o=Date.now()-e.$componentViewTime.get();i.select(zt).emit({dwellTime:n,timeSinceView:o}),e.$isHovered.set(!1);let r=!1;"loaded"!==t.status||a.isNewApiMetadata(t.objectMetadata)?"loaded"===t.status&&a.isNewApiMetadata(t.objectMetadata)&&(r=!a.getCanInvite(t.objectMetadata,h.VIEWER)&&!a.getCanInvite(t.objectMetadata,h.EDITOR)):r=a.getIsLinkOnlyMode(t.objectMetadata),e.$props.get().onClickSettingsButton({shouldOpenLinkSettings:r})}),[e,i]),s=z.useCallback((()=>{i.select(Xt).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,i]),l=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;i.select(Zt).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,i]);return z.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),z.createElement(z.Fragment,null,z.createElement(M.UtilityIconButton,{"data-testid":"settings-button",onClick:r,onMouseEnter:s,onMouseLeave:l,ref:o,variant:e.$props.get().buttonVariant,"data-uxa-log":"sm24-settings-button.loaded","data-uxa-interactions":"shown click","data-campaign-element-id":"share-modal-settings-button"},z.createElement(a.UIIcon,{src:a.SettingsLine,"aria-label":Yt(u.intl)})),z.createElement(a.Tooltip.Control,{open:t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},z.createElement(a.Text,null,Yt(u.intl))))};ta.displayName="LoadedButton";const aa=({store:e})=>z.createElement(ta,{store:e});aa.displayName="Inner";const na=e=>{const t=(e=>{const t=ot(),a=E.useInitStore(t,(e=>e));return E.useInitStore(e,(e=>{const t=E.store(!1),n=E.store(0),o=E.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return z.createElement(aa,{store:t})};na.displayName="SettingsButton";const oa=({store:e,buttonVariant:t})=>{const{objectIdentifier:a}=E.useStore(e.$props),n=z.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?(a.onActionClicked(),a.settingsHandler(t)):e.$currentScreen.set(bt.SETTINGS)}),[e]);return z.createElement(na,{onClickSettingsButton:n,objectIdentifier:a,buttonVariant:t})};oa.displayName="SettingsButton";const ia=e=>e.formatMessage({id:"FuFURj",defaultMessage:"Transfer a copy"}),ra=Symbol("ON_CLICK"),sa=Symbol("ON_CLICK_ENABLE_TRANSFER"),la=Symbol("ON_MOUSE_ENTER"),ca=Symbol("ON_MOUSE_LEAVE"),{useEmitter:da,defaultEmitter:ua}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===ra)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"transfer"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"transfer"}});e.key!==la?e.key!==ca?e.key!==sa||a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"enable_transfer_tooltip"}),{tags:{...s,action:"transfer"}}):a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"transfer"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"transfer"}),{tags:{...s,action:"transfer"}})})),ga=({store:e})=>{const t=da(),n=z.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,n=Date.now()-e.$componentViewTime.get();t.select(ra).emit({dwellTime:a,timeSinceView:n}),e.$isHovered.set(!1),e.$props.get().onClickTransferButton()}),[e,t]),o=z.useCallback((()=>{t.select(la).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),i=z.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(ca).emit({dwellTime:a}),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);return z.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),z.createElement(z.Fragment,null,z.createElement(M.ButtonWrapper,{onMouseEnter:o,onMouseLeave:i,"data-uxa-log":"sm24-transfer-button.loaded","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{"data-testid":"transfer-button",onClick:n},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:O.DropboxTransferLine,size:"medium"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(M.ButtonTitle,{content:ia(u.intl)})))))};ga.displayName="ChonkyBoiiLoadedButton";const ma=({store:e})=>{const t=da(),n=E.useOpenUrl(),[o,i]=z.useState(!1),r=z.useRef(null),{canUserUseTransfer:s,canContentUseTransfer:l,canUserEnableTransfer:c}=E.useStore(e.$props),d=z.useCallback((()=>{t.select(sa).emit(null),n("/team/admin/settings/sharing")}),[t,n]),g=z.useCallback((()=>{t.select(la).emit(null),i(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),m=z.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(ca).emit({dwellTime:a}),i(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);let _="";var p,f;return s?l||(_=(e=>e.formatMessage({id:"LvDT7L",defaultMessage:"This is not a file type that can be copied."}))(u.intl)):c?(p=u.intl,f=()=>{d()},_=p.formatMessage({id:"eGWSHS",defaultMessage:"Your team has transfer turned off. <button>Turn on</button>"},{button:e=>z.createElement(a.Button,{variant:"transparent",onClick:f},e)})):_=(e=>e.formatMessage({id:"l+F4Tm",defaultMessage:"Ask an admin to allow Transfer a copy."}))(u.intl),z.createElement(z.Fragment,null,z.createElement(M.ButtonWrapper,{"data-uxa-log":"sm24-transfer-button.disabled","data-uxa-interactions":"shown click",ref:r,onMouseEnter:g,onMouseLeave:m},z.createElement(M.VerticalButton,{disabled:!0},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:O.DropboxTransferLine,size:"medium"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(M.ButtonTitle,{content:ia(u.intl)})))),z.createElement(a.Tooltip.Control,{open:o,placement:"top",auto:!0,triggerRef:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)},z.createElement(a.Text,null,_)))};ma.displayName="ChonkyBoiiDisabledButton";const _a=()=>z.createElement(M.ButtonWrapper,{"data-uxa-log":"sm24-transfer-button.loading","data-uxa-interactions":"shown click"},z.createElement(M.VerticalButton,{disabled:!0},z.createElement(M.ButtonIconContainer,null,z.createElement(a.UIIcon,{src:O.DropboxTransferLine,size:"medium"})),z.createElement(M.Spacer,null),z.createElement(M.ButtonInnerColumn,null,z.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}}))));_a.displayName="LoadingButton";const pa=({store:e})=>{const{canUserUseTransfer:t,canContentUseTransfer:a,isTransferEligibilityLoading:n}=E.useStore(e.$props);return n?z.createElement(_a,null):t&&a?z.createElement(ga,{store:e}):z.createElement(ma,{store:e})};pa.displayName="Inner";const Ea=e=>{const t=(e=>{const t=ot(),a=E.useInitStore(t,(e=>e));return E.useInitStore(e,(e=>{const t=E.store(!1),n=E.store(0),o=E.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return z.createElement(pa,{store:t})};Ea.displayName="TransferButton";const fa=({store:e})=>{const{objectIdentifier:t}=E.useStore(e.$props),a=z.useCallback((()=>{e.$props.get().transferHandler(),e.$props.get().onActionClicked()}),[e]),n=E.useStore(e.$canContentUseTransfer),o=E.useStore(e.$canUserUseTransfer),i=E.useStore(e.$canUserEnableTransfer),r=E.useStore(e.$isTransferEligibilityLoading);return z.createElement(Ea,{canContentUseTransfer:n,canUserUseTransfer:o,canUserEnableTransfer:i,isTransferEligibilityLoading:r,onClickTransferButton:a,objectIdentifier:t})};fa.displayName="TransferButton";const Sa=(e,t)=>{switch(t[".tag"]){case"editor":return{title:e.formatMessage({id:"nop2ci",defaultMessage:"Edit link"}),subtitle:e.formatMessage({id:"Yzhe/8",defaultMessage:"People with this link can edit, comment, delete and add files"}),buttonTitle:e.formatMessage({id:"XcciHL",defaultMessage:"Edit link"})};case"viewer":return{title:e.formatMessage({id:"B6qDgp",defaultMessage:"View link"}),subtitle:e.formatMessage({id:"CWTjfa",defaultMessage:"People with this link can view, comment, and download"}),buttonTitle:e.formatMessage({id:"Ok2dm/",defaultMessage:"View link"})};default:return{title:"",subtitle:"",buttonTitle:""}}},ya=()=>z.createElement("div",{"data-testid":"loading-screen",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--dig-spacing__micro__small)",height:"122px"},"data-uxa-log":"sm24-copy_link_screen.loading","data-uxa-interactions":"shown"},z.createElement(a.Spinner,{size:"medium",withTrack:!0,hasOpaqueTrack:!0}),z.createElement(a.Text,{size:"small",color:"subtle"},u.intl.formatMessage({id:"XtsMXq",defaultMessage:"Getting the link"})));ya.displayName="LoadingScreen";const Ca=Symbol("COPY_LINK_SCREEN_LINK_CREATED"),ba=Symbol("COPY_LINK_HANDLE_AUDIENCE_CHANGE"),va=Symbol("COPY_LINK_ACCESS_LEVEL_TOGGLED"),ha=Symbol("COPY_LINK_HANDLE_ACCESS_LEVEL_CHANGE"),ka=Symbol("COPY_LINK_SCREEN_LOADING"),La=Symbol("COPY_LINK_SCREEN_LOADED"),Aa=Symbol("COPY_LINK_SETTINGS_BUTTON_CLICKED"),Ta=Symbol("COPY_LINK_AUDIENCE_TOGGLED"),Ia=Symbol("COPY_LINK_SCREEN_ERROR"),Na=Symbol("COPY_LINK_SCREEN_LINK_COPIED"),$a=Symbol("COPY_LINK_CTA_CLICKED"),Ma=Symbol("COPY_LINK_UPDATING"),wa=Symbol("COPY_LINK_MANAGE_ACCESS_LEVEL_CLICKED"),Ra=Symbol("ON_CREATE_SHARED_LINK_START"),xa=Symbol("ON_CREATE_SHARED_LINK_SUCCESS"),Oa=Symbol("ON_CREATE_SHARED_LINK_ERROR"),Pa=Symbol("ON_CREATE_SHARED_LINK_CANCELED"),Da=Symbol("ON_RECOPY_LINK_START"),Ua=Symbol("ON_COPY_SHARED_LINK_SUCCESS"),Ba=Symbol("ON_COPY_SHARED_LINK_ERROR"),Va=Symbol("ON_COPY_SHARED_LINK_CANCELED"),ja=Symbol("COPY_LINK_SCREEN_ERROR_HELP_CLICKED"),{useEmitter:Fa,defaultEmitter:qa}=I.defineLogger((async({event:e,getContextValue:t})=>{var n,o;const i=t(N.Context),r=t(N.Context$1),s=t(N.Context$2),l=t(N.Context$3),c={...N.getTags(i),...N.getTags$1(r),...N.getTags$2(s),...N.getTags$3(l)},d={isDir:c.isDir,isSm24:c.isSm24,screen:c.screen,actionSurfaceAndElement:`${c.actionSurface}___${c.actionElement}`},u={...N.getProperties(i),...N.getProperties$1(r),...N.getProperties$2(s),...N.getProperties$3(l)},g={isDir:u.isDir,actionSurface:null!==(n=u.actionSurface)&&void 0!==n?n:"undefined",actionElement:null!==(o=u.actionElement)&&void 0!==o?o:"undefined",contentAction:u.contentAction,shareModalType:u.shareModalType,contentIdentifier:u.contentIdentifier,screen:u.screen};if(u.isDir?(g.nsId=Number(u.contentIdentifier),u.sharedObjType&&(g.folderType=q.getFolderTypeFromSharedObjType(u.isDir,u.sharedObjType))):g.fileExtension=u.fileExtension,e.key!==ba)if(e.key!==va)if(e.key!==ha)if(e.key!==Ca)if(e.key!==ka)if(e.key!==La)if(e.key!==Aa)if(e.key!==Ta)if(e.key!==Ia)if(e.key!==Na)if(e.key!==$a)if(e.key!==Ma)if(e.key!==wa){if(e.key===Ra){const t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel};return a.UDCL.logStart(j.PAP_Create_SharedLink({...t}),{tags:{...d}}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logStart(j.PAP_Copy_SharedLink({...t}),{tags:{...d}}))}if(e.key===xa){const t=await F.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier),n={...g,...t,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,sharedLinkResolvedAccessLevel:e.payload.resolvedAccessLevel,createdNewLink:e.payload.isNewlyCreated};return e.payload.httpStatusCode&&(n.httpStatusCode=e.payload.httpStatusCode),void a.UDCL.logEnd(j.PAP_Create_SharedLink({eventState:"success",...n}),{tags:{...d,createdNewLink:e.payload.isNewlyCreated.toString()},eventState:"success"})}if(e.key===Oa){const t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,createSharedLinkErrorReason:F.getCreateSharedLinkErrorReasonFromString(e.payload.error)};return e.payload.httpStatusCode&&(t.httpStatusCode=e.payload.httpStatusCode),a.UDCL.logEnd(j.PAP_Create_SharedLink({...t,eventState:"failed"}),{tags:{...d},eventState:"failed"}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logEnd(j.PAP_Copy_SharedLink({...g,eventState:"failed"}),{tags:{...d},eventState:"failed"}))}if(e.key===Pa)return a.UDCL.logEnd(j.PAP_Create_SharedLink({...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"}),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logEnd(j.PAP_Copy_SharedLink({...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"}),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"}));if(e.key!==Da)if(e.key!==Ua)if(e.key!==Ba)if(e.key!==Va)e.key!==ja||a.UDCL.logEvent("ops.sm24.copyLinkScreenErrorHelpClicked",{tags:d});else{let t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"};if(e.payload.linkMetadata){const a=await F.getLinkProps(e.payload.linkMetadata.url,e.payload.linkMetadata.link_permissions.link_access_level[".tag"],g.sharedLinkIdentifier);t={...t,...a}}a.UDCL.logEnd(j.PAP_Copy_SharedLink(t),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"})}else{let t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,createSharedLinkErrorReason:F.getCreateSharedLinkErrorReasonFromString(e.payload.error),eventState:"failed"};if(e.payload.linkMetadata){const a=await F.getLinkProps(e.payload.linkMetadata.url,e.payload.linkMetadata.link_permissions.link_access_level[".tag"],g.sharedLinkIdentifier);t={...t,...a}}a.UDCL.logEnd(j.PAP_Copy_SharedLink(t),{tags:{...d},eventState:"failed"})}else{const t=await F.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier);a.UDCL.logEnd(j.PAP_Copy_SharedLink({...g,...t,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,sharedLinkResolvedAccessLevel:e.payload.resolvedAccessLevel,createdNewLink:e.payload.isNewlyCreated,eventState:"success"}),{tags:{...d,createdNewLink:e.payload.isNewlyCreated.toString()},eventState:"success"})}else{const t=await F.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier);a.UDCL.logStart(j.PAP_Copy_SharedLink({...t,...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel}),{tags:{...d}})}}else a.UDCL.logEvent("ops.sm24.copyLinkManageAccessLevelClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkUpdating",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkCtaClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLinkCopied",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenError",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkAudienceToggled",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkSettingsButtonClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLoaded",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLoading",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenlinkCreated",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkHandleAccessLevelChange",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkAccessLevelToggled",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkHandleAudienceChange",{tags:d})})),Ha=(e,n)=>{var o,i,r;const s=Fa(),l=E.useLogger(),c=(e=>g.useMutation({mutationFn:e=>a.createSharedLinkWithSettingsMutationFn()({queryClient:g.queryClient,reqCtx:{}})({apiArg:e}),onSettled:async()=>await C.invalidateListSharedLinks(e)}))(e);if(t.useEffect((()=>{c.isIdle&&(s.select(Ra).emit({requestedAccessLevel:n[".tag"],alsoLogCopyLinkEvent:!0}),c.mutate({path:p.getContentIdOrPathFromObjectIdentifier(e),settings:{access:n}}))}),[c,n,e,s]),c.isSuccess){const e=c.data.apiData;return Qa(e)?(s.select(xa).emit({requestedAccessLevel:n[".tag"],resolvedAccessLevel:e.link_permissions.link_access_level[".tag"],isNewlyCreated:!0,linkMetadata:e,httpStatusCode:200}),s.select(Ca).emit(null),{isLoading:!1,isError:!1,output:e,isNewlyCreated:!0}):(s.select(Oa).emit({requestedAccessLevel:n[".tag"],error:"type_error",alsoLogCopyLinkEvent:!0}),l("SHARE_MODAL_SHARE__COPY_LINK_LEGO__CREATE_ERROR",{linkMetadata:e}),{isLoading:!1,isError:!0,error:{".tag":"type_error"}})}if(c.isError){const e=null===(o=c.error.raw)||void 0===o?void 0:o.status,t=null===(i=c.error)||void 0===i?void 0:i.error,a=(e=>{if(e&&"shared_link_already_exists"===e[".tag"]){const t=e.shared_link_already_exists;if(t&&".tag"in t&&"metadata"===t[".tag"]&&"metadata"in t)return t.metadata}})(t);return Qa(a)?(s.select(xa).emit({requestedAccessLevel:n[".tag"],resolvedAccessLevel:a.link_permissions.link_access_level[".tag"],isNewlyCreated:!1,linkMetadata:a,httpStatusCode:e}),s.select(Ca).emit(null),{isLoading:!1,isError:!1,output:a,isNewlyCreated:!1}):(s.select(Oa).emit({requestedAccessLevel:n[".tag"],error:null!==(r=t&&t[".tag"])&&void 0!==r?r:"unknown_error_type",alsoLogCopyLinkEvent:!0,httpStatusCode:e}),l("SHARE_MODAL_SHARE__COPY_LINK_LEGO__CREATE_ERROR",{linkMetadata:null}),{isLoading:!1,isError:!0,error:t})}return c.isLoading||c.isIdle?{isLoading:!0}:(s.select(Oa).emit({requestedAccessLevel:n[".tag"],error:"unknown_mutation_error",alsoLogCopyLinkEvent:!0}),{isLoading:!1,isError:!0,error:{".tag":"unknown_mutation_error"}})},Ka=e=>function(e){switch(e){case"viewer":return te;case"editor":return ae;default:throw new Error(`Invalid tag: ${e}`)}}(e.link_permissions.link_access_level[".tag"]),Ga=e=>function(e){switch(e){case"no_one":return X;case"password":return Z;case"team":return J;case"public":return ee;default:throw new Error(`Invalid tag: ${e}`)}}(e.link_permissions.effective_audience[".tag"]),Qa=e=>{if(!e)return!1;const t=e.link_permissions.link_access_level,a=e.link_permissions.effective_audience,n=e.url;return!(null==t||null==a||null==n||"editor"!==t[".tag"]&&"viewer"!==t[".tag"]||"no_one"!==a[".tag"]&&"password"!==a[".tag"]&&"team"!==a[".tag"]&&"public"!==a[".tag"])};var Wa;!function(e){e.IDLE="IDLE",e.CREATING_LINK="CREATING_LINK",e.CREATED_LINK="CREATED_LINK",e.ERROR_CREATING_LINK="ERROR_CREATING_LINK",e.COPIED_LINK="COPIED_LINK",e.ERROR_COPYING_LINK="ERROR_COPYING_LINK",e.CAN_COPY_LINK="CAN_COPY_LINK"}(Wa||(Wa={}));const Ya={$props:E.atom({oid:{".tag":"file",fileId:""},objectMetadataResult:{isLoading:!0},defaultLinkResult:{isLoading:!0},settingsHandler:()=>{},manageAccessHandler:()=>{},onRequestClose:()=>{},onBlockClickaway:()=>{},onUnblockClickaway:()=>{}}),$currentLinkMetadata:E.atom(null),$linkStatus:E.atom(Wa.IDLE),$linkError:E.atom(null),$isLinkNewlyCreated:E.atom(!1),$currentLinkAudience:E.atom(X),$currentLinkAccessLevel:E.atom(te),$requestedAccessLevel:E.atom(ne),$senderTrackkey:E.atom("")},{StoreProvider:za,useStore:Xa}=E.defineStoreProvider((e=>{const t=E.atom(Wa.CREATING_LINK),a=E.atom(null),n=E.atom(X),o=E.atom(te),i=E.atom(ne),r=E.atom(!1),s=E.atom(null),l=E.atom(V.vendSenderTrackey()),c=E.proxy((()=>e.get().defaultLinkResult));return c.obs((()=>{const e=c.get();if(e.isLoading||e.isError||!e.output)!e.isLoading&&e.isError&&(s.set(e.error),t.set(Wa.ERROR_CREATING_LINK));else{const i=e.output;o.set(Ka(i)),n.set(Ga(i));const s=V.appendTrackeyToSharedLinkAndSortParams(i.url,l.get());a.set({...i,url:s}),r.set(e.isNewlyCreated),t.set(Wa.CREATED_LINK)}})),{$props:e,$currentLinkMetadata:a,$linkStatus:t,$linkError:s,$isLinkNewlyCreated:r,$currentLinkAccessLevel:o,$currentLinkAudience:n,$requestedAccessLevel:i,$senderTrackkey:l}}),Ya),Za=e=>{const t=L.useSharingObjectMetadata(e.oid.fileId),a=Ha(e.oid,ne),n=I.useGetContextValue()(N.Context),o=z.useMemo((()=>n?{...n,contentAction:"copy_link"}:null),[n]);return z.createElement(I.ContextProvider,{context:N.Context,value:o},z.createElement(za,{objectMetadataResult:t,defaultLinkResult:a,...e}))};Za.displayName="Provider";const Ja=()=>{const e=Xa(),t=E.useStore(e.$props),n=z.useCallback((()=>{t.onRequestClose()}),[t]);return z.createElement("div",{className:f.classes.headerSectionButtonContainer,"data-testid":"close-button"},z.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium",tone:"neutral",onClick:n,"aria-label":u.intl.formatMessage({id:"GKzMoF",defaultMessage:"Close"})},z.createElement(a.UIIcon,{src:a.CloseLine})))};Ja.displayName="CloseButton";const en=()=>{const e=Xa(),t=E.useStore(e.$props),{objectMetadataResult:n}=t,o=!(!n.isLoading&&n.isError),i=E.useAtom(e.$linkStatus),r=n.isLoading||n.isError?"":a.getName(n.output),s=z.useMemo((()=>i===Wa.COPIED_LINK?u.intl.formatMessage({id:"K4WVkI",defaultMessage:"Link copied to"}):(e=>e.formatMessage({id:"DRh5LI",defaultMessage:"Copy link to"}))(u.intl)),[i]);return z.createElement("div",{style:{display:"flex",alignItems:"flex-start"}},o&&z.createElement("div",{className:f.classes.headerSectionTextContainer,"data-testid":"header-section",id:"copy-link-header"},z.createElement(a.Text,{size:"medium",isBold:!0,className:f.classes.headerSectionPrimaryText},z.createElement(a.Truncate,{location:.5},s)),z.createElement(a.Text,{size:"small",color:"subtle"},z.createElement(a.Truncate,{location:.5},r))),z.createElement(Ja,null))};en.displayName="HeaderSection";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/copy-link-screen/internals/link-section.module.out-vflJgUUnr.css",(e=>"._badgeAsText_gpgfl_1{text-wrap:nowrap;align-items:center;border-radius:var(--dig-radius__small);display:flex;font-family:var(--dig-type__family__action);font-size:var(--dig-type__size__action__small);font-weight:500;letter-spacing:var(--dig-type__letterspacing__action);margin-right:calc(var(--dig-spacing__micro__xsmall)*-1);padding-left:var(--dig-spacing__micro__small);padding-right:var(--dig-spacing__micro__small);white-space:nowrap;width:fit-content}._badgeAsTextSuccess_gpgfl_20{background-color:var(--dig-color__success__surface--state-1);color:var(--dig-color__success__base)}._badgeAsTextUpdate_gpgfl_26{background-color:var(--dig-color__selection__surface--state-1);color:var(--dig-color__selection__base)}._badgeIcon_gpgfl_32{padding-right:var(--dig-spacing__micro__xsmall)}._badgeAsButton_gpgfl_36{margin-right:calc(var(--dig-spacing__micro__xsmall)*-1)}._updatingContainer_gpgfl_40{position:relative}._updatingOverlay_gpgfl_45{opacity:0;pointer-events:none;position:absolute;right:12px;top:50%;transform:translateY(-50%);transition:opacity .2s ease;z-index:1}._updatingContainer_gpgfl_40:has(input:disabled){pointer-events:none}._updatingContainer_gpgfl_40:has(input:disabled) ._updatingOverlay_gpgfl_45{opacity:1}"));const tn="_badgeAsTextSuccess_gpgfl_20 _badgeAsText_gpgfl_1",an="_badgeAsButton_gpgfl_36",nn=()=>{const e=Xa(),t=E.useAtom(e.$currentLinkMetadata),n=E.useLogger(),o=Fa(),i=E.useAtom(e.$currentLinkAccessLevel),r=E.useAtom(e.$isLinkNewlyCreated),s=(()=>{var e;const{user:t}=a.useActiveUser(),n=I.useGetContextValue(),o=null===(e=n(N.Context))||void 0===e?void 0:e.tiburonOrigin,i=n(N.Context$2),r=z.useRef(!1);return z.useCallback((async()=>{if(t&&K.markMilestoneAsCompleted(t,H.ActivationTileMilestoneId.SHARE_CONTENT),i&&!r.current){r.current=!0;const e=a.isNewApiMetadata(i)?i.common_metadata.path_display:i.path_display,t=a.getIsFolder(i),n={file_name:a.getName(i),file_extension:a.getExtension$2(i),file_path:e};t?a.publishEvent(a.CampaignEvents.FOLDER_OUT_OF_BAND_SHARE_SUCCESS,{context:{...n,is_team_folder:a.getIsInsideTeamFolderTree(i)?"true":"false"}}):a.publishEvent(a.CampaignEvents.FILE_OUT_OF_BAND_SHARE_SUCCESS,{context:n})}G.trackUserLeapEvent(G.SharingUserLeapEvent.SM24_OOB_SHARE_COMPLETE_CLMM_CLOSED,o)}),[t,o,i])})(),l=z.useCallback((()=>{e.$linkStatus.set(Wa.COPIED_LINK),t&&(n("SHARE_MODAL_SHARE__COPY_LINK_LEGO__COPY_SUCCESS",{linkMetadata:t}),o.select(Ua).emit({requestedAccessLevel:e.$requestedAccessLevel.get()[".tag"],resolvedAccessLevel:i[".tag"],isNewlyCreated:r,linkMetadata:t}),o.select(Na).emit(null))}),[e,t,n,o,i,r]),c=z.useCallback((()=>{e.$linkStatus.set(Wa.ERROR_COPYING_LINK),t&&(n("SHARE_MODAL_SHARE__COPY_LINK_LEGO__COPY_ERROR",{linkMetadata:t}),o.select(Ba).emit({requestedAccessLevel:e.$requestedAccessLevel.get()[".tag"],error:"failed_copy_to_clipboard",linkMetadata:t}))}),[e,t,n,o]),d=z.useCallback((()=>{(null==t?void 0:t.url)&&k.copyToClipboard(t.url,(()=>{l()}),(()=>{navigator.clipboard?navigator.clipboard.writeText(t.url).then((()=>{l()}),(()=>{c()})):c()}))}),[null==t?void 0:t.url,c,l]),u=z.useCallback((e=>{(null==t?void 0:t.url)&&e&&(e.write(t.url),l())}),[null==t?void 0:t.url,l]);return{copyLinkToClipboard:z.useCallback((a=>{(null==t?void 0:t.url)&&((()=>{const e=document.createElement("input");e.setAttribute("tabindex","-1"),e.value="sharing is caring",document.body.appendChild(e),e.select();const t=document.queryCommandEnabled("copy");return document.body.removeChild(e),t})()?d():a?u(a):(e.$linkStatus.set(Wa.ERROR_COPYING_LINK),o.select(Va).emit({requestedAccessLevel:e.$requestedAccessLevel.get()[".tag"],cancelType:"copy_to_clipboard_internal"})),s())}),[null==t?void 0:t.url,d,u,o,e,s])}},on=()=>{const e=Xa(),t=E.useAtom(e.$props),{copyLinkToClipboard:n}=nn(),o=Fa(),i=E.useAtom(e.$linkStatus),r=E.useAtom(e.$currentLinkMetadata),s=E.useAtom(e.$currentLinkAccessLevel),l=z.useRef(null),c=z.useRef(!1);z.useEffect((()=>{[Wa.COPIED_LINK].includes(i)&&l.current&&(c.current=!0,l.current.focus(),setTimeout((()=>{c.current=!1}),0))}),[i,l]);const[d,g]=z.useState(!1),m=z.useCallback((()=>{e.$requestedAccessLevel.set(s),o.select($a).emit(null),o.select(Da).emit({requestedAccessLevel:s[".tag"],linkMetadata:r,resolvedAccessLevel:s[".tag"]});let t=()=>{};const a=new Promise((e=>{t=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":a});navigator.clipboard.write([e])}else a.then((e=>navigator.clipboard.writeText(e)));n({write:e=>t(e)})}),[n,o,s]),_=z.useMemo((()=>null==r?void 0:r.url),[r]),p=z.useRef(null);z.useEffect((()=>{i===Wa.CREATED_LINK&&_&&_!==p.current&&(p.current=_,n(t.clipboardWriter))}),[i,_,n,t.clipboardWriter]);const f=z.useCallback((()=>{d||(i===Wa.COPIED_LINK&&e.$linkStatus.set(Wa.CAN_COPY_LINK),g(!0))}),[i,e.$linkStatus,d]),S=z.useCallback((e=>{i!==Wa.CAN_COPY_LINK&&i!==Wa.COPIED_LINK||e.target.select(),c.current||f()}),[i,f]),y=z.useCallback((e=>{e.currentTarget.contains(e.relatedTarget)||e.currentTarget===e.relatedTarget||i!==Wa.COPIED_LINK||g(!1)}),[i]);return z.createElement("div",{onMouseEnter:f,onMouseLeave:()=>{g(!1)},onBlur:y,"aria-label":Sa(u.intl,s).title},z.createElement("div",{"data-testid":"link-section"},z.createElement(a.TextInput,{ref:l,onCopy:m,size:"large",readOnly:!0,onFocus:S,wrapperProps:{style:{fontSize:"var(--dig-type__size__text__small)"}},value:_,withRightAccessory:(e=>{const t=(()=>{switch(i){case Wa.COPIED_LINK:return z.createElement(a.Text,{className:tn},s===ae?u.intl.formatMessage({id:"qaLT/q",defaultMessage:"Edit link copied"}):(e=>e.formatMessage({id:"Ged5jl",defaultMessage:"View link copied"}))(u.intl));case Wa.CAN_COPY_LINK:return e?z.createElement(a.Button,{variant:"primary",size:"small",onClick:m,className:an},(e=>e.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))(u.intl)):null;default:return null}})();return z.createElement("div",{style:{minHeight:"32px",display:"flex",alignItems:"center"},"aria-live":i===Wa.CAN_COPY_LINK?"off":"assertive"},t)})(d),"aria-label":Sa(u.intl,s).title})))};on.displayName="LinkSection";const rn=()=>{const e=u.useIntl(),t=Xa(),n=((e,t,n)=>{switch(t[".tag"]){case a.NO_ONE[".tag"]:return e.formatMessage({id:"Ca/e0Y",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:n===ae});case a.PUBLIC[".tag"]:return e.formatMessage({id:"/wh8mz",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:n===ae});case a.TEAM[".tag"]:return e.formatMessage({id:"60+xKH",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:n===ae});default:return""}})(e,E.useAtom(t.$currentLinkAudience),E.useAtom(t.$currentLinkAccessLevel));return z.createElement("div",{"data-testid":"link-permissions-text"},z.createElement(a.Text,{size:"small",style:{color:"var(--dig-color__text__base)"}},n))};rn.displayName="LinkPermissionsText";const sn=()=>{const e=Xa(),t=u.useIntl(),n=E.useAtom(e.$currentLinkAccessLevel),o=Fa();return z.createElement(a.Button,{"data-testid":"settings-button",variant:"transparent",size:"small",tone:"neutral",onClick:()=>{let t;t="editor"===n[".tag"]?"edit_link_settings":"view_link_settings",o.select(Aa).emit(null);e.$props.get().settingsHandler({shouldOpenLinkSettings:!0,initialTab:t})},"data-uxa-log":"copy-link-screen-settings-button.loaded","data-uxa-interactions":"shown click"},(e=>e.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))(t))};sn.displayName="SettingsButton";const ln=()=>{var e;const t=Xa(),a=E.useAtom(t.$props),{objectMetadataResult:n}=a,o=n.isLoading||n.isError?void 0:n.output,i=null===(e=null==o?void 0:o.common_metadata)||void 0===e?void 0:e.path_display;return z.createElement(d.CampaignContextualNudgeSection,{fqPath:i,onClose:a.onRequestClose})};ln.displayName="CampaignContextualNudgeSection";const cn=()=>{const e=Fa();return z.createElement("div",{style:{display:"flex",padding:"var(--dig-spacing__micro__medium)",flexDirection:"column",alignItems:"center",gap:"var(--dig-spacing__micro__small)"},"data-testid":"error-screen","data-uxa-log":"sm24-copy_link_screen.error","data-uxa-interactions":"shown"},z.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"var(--dig-spacing__micro__xsmall)"}},z.createElement(a.UIIcon,{src:a.FailLine,size:"large"})),z.createElement(a.Text,{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"var(--dig-spacing__micro__xsmall)",alignSelf:"stretch",fontStyle:"normal",fontWeight:"var(--dig-type__weight__strong)",lineHeight:"var(--dig-line-height__label__small)",letterSpacing:"var(--dig-letter-spacing__action__medium)"}},u.intl.formatMessage({id:"qmGnVg",defaultMessage:"Couldn’t copy link"})),z.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"}},z.createElement(a.Text,{style:{display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"var(--dig-color__text__subtle)",textOverflow:"ellipsis",fontFamily:"var(--dig-font-family__text)",fontSize:"var(--dig-font-size__text__small)",fontStyle:"normal",fontWeight:"var(--dig-type__weight__base)",lineHeight:"var(--dig-line-height__label__small)",gap:"var(--dig-spacing__micro__xsmall)"}},(e=>e.formatMessage({id:"hkT9RW",defaultMessage:"Try reloading the page or asking us for"}))(u.intl),z.createElement(a.Link,{href:"https://help.dropbox.com",target:"_blank",rel:"noopener noreferrer",onClick:()=>{e.select(ja).emit(null)},style:{display:"flex",justifyContent:"center",alignItems:"center",fontFamily:"var(--dig-font-family__text)",fontSize:"var(--dig-font-size__text__small)",fontStyle:"normal",fontWeight:"var(--dig-type__weight__base)",lineHeight:"var(--dig-line-height__label__small)",textDecorationLine:"underline",textDecorationStyle:"solid",color:"var(--dig-color__primary__base)"},display:"inline"},(e=>e.formatMessage({id:"yvCTUR",defaultMessage:"help"}))(u.intl)))))};cn.displayName="ErrorScreen";const dn=e=>z.createElement(Za,{...e},z.createElement(un,null));dn.displayName="CopyLinkScreen";const un=()=>{const e=Xa(),t=E.useAtom(e.$props),{objectMetadataResult:n}=t,o=n.isLoading,i=!n.isLoading&&!n.isError,r=!n.isLoading&&n.isError,s=E.useAtom(e.$linkStatus),l=Fa(),c=r||s===Wa.ERROR_CREATING_LINK,d=o||s===Wa.CREATING_LINK,u=i&&s!==Wa.CREATING_LINK&&s!==Wa.ERROR_CREATING_LINK,g=z.useRef(s);z.useEffect((()=>{g.current=s}),[s]),z.useEffect((()=>()=>{g.current===Wa.CREATING_LINK&&(l.select(Pa).emit({requestedAccessLevel:"default",cancelType:"unmount",alsoLogCopyLinkEvent:!0}),l.select(Va).emit({requestedAccessLevel:"default",cancelType:"unmount"}))}),[]);const m=z.useRef(void 0);return z.useLayoutEffect((()=>{const e=m.current;d&&!e?t.onBlockClickaway():!d&&e&&t.onUnblockClickaway(),m.current=d}),[d,t]),z.useEffect((()=>{u&&l.select(La).emit(null),c&&l.select(Ia).emit(null),d&&l.select(ka).emit(null)}),[u,c,d,l]),d?z.createElement(ya,null):c?z.createElement(cn,null):u?z.createElement("div",{"data-testid":"copy-link-screen-with-store","data-uxa-log":"sm24-copy_link_screen.loaded","data-uxa-interactions":"shown",style:{display:"flex",flexDirection:"column",gap:"var(--dig-spacing__micro__small)"},"aria-labelledby":"copy-link-header","aria-live":"polite"},z.createElement(en,null),z.createElement(on,null),z.createElement(a.Split,{gap:"Micro Medium",wrap:"nowrap",alignY:"center",display:"flex",width:"100%",style:{maxWidth:"100%"}},z.createElement(a.Split.Item,{width:"fill"},z.createElement(rn,null)),z.createElement(a.Split.Item,null,z.createElement(sn,null))),z.createElement(ln,null)):null};un.displayName="CopyLinkScreenWithStore";const gn=({store:e})=>{const t=E.useStore(e.$props),a=E.useStore(e.$clipboardWriter),{objectIdentifier:n,manageAccessHandler:o,onRequestClose:i}=t,r=z.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?a.settingsHandler(t):E.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),e.$currentScreen.set(bt.SETTINGS)}))}),[e]),s=z.useCallback((()=>{e.$isClickawayLocked.set(!0)}),[e]),l=z.useCallback((()=>{e.$isClickawayLocked.set(!1)}),[e]);return z.createElement(dn,{oid:n,settingsHandler:r,manageAccessHandler:o,onRequestClose:i,clipboardWriter:a,onBlockClickaway:s,onUnblockClickaway:l})};gn.displayName="CopyLinkScreen";const mn=e=>e.formatMessage({id:"4mDOPx",defaultMessage:"Folder"}),_n=(e,t)=>e.formatMessage({id:"Y8cvK0",defaultMessage:"Share {contentName}"},{contentName:L.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)}),pn=e=>e.formatMessage({id:"EbXgYu",defaultMessage:"Create QR code"}),En=e=>e.formatMessage({id:"Qn7mSN",defaultMessage:"People with access to"}),fn=e=>e.formatMessage({id:"FQ6/b6",defaultMessage:"Link copied to"}),Sn=(e,t)=>e.formatMessage({id:"a0hOt7",defaultMessage:"Settings for {contentName}"},{contentName:L.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)});const yn=Symbol("ON_CLICK_OUTSIDE"),Cn=Symbol("ON_RESIZE"),bn=Symbol("ON_OPEN"),vn=Symbol("ON_OVER_QUOTA_SHARE_BANNER_UPGRADE"),hn=Symbol("ON_VIEW_MANAGE_ACCESS_ENTRY_POINT_BUTTON"),kn=Symbol("ON_VIEW_ERROR_SCREEN"),{useEmitter:Ln,defaultEmitter:An}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};e.key!==bn?e.key!==yn&&e.key!==Cn?e.key!==hn?e.key!==kn?e.key===vn&&a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:e.payload.action,flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView||void 0}),{tags:{...s,action:e.payload.action}}):a.UDCL.logEvent("ops.sm24.view_error_screen",{tags:{...s,error_type:e.payload.dataLoadErrorType||"unknown"}}):a.UDCL.logEvent(C.PAP_View_ManageAccess({...l,manageAccessElement:"manage_access_entry_point_button"}),{tags:{...s,element:"manage_access_entry_point_button"}}):a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:e.payload.action,flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView||void 0}),{tags:{...s,action:e.payload.action}}):a.UDCL.logEvent(function(e){return{class:"sharing_sender",action:"view",object:"flexible_sharing_entrypoint",properties:e}}({...l}),{tags:s})})),Tn=()=>{const e=Ln(),t=ot(),n="error"===t.status?t.loadError.type:void 0;return z.useEffect((()=>{n&&e.select(kn).emit({dataLoadErrorType:n})}),[n]),z.createElement(a.Box,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",height:"310px"}},z.createElement(a.Box,{style:{color:"var(--dig-color__alert__base)"}},z.createElement(a.UIIcon,{src:Q.FailPictogram,size:"large"})),z.createElement(a.Box,null,z.createElement(a.Title,{size:"medium"},u.intl.formatMessage({id:"4EN/b3",defaultMessage:"Unable to share"}))),z.createElement(a.Box,null,z.createElement(a.Text,{size:"medium"},(e=>e.formatMessage({id:"dCo6oL",defaultMessage:"An unexpected error has occured."}))(u.intl))))};Tn.displayName="ErrorScreen";const In=e=>e.formatMessage({id:"yBYjtJ",defaultMessage:"Close"}),Nn=Symbol("ON_CLICK"),$n=Symbol("ON_MOUSE_ENTER"),Mn=Symbol("ON_MOUSE_LEAVE"),{useEmitter:wn,defaultEmitter:Rn}=I.defineLogger((async({event:e,getContextValue:t})=>{const n=t(N.Context),o=t(N.Context$1),i=t(N.Context$2),r=t(N.Context$3),s={...N.getTags(n),...N.getTags$1(o),...N.getTags$2(i),...N.getTags$3(r)},l={...N.getProperties(n),...N.getProperties$1(o),...N.getProperties$2(i),...N.getProperties$3(r)};if(e.key===Nn)return a.UDCL.logEvent(h.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"close"}}),void a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"close"}});e.key!==$n?e.key!==Mn||a.UDCL.logEvent(w.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"close"}}):a.UDCL.logEvent(w.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"close"}),{tags:{...s,action:"close"}})})),xn=({store:e})=>{const[t,n]=z.useState(!1),o=z.useRef(null),i=wn(),r=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();i.select(Nn).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickCloseButton()}),[e,i]),s=z.useCallback((()=>{i.select($n).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,i]),l=z.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;i.select(Mn).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,i]);z.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const c=E.useStore(e.$disabled);return z.createElement(z.Fragment,null,z.createElement(M.HeaderIconButton,{"data-testid":"close-button",onClick:r,onMouseEnter:s,onMouseLeave:l,ref:o,variant:e.$props.get().buttonVariant,disabled:c,"data-uxa-log":"sm24-close-button","data-uxa-interactions":"click"},z.createElement(a.UIIcon,{src:a.CloseLine,"aria-label":In(u.intl)})),z.createElement(a.Tooltip.Control,{open:!c&&t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},z.createElement(a.Text,null,In(u.intl))))};xn.displayName="LoadedButton";const On=({store:e})=>z.createElement(xn,{store:e});On.displayName="Inner";const Pn=e=>{const t=(e=>{const t=ot(),a=E.useInitStore(t,(e=>e));return E.useInitStore(e,(e=>{const t=E.store(!1),n=E.store(0),o=E.store(0),i=E.proxy((()=>{var t;return null!==(t=e.get().disabled)&&void 0!==t&&t}));return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o,$disabled:i}}))})(e);return z.createElement(On,{store:t})};Pn.displayName="CloseButton";const Dn=({store:e,buttonVariant:t})=>{const a=E.useStore(e.$isClickawayLocked),n=z.useCallback((()=>{e.$props.get().onRequestClose()}),[e]);return z.createElement(Pn,{onClickCloseButton:n,buttonVariant:t,disabled:a})};Dn.displayName="CloseButton";const Un=({store:e})=>{const{objectIdentifier:t}=E.useStore(e.$props),a=ot(),n=Ln(),o="loaded"===a.status?a.objectIdentifier:t,i=z.useCallback((()=>{E.batch((()=>{e.$currentScreen.set(bt.MANAGE_ACCESS),e.$isSuggestionsOpen.set(!1)}))}),[e]),r=z.useCallback((()=>{n.select(hn).emit(null)}),[n]);return o?z.createElement("div",null,z.createElement(C.ContentMemberFacepileButton,{oid:o,onClick:i,onView:r})):null};Un.displayName="ManageAccessFacepileButton";const Bn=({store:e})=>{const t=E.useStore(e.$currentScreen),{objectIdentifier:n,fileName:o,fileSize:i,shouldHideCloseButton:r,shouldShowBackButtonOnInbandShare:s,shouldShowBackButtonOnQrCodeScreen:l}=E.useStore(e.$props),c="file"!==n[".tag"],d=t===bt.INBAND,g=t===bt.MANAGE_ACCESS||t===bt.INBAND&&s||t===bt.QRCODE&&l,_=t===bt.COPY_LINK,{firstLine:p,secondLine:S}=z.useMemo((()=>{switch(t){case bt.INBAND:return{firstLine:(e=u.intl,e.formatMessage({id:"DOMI0b",defaultMessage:"Add people to"})),secondLine:o};case bt.QRCODE:return{firstLine:pn(u.intl),secondLine:o};case bt.MANAGE_ACCESS:return{firstLine:En(u.intl),secondLine:o};case bt.COPY_LINK:return{firstLine:fn(u.intl),secondLine:o};case bt.SETTINGS:return{firstLine:Sn(u.intl,o)};case bt.MAIN:default:return{firstLine:_n(u.intl,o),secondLine:c?mn(u.intl):m.formatBytes(u.intl,i,2,!1)}}var e}),[t,o,i,c]),y=z.useCallback((()=>{t===bt.MANAGE_ACCESS?e.$currentScreen.set(bt.INBAND):e.$currentScreen.set(bt.MAIN)}),[t,e.$currentScreen]),C=d?220:void 0;return _?null:z.createElement(z.Fragment,null,g&&z.createElement("div",{className:f.classes.headerSectionBackButton},z.createElement(a.IconButton,{onClick:y,variant:"borderless",shape:"standard",size:"medium",tone:"neutral","data-uxa-log":`sm24_back_button_${t}`,"data-testid":"sm24-back-button"},z.createElement(a.UIIcon,{src:W.ArrowLeftLine}))),z.createElement("div",{className:f.classes.headerSectionTextContainer},z.createElement(a.Text,{size:"medium",isBold:!0,className:f.classes.headerSectionPrimaryText},z.createElement(a.Truncate,{location:.5},p)),z.createElement(a.Text,{size:"small",color:"subtle"},z.createElement(a.Truncate,{maxWidth:C,location:.5},S))),z.createElement("div",{className:f.classes.headerSectionRightContainer},d&&z.createElement(Un,{store:e}),!r&&z.createElement("div",{className:f.classes.headerSectionButtonContainer},z.createElement(Dn,{store:e,buttonVariant:"borderless"}))))};Bn.displayName="HeaderSection";const Vn=({store:e})=>{const t=E.useStore(e.$props),a=ot(),{objectIdentifier:n,onConfirmationModalShownChange:o,onObjectIdentifierChanged:i}=t,r=E.useStore(e.$inviteTargets),s=E.useStore(e.$inviteMessage),l=z.useCallback((t=>{e.$inviteMessage.set(t)}),[e]),c=z.useCallback((t=>{e.$inviteTargets.set(t)}),[e]),d=z.useCallback((async e=>{"loaded"===a.status&&(await i(e),a.onObjectIdentifierChanged(e))}),[a,i]),u=z.useCallback((()=>{e.$isClickawayLocked.set(!0)}),[e]),g=z.useCallback((()=>{e.$isClickawayLocked.set(!1)}),[e]),m=z.useCallback((()=>{e.$isClickawayLocked.set(!1),e.$props.get().onInbandShareCompleted(),e.$props.get().shouldResetToMainAfterInbandShare&&E.batch((()=>{e.$currentScreen.set(bt.MAIN),e.$inviteTargets.set([]),e.$inviteMessage.set("")})),v.invalidateObjectMembers(n),L.invalidateSharingObjectMetadata(n),L.invalidateNewApiObjectMetadata(n)}),[e,n]),_=z.useCallback((()=>{e.$isInbandStarted.set(!0)}),[e]),p=z.useCallback((t=>{e.$isSuggestionsOpen.set(t)}),[e]),f=z.useCallback((async()=>{"loaded"===a.status&&await a.refreshObjectMetadata()}),[a]),S=z.useCallback((async()=>{"loaded"===a.status&&await a.refreshModal()}),[a]),y=E.useStore(e.$isConfidentialFolderBannerClosed),C=z.useCallback((()=>{e.$isConfidentialFolderBannerClosed.set(!0)}),[e.$isConfidentialFolderBannerClosed]);return z.createElement(h.Inband,{oid:t.objectIdentifier,inviteMessage:s,inviteTargets:r,hasUpdatedAccountMetadata:!1,onCloseClick:()=>t.onRequestClose(),onTargetsDropdownFocusChange:p,onInviteMessageChange:l,onInviteTargetsChange:c,onShareStart:u,onShareFailure:g,onInbandShareSuccess:m,onStartInband:_,onRefreshObjectMetadata:f,onRefreshModal:S,shouldDisablePostInbandShareHooks:t.shouldDisablePostInbandShareHooks,onConfirmationModalShownChange:o,isConfidentialFolderBannerClosed:y,onConfidentialFolderBannerClose:C,onObjectIdentifierChanged:d})};Vn.displayName="InbandShareScreen";const jn=({children:e})=>{const t=ot();return z.createElement(I.ContextProvider,{context:N.Context$2,value:"loaded"===t.status?t.objectMetadata:null},z.createElement(E.MetadataProvider,{sharingObjectMetadata:"loaded"===t.status?t.objectMetadata:void 0,sharingPrefs:"loaded"===t.status?t.sharingPrefs:void 0,sharingObjectIdentifier:"loaded"===t.status?t.objectIdentifier:void 0,shareMe24Metadata:{isShareMe24:!0}},e))};jn.displayName="LoggingMetadataProvider";const Fn=({store:e})=>{const{objectIdentifier:t,onRequestClose:n,onConfirmationModalShownChange:o,onObjectIdentifierChanged:i}=E.useStore(e.$props),r=ot(),s=z.useCallback((async e=>{"loaded"===r.status&&(await i(e),r.onObjectIdentifierChanged(e))}),[r,i]),l=z.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?a.settingsHandler(t):E.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),e.$currentScreen.set(bt.SETTINGS)}))}),[e]),c=z.useCallback((()=>{n()}),[n]),d=z.useCallback((()=>{e.$currentScreen.set(bt.INBAND)}),[e]),u=z.useCallback((()=>{e.$currentScreen.set(bt.INBAND),L.invalidateSharingObjectMetadata(t),L.invalidateNewApiObjectMetadata(t),C.invalidateListSharedLinks(t),v.invalidateObjectMembers(t),L.invalidateNewApiObjectMetadata(t)}),[t,e.$currentScreen]),g="loaded"===r.status?r.objectIdentifier:t;return g?z.createElement(a.Box,{style:{height:"322px",overflowY:"auto",scrollbarWidth:"thin"}},z.createElement(C.ContentMemberList,{objectIdentifier:g,openLinkSettings:l,onRequestClose:c,onChangeConfidentiality:d,onTransferFolderOwnership:u,onObjectIdentifierChanged:s,onConfirmationModalShownChange:o||(()=>{})})):null};Fn.displayName="ManageAccessScreen";const qn=({store:e})=>{const t=E.useStore(e.$initialSettingsTab),a=E.useStore(e.$props),{objectIdentifier:n,onObjectIdentifierChanged:o,onConfirmationModalShownChange:i,manageAccessHandler:r,onRequestClose:s,shouldResetToMainOnSettingsCancel:l,shouldResetToMainOnSettingsSave:c,settingsHandler:d,shouldResetToMainOnUnshareComplete:u}=E.useStore(e.$props),g=ot(),m=z.useCallback((async e=>{window.console.log("onObjectIdentifierChanged",e),"loaded"===g.status&&(await o(e),g.onObjectIdentifierChanged(e))}),[g,o]),_=z.useCallback((e=>{i&&i(e)}),[i]),p=z.useCallback((async()=>{"loaded"===g.status&&await g.refreshModal()}),[g]),f=z.useCallback((()=>{u&&e.$currentScreen.set(bt.MAIN)}),[u,e.$currentScreen]),S=z.useCallback((()=>{r()}),[r]),y=z.useCallback((()=>{s()}),[s]),C=z.useCallback((()=>{l?e.$currentScreen.set(bt.MAIN):s()}),[s,l,e.$currentScreen]),b=z.useCallback((()=>{c?e.$currentScreen.set(bt.MAIN):s()}),[s,c,e.$currentScreen]),v=z.useCallback((()=>{if(!d)return;let e;switch(t){case"view_link_settings":e="view_link_settings";break;case"edit_link_settings":e="edit_link_settings";break;default:e=void 0}y(),d({initialTab:e})}),[t,y,d]),h="loaded"===g.status?g.objectIdentifier:n;return z.createElement(w.SettingsPage,{objectIdentifier:h,initialTab:t,onClose:y,onCancel:C,onComplete:b,onManageLinkAccess:S,onConfirmationModalShownChange:_,onObjectIdentifierChanged:m,onRefreshModal:p,onFallback:a.settingsHandler?v:void 0,onUnshareCompleted:f})};qn.displayName="SettingsScreen";const Hn=({store:e})=>{var t;const o=E.useStore(e.$props),i=E.useStore(e.$currentScreen),r=E.useStore(e.$isExitingMainToQr),s=E.useStore(e.$isEnteringQr),l=E.useStore(e.$isEnteringInband),c=E.useStore(e.$isInbandStarted),d=E.useStore(e.$componentViewTime),u=E.useStore(e.$displayMode),g=E.useStore(e.$isInterstitialVisible),m=null!==(t=E.useStore(e.$modalCallbackRef))&&void 0!==t?t:void 0,_=E.usePlatform()===E.Platforms.METASERVER,{shouldUseDataLoadErrorScreen:p,shouldLoadErrorScreenOnInitialLoad:S,onRequestClose:C,isOpen:b}=o,v=Ln(),h=ot(),k="error"===h.status;z.useEffect((()=>{b&&(v.select(bn).emit(null),e.$componentViewTime.set(Date.now()),a.publishEvent(a.CampaignEvents.SHARE_MODAL_OPENED))}),[b,v,e.$componentViewTime]),z.useEffect((()=>{(k||S)&&p&&e.$currentScreen.set(bt.ERROR)}),[k,S,p,e.$currentScreen]);const L="loaded"===h.status&&h.accountMetadata.is_sharing_banned;z.useEffect((()=>{if(L){C();const e=o.referrerLoggingMetadata;y.openSharingBannedModal({actionSurface:null==e?void 0:e.actionSurface,actionElement:null==e?void 0:e.actionElement})}}),[L]);const A=z.useCallback((()=>{const t=e.$isClickawayLocked.get(),a=e.$isSuggestionsOpen.get();if(t||a)return;const n=Date.now()-d,o=c?"clickaway_from_inband":"clickaway";v.select(yn).emit({timeSinceView:n,action:o}),C()}),[e,d,c,v,C]),T=z.useCallback((()=>{const t=e.$props.get();"integrated_v1"!==t.settingsMode?(t.settingsHandler({shouldOpenLinkSettings:!0}),t.onActionClicked()):E.batch((()=>{e.$initialSettingsTab.set("view_link_settings"),e.$currentScreen.set(bt.SETTINGS)}))}),[e]),I=z.useCallback((()=>{r&&s&&(e.$isExitingMainToQr.set(!1),e.$currentScreen.set(bt.QRCODE))}),[s,r,e.$currentScreen,e.$isExitingMainToQr]),N=z.useCallback((t=>{s&&t.animationName===f.classes.fadeIn&&e.$isEnteringQr.set(!1)}),[e.$isEnteringQr,s]),$=z.useCallback((t=>{l&&t.animationName===f.classes.expandOuterWrapperInband&&e.$isEnteringInband.set(!1)}),[l,e.$isEnteringInband]),M=z.useCallback((()=>e.$displayMode.set({displayMode:"centered_v1"})),[e.$displayMode]),w=z.useMemo((()=>n.is_mobile_or_tablet()?{displayMode:"drawer",hasScrollLock:!g}:"anchored_v1"===u.displayMode?{displayMode:"anchored_v1",anchorRef:u.displayModeRef,offsetDistance:5,placement:u.displayModePositioning,onAnchorInvalid:M}:{displayMode:"centered_v1"}),[u,M,g]),R=o.canUserCreateStack,x=!o.isEncrypted,O=a.isBrowserSupportedByDash()&&!!R&&x,P=i!==bt.COPY_LINK&&i!==bt.ERROR?z.createElement(Bn,{store:e}):null;return z.createElement(Ie,{onEscape:A,onClickOutside:A,isOpen:b,currentScreen:i,isExitingMainToQr:r,onOverlayOrModalAnimationEnd:I,header:P,...w,modalCallbackRef:m},z.createElement("div",{className:a.cx("oa-pulsar-effect-SHARE_MODAL_TOKENIZER")},i===bt.INBAND&&z.createElement("div",{onAnimationEnd:$,className:a.cx({[f.classes.inbandScreenExpand]:l}),style:{padding:"6px",minHeight:"310px"}},z.createElement(Vn,{store:e})),i===bt.MAIN&&z.createElement(z.Fragment,null,z.createElement(Ne,null,_&&z.createElement(ie,{onUpgrade:()=>{const e=Date.now()-d;v.select(vn).emit({timeSinceView:e,action:"over_quota_share_banner_upgrade"}),C()}})),z.createElement(Ne,null,z.createElement(Ut,{store:e})),z.createElement(Ne,null,z.createElement($e,null,z.createElement(vt,{store:e})),z.createElement($e,null,z.createElement(fa,{store:e}))),O&&z.createElement(Ne,null,z.createElement(Dt,{store:e})),z.createElement(Ne,{styleName:a.cx(f.classes.utilityButtonRow,f.classes.buttonRowBmusQr)},z.createElement(Wt,{store:e,buttonVariant:"filled",onRequestClose:()=>{C()},shouldDisableQRCodeAnimation:o.shouldDisableQRCodeAnimation}),z.createElement(oa,{store:e,buttonVariant:"filled"}))),i===bt.QRCODE&&z.createElement("div",{className:a.cx({[f.classes.qrScreenExpand]:!r&&s}),onAnimationEnd:N},z.createElement(Ae,{objectIdentifier:o.objectIdentifier,onSettingsClick:T,onGetQrCodeError:()=>{C()},fileName:o.fileName,filePath:o.filePath})),i===bt.MANAGE_ACCESS&&z.createElement(Fn,{store:e}),i===bt.COPY_LINK&&z.createElement(gn,{store:e}),i===bt.SETTINGS&&z.createElement(qn,{store:e}),i===bt.ERROR&&z.createElement(Tn,null)))};Hn.displayName="Inner";e.Main=e=>{const t=(e=>E.useInitStore(e,(t=>{const a=E.proxy((()=>t.get().objectIdentifier)),n=E.proxy((()=>t.get().progressiveInbandVariant)),o=E.proxy((()=>t.get().canUserUseTransfer)),i=E.proxy((()=>t.get().canContentUseTransfer)),r=E.proxy((()=>t.get().canUserEnableTransfer)),s=E.proxy((()=>t.get().isTransferEligibilityLoading)),l=E.proxy((()=>t.get().isFolderFileCountOverLimit)),c=E.proxy((()=>t.get().contents)),d=E.store(0),u=E.store(!1),g=E.store(!1),m=E.store(bt.MAIN),_=E.store(!1),p=E.store(!1),f=E.store(!1),S=E.store(!1),y=E.store("anchored_v1"===e.initialDisplayMode?{displayMode:e.initialDisplayMode,displayModePositioning:e.displayModePositioning,displayModeRef:e.displayModeRef}:{displayMode:e.initialDisplayMode}),C=E.store([]),b=E.store(""),v=E.store(void 0),h=E.store(!1),k=E.store("object_settings"),L=E.proxy((()=>t.get().modalCallbackRef)),A=E.store(!1);return{$props:t,$objectIdentifier:a,$progressiveInbandVariant:n,$canUserUseTransfer:o,$canContentUseTransfer:i,$canUserEnableTransfer:r,$isTransferEligibilityLoading:s,$componentViewTime:d,$isClickawayLocked:u,$isInbandStarted:g,$currentScreen:m,$isExitingMainToQr:_,$isEnteringInband:f,$isEnteringQr:p,$isSuggestionsOpen:S,$displayMode:y,$inviteTargets:C,$inviteMessage:b,$clipboardWriter:v,$isFolderFileCountOverLimit:l,$contents:c,$isInterstitialVisible:h,$initialSettingsTab:k,$modalCallbackRef:L,$isConfidentialFolderBannerClosed:A}})))(e),{isOpen:n,onRequestClose:o}=e,i=E.usePlatform()===E.Platforms.METASERVER;return n?i?z.createElement(d.ShareBlockingWrapper,{action:a.LockedStateModalAction.SHARE_MODAL,onStatusChange:e=>{e===a.Status.USER_ABORTED_ACTION&&o()}},z.createElement(jn,null,z.createElement(Hn,{store:t}))):z.createElement(jn,null,z.createElement(Hn,{store:t})):null},e.Provider=nt,e.useData=ot}));
//# sourceMappingURL=c_shareme24_main.js-vfl6hVJ_a.map

//# debugId=9a97a37e-3ef4-342a-a6d7-167768734605