!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="ba9c17b9-8728-342d-a945-fe15aacfc333")}catch(e){}}();
define(["exports","./e_ui_page_files_router","./c_core_utils_region","./c_pap-events_previews_select_doc_page","./c_pap-events_pdf_edit_select_replace_original_confirmation","./c_chat_chat_constants","./c_src_sink_index","./c_pap-events_replay_shown_modal"],(function(e,t,i,o,n,r,a,c){"use strict";function s(e){return e?t.getFileTypeFromString(e):void 0}function l(e){switch(e){case t.PreviewType.Image:case t.PreviewType.Doc:case t.PreviewType.Video:case t.PreviewType.Audio:case t.PreviewType.Archive:case t.PreviewType.CloudDoc:case t.PreviewType.Linkfile:case t.PreviewType.Error:case t.PreviewType.Excel:case t.PreviewType.Text:case t.PreviewType.ThreeDimensional:return e;case t.PreviewType.SsrDoc:return"doc";case t.PreviewType.RawHTML:return"html";case t.PreviewType.Photo:return"image";default:return}}function d(e){switch(e){case"added":case"viewed":case"moved":case"renamed":case"edited":case"shared":case"commented":return e;default:return}}function p(e){switch(e){case"start":case"success":case"failed":case"canceled":case"rejected":return e;default:return}}const _={[t.SDKPreviewSurface.INBAND_SHARE]:"shared_link_in_band",[t.SDKPreviewSurface.SHARED_CONTENT_LINK]:"shared_link_out_of_band",[t.SDKPreviewSurface.SHARED_LINK]:"shared_link_out_of_band",[t.SDKPreviewSurface.BROWSE]:"browse",[t.SDKPreviewSurface.SEARCH]:"search",[t.SDKPreviewSurface.SHARED_LINK_EMBED]:"shared_link_embed",[t.SDKPreviewSurface.VERSION_HISTORY]:"version_history",[t.SDKPreviewSurface.HOME]:"home",[t.SDKPreviewSurface.HELLOSIGN]:"hellosign",[t.SDKPreviewSurface.RECENTS]:"recents",[t.SDKPreviewSurface.STARRED]:"starred",[t.SDKPreviewSurface.STANDALONE_PREVIEW]:"standalone_preview",[t.SDKPreviewSurface.PHOTOS]:"photos",[t.SDKPreviewSurface.SHARED_COLLECTION]:"shared_collection",[t.SDKPreviewSurface.TRANSFER]:"transfer",[t.SDKPreviewSurface.FILE_LOCKING]:"file_locking",[t.SDKPreviewSurface.BACKUP]:"backup",[t.SDKPreviewSurface.UNKNOWN]:"unknown_surface",[t.SDKPreviewSurface.QUICK_VIEW_BROWSE]:"quick_view_browse",[t.SDKPreviewSurface.QUICK_VIEW_SEARCH]:"quick_view_search",[t.SDKPreviewSurface.FSS_DESKTOP_PREVIEW]:"fss_desktop_preview",[t.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW]:"pollux_desktop_preview",[t.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW]:"pollux_desktop_search_preview"},v=["left","right","horizontal","vertical"];function u(e){return v.find((t=>t===(null==e?void 0:e.toLowerCase())))}const S=["save_copy_error","replace_original_error","file_load_error","too_large","too_long","too_short","over_4k","unsupported_extension","unsupported_codec"];function A(e){return S.find((t=>t===(null==e?void 0:e.toLowerCase())))}const w=["rotate","flip","crop","trim","adjust","draw","highlight","add_text","edit_text"];function f(e){return w.find((t=>t===(null==e?void 0:e.toLowerCase())))}function U(e){return{class:"previews",action:"cancel",object:"edit_mode",properties:e}}function g(e){return{class:"previews",action:"eng",object:"editing_error",properties:e}}function E(e){return{class:"previews",action:"preview",object:"audio_video_scrubber_thumbnails",properties:e}}function k(e){return{class:"previews",action:"select",object:"audio_video_scrub",properties:e}}function m(e){return{class:"previews",action:"select",object:"preview_action",properties:e}}const b={"utf-8":"utf_8","utf-16le":"utf_16le","utf-16be":"utf_16be","windows-1252":"windows_1252","iso-8859-1":"iso_8859_1","iso-8859-15":"iso_8859_15",macintosh:"macintosh",ibm866:"ibm866","iso-8859-2":"iso_8859_2","iso-8859-3":"iso_8859_3","iso-8859-4":"iso_8859_4","iso-8859-5":"iso_8859_5","iso-8859-6":"iso_8859_6","iso-8859-7":"iso_8859_7","iso-8859-8":"iso_8859_8","iso-8859-8i":"iso_8859_8i","iso-8859-10":"iso_8859_10","iso-8859-13":"iso_8859_13","iso-8859-14":"iso_8859_14","iso-8859-16":"iso_8859_16","koi8-r":"koi8_r","koi8-u":"koi8_u","windows-874":"windows_874","windows-1250":"windows_1250","windows-1251":"windows_1251","windows-1253":"windows_1253","windows-1254":"windows_1254","windows-1255":"windows_1255","windows-1256":"windows_1256","windows-1257":"windows_1257","windows-1258":"windows_1258",gbk:"gbk",gb18030:"gb18030","euc-jp":"euc_jp","iso-2022-jp":"iso_2022_jp","shift-jis":"shift_jis","euc-kr":"euc_kr",big5:"big5"};var P;e.WorkflowsEvent=void 0,(P=e.WorkflowsEvent||(e.WorkflowsEvent={})).WatermarkApplySaveAsCopy="watermark_apply_save_as_copy",P.WatermarkStart="watermark_start",P.WatermarkSuccess="watermark_success",P.WatermarkFailed="watermark_failed",P.WatermarkCancel="watermark_cancel",P.WatermarkAddImage="watermark_add_image",P.WatermarkRotate="watermark_rotate",P.WatermarkUpdatePosition="watermark_update_position",P.WatermarkUpdateColor="watermark_update_color";const y=["dropbox_sign_home_screen","dropbox_core_signature_screen","dropbox_sign_edit","dropbox_sign_recipient_email_input","docsend_content_screen","docsend_create_link_screen","capture_home_screen","screen_recording_modal","replay_home_screen","replay_preview","pdf_edit","video_edit","image_edit","pdf_edit_signature_box","ml_video_editor","watermark","dropbox_screen","backup_screen","transfer_screen","paper_screen","password_screen","dash_screen","app_center_screen","file_requests","gmail","outlook","whatsapp","facebook_workplace","line_works","dropbox_transfer","canvas","user_created_app","sign_deep_integration","browse_screen","shared_screen","deleted_files","photos_screen","third_party_app","transfer_modal","desktop_preview","web_preview","desktop_folder","text_edit","self_sign","quick_view","docsend_marketing_page","docsend_trial_start_modal","docsend_upload_modal","docsend_trial_modal","sign_home","sign_modal","sign_banner","sign_global","docsend_standalone","desktop_file","connect_more_apps","connect_apps","mobile_app","office_online","office_desktop","home_banner","promotion_section","catalog_page","preview_modal","detail_page","template_click","reached_quota","free_upsell","downloading_page","stack_details_page","serp","start_page","stacks_page"];function C(e){return y.find((t=>t===(null==e?void 0:e.toLowerCase())))}const T=["zoom_in","zoom_out"];function D(e){return T.find((t=>t===(null==e?void 0:e.toLowerCase())))}function h(e){return{class:"file_actions",action:"download",object:"file",properties:e}}function L(e){return{class:"previews",action:"edit",object:"watermark",properties:e}}function x(e){return{class:"previews",action:"next",object:"file",properties:e}}function F(e){return{class:"previews",action:"previous",object:"file",properties:e}}function O(e){return{class:"previews",action:"select",object:"logged_out_image_edit",properties:e}}function z(e){return{class:"previews",action:"watermark",object:"file",properties:e}}const I=["start","success","failed","canceled","rejected"];const M=async(i,a,c)=>{const v={previousSurface:_[c.previewSurface],file:c.file};"user_action"===i?((async(i,a,c=!1)=>{var _,v,S;const{previousSurface:w,file:E}=a,k=i.extra,P=k.action,y=k.context,T=E.extension,M="true"===k.from_transcript_search||void 0,R={fileType:t.getFileTypeFromString(T),fileSize:E.size,previewType:E.previewType?l(E.previewType):void 0,actionElement:null!==(_=k.context)&&void 0!==_?_:t.UserActionContext.PreviewTitlebar,actionSurface:null!==(v=k.actionSurface)&&void 0!==v?v:"previews",previousSurface:w,editorSessionId:null!==(S=k.editorSessionId)&&void 0!==S?S:""},j=(e,o)=>{var n;const r=null!==(n=null==o?void 0:o.key)&&void 0!==n?n:i.file_preview_session_id;t.UDCL.logStart(e,{key:r})},N=(e,o)=>{var n;const r=null!==(n=null==o?void 0:o.key)&&void 0!==n?n:i.file_preview_session_id;t.UDCL.logEnd(e,{key:r})};switch(P){case t.UserAction.EditError:t.UDCL.logEvent(g({...R,editorErrorType:A(k.errorType)}));break;case t.UserAction.EditCancel:t.UDCL.logEvent(U({...R,eventState:(V=k.eventState,I.find((e=>e===(null==V?void 0:V.toLowerCase())))),haveChanges:"true"===k.haveChanges||"false"!==k.haveChanges&&void 0}));break;case t.UserAction.EditFailure:N(o.PAP_Save_EditMode({eventState:"failed",...R}),{key:k.editorSessionId});break;case t.UserAction.EditSuccess:N(o.PAP_Save_EditMode({eventState:"success",...R}),{key:k.editorSessionId});break;case t.UserAction.EditSaveCopyCancel:N(o.PAP_Save_EditMode({eventState:"canceled",...R,actionElement:"save_a_copy"}),{key:k.editorSessionId});break;case t.UserAction.EditReplaceOriginalCancel:N(o.PAP_Save_EditMode({eventState:"canceled",...R,actionElement:"replace_original"}),{key:k.editorSessionId});break;case t.UserAction.EditReplaceOriginalClicked:j(o.PAP_Save_EditMode({eventState:"start",...R,actionElement:"replace_original"}),{key:k.editorSessionId});break;case t.UserAction.EditSaveCopyClicked:j(o.PAP_Save_EditMode({eventState:"start",...R,actionElement:"save_a_copy"}),{key:k.editorSessionId});break;case t.UserAction.EditImageAttempt:t.UDCL.logEvent(t.PAP_NavigateTo_Edit({...R,direction:u(k.direction),entryAction:f(k.entryAction),destinationSurface:"image_edit",actionElement:t.maybeMapToPreviewTitlebar(y)}));break;case t.UserAction.FlipNext:case t.UserAction.FlipPrevious:const i=t.UserAction.FlipNext?x:F;t.UDCL.logEvent(i({eventState:"start",actionScreen:"keyboard"===k.context?k.context:w,fileSize:E.size,fileType:s(T)})),t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P}));break;case t.UserAction.EditPdf:case t.UserAction.Draw:case t.UserAction.Highlight:case t.UserAction.AddText:case t.UserAction.EditPdfText:const a=P===t.UserAction.EditPdfText?"edit_text":P;c||t.UDCL.logEvent(t.PAP_NavigateTo_Edit({...R,destinationSurface:"pdf_edit",actionElement:t.maybeMapToPreviewTitlebar(y),entryAction:a!==t.UserAction.EditPdf?a:void 0})),t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:a}));break;case t.UserAction.OpenIn:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P,destinationSurface:C(k.destination_surface)}),{tags:{content_action:P,action_surface:R.actionSurface,action_element:R.actionElement,...R.fileType&&{file_type:R.fileType},...k.destination_surface&&{destination_surface:C(k.destination_surface)}}});break;case t.UserAction.ShareToAction:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P,destinationSurface:"third_party_app",appId:k.appId}));break;case t.UserAction.SendForSignature:t.UDCL.logEvent(t.PAP_NavigateTo_Sign({...R,destinationSurface:"dropbox_sign_edit",actionElement:t.maybeMapToPreviewTitlebar(y)})),t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P}));break;case t.UserAction.ZoomIn:case t.UserAction.ZoomOut:t.UDCL.logEvent({class:"previews",action:"zoom",object:"file",properties:{...R,eventState:"success",actionSurface:w,actionScreen:k.context,zoomType:D(k.action)}}),t.UDCL.logEvent(m({...R,previewAction:P}));break;case t.UserAction.ChangeTextEncoding:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:t.UserAction.ChangeTextEncoding,textEncoding:k.text_encoding?b[k.text_encoding]:void 0}));break;case t.UserAction.OpenDocSidebar:t.UDCL.logEvent({class:"previews",action:"open",object:"sidebar",properties:{eventState:"success",actionScreen:k.context,fileSize:E.size,fileType:s(T)}});break;case t.UserAction.CloseDocSidebar:t.UDCL.logEvent(function(e){return{class:"previews",action:"close",object:"sidebar",properties:e}}({eventState:"success",actionScreen:k.context,fileSize:E.size,fileType:s(T)}));break;case t.UserAction.FindInDocStart:t.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"search_box",properties:e}}({eventState:"start",actionScreen:k.context,fileSize:E.size,fileType:s(T)}));break;case t.UserAction.DownloadStart:j(h({...R,eventState:"start",actionSurface:w,actionElement:y}));break;case t.UserAction.DownloadFailed:N(h({...R,eventState:"failed",actionSurface:w}));break;case t.UserAction.DownloadSuccess:N(h({...R,eventState:"success",actionSurface:w}));break;case t.UserAction.OpenInMenu:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:t.UserAction.OpenIn}));break;case t.UserAction.OpenSendForSignature:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"add_signatures_menu",properties:e}}(R));break;case t.UserAction.OpenActionBarOverflow:t.UDCL.logEvent(o.PAP_Select_ActionBarOverflowMenu({actionSurface:w})),c&&t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"click_overflow_menu"}));break;case t.UserAction.DeleteStart:j(r.PAP_Delete_File({...R,eventState:"start",actionSurface:w}));break;case t.UserAction.DeleteSuccess:N(r.PAP_Delete_File({...R,eventState:"success",actionSurface:w}));break;case t.UserAction.DeleteFailed:case t.UserAction.DeleteFailedNoPermission:N(r.PAP_Delete_File({...R,eventState:"failed",actionSurface:w}));break;case t.UserAction.DeleteCancel:N(r.PAP_Delete_File({...R,eventState:"canceled",actionSurface:w}));break;case t.UserAction.RenameStart:j(r.PAP_Rename_File({...R,eventState:"start",actionSurface:w}));break;case t.UserAction.RenameFailed:N(r.PAP_Rename_File({...R,eventState:"failed",actionSurface:w}));break;case t.UserAction.RenameSuccess:N(r.PAP_Rename_File({...R,eventState:"success",actionSurface:w}));break;case t.UserAction.SelectSaveAs:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P,conversionType:k.conversion_type.toLowerCase()}));break;case t.UserAction.GoToFolder:t.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"folder",properties:e}}({actionScreen:w}));break;case e.WorkflowsEvent.WatermarkStart:j(z({eventState:"start",actionScreen:y,fileSize:E.size,fileType:s(T)}));break;case e.WorkflowsEvent.WatermarkSuccess:N(z({eventState:"success",fileSize:E.size,fileType:s(T)}));break;case e.WorkflowsEvent.WatermarkFailed:N(z({eventState:"failed",fileSize:E.size,fileType:s(T)}));break;case e.WorkflowsEvent.WatermarkCancel:N(z({eventState:"canceled",fileSize:E.size,fileType:s(T)}));break;case e.WorkflowsEvent.WatermarkRotate:t.UDCL.logEvent(L({actionElement:"rotate"}));break;case e.WorkflowsEvent.WatermarkAddImage:t.UDCL.logEvent(L({actionElement:"add_image"}));break;case e.WorkflowsEvent.WatermarkUpdatePosition:t.UDCL.logEvent(L({actionElement:"update_position"}));break;case e.WorkflowsEvent.WatermarkUpdateColor:t.UDCL.logEvent(L({actionElement:"update_color"}));break;case t.UserAction.SelectSidebarPage:t.UDCL.logEvent(o.PAP_Select_DocPage({actionScreen:y,fileSize:E.size,fileType:s(T)}));break;case t.UserAction.OpenFileMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"file_menu",properties:e}}({...R,actionSurface:"preview"}));break;case t.UserAction.OpenEditMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"edit_menu",properties:e}}({...R,actionSurface:"preview"}));break;case t.UserAction.OpenViewMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"view_menu",properties:e}}({...R,actionSurface:"preview"}));break;case t.UserAction.OpenHelpMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"help_menu",properties:e}}({...R,actionSurface:"preview"}));break;case t.UserAction.AddToCollection:t.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"file_new_collection",properties:e}}({...R,eventState:"start",actionSurface:"preview"}));break;case t.UserAction.OpenWithImageEditor:t.UDCL.logEvent(t.PAP_NavigateTo_Edit({...R,destinationSurface:"image_edit"}));break;case t.UserAction.AdjustTrim:case t.UserAction.AdjustCrop:t.UDCL.logEvent(n.PAP_Select_EditAction({editAction:P,...R}));break;case t.UserAction.EditTranscriptTimer:t.UDCL.logEvent(function(e){return{class:"edit",action:"edit",object:"transcript",properties:e}}({actionId:k.actionId,timeToCompletionMs:parseInt(k.timeToCompletionMs,10),...R}));break;case t.UserAction.Move:case t.UserAction.Copy:case t.UserAction.Delete:case t.UserAction.Rename:case t.UserAction.Star:case t.UserAction.Unstar:case t.UserAction.Info:case t.UserAction.VersionHistory:case t.UserAction.FileActivity:case t.UserAction.Print:case t.UserAction.SaveToDropbox:case t.UserAction.OpenMoreApps:case t.UserAction.Comment:case t.UserAction.Download:case t.UserAction.CopyLink:case t.UserAction.Share:case t.UserAction.ShareMenu:case t.UserAction.SendACopy:case t.UserAction.ShareWithAnalytics:case t.UserAction.PrivacyLegal:case t.UserAction.CookieCCPA:case t.UserAction.ReportIssue:case t.UserAction.HelpAndResources:case t.UserAction.HelpCenter:case t.UserAction.AddTag:case t.UserAction.RemoveTag:case t.UserAction.InfoHide:case t.UserAction.InfoShowMoreMetadata:case t.UserAction.InfoHideMoreMetadata:case t.UserAction.ShowComments:case t.UserAction.HideComments:case t.UserAction.TranscriptHide:case t.UserAction.TranscriptShow:case t.UserAction.TranscriptCopyAllClick:case t.UserAction.TranscriptCopySegmentClick:case t.UserAction.TranscriptJumpToTimestamp:case t.UserAction.EditTranscript:case t.UserAction.SaveEditTranscript:case t.UserAction.CancelEditTranscript:case t.UserAction.ExtractAll:case t.UserAction.Crop:case t.UserAction.Adjust:case t.UserAction.Trim:case t.UserAction.Upscale:case t.UserAction.ColorCorrect:case t.UserAction.AutoStraighten:case t.UserAction.ImageFilter:case t.UserAction.Search:case t.UserAction.Cancel:case t.UserAction.ReportToDropbox:case t.UserAction.ShowLinkWarningModal:case t.UserAction.CloseViewer:case t.UserAction.EditVideo:case t.UserAction.EditImage:case t.UserAction.CheckFileAccess:case t.UserAction.SwipeToolbar:case t.UserAction.TranscriptFeedbackSubmitted:case t.UserAction.FlipNextSlideshow:case t.UserAction.FlipPreviousSlideshow:case t.UserAction.ShowDesktopModal:case t.UserAction.ShowDesktopInstallTooltip:case t.UserAction.ShowDesktopOpenInTooltip:case t.UserAction.DesktopModalContinueDownload:case t.UserAction.DesktopModalOpenInClicked:case t.UserAction.DesktopModalDoNotShowAgain:case t.UserAction.DesktopModalClose:case t.UserAction.DesktopInstallTooltipInstallClicked:case t.UserAction.DesktopInstallTooltipClose:case t.UserAction.DesktopOpenInTooltipFinderClicked:case t.UserAction.DesktopOpenInToolTipClose:case t.UserAction.SharedLinkDesktopModalOpen:case t.UserAction.SharedLinkDesktopModalClose:case t.UserAction.SharedLinkDesktopModalAlwaysOpenInDesktopChecked:case t.UserAction.SharedLinkDesktopModalAlwaysOpenInDesktopUnchecked:case t.UserAction.SharedLinkDesktopModalOpenInClicked:case t.UserAction.SharedLinkDesktopAutoOpened:case t.UserAction.SharedLinkSyncedFileOpened:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P}));break;case t.UserAction.TranscriptSearchAttempt:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"transcript_search_attempt",...M&&{from_transcript_search:M}}));break;case t.UserAction.TranscriptLoadSuccess:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"transcript",...M&&{from_transcript_search:M}}));break;case t.UserAction.ClickDropboxLogo:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"close"}));break;case t.UserAction.OpenInApp:c&&t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"open_in",destinationSurface:"mobile_app"}));break;case t.UserAction.SelfSign:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P})),c||t.UDCL.logEvent(t.PAP_NavigateTo_Sign({...R,actionElement:t.maybeMapToPreviewTitlebar(y),destinationSurface:"self_sign"}));break;case t.UserAction.EditText:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P})),t.UDCL.logEvent(t.PAP_NavigateTo_Edit({...R,actionElement:t.maybeMapToPreviewTitlebar(y),destinationSurface:"text_edit"}));break;case t.UserAction.Watermark:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P})),t.UDCL.logEvent(t.PAP_NavigateTo_Edit({...R,actionElement:t.maybeMapToPreviewTitlebar(y),destinationSurface:"watermark"}));break;case t.UserAction.SendAndTrack:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P})),t.UDCL.logEvent(t.PAP_NavigateTo_Docsend({...R,actionElement:t.maybeMapToPreviewTitlebar(y),destinationSurface:"docsend_create_link_screen"}));break;case t.UserAction.WebToMobileSyncOffline:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:"sync_offline",destinationSurface:"mobile_app"}));break;case t.UserAction.ZoomFitToWidth:case t.UserAction.ZoomFitToPage:case t.UserAction.ZoomChangePercentage:case t.UserAction.HideTools:case t.UserAction.ShowTools:case t.UserAction.ToggleFullscreenOn:case t.UserAction.ToggleFullscreenOff:case t.UserAction.HidePageSelector:case t.UserAction.PageSelector:case t.UserAction.ChangeSpeed:case t.UserAction.ToggleSlideshowOn:case t.UserAction.ToggleSlideshowOff:case t.UserAction.SlideshowPlay:case t.UserAction.SlideshowPause:case t.UserAction.SlideshowDurationDropdownOpened:case t.UserAction.SlideshowDurationChanged:t.UDCL.logEvent(m({...R,actionSurface:"previews",previewAction:P}));break;case t.UserAction.OpenActivityFilterMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"activity_filter_menu",properties:e}}({...R,actionElement:t.UserActionContext.PreviewSidebar}));break;case t.UserAction.AddActivityFilter:t.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"activity_filter",properties:e}}({...R,actionElement:t.UserActionContext.PreviewSidebar,filterElement:d(y)}));break;case t.UserAction.Filter:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P,filterType:k.filterType}));break;case t.UserAction.FilterSelectAll:case t.UserAction.FilterClearAll:case t.UserAction.FileActivityHide:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P}));break;case o.OpenInUserAction.InviteViaEmail:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"share_with_dropbox",properties:e}}({...R,actionSurface:"preview"}));break;case o.OpenInUserAction.Transfer:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"send_a_copy",properties:e}}({...R,actionSurface:"preview"})),t.UDCL.logEvent(t.PAP_NavigateTo_Transfer({...R,destinationSurface:"transfer_modal"}));break;case o.OpenInUserAction.SendForSignatureAction:t.UDCL.logEvent(t.PAP_NavigateTo_Sign({...R,actionSurface:"preview",destinationSurface:"dropbox_sign_recipient_email_input"}));break;case t.UserAction.RotateLeft:case t.UserAction.RotateRight:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:t.UserAction.Rotate,direction:P===t.UserAction.RotateLeft?"left":"right"}));break;case t.UserAction.FlipHorizontal:case t.UserAction.FlipVertical:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:t.UserAction.Flip,direction:P===t.UserAction.FlipHorizontal?"horizontal":"vertical"}));break;case t.UserAction.Enhance:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,actionSurface:"image_edit",actionElement:"edit_toolbar",contentAction:t.UserAction.Enhance}));break;case t.UserAction.SaveACopy:t.UDCL.logEvent(n.PAP_Select_SaveACopy({...R}));break;case t.UserAction.ReplaceOriginal:t.UDCL.logEvent(n.PAP_Select_ReplaceOriginal({...R}));break;case t.UserAction.EditStart:t.UDCL.logEvent(n.PAP_Start_EditMode({...R,eventState:p(null==k?void 0:k.eventState),actionElement:void 0}));break;case t.UserAction.DashChat:case t.UserAction.HideDashChat:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:P}));break;case t.UserAction.LoggedOutRotateLeft:case t.UserAction.LoggedOutRotateRight:t.UDCL.logEvent(O({...R,entryAction:"rotate"}));break;case t.UserAction.LoggedOutFlipHorizontal:case t.UserAction.LoggedOutFlipVertical:t.UDCL.logEvent(O({...R,entryAction:"flip"}));break;case t.UserAction.LoggedOutCrop:t.UDCL.logEvent(O({...R,entryAction:"crop"}));break;case t.UserAction.LoggedOutAdjust:t.UDCL.logEvent(O({...R,entryAction:"adjust"}));break;case t.UserAction.LoggedOutEditImageAttempt:t.UDCL.logEvent(O(R));break;case t.UserAction.LoggedOutEditPdfAttempt:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_pdf_edit",properties:e}}(R));break;case t.UserAction.LoggedOutEditAudioVideoAttempt:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_audio_video_edit",properties:e}}({...R,entryAction:f(k.initialAction)}));break;case t.UserAction.Continue:t.UDCL.logEvent(t.PAP_Select_ContentAction({...R,contentAction:t.UserAction.Continue,dontAskAgainChecked:"true"===k.dontAskAgainChecked}));break;case t.UserAction.MotionPhotoReady:t.UDCL.logEvent(function(e){return{class:"previews",action:"preview",object:"live_photo",properties:e}}({...R}));break;case t.UserAction.MotionPhotoRequestPlay:t.UDCL.logEvent(m({...R,previewAction:"play"}))}var V})(a,v,"mobile"===a.device_type),(async(e,i)=>{var n;const{previousSurface:r,file:a}=i,c=e.extra,d=c.action,p=c.context,_=a.extension,v=null!=p?p:t.UserActionContext.PreviewToolbar,S={fileType:s(_),fileSize:a.size,previewType:a.previewType?l(a.previewType):void 0,actionSurface:null!==(n=c.actionSurface)&&void 0!==n?n:"video_edit",actionElement:v,previousSurface:r},w="true"===c.has_transcript_search_matches,E={actionElement:v,actionSurface:"previews",fileType:s(_),fileSize:a.size,previewType:a.previewType?l(a.previewType):void 0,previousSurface:r,...w&&{hasTranscriptSearchMatch:!0}},b=i=>{t.UDCL.logStart(i,{key:e.file_preview_session_id})},P=i=>{t.UDCL.logEnd(i,{key:e.file_preview_session_id})};function y(e){t.UDCL.logEvent(m({...E,eventState:e,previewAction:"closed_captioning_on"}))}function C(e){t.UDCL.logEvent(m({...E,eventState:e,previewAction:"closed_captioning_off"}))}switch(d){case t.UserAction.EditVideoAttempt:t.UDCL.logEvent(t.PAP_NavigateTo_Edit({actionElement:t.maybeMapToPreviewTitlebar(p),actionSurface:"previews",destinationSurface:"video_edit",direction:u(c.direction),entryAction:f(c.entryAction),fileSize:a.size,fileType:s(_),previewType:l(a.previewType)}));break;case t.UserAction.EditVideoFailure:t.UDCL.logEvent(g({fileType:s(_),fileSize:a.size,previewType:a.previewType?l(a.previewType):void 0,actionSurface:"video_edit",editorErrorType:A(c.reason),videoDuration:c.duration?Number.parseInt(c.duration,10):void 0}));break;case t.UserAction.EditVideoCancel:t.UDCL.logEvent(U({eventState:"canceled",actionSurface:"video_edit",fileSize:a.size,fileType:s(_),haveChanges:"true"===c.have_changes}));break;case t.UserAction.EditVideoDiscardChangesCancel:t.UDCL.logEvent(U({eventState:"canceled",actionSurface:"video_edit",fileSize:a.size,fileType:s(_)}));break;case t.UserAction.EditVideoDiscardChangesConfirmed:t.UDCL.logEvent(U({eventState:"success",actionSurface:"video_edit",fileSize:a.size,fileType:s(_)}));break;case t.UserAction.EditVideoRedo:t.UDCL.logEvent({class:"previews",action:"redo",object:"edit_mode",properties:{...S,actionSurface:"video_edit"}});break;case t.UserAction.EditVideoUndo:t.UDCL.logEvent({class:"previews",action:"undo",object:"edit_mode",properties:{...S,actionSurface:"video_edit"}});break;case t.UserAction.EditVideoReplaceOriginalClicked:b(o.PAP_Save_EditMode({eventState:"start",fileSize:a.size,fileType:s(_),actionElement:"replace_original",previewType:l(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoReplaceOriginalCancel:P(o.PAP_Save_EditMode({eventState:"canceled",fileSize:a.size,fileType:s(_),actionElement:"replace_original",previewType:l(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoSaveCopyClicked:b(o.PAP_Save_EditMode({eventState:"start",fileSize:a.size,fileType:s(_),actionElement:"save_a_copy",previewType:l(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoSaveCopyCancel:P(o.PAP_Save_EditMode({eventState:"canceled",fileSize:a.size,fileType:s(_),actionElement:"save_a_copy",previewType:l(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.ClosedCaptionsClick:"true"===c.cc_state_open?C("start"):y("start");break;case t.UserAction.ClosedCaptionsClickSuccess:"true"===c.new_cc_state_open?y("success"):C("success");break;case t.UserAction.AudioVideoSettingsMenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_settings_menu",properties:e}}({actionScreen:p,fileSize:a.size,fileType:s(_)}));break;case t.UserAction.QualitySettingsSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_quality_menu",properties:e}}({actionScreen:p,fileSize:a.size,fileType:s(_)}));break;case t.UserAction.PlaybackRateSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_speed_menu",properties:e}}({actionScreen:p,fileSize:a.size,fileType:s(_)}));break;case t.UserAction.SetVolume:t.UDCL.logEvent(m({...E,previewAction:"volume_change"}));break;case t.UserAction.SetMuted:t.UDCL.logEvent(m({...E,previewAction:"mute"}));break;case t.UserAction.SetUnmuted:t.UDCL.logEvent(m({...E,previewAction:"unmute"}));break;case t.UserAction.AudioVideoSeeked:t.UDCL.logEvent(k({eventState:"success",actionScreen:p,fileSize:a.size,fileType:s(_)}));break;case t.UserAction.AudioTrackChanged:t.UDCL.logEvent(m({...E,previewAction:"media_track_change"}));break;case t.UserAction.AudioTrackSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_track_menu",properties:e}}({actionScreen:r,fileSize:a.size,fileType:s(_)}));break;case t.UserAction.ChangePlaybackPosition:switch(c.playback_control){case"forward":t.UDCL.logEvent(m({...E,previewAction:"skip_forward"}));break;case"backward":t.UDCL.logEvent(m({...E,previewAction:"skip_backward"}));break;case"select_next_frame":t.UDCL.logEvent(m({...E,previewAction:"skip_forward",skipDuration:0}));break;case"select_prev_frame":t.UDCL.logEvent(m({...E,previewAction:"skip_backward",skipDuration:0}))}break;case t.UserAction.SetThumbnail:t.UDCL.logEvent(m({...E,previewAction:"set_thumbnail"}))}})(a,v)):R(i,v,a)},R=async(e,i,o)=>{const{previousSurface:n,file:r}=i,a=r.extension;let c,d;switch(e){case t.SessionEventType.FilePreviewAttemptStarted:c="start";break;case t.SessionEventType.FilePreviewRenderSucceeded:c="success";break;case t.SessionEventType.FilePreviewSupportDenied:c="rejected",d="unimplemented";break;case t.SessionEventType.FilePreviewDownloadFailed:c="failed",d="network_error";break;case t.SessionEventType.FilePreviewRenderFailed:const e=o.extra.error_code;c=e===t.FVErrorCode.PasswordProtected||e===t.FVErrorCode.NestedFiletypeNotSupported?"rejected":"failed",d="rendering_error";break;case t.SessionEventType.FilePreviewSessionEnded:switch(o.extra.last_event){case t.SessionEventType.FilePreviewSupportDenied:case t.SessionEventType.FilePreviewDownloadFailed:case t.SessionEventType.FilePreviewRenderFailed:case t.SessionEventType.FilePreviewRenderSucceeded:return;default:c="canceled"}break;default:return}const p=o.extra.page_start_ts?Date.now()-parseInt(o.extra.page_start_ts,10):void 0;("start"===c?t.UDCL.logStart:t.UDCL.logEnd)({class:"previews",action:"preview",object:"file",properties:{eventState:c,actionScreen:n,fileType:s(a),fileSize:r.size,previewType:r.previewType?l(r.previewType):void 0,startType:"initial",actionId:o.file_preview_session_id,contentIdentifier:r.fileId,previewFailureReason:d,timeSinceStartMs:p,validationTraceId:o.extra.validation_trace_id}},{key:o.file_preview_session_id,tags:{previewType:l(r.previewType)||"",actionScreen:n}})},j="core_tags",N=()=>c.getYapsDeployment(),V=[t.SessionEventType.FilePreviewSupportConfirmed,t.SessionEventType.FilePreviewSupportDenied,t.SessionEventType.FilePreviewDownloadAttempted,t.SessionEventType.FilePreviewDownloadSucceeded,t.SessionEventType.FilePreviewDownloadFailed,t.SessionEventType.FilePreviewRenderSucceeded,t.SessionEventType.FilePreviewRenderFailed,t.SessionEventType.FilePreviewSessionEnded],W=new Set([t.SessionEventType.FilePreviewAttemptStarted,t.SessionEventType.FilePreviewRenderSucceeded,t.SessionEventType.FilePreviewSupportDenied,t.SessionEventType.FilePreviewDownloadFailed,t.SessionEventType.FilePreviewRenderFailed,t.SessionEventType.FilePreviewSessionEnded]),K="core_tags",H=e=>({device_type:e.device_type,...e.extra.source_context&&{source_context:e.extra.source_context},...e.extra.preview_type&&{preview_type:e.extra.preview_type},...e.extra.action&&{action:e.extra.action}}),$=(e,t={})=>({...t,...e.source_context&&{source_context:e.source_context},...e.preview_type&&{preview_type:e.preview_type}}),q=(e,i,o,n,r={},s={})=>{const l={...r,...n&&H(n),deployment:N(),is_edison:String(c.isServedByEdisonWebServer())},d=$(l,r);t.UDCL$1.track(`${o}/${e}`,{detail:{...l,quantity:i,hiveData:s}}),t.UDCL$1.track(`${o}/${K}/${e}`,{detail:{...d,quantity:i}}),(async(e,t,i,o,n)=>{const r=await a.getFenixAmisEnvironment();r&&(a.logAmisEventToDesktop(r,{namespace:i,metricName:e,tags:{...o},type:"histogram",samples:[t]}),a.logAmisEventToDesktop(r,{namespace:i,metricName:`${j}/${e}`,tags:{...n},type:"histogram",samples:[t]}))})(e,i,o,l,d)},B=(e,i,o,n,r={},s=void 0)=>{const l={...r,...n&&H(n),deployment:N(),is_edison:String(c.isServedByEdisonWebServer())},d=$(l,r),p=Date.now();t.UDCL$1.measure(`${o}/${e}`,{start:p-i,end:p,detail:{...l,hiveData:s}}),t.UDCL$1.measure(`${o}/${K}/${e}`,{start:p-i,end:p,detail:d}),(async(e,t,i,o,n)=>{const r=await a.getFenixAmisEnvironment();r&&(a.logAmisEventToDesktop(r,{namespace:i,metricName:e,tags:{...o},type:"histogram",samples:[t]}),a.logAmisEventToDesktop(r,{namespace:i,metricName:`${j}/${e}`,tags:{...n},type:"histogram",samples:[t]}))})(e,i,o,l,d)},J=(e,i,o)=>{const n=i.extra.file_preview_timeline?JSON.stringify(Object.entries(JSON.parse(i.extra.file_preview_timeline)).reduce(((e,[t,i])=>({...e,[t+"_ts"]:i})),{})):void 0,r={device_type:i.device_type,event_name:e,extra:JSON.stringify({...i.extra,initial_request_id:c.getRequestId()}),file_viewer_session_id:i.file_viewer_session_id,file_preview_session_id:i.file_preview_session_id,file_ns_id:i.ns_id,file_sjid:i.sj_id,file_preview_timeline:n,file_preview_size:i.file_preview_size,file_id:i.file_id,file_extension:i.file_extension,request_id:c.getRequestId()};q(e,1,"web_previews",i,o,r),V.includes(e)&&((e,i)=>{const o=i.extra.file_preview_timeline?JSON.parse(i.extra.file_preview_timeline):{};if(t.SessionEventType.FilePreviewAttemptStarted in o&&e in o){const n=o[e]-o[t.SessionEventType.FilePreviewAttemptStarted];n>0&&B("time_from_attempt_ms",n,"web_previews",i,{event_name:e})}})(e,i),Q(e,i),X(e,i)},Q=(e,i)=>{var o,n,r,a;const c=null===(o=i.extra)||void 0===o?void 0:o.event;if(e===t.EventType.Background&&c===t.BackgroundEvent.DocPageLoad){const e=null===(n=i.extra)||void 0===n?void 0:n.status,o=null===(r=i.extra)||void 0===r?void 0:r.durationMs,c=null===(a=i.extra)||void 0===a?void 0:a.error;e===t.DocPageLoadState.Loaded&&void 0!==o?(q("doc_preview/page_load_status",1,"web_previews",i,{status:t.DocPageLoadState.Loaded}),B("doc_preview/page_success_load_duration_ms",Number.parseInt(o,10),"web_previews",i)):e===t.DocPageLoadState.Error&&void 0!==c&&q("doc_preview/page_load_status",1,"web_previews",i,{status:t.DocPageLoadState.Error,error:c})}},Z=(e,i,o)=>(n,r,a)=>{W.has(n)&&(r.extra={validation_trace_id:t.UUID.v4(),...o&&{session_id:o},...r.extra}),J(n,r,a);const c=i();M(n,r,{previewSurface:e,file:c})},G=({eventName:e,durationInMs:i,session:o,tags:n={},shouldLogToHive:r})=>{let a;if(r&&o){const n={event_name:e,duration:i.toString()};a={event_name:"user_timing",device_type:o.device_type,client_timestamp_ms:t.WebTimingUtil.getNow(),file_preview_session_id:o.file_preview_session_id,file_viewer_session_id:o.file_viewer_session_id,file_preview_size:o.file_preview_size,file_ns_id:o.ns_id,file_sjid:o.sj_id,extra:JSON.stringify({...o.extra,...n}),file_id:o.file_id,file_extension:o.file_extension,request_id:c.getRequestId()}}B(e,i,"web_previews",o,n,a)},X=(e,i)=>{var o,n;e===t.EventType.UserAction&&(null===(o=i.extra)||void 0===o?void 0:o.action)===t.UserAction.OpenIn&&"third_party_app"===(null===(n=i.extra)||void 0===n?void 0:n.destination_surface)&&q("open_in_third_party_app",1,"web_previews",i)};var Y=Object.freeze({__proto__:null,logDuration:G,logDurationToAMISAndUDCL:B,logEvent:J,logQuantityToAMISAndUDCL:q,makeLogger:Z});e.getPapPreviewType=l,e.logAudioPlayToPap=async(e,o,n)=>{const{previousSurface:r,file:a}=o,c=a.extension,d="true"===(null==n?void 0:n.has_transcript_search_matches),p={actionSurface:"previews",fileType:s(c),fileSize:a.size,previewType:a.previewType?l(a.previewType):void 0,previousSurface:r,...d&&{hasTranscriptSearchMatch:!0}},_=e=>{t.UDCL.logEvent(m({...p,eventState:e,previewAction:"play"}),{tags:{preview_action:"play",event_status:e,preview_type:p.previewType||"UNKNOWN"}})};switch(e){case i.VideoPreviewEvent.VideoStartsPlaying:_("success");break;case i.VideoPreviewEvent.MediaError:_("failed");break;case i.VideoPreviewEvent.VideoResumesPlaying:t.UDCL.logEvent(m({...p,previewAction:"play"}))}},e.logAudioVideoEventToPap=(e,o,n,r)=>{var a,c;const l=e.extension,d="true"===(null===(a=r.extra)||void 0===a?void 0:a.has_transcript_search_matches),p={actionSurface:"previews",fileType:s(l),fileSize:e.size,previousSurface:o,...d&&{hasTranscriptSearchMatch:!0}};switch(n){case i.VideoPreviewEvent.ChangeVideoQuality:"user_selected"===(null===(c=r.extra)||void 0===c?void 0:c.video_quality_changer)&&t.UDCL.logEvent(m({...p,previewAction:"quality_change"}));break;case i.VideoPreviewEvent.ChangePlaybackRate:t.UDCL.logEvent(m({...p,previewAction:"playback_speed_change"}));break;case i.VideoPreviewEvent.HoverScrubberThumbnailsSucceeded:t.UDCL.logEvent(E({eventState:"success",actionScreen:o,fileSize:e.size,fileType:s(l)}));break;case i.VideoPreviewEvent.HoverScrubberThumbnailsFailed:t.UDCL.logEvent(E({eventState:"failed",actionScreen:o,fileSize:e.size,fileType:s(l)}));break;case i.VideoPreviewEvent.HoverTranscriptButton:t.UDCL.logEvent(E({eventState:"success",actionScreen:o,fileSize:e.size,fileType:s(l),hasTranscriptSearchMatch:!0}));break;case i.VideoPreviewEvent.ClickTranscriptButton:t.UDCL.logEvent(k({eventState:"success",actionScreen:o,fileSize:e.size,fileType:s(l),hasTranscriptSearchMatch:!0}))}},e.logDuration=G,e.logDurationToAMISAndUDCL=B,e.logQuantityToAMISAndUDCL=q,e.logVideoPlayPauseToPap=async(e,o,n)=>{const{previousSurface:r,file:a}=o,c=a.extension,d="true"===(null==n?void 0:n.has_transcript_search_matches),p={actionElement:null==n?void 0:n.action_element,actionSurface:"previews",fileType:s(c),fileSize:a.size,previewType:a.previewType?l(a.previewType):void 0,previousSurface:r,...d&&{hasTranscriptSearchMatch:!0}},_=e=>{t.UDCL.logEvent(m({...p,eventState:e,previewAction:"play"}),{tags:{preview_action:"play",event_status:e,preview_type:p.previewType||"UNKNOWN"}})};switch(e){case i.VideoPreviewEvent.VideoStartsPlaying:_("success");break;case i.VideoPreviewEvent.MediaError:_("failed");break;case i.VideoPreviewEvent.VideoPaused:t.UDCL.logEvent(m({...p,previewAction:"pause"}));break;case i.VideoPreviewEvent.VideoResumesPlaying:t.UDCL.logEvent(m({...p,previewAction:"play"}))}},e.makeLogger=Z,e.previewSurfaceToPreviousSurface=_,e.preview_logger_esnext=Y}));
//# sourceMappingURL=c_file_viewer_preview_logger.js-vflTFIaYF.map

//# debugId=ba9c17b9-8728-342d-a945-fe15aacfc333