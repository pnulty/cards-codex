!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4b539369-08ce-300a-9a8b-1d5ccddc60da")}catch(e){}}();
define(["require","exports","react","./c_core_i18n","./e_ui_page_files_router","./e_data_modules_stormcrow","./e_core_exception"],(function(e,a,t,s,r,n,i){"use strict";function c(e){if(e&&e.__esModule)return e;var a=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(a,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}})),a.default=e,Object.freeze(a)}var d=c(t);const o="custom:get_all_stacks",l=r.getCustomRequestQueryKey(o),_=r.createCustomRequestQuery({requestMethod:o,queryFn:({apiArg:e})=>async()=>{const a=(null==e?void 0:e.isMergingFssStacksDashStacksEnabled)?void 0:{fss_stacks:!0},t=(await r.GetStacksRoutes(new r.ActiveUserApiV2Client).rpc("query_stacks",{fields:{name:!0,max_hlc:!0,sharing_data:!0},stack_types:a},{})).stacks||[];return t.sort(((e,a)=>{var t,s;const r=e.max_hlc_micros||0,n=a.max_hlc_micros||0,i=null===(t=e.user_data)||void 0===t?void 0:t.is_pinned;return!!i==!!(null===(s=a.user_data)||void 0===s?void 0:s.is_pinned)?n-r:i?-1:1})),{apiData:t,pkgData:null}},getQueryKey:l}),u=s.defineMessage({id:"l6ovbV",defaultMessage:"Adding files to Stackâ€¦"}),g=s.defineMessage({id:"+sy8AO",defaultMessage:"Files added to Stack"}),f=s.defineMessage({id:"EnTfEk",defaultMessage:"No files to add to Stack"});const k=s.defineMessage({id:"bE01xd",defaultMessage:"You are not allowed to create Stacks"}),m=s.defineMessage({id:"AjUqKc",defaultMessage:"Invalid Stack name"}),p=s.defineMessage({id:"AAW0rI",defaultMessage:"Stack data too large"}),S=s.defineMessage({id:"XXD6Af",defaultMessage:"Failed to create Stack"}),h=s.defineMessage({id:"2+K1rd",defaultMessage:"Failed to add items to Stack"}),M=e=>{switch(e){case"not_allowed":return k;case"invalid_name":return m;case"stack_data_too_large":return p;case"enqueue_error":return h;default:return S}};a.STACK_SIZE_LIMIT=200,a.asyncAddToStack=async(a,t,i,c,o,u)=>{const g=await r.fetchExperimentVariant("dash_2025_10_07_merging_fss_stacks_and_dash_stacks");((e,a)=>{e.invalidateQueries({queryKey:l({isMergingFssStacksDashStacksEnabled:a})}),_.prefetchQuery(e,{apiArg:{isMergingFssStacksDashStacksEnabled:a}})})(t,!!("ON"===(null==g?void 0:g.variant)));const{AddToStackModal:f}=await new Promise((function(a,t){e(["./c_stacks_add_to_stack"],a,t)}));return r.Modal.showInstance(d.createElement(n.QueryClientProvider,{client:t},d.createElement(s.Provider,{value:a},d.createElement(f,{files:c,navigate:i,sectionName:u,actionSurface:o}))))},a.canAddToStack=e=>e.length<=200,a.createStackAndAddFiles=async function(e,a,t,s,n){var c;if(!t.length)return void r.Snackbar.fail(e.formatMessage(f));r.Snackbar.sync(e.formatMessage(u));const d=r.GetStacksRoutes(new r.ActiveUserApiV2Client);try{const{stack:i}=await d.rpc("create_stack",{stack_data:{...s,creation_type:{".tag":"fss_stack"}}},{});if(!i||!i.sharing_id||!i.namespace_id){const e=new r.ApiError;throw e.error={".tag":"other"},e}return await d.rpc("create_fss_stack_item_batch_async",{parent_ns_id:i.namespace_id,item_list:t},{}),await new Promise((e=>setTimeout(e,Math.min(100*t.length,1e4)))),r.Snackbar.complete(e.formatMessage(g)),a(`/stacks/${i.sharing_id}${n?`?${n}`:""}`),i}catch(a){i.reportException({err:a,tags:["create-stack-and-add-files"]});const t=r.filterApiError(a),s=t?null===(c=t.error)||void 0===c?void 0:c[".tag"]:void 0;return void r.Snackbar.fail(e.formatMessage(M(s)))}},a.updateStackAndAddFiles=async function(e,a,t,s,n){if(!s.length)return r.Snackbar.fail(e.formatMessage(f)),!1;r.Snackbar.sync(e.formatMessage(u));try{return n&&n.length&&await r.GetStacksRoutes(new r.ActiveUserApiV2Client).rpc("update_stack",{namespace_id:t.namespace_id,stack_data_updates:n},{}),await r.GetStacksRoutes(new r.ActiveUserApiV2Client).rpc("create_fss_stack_item_batch_async",{parent_ns_id:t.namespace_id,item_list:s},{}),await new Promise((e=>setTimeout(e,Math.min(100*s.length,1e4)))),r.Snackbar.complete(e.formatMessage(g)),a(`/stacks/${t.sharing_id}`),!0}catch(a){return i.reportException({err:a,tags:["add-to-stack"]}),r.Snackbar.fail(e.formatMessage(h)),!1}},a.useAllStacks=()=>{var e;const a="ON"===(null===(e=r.useExperimentVariant("dash_2025_10_07_merging_fss_stacks_and_dash_stacks"))||void 0===e?void 0:e.variant);return _.useQuery({apiArg:{isMergingFssStacksDashStacksEnabled:a}})}}));
//# sourceMappingURL=c_stacks_lib_api.js-vflQuDCRO.map

//# debugId=4b539369-08ce-300a-9a8b-1d5ccddc60da