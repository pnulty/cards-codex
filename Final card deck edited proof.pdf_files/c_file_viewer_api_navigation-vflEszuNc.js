!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8e050aec-d5b5-3f09-b0a9-3ab56f69141d")}catch(e){}}();
define(["exports","./e_ui_page_files_router","react","./c_file_viewer_api_ui","./c_file_viewer_hooks_usePrevious","./c_file_viewer_hooks_lifecycle_logging","./e_data_modules_stormcrow"],(function(e,i,l,t,o,n,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var a=s(l);const u=i.previewKeyAtom(void 0),c=(e,l)=>!((null==l?void 0:l.previewType)!==i.PreviewType.CloudDoc&&(null==l?void 0:l.previewType)!==i.PreviewType.SsrDoc||"preview"!==e.cloud_doc_preview_mode&&(e=>{var l,t;const o=null==e?void 0:e.previewType;if((o===i.PreviewType.SsrDoc||o===i.PreviewType.CloudDoc)&&"cloud_doc"===(null===(l=null==e?void 0:e.content)||void 0===l?void 0:l[".tag"])&&(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.exit_url))return e.content.exit_url})(l)),d="files:get_metadata_batch",C=e=>{const{logUserAction:l}=i.useFileViewerContext(),t=i.useSetFileViewerAtom(i.leftSidebarIdAtom);return i.useStabilizedCallback((o=>{const n={[i.INFO_BLADE_PLUGIN_ID]:i.UserAction.Info,[i.FILE_ACTIVITY_PLUGIN_ID]:i.UserAction.FileActivity};t(o,{actionContext:e}),void 0!==o&&l(n[o],e)}))},v=e=>{const{logUserAction:l}=i.useFileViewerContext(),t=i.useSetFileViewerAtom(i.rightSidebarIdAtom);return i.useStabilizedCallback((o=>{const n={[i.DUPLICATE_FILES_BLADE_PLUGIN_ID]:i.UserAction.DuplicateFilesShow,[i.TRANSCRIPT_BLADE_PLUGIN_ID]:i.UserAction.TranscriptShow,[i.COMMENTS_PLUGIN_ID]:i.UserAction.ShowComments};t(o,{actionContext:e}),void 0!==o&&l(n[o],e)}))},A=()=>{const{logUserAction:e,optionalIOClients:{fullScreenClient:l}}=i.useFileViewerContext(),o=i.useSetFileViewerAtom(t.isFullScreenAtom),n=i.useSetFileViewerAtom(t.isDashChatClosedByFullscreenPreviewAtom),r=b(),s=S();return i.useStabilizedCallback((({actionContext:t,skipAction:a})=>{e(i.UserAction.ToggleFullscreenOn,t),null==l||l.enterFullScreen((()=>s({actionContext:t,skipAction:a})),!!a,{setIsDashChatClosedByFullscreenPreview:n}),o(!0),r({zoomType:"fitToPage"})}))},S=()=>{const{logUserAction:e,optionalIOClients:{fullScreenClient:l}}=i.useFileViewerContext(),o=i.useSetFileViewerAtom(t.isFullScreenAtom),n=i.useSetFileViewerAtom(t.isSlideshowAtom),[r,s]=i.useFileViewerAtom(t.isDashChatClosedByFullscreenPreviewAtom);return i.useStabilizedCallback((({actionContext:t,skipAction:a})=>{e(i.UserAction.ToggleFullscreenOff,t),null==l||l.exitFullScreen(!!a,{isDashChatClosedByFullscreenPreview:r,setIsDashChatClosedByFullscreenPreview:s}),n(!1),o(!1)}))},b=()=>i.useSetFileViewerAtom(t.zoomPercentAtom);e.getWillCloudDocPreviewAsSsrDoc=c,e.imageLocalDimensionsAtom=u,e.useCloseSidebarCallback=e=>{const{logUserAction:l}=i.useFileViewerContext(),o=t.useLeftSidebarId(),n=t.useRightSidebarId(),r=C(e),s=v(e);return i.useStabilizedCallback((t=>{const a={[i.DUPLICATE_FILES_BLADE_PLUGIN_ID]:i.UserAction.DuplicateFilesHide,[i.TRANSCRIPT_BLADE_PLUGIN_ID]:i.UserAction.TranscriptHide,[i.INFO_BLADE_PLUGIN_ID]:i.UserAction.InfoHide,[i.COMMENTS_PLUGIN_ID]:i.UserAction.HideComments,[i.FILE_ACTIVITY_PLUGIN_ID]:i.UserAction.FileActivityHide};o===t?(r(void 0),l(a[t],e)):n===t&&(s(void 0),l(a[t],e))}))},e.useCloseViewerCallback=()=>{const{logUserAction:e,optionalIOClients:{navigationClient:l,urlClient:t}}=i.useFileViewerContext(),o=i.useFileViewerAtomValue(i.rootFileInfoAtom),[n,r]=i.useFileViewerAtom(i.currentArchivePathAtom);return i.useStabilizedCallback((s=>{var a;if(e(i.UserAction.CloseViewer,s),o&&(null==n?void 0:n.length)){const e=n.slice(0,-1);r(e,t,{fromUrlChanged:!1,isDir:!0})}else null==t||t.setQueryStringParameter(i.archiveSubpathQueryParam,null),null===(a=null==l?void 0:l.closeViewer)||void 0===a||a.call(l)}))},e.useDeleteFileCallback=()=>{const{logUserAction:e,optionalIOClients:{fileActionsClient:l}}=i.useFileViewerContext(),o=i.useSetFileViewerAtom(t.isDeleteFileModalOpenAtom);return i.useStabilizedCallback(((t,n)=>{var r;e(i.UserAction.DeleteStart,t,{key:n});null===(r=null==l?void 0:l.delete)||void 0===r||r.call(l,{onDelete:()=>{},onDeleteSuccess:()=>{e(i.UserAction.DeleteSuccess,t)},onDeleteFailed:()=>{e(i.UserAction.DeleteFailed,t)},onDeleteFailedNoPermission:()=>{e(i.UserAction.DeleteFailedNoPermission,t)},onDeleteCancel:()=>{e(i.UserAction.DeleteCancel,t)},setDeleteFileModalOpen:e=>{o(e)}})}))},e.useEnterFullScreenCallback=A,e.useExitEditModeCallback=()=>{const e=i.useSetFileViewerAtom(i.activeEditorIdAtom);return i.useStabilizedCallback((i=>{e(void 0)}))},e.useExitFullScreenCallback=S,e.useFileFlippingCallbacks=()=>{const{logUserAction:e,optionalIOClients:{navigationClient:l}}=i.useFileViewerContext();return{flipToNextFile:i.useStabilizedCallback((t=>{var o;e(i.UserAction.FlipNext,t),null===(o=null==l?void 0:l.flipToNextFile)||void 0===o||o.call(l)})),flipToPreviousFile:i.useStabilizedCallback((t=>{var o;e(i.UserAction.FlipPrevious,t),null===(o=null==l?void 0:l.flipToPreviousFile)||void 0===o||o.call(l)})),flipToNextSlideshowFile:i.useStabilizedCallback((t=>{var o;e(i.UserAction.FlipNextSlideshow,t),null===(o=null==l?void 0:l.flipToNextSlideshowFile)||void 0===o||o.call(l)})),flipToPreviousSlideshowFile:i.useStabilizedCallback((t=>{var o;e(i.UserAction.FlipPreviousSlideshow,t),null===(o=null==l?void 0:l.flipToPreviousSlideshowFile)||void 0===o||o.call(l)}))}},e.useHideToolsCallback=e=>{const{logUserAction:l}=i.useFileViewerContext(),o=i.useSetFileViewerAtom(t.areToolsHiddenAtom);return i.useStabilizedCallback((()=>{o(!0),l(i.UserAction.HideTools,e)}))},e.useNavigateToPageCallback=e=>{const{logUserAction:l,featureConfig:o}=i.useFileViewerContext(),r=n.useCurrentPreviewKey(),s=i.useCurrentPreviewMetadata(),a=s.previewType,u=t.usePageCount(r,s),d=i.useSetPreviewKeyAtom(t.docCurrentPageIndexAtom,r),C=c(o,s),v=i.useSetPreviewKeyAtom(t.docPageNavigationAtom,r);return i.useStabilizedCallback(((t,o)=>{(a===i.PreviewType.SsrDoc||C)&&null!=r&&(l(i.UserAction.PageJump,e),d(t,null!=u?u:0),v({pageIndex:t,offset:o}))}))},e.useOpenUrlCallback=()=>{const{optionalIOClients:{navigationClient:e}}=i.useFileViewerContext();return i.useStabilizedCallback((i=>{var l;null===(l=null==e?void 0:e.openUrl)||void 0===l||l.call(e,i)}))},e.usePauseCallback=()=>{const e=o.usePreviewControls().videoPlayer;return i.useStabilizedCallback((()=>{e&&e.pause()}))},e.usePlayCallback=()=>{const e=o.usePreviewControls().videoPlayer;return i.useStabilizedCallback((()=>{e&&e.play()}))},e.useResetPreviewCallback=()=>{const{apiV2ClientShim:e,optionalIOClients:{navigationClient:l}}=i.useFileViewerContext(),t=r.useQueryClient(),[o,n]=i.useFileViewerAtom(i.rootFileInfoAtom),s=a.default.useMemo((()=>{return i=e.filesGetMetadataBatch,r.createGenericQuery({queryRouteFilter:["apiv2",d],queryFn:({apiArg:e})=>async({})=>({apiData:await i(e),pkgData:null}),getQueryKey:r.getGenericQueryKey("apiv2",d)});var i}),[e.filesGetMetadataBatch]),u=i.useSetFileViewerAtom(i.rootFileMetadataAtom);return i.useStabilizedCallback((r=>{var a;if(!o)return;const c=r||o.file_id;if(c){null===(a=null==l?void 0:l.updateFiles)||void 0===a||a.call(l);const r={apiArg:{paths:[c]},pkgArg:null};s.fetchQuery(t,r).then((l=>{var r,s,a,d,C;if(!(null===(r=l.apiData)||void 0===r?void 0:r.entries)||0===l.apiData.entries.length)return;const v=l.apiData.entries[0];if("file"!==(null==v?void 0:v[".tag"]))return;const A={...v,file_id:c,file_name:v.name,readOnly:null!==(C=null!==(a=null===(s=v.sharing_info)||void 0===s?void 0:s.read_only)&&void 0!==a?a:null===(d=v.sharing_info)||void 0===d?void 0:d.is_parent_shared_folder_read_only)&&void 0!==C&&C};u(A);const S=i.getPreviewKeyFromFileInfo(A);n({...A,previewKey:S});i.makePreviewMetadataRequestPackage(e.previewsGetPreviewDataBatch).invalidateQueries(t,o)}))}}))},e.useSeekCallback=()=>{const e=o.usePreviewControls().videoPlayer;return i.useStabilizedCallback((i=>{e&&(e.currentTime(i/100),e.pause())}))},e.useSeekRelativeCallback=()=>{const e=o.usePreviewControls().videoPlayer;return i.useStabilizedCallback((i=>{var l;e&&(0===e.currentTime()&&(null===(l=e.play())||void 0===l||l.then((()=>{e.pause()})).catch((()=>{}))),e.currentTime(e.currentTime()+i),e.pause())}))},e.useSetActiveEditorCallback=()=>{const e=i.useSetFileViewerAtom(i.activeEditorIdAtom);return i.useStabilizedCallback(((i,l,t)=>{e(i,t)}))},e.useSetDeleteFileModalOpenCallback=()=>{const e=i.useSetFileViewerAtom(t.isDeleteFileModalOpenAtom);return i.useStabilizedCallback((i=>e(i)))},e.useSetIsDocSidebarOpen=e=>{const{optionalIOClients:{preferencesClient:l},logUserAction:o}=i.useFileViewerContext(),n=i.useSetFileViewerAtom(t.isDocSidebarOpenAtom);return i.useStabilizedCallback((t=>{var r;n(t),o(t?i.UserAction.PageSelector:i.UserAction.HidePageSelector,e),null===(r=null==l?void 0:l.docSidebar)||void 0===r||r.setCollapsedState({isCollapsed:!t})}))},e.useSetLeftSidebarCallback=C,e.useSetRightSidebarCallback=v,e.useToggleFullScreenCallback=()=>{const e=A(),l=S(),o=t.useIsFullscreen();return i.useStabilizedCallback((i=>{o?l(i):e(i)}))},e.useToggleLineNumbersCallback=e=>{const{logUserAction:l}=i.useFileViewerContext(),[o,n]=i.useFileViewerAtom(t.areLineNumbersHiddenAtom);return i.useStabilizedCallback((()=>{n(!o),l(o?i.UserAction.ShowLineNumbers:i.UserAction.HideLineNumbers,e)}))},e.useToggleRenameStateCallback=()=>{const e=i.useSetFileViewerAtom(t.isTitleBarRenameActiveAtom);return i.useStabilizedCallback((i=>{e(i)}))},e.useToggleSlideshowCallback=()=>{const e=(()=>{const{logUserAction:e,optionalIOClients:{preferencesClient:l}}=i.useFileViewerContext(),o=A(),n=i.useSetFileViewerAtom(t.isSlideshowAtom),r=i.useSetFileViewerAtom(t.isSlideshowPausedAtom),s=t.useIsFullscreen();return i.useStabilizedCallback((({actionContext:t,skipAction:a})=>{var u;e(i.UserAction.ToggleSlideshowOn,t),null===(u=null==l?void 0:l.ui)||void 0===u||u.setHiddenState({isHidden:!0}),s||o({actionContext:t,skipAction:a}),n(!0),r(!1)}))})(),l=(()=>{const{logUserAction:e}=i.useFileViewerContext(),l=S();return i.useStabilizedCallback((({actionContext:t,skipAction:o})=>{e(i.UserAction.ToggleSlideshowOff,t),l({actionContext:t,skipAction:o})}))})(),o=t.useIsSlideshow();return i.useStabilizedCallback((i=>{o?l(i):e(i)}))},e.useUpdateArchiveFileCurrentPathCallback=()=>{const{optionalIOClients:{urlClient:e}}=i.useFileViewerContext(),l=i.useSetFileViewerAtom(i.currentArchivePathAtom);return i.useStabilizedCallback(((i,t,o=!1)=>{l(i,e,{isDir:t,fromUrlChanged:o})}))},e.useUpdateZoomCallback=b}));
//# sourceMappingURL=c_file_viewer_api_navigation.js-vflQxhjHE.map

//# debugId=8e050aec-d5b5-3f09-b0a9-3ab56f69141d