!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="698ee514-7576-3a6f-ae82-71c4a09984ce")}catch(e){}}();
define(["exports","./e_ui_page_files_router","react"],(function(e,i,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var r=n(t);const s=()=>i.useFileViewerAtomValue(i.rootPreviewKeyAtom),o=()=>i.useFileViewerAtomValue(i.currentPreviewKeyAtom),l=()=>{var e;const t=s(),n=i.useFileViewerAtomValue(i.rootFileMetadataAtom),r=o(),l=((e,t,n)=>{var r;const s=i.useArchiveDataQuery(e,t);if(!n)return;const o=null===(r=s.data)||void 0===r?void 0:r.apiData.entries;return null==o?void 0:o[n]})(t,i.usePreviewMetadataForPreviewKey(t),r&&i.isNestedArchiveFilePreviewKey(r)?r.subpath:void 0);return l&&n&&l&&!l.isDir?{file_name:l.name,file_collection_context:n.file_collection_context,size:null!==(e=l.size)&&void 0!==e?e:0,readOnly:!0}:n};const u=(()=>{let e,i;const t=[];for(e=0,i=e;e<=255;e++,i=e)t.push((i+256).toString(16).substr(1));return t})();function a(e){return e.map((e=>u[e])).join("")}function d(){const e=function(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const i=Array.prototype.slice.call(e);return[i.slice(0,4),i.slice(4,6),i.slice(6,8),i.slice(8,10),i.slice(10,16)].map(a).join("-")}const c=i.fileViewerAtom(void 0);function v(e){const{file_viewer_session_id:t=d(),file_preview_session_id:n=d(),file_id:r="",sj_id:s,ns_id:o,file_extension:l=i.getWhitelistedFileExtension(""),device_type:u=i.DeviceType.desktop,extra:a={},file_preview_size:c}=e||{};return{file_viewer_session_id:t,file_preview_session_id:n,file_id:r,sj_id:s,ns_id:o,file_extension:l,device_type:u,file_preview_size:c,extra:{...a,source_context:a.source_context||i.SourceContext.FileViewer,was_flipped:a.was_flipped||!1,file_preview_timeline:{}}}}let f={};const w=e=>void 0!==e?f[e]:void 0;function _(e){return Object.keys(e).reduce(((i,t)=>{const n=e[t];return"string"==typeof n||"number"==typeof n?i[t]=String(n):"boolean"==typeof n?i[t]=String(+n):"object"==typeof n&&n&&(i[t]=JSON.stringify(n)),i}),{})}function p(e,t){return{...e,file_extension:i.getWhitelistedFileExtension(e.file_extension||""),extra:_({...e.extra,...t})}}const S=()=>{const{logger:e}=i.useFileViewerContext();return i.useStabilizedCallback(((t,n,r)=>{const s=w(t);if(!s)return;const o=function(e,t){const{extra:{last_event:n}}=e;if(n!==t){switch(t){case i.SessionEventType.FilePreviewSupportConfirmed:case i.SessionEventType.FilePreviewSupportDenied:if(n!==i.SessionEventType.FilePreviewAttemptStarted)return;break;case i.SessionEventType.FilePreviewDownloadAttempted:if(n!==i.SessionEventType.FilePreviewSupportConfirmed)return;break;case i.SessionEventType.FilePreviewDownloadFailed:case i.SessionEventType.FilePreviewDownloadSucceeded:if(n!==i.SessionEventType.FilePreviewDownloadAttempted)return;break;case i.SessionEventType.FilePreviewRenderSucceeded:case i.SessionEventType.FilePreviewRenderFailed:if(n!==i.SessionEventType.FilePreviewDownloadSucceeded)return}return{...e,extra:{...e.extra,file_preview_timeline:{...e.extra.file_preview_timeline,[t]:Date.now()}}}}}(s,n);if(o)null==e||e.log(n,p(o,r),r),((e,i)=>{f={...f,[e]:i}})(t,function(e,i){return{...e,extra:{...e.extra,last_event:i}}}(o,n));else{const t={...r,current_event:n};null==e||e.log(i.BackgroundEvent.InvalidLoggingOrder,p(s,t),t)}}))},y=(e,i,t,n)=>{const s=S();r.default.useMemo((()=>{e&&i&&s(e,i)}),[i,s,e]),r.default.useMemo((()=>{e&&n&&s(e,t)}),[n,s,e,t])};e.filePreviewSessionIdAtom=c,e.getLoggingSession=w,e.serializeSession=p,e.useCurrentFileMetadata=l,e.useCurrentPreviewKey=o,e.useDownloadSucceeded=(e,t)=>{y(e,i.SessionEventType.FilePreviewDownloadAttempted,i.SessionEventType.FilePreviewDownloadSucceeded,t)},e.useEndSession=e=>{const t=S();r.default.useEffect((()=>{if(!e)return;const n=()=>{var n;const r=null===(n=w(e))||void 0===n?void 0:n.extra.last_event;t(e,i.SessionEventType.FilePreviewSessionEnded,{...r&&{last_event:r}}),i.PreviewsEventLogger.endCurrentSession()};return window.addEventListener("beforeunload",n),()=>{n(),window.removeEventListener("beforeunload",n)}}),[t,e])},e.useInitializePreviewSession=(e,t,n,s,o)=>{const{deviceType:l,loggingSessionId:u,featureConfig:a,sourceSession:w}=i.useFileViewerContext();r.default.useRef(a).current=a;const _=r.default.useRef(w);_.current=w;const p=r.default.useRef(t);p.current=t;const S=r.default.useRef(n);S.current=n;const y=r.default.useMemo((()=>{const t=d(),n=S.current,r=p.current;if(!e||!r||!n)return;const a=i.isNestedArchiveFilePreviewKey(e),c=i.getFileExtension(a?e.subpath:n.file_name),w=a?{source_context:i.SourceContext.ArchiveFile,page_start_ts:Date.now(),was_flipped:!1}:_.current,y=i.resolvePreviewType(o,a?e.subpath:n.file_name);var F,m;return F=t,m={file_viewer_session_id:u,file_preview_session_id:t,file_id:r.file_id,sj_id:r.sj_id,ns_id:r.ns_id,device_type:l,file_extension:i.getWhitelistedFileExtension(c),file_preview_size:n.size,extra:{...w,preview_type:y}},f={...f,[F]:v(m)},null==s||s(t),t}),[l,u,s,e]),F=i.useSetFileViewerAtom(c);return r.default.useEffect((()=>{F(y)}),[y,F]),y},e.useLogSessionEvent=S,e.usePreviewState=function(e){return{fileMetadata:l(),previewMetadata:i.usePreviewMetadataForPreviewKey(e),fileInfo:(()=>{const e=o(),t=i.useFileViewerAtomValue(i.rootFileInfoAtom),n=!!e&&i.isNestedArchiveFilePreviewKey(e);return t&&!n?t:void 0})()}},e.useRenderSucceededWithLogging=(e,t)=>{const[n,s]=r.default.useState(!1);return y(e,void 0,i.SessionEventType.FilePreviewRenderSucceeded,n),r.default.useCallback((()=>{s(!0),t()}),[t])},e.useRootPreviewKey=s,e.useSupportConfirmed=(e,t)=>{y(e,i.SessionEventType.FilePreviewAttemptStarted,i.SessionEventType.FilePreviewSupportConfirmed,t)},e.v4=d}));
//# sourceMappingURL=c_file_viewer_hooks_lifecycle_logging.js-vflQOtb6C.map

//# debugId=698ee514-7576-3a6f-ae82-71c4a09984ce