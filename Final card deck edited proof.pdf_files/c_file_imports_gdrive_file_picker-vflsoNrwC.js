!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="364614ae-ea49-3220-b286-cf8a304e405e")}catch(e){}}();
define(["exports","./c_ncct_manual_assist_util","./e_core_exception","./e_ui_page_files_router","react","./c_core_i18n","./c_profile_services_profile_services_constants"],(function(e,r,t,o,i,n,l){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var s,c,d,p,u=a(i);!function(e){e.OpenGdriveFilePicker="OpenGdriveFilePicker"}(s||(s={})),e.FilePickerAction=void 0,(c=e.FilePickerAction||(e.FilePickerAction={})).PICKED="PICKED",c.CANCELED="CANCELED",e.FilePickerViewId=void 0,(d=e.FilePickerViewId||(e.FilePickerViewId={})).DOCS="all",d.FOLDERS="folders",function(e){e.IframeLoaded="IframeLoaded",e.FilePickerResult="FilePickerResult",e.SignInWithDifferentAccount="SignInWithDifferentAccount",e.UnhandledError="UnhandledError",e.UnhandledRejection="UnhandledRejection"}(p||(p={}));const f="FileImports",v=(e,r,o,i)=>{i?t.reportException({err:i,severity:e,tags:[f],exc_extra:o}):t.reportStack(r,{severity:e,tags:[f],exc_extra:o,silent:!1})},g={info:(e,r,o)=>v(t.SEVERITY.OPERATIONAL,e,r,o),warn:(e,r,o)=>v(t.SEVERITY.NONCRITICAL,e,r,o),error:(e,r,o)=>v(t.SEVERITY.CRITICAL,e,r,o),uncaught:(e,r,o)=>v(t.SEVERITY.UNCAUGHT,e,r,o)};o.injectInternalStyle("/static/metaserver/static/js/file_imports/gdrive/file_picker.module.out-vflUvIQdI.css",(e=>"._overlay_g01kv_1{background-color:var(--color__utility__overlay);height:100%;left:0;position:fixed;top:0;transition-delay:0;transition-duration:.333;transition-property:opacity;transition-timing-function:cubic-bezier(.66,0,0,1);width:100%;z-index:10001}"));const m="_overlay_g01kv_1",_=()=>n.intl.formatMessage({id:"h2PZeS",defaultMessage:"Google"}),S=()=>n.intl.formatMessage({id:"MDiUcD",defaultMessage:"Google Drive"}),E=()=>n.intl.formatMessage({id:"Ur1/IM",defaultMessage:"Microsoft"}),C=()=>n.intl.formatMessage({id:"rfdy2l",defaultMessage:"OneDrive"}),w=()=>n.intl.formatMessage({id:"dObY3n",defaultMessage:"Unknown"}),D=e=>{switch(e[".tag"]){case"gdrive":return S();case"onedrive":return C()}return w()},h=e=>{switch(e[".tag"]){case"gdrive":return _();case"onedrive":return E()}return w()};const x="browse",b=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive"}},P=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive"}},F=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"try_again",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},L=(e,r,t,i)=>{const n={class:"file_imports",action:"select",object:"gdrive_file_picker",properties:{actionSurface:null!=t?t:x,srcFilesTotal:e,eventState:r}};const l={eventState:"start"!==r?r:void 0,tags:i};r?"start"===r?o.UDCL.logStart(n,l):o.UDCL.logEnd(n,l):o.UDCL.logEvent(n,l)},U={GotIt:()=>n.intl.formatMessage({id:"j8BdSl",defaultMessage:"Got it"}),TryAgain:()=>n.intl.formatMessage({id:"HImQBL",defaultMessage:"Try again"}),Cancel:()=>n.intl.formatMessage({id:"cp7jer",defaultMessage:"Cancel"}),CloseAriaLabel:()=>n.intl.formatMessage({id:"F4pNeQ",defaultMessage:"Close"}),ViewDetails:()=>n.intl.formatMessage({id:"YPmkDk",defaultMessage:"View details"}),HideDetails:()=>n.intl.formatMessage({id:"p8xGcP",defaultMessage:"Hide details"}),SkipForNow:()=>n.intl.formatMessage({id:"/BdoCx",defaultMessage:"Skip for now"})},k=e=>n.intl.formatMessage({id:"ibOvmo",defaultMessage:"Couldnâ€™t get a response from {serviceProvider} servers"},{serviceProvider:h(e)}),y=e=>n.intl.formatMessage({id:"kL19SV",defaultMessage:"You can try again, or download your files and folders from {service} and drag them into Dropbox."},{service:D(e)}),j=({open:e,onRequestClose:r,supportedService:t,tryAgain:n,onSkipForNow:l,actionSurface:a})=>(i.useEffect((()=>{((e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"external_api_error",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})})(t.importType,a)}),[t.importType,a]),u.default.createElement(o.Modal$1,{onRequestClose:r,open:e,isCentered:!0,withCloseButton:U.CloseAriaLabel()},u.default.createElement(o.Modal$1.Header,{hasBottomSpacing:"title-standard"},u.default.createElement(o.Modal$1.Title,null,k(t.importType))),u.default.createElement(o.Modal$1.Body,{hasVerticalSpacing:!1},u.default.createElement(o.Text,{tagName:"p"},y(t.importType))),u.default.createElement(o.Modal$1.Footer,null,u.default.createElement(o.Button,{variant:"opacity",onClick:()=>{r(),null==l||l()},autoFocus:!0},l?U.SkipForNow():U.GotIt()),u.default.createElement(o.Button,{variant:"primary",autoFocus:!0,onClick:()=>{r(),n(),F(t.importType,a)}},U.TryAgain())))),M=(e,r,t,i)=>{o.Modal.showInstance(u.default.createElement(j,{supportedService:e,open:!0,onRequestClose:()=>o.Modal.close(),tryAgain:r,onSkipForNow:i,actionSurface:t}))},I={GDrive:{displayName:"Google Drive",importType:{".tag":"gdrive"},signinServiceDisplayName:"Google",profileServicesConstant:l.ProfileServicesConstants.GOOGLE,profileServicesApiServiceType:{".tag":"google"},defaultDestPath:"Google Drive",profileServicesAction:"link_read_files"},OneDrive:{displayName:"Microsoft OneDrive",importType:{".tag":"onedrive"},signinServiceDisplayName:"Microsoft",profileServicesConstant:l.ProfileServicesConstants.OUTLOOK,profileServicesApiServiceType:{".tag":"outlook"},defaultDestPath:"Microsoft OneDrive",profileServicesAction:"access_files_and_wiki"}},T=async e=>new Promise((r=>setTimeout(r,e)));let A,O,N,G,R,B=null,V=()=>{},$="",q=()=>{};const Y=`https://${r.getDomains().FILE_IMPORTS_SUBDOMAIN}`,J=e=>{var r;B&&(V(e),null===(r=B.parentNode)||void 0===r||r.removeChild(B),window.removeEventListener("message",R),B=null,V=()=>{})},W=(r,t)=>(R=async o=>{var i;if(!B||o.origin!==Y||o.source!==B.contentWindow||!(null===(i=o.data)||void 0===i?void 0:i.hasOwnProperty("eventType")))return;const n=o.data;switch(n.eventType){case p.IframeLoaded:L(0,"start",G),(null==B?void 0:B.contentWindow)&&B.contentWindow.postMessage({eventType:s.OpenGdriveFilePicker,accessToken:$,views:A,rootId:O,title:N,hideSwitchAccountButton:!q,multiFileImportEnabled:r,listModeEnabled:t},Y);break;case p.FilePickerResult:const o=n.result.action===e.FilePickerAction.PICKED?n.result.fileIds.length:0;L(o,"success",G),J(n.result);break;case p.SignInWithDifferentAccount:J({action:e.FilePickerAction.CANCELED}),null==q||q();break;case p.UnhandledError:g.warn(`Unhandled error in file picker iframe: ${n.error}`),L(0,"failed",G,{error_type:p.UnhandledError}),await(async()=>{await T(500),J({action:e.FilePickerAction.CANCELED}),await T(50)})();M(I.GDrive,(()=>{H($,q,G,A,O,N,r,t)}));break;case p.UnhandledRejection:g.warn(`Unhandled rejection in file picker iframe: ${n.error}`),L(0,"failed",G,{error_type:p.UnhandledRejection})}},R),H=(e,r,t,i,n,l,a,s)=>((e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"gdrive_file_picker",properties:{actionSurface:null!=e?e:x}})})(t),new Promise((o=>{if(B)throw new Error("File picker already open");$=e,q=r,V=o,A=i,O=n,N=l,G=t,B=document.createElement("iframe"),B.setAttribute("allowTransparency","true"),B.setAttribute("sandbox","allow-scripts allow-same-origin allow-modals"),B.setAttribute("src",Y),B.setAttribute("frameBorder","0"),B.classList.add(m),document.body.appendChild(B),window.addEventListener("message",W(a,s))})));e.Buttons=U,e.FileImportsExclog=g,e.SupportedServices=I,e.getLocalizedLoginServiceName=h,e.getLocalizedServiceName=D,e.getSupportedService=e=>{switch(e[".tag"]){case"gdrive":return I.GDrive;case"onedrive":return I.OneDrive}throw new Error(`Bad import type: ${JSON.stringify(e)}`)},e.logCancelConnectExternalAccount=(e,r,t)=>{o.UDCL.logEvent({class:"file_imports",action:"cancel",object:"connect_external_account",properties:{actionSurface:null!=r?r:x,externalProvider:b(e),timeToCompletionMs:t}})},e.logCancelImportJob=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"cancel",object:"import_job",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logContinueOnedriveConnectionSuccess=e=>{o.UDCL.logEvent({class:"file_imports",action:"continue",object:"onedrive_connection_success",properties:{actionSurface:null!=e?e:x}})},e.logFailConnectExternalAccount=e=>{o.UDCL.logEvent({class:"file_imports",action:"fail",object:"connect_external_account",properties:{actionSurface:x,externalProvider:b(e)}})},e.logFailImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num4xxErrors:n,num5xxErrors:l,numOtherErrors:a,allErrorCounts:s,actionSurface:c})=>{o.UDCL.logEvent({class:"file_imports",action:"fail",object:"import_job",properties:{actionSurface:null!=c?c:x,externalProvider:P(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num_4xxErrors:n,num_5xxErrors:l,numOtherErrors:a,allErrorCounts:s}})},e.logPartialSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num4xxErrors:n,num5xxErrors:l,numOtherErrors:a,allErrorCounts:s,actionSurface:c})=>{o.UDCL.logEvent({class:"file_imports",action:"partial_succeed",object:"import_job",properties:{actionSurface:null!=c?c:x,externalProvider:P(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num_4xxErrors:n,num_5xxErrors:l,numOtherErrors:a,allErrorCounts:s}})},e.logSelectDeleteSource=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"delete_source",properties:{actionSurface:x,externalProvider:P(e)}})},e.logSelectFolderStructure=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"folder_structure",properties:{actionSurface:x,externalProvider:P(e)}})},e.logSelectGdriveFilePicker=L,e.logSelectImportAll=(e,r,t)=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"import_all",properties:{actionElement:r,actionSurface:null!=t?t:x,externalProvider:P(e)}})},e.logSelectOneDriveFilePicker=(e,r,t,i)=>{const n={class:"file_imports",action:"select",object:"onedrive_file_picker",properties:{actionSurface:null!=t?t:x,srcFilesTotal:e,eventState:r}};const l={eventState:"start"!==r?r:void 0,tags:i};r?"start"===r?o.UDCL.logStart(n,l):o.UDCL.logEnd(n,l):o.UDCL.logEvent(n,l)},e.logSelectOverquotaUpgrade=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"overquota_upgrade",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logSelectOverwriteFiles=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"overwrite_files",properties:{actionSurface:x,externalProvider:P(e)}})},e.logSelectTryAgain=F,e.logSelectViewDetails=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"view_details",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownExternalAuthError=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"external_auth_error",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownFailedCancel=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"failed_cancel",properties:{actionSurface:x,externalProvider:P(e)}})},e.logShownFileImportsSnackbar=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"file_imports_snackbar",properties:{actionSurface:null!=e?e:x}})},e.logShownImportAll=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"import_all",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownImportAlreadyRunning=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"import_already_running",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownImportOptions=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"import_options",properties:{actionSurface:x,externalProvider:P(e)}})},e.logShownNetworkError=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"network_error",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownNoFiles=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"no_files",properties:{actionSurface:x,externalProvider:P(e)}})},e.logShownOneDriveFilePicker=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"onedrive_file_picker",properties:{actionSurface:null!=e?e:x}})},e.logShownOnedriveConnectionSuccess=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"onedrive_connection_success",properties:{actionSurface:null!=e?e:x}})},e.logShownOverquotaPrompt=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"overquota_prompt",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownPartialUpload=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"partial_upload",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logShownPopupBlocked=(e,r,t)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"popup_blocked",properties:{actionSurface:null!=t?t:x,browserName:r,externalProvider:P(e)}})},e.logShownUnknownError=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"unknown_error",properties:{actionSurface:null!=r?r:x,externalProvider:P(e)}})},e.logStartConnectExternalAccount=(e,r)=>{o.UDCL.logEvent({class:"file_imports",action:"start",object:"connect_external_account",properties:{actionSurface:null!=r?r:x,externalProvider:b(e)}})},e.logStartImportJob=(e,r,t)=>{o.UDCL.logEvent({class:"file_imports",action:"start",object:"import_job",properties:{srcFilesTotal:e,actionSurface:null!=t?t:x,externalProvider:P(r)}})},e.logSucceedConnectExternalAccount=(e,r,t)=>{o.UDCL.logEvent({class:"file_imports",action:"succeed",object:"connect_external_account",properties:{actionSurface:null!=r?r:x,externalProvider:b(e),timeToCompletionMs:t}})},e.logSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num4xxErrors:n,actionSurface:l})=>{o.UDCL.logEvent({class:"file_imports",action:"succeed",object:"import_job",properties:{actionSurface:null!=l?l:x,externalProvider:P(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num_4xxErrors:n}})},e.openGdriveFilePicker=H,e.showExternalProviderApiErrorModal=M,e.sleep=T}));
//# sourceMappingURL=c_file_imports_gdrive_file_picker.js-vfl0qxYzx.map

//# debugId=364614ae-ea49-3220-b286-cf8a304e405e