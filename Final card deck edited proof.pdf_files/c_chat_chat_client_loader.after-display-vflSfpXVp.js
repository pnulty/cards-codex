!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3403559f-7a66-3bb1-886c-206f0b6ee180")}catch(e){}}();
define(["require","exports","./c_pap-events_replay_shown_modal","./e_ui_page_files_router","./e_core_exception","react","./c_core_i18n","./c_src_sink_index","./c_action_bar_action_bar_constants","./c_lodash-es_lodash","./c_pap-events_pdf_edit_select_replace_original_confirmation","metaserver/static/js/langpack","./c_bem","react-dom","./c_ncct_manual_assist_util","./c_core_notify","./e_edison","./c__rollupPluginBabelHelpers","./e_data_modules_stormcrow","./c_memoize-one","react/jsx-runtime","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_chat_chat_constants"],(function(e,t,n,i,o,a,s,c,r,_,l,h,u,d,C,p,m,g,f,A,w,P,M,k){"use strict";function y(e){return e.ns("megaphone_chat")}const L=new class{constructor(){this.loadClient=(e,t)=>{if(e){const n=t.chatStoneToProtoModule.chatStoneToProto(e);t.chatClientModule.ChatClientSingleton.setupChatEnvironment(n)}},this.getBestChatCampaignAndLoadChatClient=(e,t,n)=>{const i={url:e};if(n){return y(new t.defaultUserClientModule.DefaultUserApiV2Client(n)).rpc("get_best_chat_campaigns",i,{}).then((e=>this.loadClient(e.props,t)))}return y(new t.noAuthClientModule.NoAuthApiV2Client).rpc("get_best_chat_campaigns",i,{}).then((e=>this.loadClient(e.props,t)))},this.getChatCampaignByIdAndLoadClient=(e,t,n,i)=>{const o={url:e,campaign_id:t,locale:window.navigator.language?window.navigator.language:window.navigator.browserLanguage};if(i){return y(new n.defaultUserClientModule.DefaultUserApiV2Client(i)).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,n)))}return y(new n.noAuthClientModule.NoAuthApiV2Client).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,n)))},this.resumeOrGetBestChatCampaignAndLoadClient=(e,t,n,i)=>e?Promise.resolve(this.loadClient(e,t)):this.getBestChatCampaignAndLoadChatClient(n,t,i),this.getResumedChatCampaignAndLoadClient=(e,t,n,i,o)=>{const a={url:e,legacy_persistence_cookie:t||"",chat_persistence_cookie:n||""};if(o){return y(new i.defaultUserClientModule.DefaultUserApiV2Client(o)).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,i,e,o)))}return y(new i.noAuthClientModule.NoAuthApiV2Client).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,i,e,o)))},this.importDependencies=()=>Promise.all([new Promise((function(t,n){e(["./e_ui_page_files_router"],t,n)})).then((function(e){return e.default_user_client_esnext})),new Promise((function(t,n){e(["./e_ui_page_files_router"],t,n)})).then((function(e){return e.noauth_client_esnext})),new Promise((function(t,n){e(["./c_chat_chat_stone_to_proto"],t,n)})),new Promise((function(t,n){e(["./c_chat_chat_client"],t,n)})),new Promise((function(t,n){e(["./c_bem"],t,n)})).then((function(e){return e.cookies_esnext})),new Promise((function(t,n){e(["./c_chat_chat_constants"],t,n)})).then((function(e){return e.chat_constants_esnext}))]),this.getCookies=(e,t)=>{const{Cookies:n}=e,{SNAPENGAGE_CHAT_VISIBLE_COOKIE:i,CHAT_CAMPAIGN_VISIBLE_COOKIE:o}=t;return{legacy_persistence_cookie:n.read(i),chat_persistence_cookie:n.read(o)}},this.getCampaignFromChatServiceWithDependencies=([e,t,n,i,o,a],s,c)=>{const r={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:n,chatClientModule:i,cookiesModule:o,chatConstantsModule:a},_=this.getCookies(o,a);return _.legacy_persistence_cookie||_.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,_.legacy_persistence_cookie,_.chat_persistence_cookie,r,c):this.getBestChatCampaignAndLoadChatClient(s,r,c)},this.getChatCampaignIDFromChatServiceWithDependencies=([e,t,n,i,o,a],s,c,r)=>{const _={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:n,chatClientModule:i,cookiesModule:o,chatConstantsModule:a},l=this.getCookies(o,a);return l.legacy_persistence_cookie||l.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,l.legacy_persistence_cookie,l.chat_persistence_cookie,_,r):this.getChatCampaignByIdAndLoadClient(s,c,_,r)},this.loadChatClientWithBestCampaign=(e,t,n)=>{if(this.loadPromise)return this.loadPromise;const o=n?Promise.resolve():i.waitForTTI({timeoutMS:5e3});return this.loadPromise=o.then((()=>this.importDependencies())).then((n=>this.getCampaignFromChatServiceWithDependencies(n,e,t))),this.loadPromise},this.loadCampaignByID=(e,t,n)=>(this.loadPromise||(this.loadPromise=this.importDependencies().then((i=>this.getChatCampaignIDFromChatServiceWithDependencies(i,e,t,n)))),this.loadPromise)}};t.default=L}));
//# sourceMappingURL=c_chat_chat_client_loader.after-display.js-vfle0iBuY.map

//# debugId=3403559f-7a66-3bb1-886c-206f0b6ee180