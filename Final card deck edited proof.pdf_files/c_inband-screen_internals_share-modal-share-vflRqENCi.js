!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="aef11fd5-079d-3b67-b33e-443169821217")}catch(e){}}();
define(["require","exports","./c_lib_logging","react","./e_ui_page_files_router","./c_core_i18n","./c_dig-components_banner_index","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_src_bindings_provider","./c_src_utils_initials","./c_sharing_settings_utils_link_metadata_types","./e_data_modules_stormcrow","./c_react_query_api_helpers_queries_seen_state_info","./c_domain_restriction_utils_date_formatting","./c_continuous_onboarding_milestone_api","./c_sharing_ui_util","./c_common_logging-contexts_desktop-platform-logging-metadata","./c_src_bindings_api-context","./c_domain_restriction_hooks_use_domain_restriction","./c_sharing_sharing_pap_logging_common_util","./c_sharing_sharing_pap_logging_send_share_invite_util","./e_core_exception","./c_action_bar_action_bar_constants","./c_dig-components_typeahead_index","./c_flux_action_type","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_common_components_buttons"],(function(e,t,a,i,n,o,r,s,l,_,d,c,g,u,m,p,f,h,v,y,E,S,w,b,A,I,T){"use strict";function R(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var i=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var M=R(i);function k(e){return e.requested_visibility===d.RequestedVisibilityPolicy.password||e.require_password}function N(e){return e.audience_options.filter((e=>"password"===e.audience&&e.allowed)).length>0}function C(e){if(e.effective_audience)return e.effective_audience;switch(e.resolved_visibility){case"public":case"password":case"no_one":return e.resolved_visibility;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}const L={day_1:1,day_3:3,day_7:7,day_30:30,day_90:90,day_180:180,year_1:365};function x(e){return["public","password"].includes(e)}function O(e){return!!e.days_to_expire_policy&&"none"!==e.days_to_expire_policy}function D(e){return!!e.enforce_shared_link_password_policy&&"required"===e.enforce_shared_link_password_policy}function $(e){return O(e)&&!!e.change_shared_link_expiration_policy&&"not_allowed"===e.change_shared_link_expiration_policy}function F(e,t){return x(e.audience)&&(!e.expires&&$(t)||!k(t)&&D(t))}const P=(e,t)=>Boolean(!e||t);function H(e,t,a=!1){return e.filter((e=>void 0!==e.email)).map((e=>({email:e.email,checkForInvite:t,isResurface:a})))}function U(e,t,a){return[...H(e,!0),...H(a,!0,!0),...H(t,!1)]}function V(e){return["member_invite_expand_eligibility","member_suggestion_expand_eligibility","member_invite_partial_eligibility"].includes(e)}function B(e,t,a){const i=e.length>0,n=t.length>0,o=(i||n)&&(function(e){return["admin_invite_after_move","admin_invite_expand_eligibility"].includes(e)}(a)||V(a));return Boolean(o)}const j=e=>n.create("email",{email:e}),z=e=>"user"===e[".tag"]?""===e.dbx_account_id?`EMAIL:${e.email}`:`DBX_ID:${e.dbx_account_id}`:"group"===e[".tag"]?`DBX_ID:${e.group_id}`:"email"===e[".tag"]?`EMAIL:${e.email}`:n.exhausts(e,"UNKNOWN"),G=e=>"user"===e[".tag"]&&e.photo_url||null,q=(e,t)=>"user"===e[".tag"]||"email"===e[".tag"]?e.email:"group"===e[".tag"]?t.formatMessage({id:"XMHn5C",defaultMessage:"{count, plural, one{# member} other{# members}}"},{count:e.group_size||0}):"",W=e=>"email"===e[".tag"]?{".tag":"email",email:e.email}:"group"===e[".tag"]?{".tag":"dropbox_id",dropbox_id:e.group_id}:"user"===e[".tag"]?""===e.dbx_account_id?{".tag":"email",email:e.email}:{".tag":"dropbox_id",dropbox_id:e.dbx_account_id}:{".tag":"other"},Y={".tag":"public"},Z={".tag":"team_only"},K={".tag":"password"},Q={".tag":"team_and_password"},X={".tag":"shared_folder_only"},J={".tag":"no_one"},ee={".tag":"only_you"},te={".tag":"other"},ae={".tag":"day_1"},ie={".tag":"day_180"},ne={".tag":"day_3"},oe={".tag":"day_30"},re={".tag":"day_7"},se={".tag":"day_90"},le={".tag":"none"},_e={".tag":"year_1"},de={".tag":"other"},ce={".tag":"allowed"},ge={".tag":"not_allowed"},ue={".tag":"other"},me={".tag":"optional"},pe={".tag":"required"},fe={".tag":"other"},he={".tag":"admin_invite_expand_eligibility"},ve={".tag":"member_suggestion_expand_eligibility"},ye={".tag":"member_invite_expand_eligibility"},Ee={".tag":"member_invite_partial_eligibility"},Se={".tag":"not_enabled"},we={".tag":"anyone"},be={".tag":"team"},Ae={".tag":"team_and_approved"},Ie={".tag":"other"},Te={".tag":"from_team_only"},Re={".tag":"from_anyone"},Me={".tag":"other"},ke={".tag":"default_public"},Ne={".tag":"default_team_only"},Ce={".tag":"team_only"},Le={".tag":"default_no_one"},xe={".tag":"other"},Oe={".tag":"admins_and_members"},De={".tag":"admins_only"},$e={".tag":"members"},Fe={".tag":"anyone"},Pe={".tag":"other"},He={".tag":"optional"},Ue={".tag":"required"},Ve={".tag":"other"},Be={".tag":"day_1"},je={".tag":"day_180"},ze={".tag":"day_3"},Ge={".tag":"day_30"},qe={".tag":"day_7"},We={".tag":"day_90"},Ye={".tag":"none"},Ze={".tag":"year_1"},Ke={".tag":"other"},Qe={".tag":"default"},Xe={".tag":"edit"},Je={".tag":"view"},et=e=>"email"===e[".tag"]?n.Contact.buildFromRawEmail(e.email):"group"===e[".tag"]?new n.Contact({type:n.ContactTypes.NEW_STYLE_GROUP,dbx_team_id:e.dbx_team_id,members:e.members,name:e.name,group_id:e.group_id,group_size:e.group_size}):"user"===e[".tag"]?e.dbx_account_id?new n.Contact({type:n.ContactTypes.EMAIL,dbx_team_id:e.dbx_team_id,...void 0!==e.photo_url?{photo_url:e.photo_url}:{},name:e.name,invalid:!n.validateEmail(e.email),dbx_account_id:e.dbx_account_id,email:e.email}):n.Contact.buildFromRawEmail(e.email):n.exhausts(e,n.Contact.buildFromRawEmail("")),tt=e=>"invalid"===e.state?{".tag":"disallowed",disallowed:{".tag":"other"}}:"ok"===e.state?"NOT_DROPBOX_USER"===e.msg?{".tag":"allowed",allowed:{".tag":"not_dropbox_user"}}:{".tag":"allowed",allowed:{".tag":"no_warning"}}:"warn"===e.state?e.msg===p.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM?{".tag":"allowed",allowed:{".tag":"outside_of_team"}}:{".tag":"allowed",allowed:{".tag":"other"}}:{".tag":"other"},at=e=>"owner"===e?_.OWNER:"reader"===e?_.VIEWER:"writer"===e?_.EDITOR:"reader_no_comment"===e?_.VIEWER_NO_COMMENT:_.OTHER,it=e=>void 0===e?n.OTHER$1:"editor"===e?n.EDITOR:"viewer"===e?n.VIEWER:n.exhausts(e,n.OTHER$1),nt=e=>"public"===e?Y:"team_only"===e?Z:"password"===e?K:void 0,ot=e=>"public"===e?n.PUBLIC:"team"===e?n.TEAM:"password"===e?n.PASSWORD:"no_one"===e?n.NO_ONE:n.OTHER,rt=e=>{var t,a,i,n,o,r,s,l,_,d,c,g,u;const m=[];return void 0===e||(void 0!==(null===(t=e.change_options)||void 0===t?void 0:t.allow)&&m.push({action:{".tag":"change_options"},allow:e.change_options.allow}),void 0!==(null===(a=e.disable_viewer_info)||void 0===a?void 0:a.allow)&&m.push({action:{".tag":"disable_viewer_info"},allow:e.disable_viewer_info.allow}),void 0!==(null===(i=e.edit_contents)||void 0===i?void 0:i.allow)&&m.push({action:{".tag":"edit_contents"},allow:e.edit_contents.allow}),void 0!==(null===(n=e.enable_viewer_info)||void 0===n?void 0:n.allow)&&m.push({action:{".tag":"enable_viewer_info"},allow:e.enable_viewer_info.allow}),void 0!==(null===(o=e.invite_editor)||void 0===o?void 0:o.allow)&&m.push({action:{".tag":"invite_editor"},allow:e.invite_editor.allow}),void 0!==(null===(r=e.invite_viewer)||void 0===r?void 0:r.allow)&&m.push({action:{".tag":"invite_viewer"},allow:e.invite_viewer.allow}),void 0!==(null===(s=e.invite_viewer_no_comment)||void 0===s?void 0:s.allow)&&m.push({action:{".tag":"invite_viewer_no_comment"},allow:e.invite_viewer_no_comment.allow}),void 0!==(null===(l=e.leave_a_copy)||void 0===l?void 0:l.allow)&&m.push({action:{".tag":"leave_a_copy"},allow:e.leave_a_copy.allow}),void 0!==(null===(_=e.relinquish_membership)||void 0===_?void 0:_.allow)&&m.push({action:{".tag":"relinquish_membership"},allow:e.relinquish_membership.allow}),void 0!==(null===(d=e.update_confidentiality)||void 0===d?void 0:d.allow)&&m.push({action:{".tag":"update_confidentiality"},allow:e.update_confidentiality.allow}),void 0!==(null===(c=e.unmount)||void 0===c?void 0:c.allow)&&m.push({action:{".tag":"unmount"},allow:e.unmount.allow}),void 0!==(null===(g=e.unshare)||void 0===g?void 0:g.allow)&&m.push({action:{".tag":"unshare"},allow:e.unshare.allow}),void 0!==(null===(u=e.create_link)||void 0===u?void 0:u.allow)&&m.push({action:{".tag":"create_link"},allow:e.create_link.allow})),m},st=e=>{var t,a,i,n,o,r,s,l,_,d,c,g,u,m,p;const f=[];return void 0===e||(void 0!==(null===(t=e.create_edit_link)||void 0===t?void 0:t.allow)&&f.push({action:{".tag":"create_edit_link"},allow:e.create_edit_link.allow}),void 0!==(null===(a=e.create_view_link)||void 0===a?void 0:a.allow)&&f.push({action:{".tag":"create_view_link"},allow:e.create_view_link.allow}),void 0!==(null===(i=e.change_options)||void 0===i?void 0:i.allow)&&f.push({action:{".tag":"change_options"},allow:e.change_options.allow}),void 0!==(null===(n=e.disable_viewer_info)||void 0===n?void 0:n.allow)&&f.push({action:{".tag":"disable_viewer_info"},allow:e.disable_viewer_info.allow}),void 0!==(null===(o=e.edit_contents)||void 0===o?void 0:o.allow)&&f.push({action:{".tag":"edit_contents"},allow:e.edit_contents.allow}),void 0!==(null===(r=e.enable_viewer_info)||void 0===r?void 0:r.allow)&&f.push({action:{".tag":"enable_viewer_info"},allow:e.enable_viewer_info.allow}),void 0!==(null===(s=e.invite_viewer)||void 0===s?void 0:s.allow)&&f.push({action:{".tag":"invite_viewer"},allow:e.invite_viewer.allow}),void 0!==(null===(l=e.invite_editor)||void 0===l?void 0:l.allow)&&f.push({action:{".tag":"invite_editor"},allow:e.invite_editor.allow}),void 0!==(null===(_=e.invite_viewer_no_comment)||void 0===_?void 0:_.allow)&&f.push({action:{".tag":"invite_viewer_no_comment"},allow:e.invite_viewer_no_comment.allow}),void 0!==(null===(d=e.relinquish_membership)||void 0===d?void 0:d.allow)&&f.push({action:{".tag":"relinquish_membership"},allow:e.relinquish_membership.allow}),void 0!==(null===(c=e.remove_download_policy)||void 0===c?void 0:c.allow)&&f.push({action:{".tag":"remove_download_policy"},allow:e.remove_download_policy.allow}),void 0!==(null===(g=e.set_download_policy)||void 0===g?void 0:g.allow)&&f.push({action:{".tag":"set_download_policy"},allow:e.set_download_policy.allow}),void 0!==(null===(u=e.unshare)||void 0===u?void 0:u.allow)&&f.push({action:{".tag":"unshare"},allow:e.unshare.allow}),void 0!==(null===(m=e.create_link)||void 0===m?void 0:m.allow)&&f.push({action:{".tag":"create_link"},allow:e.create_link.allow}),void 0!==(null===(p=e.share_message_as_comment)||void 0===p?void 0:p.allow)&&f.push({action:{".tag":"share_message_as_comment"},allow:e.share_message_as_comment.allow})),f},lt=(e,t,a)=>{var i,n,o,r,s,l,_,d;if(void 0===e)throw new Error("Adapter error.");if(e.isFolder()){if(e.isNewSharedFolder()){const i=e;return{".tag":"file_folder",access_type:at(e.access_type),is_inside_team_folder:t,is_team_folder:a,owner_team:i.owner_team,parent_shared_folder_id:i.parent_shared_folder_id?String(i.parent_shared_folder_id):void 0,path_lower:i.path_lower,parent_folder_name:i.parent_folder_name,...void 0!==i.is_confidential?{is_confidential:i.is_confidential}:{},name:e.name,policy:{member_policy:i.policy.member_policy?{".tag":i.policy.member_policy}:void 0,resolved_member_policy:i.policy.resolved_member_policy?{".tag":i.policy.resolved_member_policy}:void 0,acl_update_policy:i.policy.acl_update_policy?{".tag":i.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:i.policy.shared_link_policy?{".tag":i.policy.shared_link_policy}:{".tag":"other"},viewer_info_policy:i.policy.viewer_info_policy?{".tag":i.policy.viewer_info_policy}:void 0},permissions:rt(e.permissions),members_cursor:e.members_cursor,owner_team_policies:_t(i.owner_team_policies),folder_id:i.folder_id}}{const n=e;return{".tag":"shared_folder",access_type:at(e.access_type),is_inside_team_folder:t,is_team_folder:a,owner_team:n.owner_team,parent_shared_folder_id:n.parent_shared_folder_id?String(n.parent_shared_folder_id):void 0,path_lower:n.path_lower,parent_folder_name:n.parent_folder_name,...void 0!==n.is_confidential?{is_confidential:n.is_confidential}:{},name:e.name,permissions:rt(e.permissions),policy:{member_policy:n.policy.member_policy?{".tag":n.policy.member_policy}:void 0,resolved_member_policy:n.policy.resolved_member_policy?{".tag":n.policy.resolved_member_policy}:void 0,acl_update_policy:n.policy.acl_update_policy?{".tag":n.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:n.policy.shared_link_policy?{".tag":n.policy.shared_link_policy}:{".tag":"other"},download_policy:n.policy.download_policy?{".tag":n.policy.download_policy}:{".tag":"other"},viewer_info_policy:n.policy.viewer_info_policy?{".tag":n.policy.viewer_info_policy}:void 0},preview_url:n.preview_url||"",shared_folder_id:n.shared_folder_id.toString(),time_invited:(null===(i=n.time_invited)||void 0===i?void 0:i.toString())||"",folder_size:n.folder_size,can_mount:n.can_mount,invite_info:n.invite_info,owner_team_policies:_t(n.owner_team_policies),is_encrypted:n.is_encrypted,folder_id:n.folder_id}}}{const t=e;return{".tag":"file",access_type:at(t.access_type),download_policy:{".tag":"other"},id:t.id,name:t.name,owner_team:t.owner_team,parent_shared_folder_id:t.parent_shared_folder_id?String(t.parent_shared_folder_id):void 0,path_display:t.path_display,path_lower:t.path_lower,permissions:st(t.permissions),policy:{member_policy:(null===(n=t.policy)||void 0===n?void 0:n.member_policy)?{".tag":t.policy.member_policy}:void 0,resolved_member_policy:(null===(o=t.policy)||void 0===o?void 0:o.resolved_member_policy)?{".tag":t.policy.resolved_member_policy}:void 0,acl_update_policy:(null===(r=t.policy)||void 0===r?void 0:r.acl_update_policy)?{".tag":t.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:(null===(s=t.policy)||void 0===s?void 0:s.shared_link_policy)?{".tag":t.policy.shared_link_policy}:{".tag":"other"},download_policy:(null===(l=t.policy)||void 0===l?void 0:l.download_policy)?{".tag":t.policy.download_policy}:{".tag":"other"},viewer_info_policy:(null===(_=t.policy)||void 0===_?void 0:_.viewer_info_policy)?{".tag":t.policy.viewer_info_policy}:void 0},preview_url:t.preview_url||"",time_invited:null===(d=t.time_invited)||void 0===d?void 0:d.toString(),is_cloud_doc:t.is_cloud_doc,owner_team_policies:_t(t.owner_team_policies)}}},_t=e=>{if(e)return{shared_folder_member_policy:dt(e.shared_folder_member_policy),shared_folder_join_policy:ct(e.shared_folder_join_policy),shared_link_create_policy:gt(e.shared_link_create_policy),group_creation_policy:ut(e.group_creation_policy),shared_folder_link_restriction_policy:mt(e.shared_folder_link_restriction_policy),enforce_link_password_policy:pt(e.enforce_link_password_policy),default_link_expiration_days_policy:ft(e.default_link_expiration_days_policy),shared_link_default_permissions_policy:ht(e.shared_link_default_permissions_policy)}},dt=e=>{switch(e){case"team":return be;case"team_and_approved":return Ae;case"other":return Ie;default:return we}},ct=e=>{switch(e){case"from_team_only":return Te;case"other":return Me;default:return Re}},gt=e=>{switch(e){case"default_team_only":return Ne;case"team_only":return Ce;case"default_no_one":return Le;case"other":return xe;default:return ke}},ut=e=>"admins_only"===e?De:Oe,mt=e=>{switch(e){case"members":return $e;case"other":return Pe;default:return Fe}},pt=e=>{switch(e){case"required":return Ue;case"other":return Ve;default:return He}},ft=e=>{switch(e){case"day_1":return Be;case"day_180":return je;case"day_3":return ze;case"day_30":return Ge;case"day_7":return qe;case"day_90":return We;case"year_1":return Ze;case"other":return Ke;default:return Ye}},ht=e=>{switch(e){case"default":default:return Qe;case"edit":return Xe;case"view":return Je}},vt=e=>{switch(e){case n.LinkAudienceDisallowedReason.DeleteAndRecreate:return n.DISALLOWED_REASON_DELETE_AND_RECREATE;case n.LinkAudienceDisallowedReason.RestrictedBySharedFolder:return n.DISALLOWED_REASON_RESTRICTED_BY_SHARED_FOLDER;case n.LinkAudienceDisallowedReason.RestrictedByTeam:return n.DISALLOWED_REASON_RESTRICTED_BY_TEAM;case n.LinkAudienceDisallowedReason.UserAccountType:return n.DISALLOWED_REASON_USER_ACCOUNT_TYPE;case n.LinkAudienceDisallowedReason.UserNotOnTeam:return n.DISALLOWED_REASON_USER_NOT_ON_TEAM;case n.LinkAudienceDisallowedReason.PermissionDenied:return n.DISALLOWED_REASON_PERMISSION_DENIED;default:return}},yt=e=>{if(void 0!==e)return e.map((e=>({audience:ot(e.audience),allowed:e.allowed,disallowed_reason:vt(e.disallowed_reason)})))},Et=e=>{switch(e){case"day_1":return ae;case"day_180":return ie;case"day_3":return ne;case"day_30":return oe;case"day_7":return re;case"day_90":return se;case"none":return le;case"year_1":return _e;case"other":return de;default:return}},St=e=>{switch(e){case"allow":return ce;case"not_allowed":return ge;case"other":return ue;default:return}},wt=e=>{switch(e){case"optional":return me;case"required":return pe;case"other":return fe;default:return}},bt=e=>({id:e.id,name:e.name}),At=e=>{switch(e){case"admin_invite_expand_eligibility":return he;case"member_suggestion_expand_eligibility":return ve;case"member_invite_expand_eligibility":return ye;case"member_invite_partial_eligibility":return Ee;default:return Se}},It=a.defineContext(""),Tt={".tag":"viewer"},Rt={".tag":"editor"};function Mt(e){return{class:"sharing_sender",action:"select",object:"flexible_sharing_entrypoint_action",properties:e}}const kt=({teamName:e,parentFolderName:t,isRestoreAccessEnabled:a,onRestoreAccessClick:i,onBannerClose:s})=>{const l=o.useIntl(),d=M.useCallback((()=>{i(e)}),[e,i]),c=""!==t?l.formatMessage({id:"KG/fFv",defaultMessage:"This folder isn’t shared with everyone who has access to parent folder <b>{parent}</b>."},{parent:t,b:e=>M.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}):l.formatMessage({id:"kIOCH3",defaultMessage:"This folder isn’t shared with everyone on {team_name}."},{team_name:_.Emstring.em_snippet(e,n.SNIPPET_SIZES.DISPLAY_NAME)}),g=l.formatMessage({id:"96XDs/",defaultMessage:"Share with everyone"});return M.createElement(r.Banner,{withLeftIcon:M.createElement(n.UIIcon,{src:n.InfoLine}),withCloseButton:s?l.formatMessage({id:"R/Hjn0",defaultMessage:"Close"}):void 0,onRequestClose:s},M.createElement(r.Banner.Message,null,M.createElement(n.Text,null,c,a&&" ",a&&M.createElement(n.Button,{"aria-label":g,key:"restore access",variant:"transparent",size:"medium",onClick:d,style:{fontFamily:"var(--type__body__standard--fontfamily)",fontWeight:"var(--type__body__standard--fontweight_strong)",fontSize:"var(--type__body__standard--fontsize)",letterSpacing:0}},g))))};kt.displayName="ConfidentialFolderSection";const Nt=e=>e.formatMessage({id:"RYuEPZ",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),Ct=e=>e.formatMessage({id:"c7+ulZ",defaultMessage:"This email isn’t on your Dropbox team."}),Lt=e=>e.formatMessage({id:"Vp93jb",defaultMessage:"One or more of these emails is no longer active."}),xt=e=>e.formatMessage({id:"Eowy6P",defaultMessage:"Automatic groups can only be added to team folders."}),Ot=e=>e.formatMessage({id:"LKdcDm",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),Dt=e=>e.formatMessage({id:"mvBmmQ",defaultMessage:"This email isn’t on your Dropbox team."}),$t=e=>e.formatMessage({id:"0IC8VF",defaultMessage:"You don’t have permission to share with some of these people."}),Ft=e=>e.formatMessage({id:"8tC+2X",defaultMessage:"Only groups can be added to team folders."}),Pt=e=>e.formatMessage({id:"UrkgWp",defaultMessage:"You don’t have permission to share with some of these people due to restrictions on their end."}),Ht=e=>e.formatMessage({id:"S+fqGv",defaultMessage:"One or more of the emails you entered are invalid."}),Ut=e=>e.formatMessage({id:"KxgNgG",defaultMessage:"Add message (optional)"}),Vt=e=>e.formatMessage({id:"gO5KOr",defaultMessage:"Loading Dash summary..."}),Bt=e=>e.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),jt=e=>e.formatMessage({id:"Qd1iC2",defaultMessage:"Sharing..."}),zt=(e,t)=>t?jt(e):(e=>e.formatMessage({id:"lHCrsZ",defaultMessage:"Share"}))(e),Gt=(e,t)=>"editor"===t[".tag"]?(e=>e.formatMessage({id:"J3CMt1",defaultMessage:"can edit"}))(e):(e=>e.formatMessage({id:"xOIBKS",defaultMessage:"can view"}))(e),qt=(e,t)=>e.formatMessage({id:"lvjqTm",defaultMessage:"Shared <st>{name}</st>."},{st:e=>M.createElement("strong",{key:n.getName(t)},e),name:_.Emstring.em_snippet(n.getName(t),n.SNIPPET_SIZES.FILENAME)}),Wt=e=>e.formatMessage({id:"nf2M+i",defaultMessage:"There was a problem completing this request."}),Yt=e=>e.formatMessage({id:"PbG9/M",defaultMessage:"You don’t have access to this content."}),Zt=e=>e.formatMessage({id:"ktVMZy",defaultMessage:"Your team settings don’t allow sharing outside your team."}),Kt=e=>e.formatMessage({id:"ccjg/d",defaultMessage:"You entered an invalid name or email address."}),Qt=e=>e.formatMessage({id:"KWUYO4",defaultMessage:"You’ve hit the limit of invites for today. Try again later."}),Xt=e=>e.formatMessage({id:"CTRWVL",defaultMessage:"You don’t have permission to do this. Contact the owner."}),Jt=e=>e.formatMessage({id:"xoQiJt",defaultMessage:"You haven’t verified your email. Check your email and try again."}),ea=e=>e.formatMessage({id:"kJSilf",defaultMessage:"Couldn’t share, but it might work if you reload the page and try again."}),ta=e=>e.formatMessage({id:"A35Dw0",defaultMessage:"You need to upgrade your account to do this."}),aa=e=>e.formatMessage({id:"ebZyPl",defaultMessage:"You’re sharing with too many people."}),ia=e=>e.formatMessage({id:"Bcojaq",defaultMessage:"Contact support"}),na=(e,t)=>e.formatMessage({id:"0UrAT5",defaultMessage:"Couldn’t create shared folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t}),oa=e=>e.formatMessage({id:"/sRvdA",defaultMessage:"Folder updates in progress — please try again later."}),ra=(e,t,a)=>{const i=n.getName(a),o=n.getParentFolderName(a);return t?e.formatMessage({id:"5xCeTo",defaultMessage:"Removing members from <strong>{folderName}</strong>…"},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)}):""===o?e.formatMessage({id:"90I244",defaultMessage:"Sharing <strong>{folderName}</strong> with everyone…"},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)}):e.formatMessage({id:"16RnmU",defaultMessage:"Sharing <strong>{folderName}</strong> with members of <strong>{parentFolderName}</strong>…"},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:_.Emstring.em_snippet(o,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)})},sa=(e,t)=>t?e.formatMessage({id:"1HgFQB",defaultMessage:"Couldn’t remove members. Try again."}):e.formatMessage({id:"ypun4U",defaultMessage:"Couldn’t share folder. Try sharing again."}),la=e=>e.formatMessage({id:"b0sjjf",defaultMessage:"Learn more"}),_a=()=>{const e=da();return M.useMemo((()=>(null==e?void 0:e.isLoading)?{isLoading:!0}:(null==e?void 0:e.error)?{isLoading:!1,isError:!0,error:e.error.appError}:{output:e.data.apiData,isLoading:!1,isError:!1}),[e])},da=()=>n.sharingPrefsPackage.useQuery({},{staleTime:36e5});const ca=/^['#&A-Za-z0-9._%+-]+@[A-Za-z0-9-][A-Za-z0-9.-]*\.[A-Za-z]{2,15}$/,ga={$props:l.atom({oid:{".tag":"file",fileId:""},objectMetadataResult:{isLoading:!0},accountMetadataResult:{isLoading:!0},sharingPrefsResult:{isLoading:!0},inviteMessage:"",inviteTargets:[],hasUpdatedAccountMetadata:!1,onCloseClick:()=>{},onTargetsDropdownFocusChange:()=>{},onInviteMessageChange:()=>{},onInviteTargetsChange:()=>{},onShareStart:()=>{},onInbandShareSuccess:()=>{},onShareFailure:()=>{},onStartInband:()=>{},onRefreshObjectMetadata:()=>{},onRefreshModal:()=>{},onObjectIdentifierChanged:()=>Promise.resolve(),shouldStyleForSM21:!1,shouldTransitionAccessoryAreaEnter:!1,isConfidentialFolderBannerClosed:!1}),$inviteTargets:l.atom([]),$inviteMessage:l.atom(""),$inviteTargetValidations:l.atom({}),$isDataBeingUpdated:l.atom(!1),$isInviteSending:l.atom(!1),$shouldPostMessageAsComment:l.atom(!1),$isInviteMessageTooLong:l.atom(!1),$changeConfidentialityData:l.atom(null),$isSuggestionsOpen:l.atom(!1),$isProgressiveButtonHovered:l.atom(!1),$progressiveButtonHoverStartTime:l.atom(0),$componentViewTime:l.atom(0),$inviteTargetsWithValidEmails:l.atom([]),$inviteTargetsWithInvalidEmails:l.atom([]),$objectIdentifierId:l.atom(""),$sharingAccessLevel:l.atom(Tt),$canInviteViewer:l.atom(!1),$canInviteEditor:l.atom(!1),$isFolder:l.atom(!1),$isConfidentialFolder:l.atom(!1),$isNewFolder:l.atom(!1)},{StoreProvider:ua,useStore:ma}=l.defineStoreProvider((e=>{const t=l.proxy((()=>e.get().inviteMessage),(t=>e.get().onInviteMessageChange(t))),a=l.proxy((()=>e.get().inviteTargets),(t=>e.get().onInviteTargetsChange(t))),i=l.proxy((()=>a.get().filter((e=>"group"===e[".tag"]||ca.test(e.email))))),o=l.proxy((()=>a.get().filter((e=>"group"!==e[".tag"]&&!ca.test(e.email))))),r=l.atom({}),s=l.atom(!1),_=l.atom(!1),c=l.atom(!1),g=l.atom(!1),u=l.atom(null),m=l.atom(!1),p=l.atom(!1),f=l.atom(0),h=l.atom(0),v=l.atom(d.getContentIdOrPathFromObjectIdentifier(e.get().oid)),y=l.proxy((()=>{const t=e.get().sharingPrefsResult;return t.isLoading||t.isError?null:t.output})),E=l.proxy((()=>{const t=e.get().objectMetadataResult;return t.isLoading||t.isError?null:t.output})),S=l.proxy((()=>{const e=y.get(),t=E.get();return!(!e||!t)&&n.getCanInvite(t,Rt)})),w=l.proxy((()=>{const e=y.get(),t=E.get();return!(!e||!t)&&n.getCanInvite(t,Tt)})),b=l.proxy((()=>{const e=y.get();return e&&S.get()?(e=>{const t=e.default_sharing_access_level_setting;if(!t)return n.EDITOR;switch(t[".tag"]){case n.SharingAccessLevel.VIEW:return n.VIEWER;case n.SharingAccessLevel.UNKNOWN:case n.SharingAccessLevel.EDIT:default:return n.EDITOR}})(e):Tt})),A=l.atom(b.get()),I=l.proxy((()=>{const e=E.get();return!!e&&n.getIsFolder(e)})),T=l.proxy((()=>{const e=E.get();return!!e&&n.getIsConfidentialFolder(e)})),R=l.proxy((()=>{var t;return null!==(t=e.get().isNewFolder)&&void 0!==t&&t}));return{$props:e,$inviteMessage:t,$inviteTargets:a,$inviteTargetsWithInvalidEmails:o,$inviteTargetsWithValidEmails:i,$inviteTargetValidations:r,$isDataBeingUpdated:s,$isInviteSending:_,$shouldPostMessageAsComment:c,$isInviteMessageTooLong:g,$changeConfidentialityData:u,$isSuggestionsOpen:m,$isProgressiveButtonHovered:p,$progressiveButtonHoverStartTime:f,$componentViewTime:h,$objectIdentifierId:v,$sharingAccessLevel:A,$canInviteViewer:w,$canInviteEditor:S,$isFolder:I,$isConfidentialFolder:T,$isNewFolder:R}}),ga),pa=e=>{const t=_.useSharingObjectMetadata(e.oid.fileId),a=_.useSharingAccountInfo(),i=_a();return M.createElement(ua,{objectMetadataResult:t,accountMetadataResult:a,sharingPrefsResult:i,...e})};pa.displayName="Provider";const fa="share-modal-evolution-access-level-dropdown",ha=`${fa}__audience-text`,va=`${fa}__portaled-menu`,ya=()=>{const e=o.useIntl(),t=ma(),a=l.useAtom(t.$sharingAccessLevel),i=l.useAtom(t.$isInviteSending),r=l.useAtom(t.$canInviteEditor),s=l.useAtom(t.$canInviteViewer),_=(r?1:0)+(s?1:0),d=(()=>{const e=l.useLogger(),t=ma(),a=l.useAtom(t.$sharingAccessLevel);return M.useCallback((i=>{e("SHARE_MODAL_SHARE__LINK_ACCESS_LEVEL__CHANGE",{previous:a,next:{".tag":i}}),t.$sharingAccessLevel.set({".tag":i})}),[t,e,a])})();return M.createElement(n.Box,{className:n.cx([`${fa}`,_>1?`${fa}__with-menu`:void 0]),borderRadius:"Small",style:{minWidth:"auto",display:"flex",whiteSpace:"pre-wrap",flexWrap:"wrap",alignItems:"center"},"data-testid":"access-level-dropdown"},M.createElement(n.Text,{className:ha,"data-testid":"invite-audience",color:i?"disabled":"standard",size:"small"},(e=>e.formatMessage({id:"OGm4kF",defaultMessage:"People added"}))(e)," "),1===_?M.createElement(n.Text,{className:ha,isBold:!0,size:"small",color:i?"disabled":"standard"},Gt(e,a)):M.createElement(n.Menu.Wrapper,{onSelection:d,style:{verticalAlign:"bottom",whiteSpace:"nowrap"},className:va},(({getContentProps:t,getTriggerProps:o})=>M.createElement(M.Fragment,null,M.createElement(n.Button,{...o(),variant:"transparent",withDropdownIcon:!0,size:"small",style:{marginTop:"1px",position:"relative"},disabled:i},Gt(e,a)),M.createElement(n.Menu.Content,{"data-sharing-sdk":"1",...t(),placement:"bottom-end"},M.createElement(n.Menu.Segment,null,s?M.createElement(n.Menu.SelectItem,{key:"view",value:"viewer",selected:"editor"!==a[".tag"]},M.createElement(n.Text,null,Gt(e,Tt))):null,r?M.createElement(n.Menu.SelectItem,{key:"edit",value:"editor",selected:"editor"===a[".tag"]},M.createElement(n.Text,null,Gt(e,Rt))):null))))))};ya.displayName="AccessLevelDropdown";const Ea=e=>e.reduce(((e,t)=>({[_.getUniqueId(t.member)]:t,...e})),{}),Sa=l.define({name:"sharing.validateTargets"},(e=>t=>l.handler(e.sharingTargetsValidate(t)))),wa=e=>{const t=ma(),a=(e=>{const t=l.useEndpoint(Sa),a=l.useLogger(),i=ma();return M.useCallback((async()=>{const o=i.$inviteTargets.get();if(0===o.length)return void i.$inviteTargetValidations.set({});const r=i.$inviteTargetsWithInvalidEmails.get().reduce(((e,t)=>({...e,[z(t)]:{member:W(t),result:{".tag":"disallowed",disallowed:{".tag":"invalid_target"}},target_invite_eligibility:{".tag":"other"}}})),{});if(i.$inviteTargetValidations.set({...i.$inviteTargetValidations.get(),...r}),0===i.$inviteTargetsWithValidEmails.get().length)return;const s=Object.values(i.$inviteTargetValidations.get()).map((e=>e?_.getUniqueId(e.member):null)),l=i.$inviteTargetsWithValidEmails.get().filter((e=>{const t=_.getUniqueId(W(e));return!s.includes(t)}));if(0===l.length)return;const c=n.getIsFile(e)?"file":"folder",g=i.$objectIdentifierId.get();a("SHARE_MODAL_SHARE__PREVALIDATION__API_START",null);const u=await t({access_level:i.$sharingAccessLevel.get(),content_id:g,content_type:{".tag":c},members:l.map(W)});if("ERROR"===u.status)return void a("SHARE_MODAL_SHARE__PREVALIDATION__API_ERROR",{error:u.error});if("FATAL"===u.status)return void a("SHARE_MODAL_SHARE__PREVALIDATION__API_FATAL",{error:u.error});a("SHARE_MODAL_SHARE__PREVALIDATION__API_SUCCESS",null);const m=i.$inviteTargets.get(),p=i.$sharingAccessLevel.get(),f=e,h=d.getContentIdOrPathFromObjectIdentifier(i.$props.get().oid);o===m&&i.$sharingAccessLevel.get()===p&&g===h&&e===f&&i.$inviteTargetValidations.set({...i.$inviteTargetValidations.get(),...Ea(u.output.results)})}),[i,t,a,e])})(e);M.useEffect((()=>{const e=[t.$inviteTargets.obs(a),t.$sharingAccessLevel.obs((()=>{a()})),t.$objectIdentifierId.obs((()=>{t.$inviteTargetValidations.set({}),a()}))];return t.$props.get().inviteTargets.length>0&&a(),()=>e.forEach((e=>e()))}),[])},ba=l.define({name:"sharing.addFileMember"},(e=>t=>l.handler(e.sharingAddFileMember(t)))),Aa=l.define({name:"sharing.addFolderMember"},(e=>t=>l.handler(e.sharingAddFolderMemberV3(t))));function Ia(e){return{class:"sharing_sender",action:"initiate",object:"post_share_action",properties:e}}const Ta=Symbol("ON_SHOW_ADMIN_INVITE_AFTER_SHARING_MODAL"),Ra=Symbol("ON_SHOW_MEMBER_INVITE_AFTER_SHARING_MODAL"),{useEmitter:Ma,defaultEmitter:ka}=a.defineLogger((async({event:e,getContextValue:t})=>{const a=t(f.Context),i=t(f.Context$1),o=t(f.Context$2),r=t(f.Context$3),s={...f.getTags(a),...f.getTags$1(i),...f.getTags$2(o),...f.getTags$3(r),isSm24:"true"};e.key!==Ta?e.key!==Ra||n.UDCL.logEvent(Ia({postShareAction:"member_invite_after_sharing_modal",numInviteEligibleUsers:e.payload.numInviteEligibleUsers}),{tags:s}):n.UDCL.logEvent(Ia({postShareAction:"admin_invite_after_sharing_modal",numInviteEligibleUsers:e.payload.numInviteEligibleUsers}),{tags:s})})),Na=()=>{var t,i,o;const r=a.useGetContextValue(),{isNonUserRelativeContext:s}=h.useSharingApiContext(),_=Ma(),{variant:d}=n.useExperimentVariant("member_expansion_2025_10_16_gating_teams_value_m1"),c=l.usePlatform(),g="ON"===d||"FORCE_ON"===d,y=v.useDomainRestriction(g),E=null!==(i=null===(t=y.data)||void 0===t?void 0:t.restrictionState)&&void 0!==i?i:n.DomainRestrictionState.NOT_RESTRICTED,S=(null===(o=y.data)||void 0===o?void 0:o.scheduledCaptureUtcMs)?Number(y.data.scheduledCaptureUtcMs):void 0;return M.useCallback((async t=>{var a,i,o;if(t.sharingPrefs.should_reduce_upsells_churn_analysis)return;s||xa(t.objectIdentifier,t.objectMetadata),t.user&&m.markMilestoneAsCompleted(t.user,u.ActivationTileMilestoneId.SHARE_CONTENT);const g=n.isNewApiMetadata(t.objectMetadata)?t.objectMetadata.common_metadata.path_display:t.objectMetadata.path_display,h=n.getIsFolder(t.objectMetadata),v={file_name:n.getName(t.objectMetadata),file_extension:n.getExtension$2(t.objectMetadata),file_path:g};h?n.publishEvent(n.CampaignEvents.FOLDER_IN_BAND_SHARE_SUCCESS,{context:{...v,is_team_folder:n.getIsInsideTeamFolderTree(t.objectMetadata)?"true":"false"}}):n.publishEvent(n.CampaignEvents.FILE_IN_BAND_SHARE_SUCCESS,{context:v});const y=null===(a=r(f.Context))||void 0===a?void 0:a.tiburonOrigin,w=null===(i=r(f.Context))||void 0===i?void 0:i.actionSurface;!w||"browse_screen"!==w&&"quick-view-browse"!==w&&"file_choose"!==w||p.trackUserLeapEvent(p.SharingUserLeapEvent.SM24_IB_SHARE_COMPLETE,y);const b=c===l.Platforms.METASERVER;let A=!1;b&&("FORCE_ON"===d?A=!0:"ON"===d&&(A=E===n.DomainRestrictionState.WARNING||E===n.DomainRestrictionState.CAPTURED));const I=()=>{A&&async function(){const{asyncShowAccountResolutionModal:t}=await new Promise((function(t,a){e(["./c_teams_domain_restriction_account_resolution_modal_async"],t,a)}));return t}().then((e=>{e({onClose:()=>{},scheduledCaptureUtcMs:S,restrictionState:E})}))},{inviteEligibleNotSeenContacts:T,inviteEligibleSeenContacts:R,inviteEligibleSeenResurfaceContacts:M}=La(t.inviteTargets,t.targetsValidateResult),k=U(T,R,M),N=null===(o=t.sharingPrefs.invite_after_sharing_modal_variant)||void 0===o?void 0:o[".tag"];let C=!1;if(N&&B(T,M,N)){C=!0;const a=A?I:void 0;if("admin_invite_expand_eligibility"===N)if(1===k.length){const e=Date.now();Ca().then((t=>{_.select(Ta).emit({numInviteEligibleUsers:k.length}),t({eligibleUsers:k,adminModalVariant:N,modalOrigin:y,modalLoadingStartTime:e,...a&&{onModalClose:a}})}))}else{const e=Date.now();Ca().then((t=>{_.select(Ta).emit({numInviteEligibleUsers:k.length}),t({eligibleUsers:k,adminModalVariant:N,modalOrigin:y,modalLoadingStartTime:e,...a&&{onModalClose:a}})}))}else if(V(N)){const i=Date.now(),n=t.sharingPrefs.num_available_licenses;(async function(){const{showMemberInviteAfterSharingModal:t}=await new Promise((function(t,a){e(["./c_modals_invite_after_sharing_member_invite_after_sharing_modal"],t,a)}));return t})().then((e=>{_.select(Ra).emit({numInviteEligibleUsers:k.length}),e({eligibleUsers:k,memberModalVariant:N,sharingOrigin:y,modalLoadingStartTime:i,numAvailableLicenses:n,...a&&{onModalClose:a}})}))}}C||I()}),[r,_,d,c,s,E,S])};async function Ca(){const{showAdminInviteAfterSharingModal:t}=await new Promise((function(t,a){e(["./c_modals_invite_after_sharing_admin_invite_after_sharing_modal"],t,a)}));return t}const La=(e,t)=>{const a=Object.fromEntries(e.map((e=>[z(e),e]))),i=[],n=[],o=[];for(const e of t.results){const t=_.getUniqueId(e.member);a.hasOwnProperty(t)&&("eligible_not_seen"===e.target_invite_eligibility[".tag"]?i.push(a[t]):"eligible_seen"===e.target_invite_eligibility[".tag"]?n.push(a[t]):"eligible_seen_resurface"===e.target_invite_eligibility[".tag"]&&o.push(a[t]))}return{inviteEligibleNotSeenContacts:i.map((e=>et(e))),inviteEligibleSeenContacts:n.map((e=>et(e))),inviteEligibleSeenResurfaceContacts:o.map((e=>et(e)))}},xa=(e,t)=>{if(n.getIsFile(t)){const t=[d.getContentIdOrPathFromObjectIdentifier(e)];n.getStoreForSharedWith().dispatch(n.sharedFileDataOutOfDate(t))}else n.getStoreForSharedWith().dispatch(n.sharedFolderDataOutOfDate())},Oa=["access_denied","path","not_found","email_not_verified","settings_error","not_authorized","undefined_error","banned_member","failed_copy_to_clipboard","invalid_logged_out_cookie","internal_error","other","contacts_error","rate_limit","bad_member","access_error","cant_share_outside_team","no_permission","too_many_invitees","invalid_csrf_token","invalid","user_not_logged_in","too_many_files","total_mounts_exceeded","home_mounts_exceeded","tree_size_exceeded","invalid_shared_folder","invalid_comment","team_policy_disallows_member_policy","disallowed_shared_link_policy","insufficient_plan","invalid_email","network","team_folder","too_many_members","too_many_pending_invites","already_shared"];function Da(e){return Oa.find((t=>t===(null==e?void 0:e.toLowerCase())))}const $a=Symbol("ON_IMMEDIATE_TRANSITION"),Fa=Symbol("ON_INVITE__START"),Pa=Symbol("ON_ADD_FILE_MEMBER_API_ERROR"),Ha=Symbol("ON_ADD_FILE_MEMBER_API_FATAL"),Ua=Symbol("ON_ADD_FILE_MEMBER_API_SUCCESS"),Va=Symbol("ON_SHARE_FILE_FOLDER_FAILURE"),Ba=Symbol("ON_SHARE_FILE_FOLDER_FAILURE_CONTINUE"),ja=Symbol("ON_ADD_FOLDER_MEMBER_API_ERROR"),za=Symbol("ON_ADD_FOLDER_MEMBER_API_FATAL"),Ga=Symbol("ON_ADD_FOLDER_MEMBER_API_SUCCESS"),qa=Symbol("ON_BEFORE_UNLOAD_DURING_INVITE"),Wa=Symbol("ON_UNLOAD_DURING_INVITE"),{useEmitter:Ya,defaultEmitter:Za}=a.defineLogger((async({event:e,getContextValue:t})=>{const a=t(f.Context),i=t(f.Context$1),o=t(f.Context$2),r=y.getShareModalTypeFromString("sm24"),s={...f.getTags(a),...f.getTags$1(i),...f.getTags$2(o)},l={...f.getProperties(a),...f.getProperties$1(i),...f.getProperties$2(o)};if(e.key!==Fa)if(e.key!==Ua&&e.key!==Ga){if(e.key===Ha||e.key===za)return n.UDCL.logEnd(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:"network",fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:{...s,errorReason:"network"},eventState:"failed",key:e.payload.actionKey}),void(Date.now()-e.payload.startTime>11e4&&n.UDCL.logEvent("ops.inband.likely_api_timeout",{tags:s}));if(e.key===Va){const t=Da(E.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return n.UDCL.logEnd(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:{...s,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void n.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...s,errorReason:e.payload.error}})}if(e.key!==Ba){if(e.key===ja){const t=Da(E.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return n.UDCL.logEnd(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:{...s,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void n.UDCL.logEvent("ops.sm24.add_folder_member_api_failure",{tags:{...s,errorReason:e.payload.error}})}if(e.key===Pa){const t=Da(E.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return n.UDCL.logEnd(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:{...s,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void n.UDCL.logEvent("ops.sm24.add_file_member_api_failure",{tags:{...s,errorReason:e.payload.error}})}if(e.key!==$a)if(e.key!==qa){if(e.key!==Wa)return n.exhausts(e,void 0);n.UDCL.logEnd(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,eventState:"canceled",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:{...s,errorReason:"navigation"},eventState:"canceled",key:e.payload.actionKey})}else{const t=Date.now()-e.payload.startTime,a=Math.round(1e4*t)/1e4;n.UDCL.logEvent("ops.inband.before_unload_during_invite",{tags:{...s,timeBucket:a.toString()}})}else n.UDCL.logEvent(Mt({...l,flexibleSharingEntryPointAction:"inband_immediate",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"inband_immediate"}})}else n.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...s,errorReason:e.payload.error}})}else n.UDCL.logEnd(E.PAP_Send_ShareInvite({validationTraceId:void 0,numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,sckeySha1:e.payload.sckeySha1,eventState:"success",shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:s,eventState:"success",key:e.payload.actionKey});else n.UDCL.logStart(E.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,shareModalType:r,actionElement:s.actionElement,actionSurface:s.actionSurface,isDir:"true"===s.isDir,screen:l.screen}),{tags:s,key:e.payload.actionKey})})),Ka=e=>{const t=ma(),a=l.useAtom(t.$inviteTargets),i=l.useAtom(t.$inviteTargetValidations),r=o.useIntl(),s=l.useLogger();return M.useMemo((()=>{let t=null;const o=Object.values(i).reduce(((e,t)=>"allowed"===t.result[".tag"]&&"outside_of_team"===t.result.allowed[".tag"]||"disallowed"===t.result[".tag"]&&"outside_of_team"===t.result.disallowed[".tag"]?e+1:e),0);for(const l of a){const a=z(l),_=i[a];if(_)if("disallowed"===_.result[".tag"]){const a=_.result.disallowed[".tag"];if("invalid_target"===a){t={level:"error",message:Ht(r)};break}if("invalid_member"===a){if("group"===l[".tag"]){t={level:"error",message:xt(r)};break}t={level:"error",message:Lt(r)};break}"outside_of_team"===a?t={level:"error",message:o>1?Ot(r):Dt(r)}:"no_permission"===a?t=e&&n.getIsCollection(e)&&"group"===l[".tag"]?{level:"error",message:r.formatMessage({id:"vLSoUY",defaultMessage:"Collection sharing for groups is currently not supported"})}:{level:"error",message:$t(r)}:"target_is_individual"===a?t={level:"error",message:Ft(r)}:"target_not_same_team_restricted"===a?t={level:"error",message:Pt(r)}:(s("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:a}),t={level:"error",message:Ht(r)})}else if(!t&&"allowed"===_.result[".tag"]){const e=_.result.allowed[".tag"];if("no_warning"===e)continue;"outside_of_team"===e?t=t||{level:"warn",message:o>1?Nt(r):Ct(r)}:s("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:e})}}return t}),[s,r,a,i,e])},Qa=(e,t)=>{const a=ma(),i=o.useIntl(),r=_.useShowSharingNotifcation(),c=l.useLogger(),u=l.usePlatform(),m=l.useEndpoint(ba),p=l.useEndpoint(Aa),f=l.useEndpoint(Sa),h=_.useAction(_.action),v=(()=>{const e=o.useIntl(),t=_.useShowSharingNotifcation();return M.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Yt(e)}),a.error[".tag"]):"user_error"===a.error[".tag"]&&"email_unverified"===a.error.user_error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Jt(e)}),a.error.user_error[".tag"]):"invalid_comment"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Wt(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Qt(e)}),a.error[".tag"]):(a.error[".tag"],t({type:_.SharingNotificationType.FAILURE,message:Wt(e)}),a.error[".tag"])),[e,t])})(),y=(()=>{const e=o.useIntl(),t=_.useShowSharingNotifcation();return M.useCallback((a=>"NetworkFailure"!==a.type&&"PollingNetworkFailure"!==a.type||429!==a.value.response.statusCode?"ApiError"===a.type&&"email_unverified"===a.value.response.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Jt(e)}),a.value.response.error[".tag"]):"ApiError"===a.type&&"no_permission"===a.value.response.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Xt(e)}),a.value.response.error[".tag"]):"ApiError"!==a.type||"too_many_mounts"!==a.value.response.error[".tag"]||"tree_size_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"home_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"total_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]?"ApiError"===a.type&&"bad_path"===a.value.response.error[".tag"]&&"already_shared"===a.value.response.error.bad_path[".tag"]?a.value.response.error.bad_path[".tag"]:"PollingApiError"===a.type&&"internal_error"===a.value.response.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE_WITH_HELP,message:ea(e),helpUrl:"/support",helpMessage:ia(e)}),a.value.response.error[".tag"]):(t({type:_.SharingNotificationType.FAILURE,message:Wt(e)}),"PollingTimeout"===a.type?"network":"PollingFailed"===a.type?"failed":"ApiError"===a.type||"PollingApiError"===a.type?a.value.response.error[".tag"]:"undefined"):(t({type:_.SharingNotificationType.FAILURE_WITH_HELP,message:na(e,a.value.response.error.too_many_mounts.limit-a.value.response.error.too_many_mounts.current_count),helpMessage:la(e),helpUrl:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate"}),a.value.response.error.too_many_mounts[".tag"]):(t({type:_.SharingNotificationType.FAILURE_WITH_HELP,message:oa(e),helpUrl:"/help/9259"}),"network")),[e,t])})(),E=(()=>{const e=o.useIntl(),t=_.useShowSharingNotifcation();return M.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Yt(e)}),a.error[".tag"]):"email_unverified"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Jt(e)}),a.error[".tag"]):"bad_member"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Kt(e)}),a.error[".tag"]):"cant_share_outside_team"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Zt(e)}),a.error[".tag"]):"too_many_members"===a.error[".tag"]||"too_many_pending_invites"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:aa(e)}),a.error[".tag"]):"insufficient_plan"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:ta(e)}),a.error[".tag"]):"team_folder"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Zt(e)}),a.error[".tag"]):"no_permission"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Xt(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:_.SharingNotificationType.FAILURE,message:Qt(e)}),a.error[".tag"]):(t({type:_.SharingNotificationType.FAILURE,message:Wt(e)}),a.error[".tag"])),[e,t])})(),S=Ya(),{user:w}=n.useActiveUser(),b=Na(),A=l.useAtom(a.$sharingAccessLevel),I=Ka(e),{oid:T,onShareStart:R,onShareFailure:k,onInbandShareSuccess:N,onObjectIdentifierChanged:C}=l.useAtom(a.$props),{getVisitorData:L}=s.useAbuseFpjsContext();return M.useCallback((async()=>{if(a.$isInviteSending.get())return;const o=a.$inviteTargets.get(),s=A[".tag"],M=a.$isNewFolder.get();let x=T;const O={numRecipients:o.length,accessLevel:"viewer"===s?"view":"edit",actionKey:Math.random().toString(),isNewFolder:M,startTime:Date.now()};if(c("SHARE_MODAL_SHARE__INVITE__START",null),S.select(Fa).emit(O),R(null),a.$isInviteSending.set(!0),a.$inviteTargetsWithInvalidEmails.get().length>0)return;c("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_START",null);const D=d.getContentIdOrPathFromObjectIdentifier(T),$=await f({members:a.$inviteTargetsWithValidEmails.get().map(W),content_type:{".tag":"file"===T[".tag"]?"file":"file_folder"===T[".tag"]?"folder":"shared_folder"},access_level:{".tag":s},content_id:D});if("ERROR"===$.status&&c("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_ERROR",{error:$.error}),"FATAL"===$.status&&c("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_FATAL",{error:$.error}),"SUCCESS"===$.status&&(c("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_SUCCESS",null),a.$inviteTargetValidations.set(Ea($.output.results))),I&&"error"===I.level)return c("SHARE_MODAL_SHARE__INVITE__CANCELLED",null),void a.$isInviteSending.set(!1);const F=e=>(c("SHARE_MODAL_SHARE__INVITE__NAVIGATE_ATTEMPT",null),S.select(qa).emit(O),e.preventDefault(),e.returnValue="",""),P=()=>{c("SHARE_MODAL_SHARE__INVITE__NAVIGATE_AWAY",null),S.select(Wa).emit(O)};a.$props.get().onShareStart(null),window.addEventListener("beforeunload",F),window.addEventListener("unload",P);const H=()=>{a.$isInviteSending.set(!1),window.removeEventListener("beforeunload",F),window.removeEventListener("unload",P),k(null)},U=a.$props.get().inviteMessage,V=a.$shouldPostMessageAsComment.get(),B=(null==w?void 0:w.email)||"";if("file"===T[".tag"]){const e=await L("INBAND_SHARE_MODAL_FILE",B);c("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_START",null);const t=await m({access_level:{".tag":s},file:D,members:o.map(W),custom_message:U,add_message_as_comment:V&&U.length>0,fp_sealed_result:e.sealedResult});if("ERROR"===t.status){c("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_ERROR",{response:t});const e=v(t);return S.select(Pa).emit({...O,error:e}),void H()}if("FATAL"===t.status)return c("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_FATAL",{response:t}),S.select(Ha).emit(O),H(),void r({type:_.SharingNotificationType.FAILURE_WITH_HELP,message:ea(i),helpUrl:"/support",helpMessage:ia(i)});g.invalidateObjectMembers(T),c("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_SUCCESS",{response:t});const a=t.output[0]&&t.output[0].sckey_sha1&&t.output[0].sckey_sha1;S.select(Ua).emit({...O,sckeySha1:a})}if("file_folder"===T[".tag"]||"shared_folder"===T[".tag"]||"collection"===T[".tag"]){let t="file_folder"===T[".tag"]?"":"collection"===T[".tag"]?T.nsId:T.sharedFolderId;if("file_folder"===T[".tag"]){c("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__START",null);const a=await h({path:T.path,timeout:12e4,interval:1e3});if(a.success){t=a.value.response.output.shared_folder_id;const e=a.value.response.output.folder_id;u===l.Platforms.DESKTOP&&(x={".tag":"shared_folder",sharedFolderId:t,fileId:e})}else{if("ApiError"!==a.type||"bad_path"!==a.value.response.error[".tag"]||"already_shared"!==a.value.response.error.bad_path[".tag"]){H(),c("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__FAILURE",{output:a});const e=y(a);return void S.select(Va).emit({...O,error:e})}{t=a.value.response.error.bad_path.shared_folder_id;const e=a.value.response.error.bad_path.folder_id;u===l.Platforms.DESKTOP&&(x={".tag":"shared_folder",sharedFolderId:t,fileId:e});const i=y(a);S.select(Ba).emit({...O,error:i})}}c("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__SUCCESS",null),await _.invalidateSharingObjectMetadata(x),n.isNewApiMetadata(e)&&await _.invalidateNewApiObjectMetadata(x)}const a=await L("INBAND_SHARE_MODAL_FOLDER",B);c("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_START",null);const d=await p({shared_folder_id:t,...{...U?{custom_message:U}:{}},members:o.map((e=>({access_level:{".tag":s},member:W(e)}))),fp_sealed_result:a.sealedResult});if("ERROR"===d.status){c("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_ERROR",{response:d});const e=E(d);return S.select(ja).emit({...O,error:e}),void H()}if("FATAL"===d.status)return c("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_FATAL",{response:d}),S.select(za).emit(O),H(),void r({type:_.SharingNotificationType.FAILURE,message:ea(i)});c("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_SUCCESS",{response:d}),x={".tag":"shared_folder",sharedFolderId:t,fileId:T.fileId},await g.invalidateObjectMembers(x),await _.invalidateSharingObjectMetadata(x),await _.invalidateNewApiObjectMetadata(x);const m=void 0;S.select(Ga).emit({...O,sckeySha1:m})}a.$isInviteSending.set(!1),window.removeEventListener("beforeunload",F),window.removeEventListener("unload",P),r({type:_.SharingNotificationType.COMPLETED,message:qt(i,e)}),x&&await(null==C?void 0:C(x)),N(),"SUCCESS"===$.status&&(a.$props.get().shouldDisablePostInbandShareHooks||b({objectMetadata:e,objectIdentifier:T,inviteTargets:o,targetsValidateResult:$.output,sharingPrefs:t,user:w}))}),[a,A,c,S,R,T,f,I,w,r,i,e,N,k,L,m,v,p,h,u,y,E,C,b,t])},Xa=e=>{const t=o.useIntl(),a=l.useLogger(),i=ma(),r=_.useShowSharingNotifcation(),{onRefreshModal:s,onRefreshObjectMetadata:d}=l.useAtom(i.$props);return M.useCallback((async(i,o,l,c,g=!1)=>{g?await s():await d();const u=((e,t,a)=>{const i=n.getName(a),o=n.getParentFolderName(a);return t?e.formatMessage({id:"7POTZF",defaultMessage:"Members removed from <strong>{folderName}</strong>."},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)}):void 0===o||""===o?e.formatMessage({id:"nni9pE",defaultMessage:"<strong>{folderName}</strong> shared with everyone."},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)}):e.formatMessage({id:"qvP8A+",defaultMessage:"<strong>{folderName}</strong> shared with members of <strong>{parentFolderName}</strong>."},{folderName:_.Emstring.em_snippet(i,n.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:_.Emstring.em_snippet(o,n.SNIPPET_SIZES.FOLDER_NAME),strong:e=>M.createElement("strong",null,e)})})(t,o,e);r(l?{type:_.SharingNotificationType.COMPLETED_WITH_UNDO,message:u,undoOnClick:()=>null==c?void 0:c(i)}:{type:_.SharingNotificationType.COMPLETED,message:u}),a("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__FINISH",null)}),[t,r,a,e,s,d])},Ja=e=>{const t=ma(),{oid:a}=l.useAtom(t.$props),i=(e=>{const t=o.useIntl(),a=_.useShowSharingNotifcation(),i=ma(),r=l.useLogger(),{onObjectIdentifierChanged:s}=l.useAtom(i.$props),d=_.useAction(_.action$1),c=_.useAction(_.action),u=Xa(e);return M.useCallback((async(i,o,l,m)=>{if("shared_folder"!==i[".tag"]&&"file_folder"!==i[".tag"])return;r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__START",null),a({type:_.SharingNotificationType.IN_PROGRESS,message:ra(t,o,e)});let p=i;if("file_folder"===p[".tag"]){r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_START",null);const d=await c({path:p.path,confidentiality:o?{".tag":"confidential"}:{".tag":"not_confidential"},timeout:12e4,interval:1e3});if(d.success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),p={".tag":"shared_folder",sharedFolderId:d.value.response.output.shared_folder_id,fileId:i.fileId},await(null==s?void 0:s(p)),n.isNewApiMetadata(e)&&await _.invalidateNewApiObjectMetadata(i),u(p,o,l,m),void g.invalidateObjectMembers(p);if("ApiError"!==d.type||"bad_path"!==d.value.response.error[".tag"]||"already_shared"!==d.value.response.error.bad_path[".tag"])return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_FAILURE",null),void a({type:_.SharingNotificationType.FAILURE,message:sa(t,o)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),p={".tag":"shared_folder",sharedFolderId:d.value.response.error.bad_path.shared_folder_id,fileId:i.fileId},await(null==s?void 0:s(p)),n.isNewApiMetadata(e)&&await _.invalidateNewApiObjectMetadata(i),r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null)}if(r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_START",null),!(await d({setAccessInheritanceArg:{access_inheritance:o?{".tag":"no_inherit"}:{".tag":"inherit"},shared_folder_id:p.sharedFolderId},timeout:12e4,interval:1e3})).success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_FAILURE",null),void a({type:_.SharingNotificationType.FAILURE,message:sa(t,o)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_SUCCESS",null),u(p,o,l,m,!0),g.invalidateObjectMembers(p)}),[t,a,r,e,u,d,c,s])})(e);return M.useCallback((async e=>i(a,e,!0,(async t=>i(t,!e,!1)))),[a,i])},ei=(e,t,a)=>a?((e,t)=>e.formatMessage({id:"6jTcuT",defaultMessage:"Share with {teamName}"},{teamName:_.Emstring.em_snippet(t,n.SNIPPET_SIZES.DISPLAY_NAME)}))(e,t):(e=>e.formatMessage({id:"P5jM9e",defaultMessage:"Share"}))(e),ti=(e,t,a,i,o)=>o?((e,t,a)=>e.formatMessage({id:"ipUgQi",defaultMessage:"Share <b>{folderName}</b> with everyone at {teamName}?"},{folderName:_.Emstring.em_snippet(t,n.SNIPPET_SIZES.FOLDER_NAME),teamName:_.Emstring.em_snippet(a,n.SNIPPET_SIZES.DISPLAY_NAME),b:e=>M.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,a,t):((e,t,a)=>e.formatMessage({id:"znRNbl",defaultMessage:"Share <b>{folderName}</b> with everyone who can access <b>{parentFolderName}</b>?"},{folderName:_.Emstring.em_snippet(t,n.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:_.Emstring.em_snippet(a,n.SNIPPET_SIZES.FOLDER_NAME),b:e=>M.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,a,i),ai=(e,t,a,i,n)=>n?((e,t,a)=>e.formatMessage({id:"R8xJiq",defaultMessage:"<b>{folderName}</b> won’t be shared privately any more. Everyone at {teamName} will have access to this folder."},{folderName:t,teamName:a,b:e=>M.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,a,t):((e,t)=>e.formatMessage({id:"ioGEl6",defaultMessage:"Everyone who can access <b>{parentFolderName}</b> will be able to access this folder."},{parentFolderName:t,b:e=>M.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,i),ii=({objectMetadata:e})=>{const t=o.useIntl(),a=ma(),i=l.useAtom(a.$changeConfidentialityData),r=(()=>{const e=ma();return M.useCallback((()=>{e.$changeConfidentialityData.set(null)}),[e])})(),s=Ja(e);if(!i)return null;const _=n.getName(e),d=n.getParentFolderName(e),c=""===d,g=ei(t,i.teamName,c),u=ti(t,i.teamName,_,d,c),m=ai(t,i.teamName,_,d,c);return M.createElement(M.Fragment,null,M.createElement(n.Modal$1,{open:!0,isCentered:!0,withCloseButton:"Close",onRequestClose:r},M.createElement(n.Modal$1.Header,{"data-sharing-sdk":"1",hasBottomSpacing:"title-standard"},M.createElement(n.Modal$1.Title,null,u)),M.createElement(n.Modal$1.Body,{"data-sharing-sdk":"1"},m),M.createElement(n.Modal$1.Footer,{"data-sharing-sdk":"1"},M.createElement(n.Button,{variant:"opacity",onClick:r},(e=>e.formatMessage({id:"i3tRYX",defaultMessage:"Cancel"}))(t)),M.createElement(n.Button,{variant:"primary",onClick:()=>{s(!1),r()}},g))))};ii.displayName="ChangeConfidentialityModal";const ni=({message:e,variant:t})=>{if(!e)return null;const a="error"===t?"alert":"attention";return M.createElement(r.Banner,{type:a},M.createElement(r.Banner.Message,{className:"scl-sharing-modal-validation-warning__message"},e))};ni.displayName="FormValidationMessage";const oi=e=>{S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["desktop-discovery","ai-sharing-summary"]})},ri=()=>{var e,t,a;const i=(()=>{const{variant:e,error:t}=n.useExperimentVariant("bridge_growth_sharing_email_ai_summary");return t?(oi(t),"OFF"):null!=e?e:"OFF"})(),{data:o,isLoading:r}=(()=>{try{return n.useDashAccess()}catch(e){return oi(e),{data:void 0,isLoading:!1}}})(),s=null!==(a=null===(t=null===(e=null==o?void 0:o.apiData)||void 0===e?void 0:e.feature_attributes)||void 0===t?void 0:t.has_chat_in_fss)&&void 0!==a&&a;return"ON"===i&&s&&!r};n.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen/internals/message-field.module.out-vflBIPWhT.css",(e=>"._message-field_1uyu3_1{display:flex;flex-direction:column;flex-grow:1;margin-bottom:-3px;padding-top:0;position:relative}._message-field_1uyu3_1 textarea{background-color:var(--dig-color__background__base);border:1px solid var(--dig-color__border__subtle);flex-grow:1;height:auto}._message-field-with-banner_1uyu3_17 textarea{border-bottom-color:var(--dig-color__primary__surface--state-2);border-bottom-left-radius:0;border-bottom-right-radius:0;min-height:114px}._message-field-textarea-mobile_1uyu3_25{font-size:16px}._top-right-button_1uyu3_29{position:absolute;right:11px;top:8px}._summarized-banner_1uyu3_35{border:1px solid var(--dig-color__primary__surface--state-2);border-top:none;border-top-left-radius:0;border-top-right-radius:0;z-index:-1}._summarized-banner-message_1uyu3_44{color:var(--dig-color__primary__base);font-weight:500}._summarized-banner-icon_1uyu3_49{color:var(--dig-color__foldericon__icon)}"));const si="_message-field_1uyu3_1",li="_message-field-with-banner_1uyu3_17",_i="_message-field-textarea-mobile_1uyu3_25",di="_summarized-banner_1uyu3_35",ci="_summarized-banner-message_1uyu3_44",gi="_summarized-banner-icon_1uyu3_49",ui=()=>{const e=o.useIntl(),t=ma(),a=l.useLogger(),i=l.useStore(t.$isInviteSending),[s,_]=M.useState(!1),[d,c]=M.useState(!1),[g,u]=M.useState(!1),[m,p]=M.useState(!1),f=M.useRef(!1),h=ri(),[v,y]=M.useState(t.$inviteMessage.get()),[E,S]=M.useState(!1),b=M.useCallback((e=>{if(t.$isInviteMessageTooLong.set(e.currentTarget.value.length>2e3),h){""===e.currentTarget.value?(u(!1),p(!1),c(!1)):g&&!m&&p(!0)}a("SHARE_MODAL_SHARE__MESSAGE_CHANGED",null),y(e.currentTarget.value),t.$inviteMessage.set(e.currentTarget.value)}),[g,h,a,t,m]),A=w.is_mobile_or_tablet();M.useCallback((()=>{}),[]);const I=d&&!s&&Boolean(v);return M.useEffect((()=>{""===v&&h&&(u(!1),p(!1),c(!1))}),[v,h]),M.useEffect((()=>{let e=!1;const a=async()=>{_(!0);try{const{objectMetadataResult:a,oid:i}=t.$props.get(),o=await(async(e,t)=>{var a;const{isReady:i,fileId:o,fssSearchScope:r}=((e,t)=>{var a,i;if(!e||e.isLoading||e.isError)return{fileId:"",fssSearchScope:void 0,isReady:!1};const n=e.output;return n?{fileId:(null===(a=n.common_metadata)||void 0===a?void 0:a.file_id)||t.fileId||"",fssSearchScope:null===(i=n.common_metadata)||void 0===i?void 0:i.path_display,isReady:!0}:{fileId:"",fssSearchScope:void 0,isReady:!1}})(e,t);if(!i||!o)return null;try{const e=await n.getContextEngineApiClient(),t=((e,t)=>({conversation_id:"",user_message:{text:"Summarize this",rephrased:"",agent_ids:["summarize"],attachments:[{uuid:e,fss_retriever_info:{fss_file_identifier:{file_id:e}}}],agent_payload:"",llm_ignore:!1,fss_search_scope:t||"",stack_id_scope:""}}))(o,r),i=await e.rpc("conversations/get_response",t,{headers:n.getDefaultHeaders()}),s=((null==i?void 0:i.messages)||[]).find((e=>{var t;return"assistant_message"===(null===(t=e.message_type)||void 0===t?void 0:t[".tag"])}))||null;return s&&"assistant_message"===(null===(a=s.message_type)||void 0===a?void 0:a[".tag"])&&s.message_type.text?s.message_type.text:null}catch(e){return null}})(a,i);if(e)return;_(!1),o&&(y(o),t.$inviteMessage.set(o),c(!0),u(!0),p(!1))}catch(t){if(e)return;_(!1)}};return!h||v||f.current||(f.current=!0,a()),()=>{e=!0}}),[v,h,t]),M.createElement(n.Box,{className:n.cx(si,I?li:void 0),paddingTop:"Micro Large"},M.createElement(n.TextArea,{className:n.cx(A?_i:void 0),value:v,placeholder:s?Vt(e):Ut(e),"aria-label":Bt(e),onChange:e=>{y(e.currentTarget.value),E||b(e)},disabled:i||s,"data-testid":"ib-message-field-textarea",onCompositionStart:()=>S(!0),onCompositionEnd:e=>{S(!1),b(e)}}),I&&M.createElement(r.Banner,{className:di,type:"attention",variant:"basic",withLeftIcon:M.createElement(n.UIIcon,{src:n.Twinkle2Line,className:gi})},M.createElement(r.Banner.Message,{className:ci},(e=>e.formatMessage({id:"VlECo+",defaultMessage:"Summarized by Dash"}))(e))),!1)};ui.displayName="MessageField";n.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen/internals/share-modal-share.module.out-vflXLGzBa.css",(e=>"._action-row_1nkgf_1{display:flex;flex-direction:column;min-height:310px;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1nkgf_12{animation:_action-row-expand-accessory-area_1nkgf_1 var(--duration__surface) var(--easing__transition) forwards;min-height:64px;overflow:hidden}._action-section_1nkgf_19{border:1px solid var(--dig-color__border__subtle);border-radius:var(--dig-radius__medium);position:relative;transition:border var(--duration__micro-fast) var(--easing__transition);z-index:1}._action-section-top_1nkgf_28{padding:var(--dig-spacing__micro__medium)}._action-section-active_1nkgf_32{border-color:var(--dig-color__secondary__base);box-shadow:none}._action-section-active_1nkgf_32,._action-section-active_1nkgf_32:hover,._action-section_1nkgf_19:focus-within{box-shadow:var(--dig-utilities__boxshadow__focus-ring);transition:box-shadow var(--duration__micro-fast) var(--easing__transition)}._accessory-section_1nkgf_44{animation:_fade-in_1nkgf_1 var(--duration__micro-fast) var(--easing__transition) forwards;display:flex;flex-direction:column;flex-grow:1;height:100%;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1nkgf_12 ._accessory-section_1nkgf_44{animation:_fade-in_1nkgf_1 var(--duration__surface) var(--easing__transition) forwards}@media (prefers-reduced-motion:reduce){._action-row-expand-from-accessory-area_1nkgf_12,._action-row-expand-from-accessory-area_1nkgf_12 ._accessory-section_1nkgf_44{animation-timing-function:var(--easing__linear)}}@keyframes _action-row-expand-accessory-area_1nkgf_1{0%{max-height:64px;min-height:64px}to{min-height:286px;overflow:visible}}@keyframes _fade-in_1nkgf_1{0%{opacity:0}to{opacity:1}}._action-section-bottom_1nkgf_88{align-items:center;display:flex;height:32px;justify-content:space-between}._add-icon-small_1nkgf_96{height:var(--dig-spacing__dimension__24);margin-top:var(--dig-spacing__dimension__6);min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}._add-icon-small_1nkgf_96 svg{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}._add-icon_1nkgf_96,._add-icon_1nkgf_96>svg{transition:min-width var(--duration__surface) var(--easing__transition),width var(--duration__surface) var(--easing__transition),background-color var(--duration__surface) var(--easing__transition),color var(--duration__surface) var(--easing__transition),height var(--duration__surface) var(--easing__transition),margin-top var(--duration__surface) var(--easing__transition)}._add-icon-shrink_1nkgf_121{animation:_shrink-icon_1nkgf_1 var(--duration__micro-fast) var(--easing__transition) forwards}._add-icon-shrink_1nkgf_121>svg{animation:_shrink-icon-svg_1nkgf_1 var(--duration__micro-fast) var(--easing__transition) forwards}@keyframes _shrink-icon_1nkgf_1{0%{height:var(--dig-spacing__dimension__36);margin-top:0;min-width:var(--dig-spacing__dimension__36);width:var(--dig-spacing__dimension__36)}to{height:var(--dig-spacing__dimension__24);margin-top:5px;min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}}@keyframes _shrink-icon-svg_1nkgf_1{0%{height:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}to{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}}._add-members-directly-action-section_1nkgf_170{border-color:var(--dig-color__border__subtle);border-radius:var(--dig-radius__small);border-style:solid;border-width:2px;position:relative;z-index:1}._add-members-directly-action-section_1nkgf_170 ._add-icon_1nkgf_96{margin-top:0}._add-members-directly-action-section-active_1nkgf_183,._add-members-directly-action-section_1nkgf_170:focus-within{border-color:var(--dig-color__utility__focus-ring)}._add-members-directly-action-section-active_1nkgf_183 ._add-icon_1nkgf_96,._add-members-directly-action-section_1nkgf_170:focus-within ._add-icon_1nkgf_96,._add-members-directly-action-section_1nkgf_170:hover ._add-icon_1nkgf_96{background:var(--dig-color__primary__base);color:var(--dig-color__background__base)}._add-members-directly-action-section-bottom_1nkgf_195{padding:var(--dig-spacing__micro__medium);padding-top:var(--dig-spacing__micro__medium)}._add-members-directly-action-section-active_1nkgf_183 ._add-icon-sending_1nkgf_200,._add-members-directly-action-section_1nkgf_170:focus-within ._add-icon-sending_1nkgf_200,._add-members-directly-action-section_1nkgf_170:hover ._add-icon-sending_1nkgf_200{background:var(--dig-color__disabled__base)}._add-members-directly-action-section_1nkgf_170 ._add-icon-sending_1nkgf_200>svg,._add-members-directly-action-section-active_1nkgf_183 ._add-icon-sending_1nkgf_200>svg,._add-members-directly-action-section_1nkgf_170:focus-within ._add-icon-sending_1nkgf_200>svg,._add-members-directly-action-section_1nkgf_170:hover ._add-icon-sending_1nkgf_200>svg{color:var(--dig-color__disabled__on-surface)}"));const mi="_action-row_1nkgf_1",pi="_action-row-expand-from-accessory-area_1nkgf_12",fi="_action-section_1nkgf_19",hi="_action-section-top_1nkgf_28",vi="_action-section-active_1nkgf_32",yi="_accessory-section_1nkgf_44",Ei="_action-section-bottom_1nkgf_88",Si="_add-icon-small_1nkgf_96",wi="_add-icon_1nkgf_96",bi="_add-icon-shrink_1nkgf_121",Ai="_add-members-directly-action-section_1nkgf_170",Ii="_add-members-directly-action-section-active_1nkgf_183",Ti="_add-icon-sending_1nkgf_200",Ri=(e,t)=>{const a=e.linked_services.find((e=>e.service_type[".tag"]===t[".tag"]));return!!a&&"is_connected"===a.connection_state[".tag"]},Mi=(e,t,a)=>{const i=e.linked_services.find((e=>e.service_type[".tag"]===t[".tag"]));return!!i&&i.granted_permissions.some((e=>e[".tag"]===a[".tag"]))},ki=l.define({name:"profileServices.listLinkedServices"},(e=>()=>l.handler(e.profileServicesListLinkedServices()))),Ni=e=>e,Ci=l.define({name:"sharing.targetsSearch"},(e=>async t=>{const a=await l.handler(e.sharingTargetsSearch(t));return"SUCCESS"===a.status?{status:l.Status.SUCCESS,output:a.output.entries.map(Ni)}:a})),Li=Symbol("ON_SHOW_SUGGESTIONS"),xi=Symbol("ON_SELECT_SUGGESTION"),{useEmitter:Oi,defaultEmitter:Di}=a.defineLogger((async({event:e,getContextValue:t})=>{const a=t(f.Context),i=t(f.Context$1),o=t(f.Context$2),r=t(f.Context$3),s={...f.getTags(a),...f.getTags$1(i),...f.getTags$2(o),...f.getTags$3(r)};e.key!==Li?e.key!==xi||n.UDCL.logEvent("ops.sm24.select_tokenizer_suggestion",{tags:{...s,method:e.payload.method,suggestionIndex:e.payload.index.toString()}}):n.UDCL.logEvent("ops.sm24.show_tokenizer_suggestions",{tags:{...s,numSuggestions:e.payload.numSuggestions.toString()}})}));n.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/targets-tokenizer/internals/targets-tokenizer.module.out-vflGehY5z.css",(e=>"._share-tokenizer_1l70k_1{color-scheme:var(--dig-color-scheme);margin-top:var(--dig-spacing__dimension__4);max-height:80px;max-height:64px;max-width:100%;min-height:32px;min-width:auto;overflow-y:hidden;width:100%}._share-tokenizer-with-targets_1l70k_16{overflow-y:scroll}._share-tokenizer-text-input-container_1l70k_20{border:none;box-shadow:none;cursor:text;outline:none;position:relative}._share-tokenizer-text-input-container_1l70k_20:focus-within{border:none;box-shadow:none;outline:none}._share-tokenizer-text-input-container_1l70k_20:has(input:focus){border:none;box-shadow:none;outline:none}._share-tokenizer-typeahead-container_1l70k_43{border-radius:var(--dig-radius__small);transform:translate(-14px,20px);width:calc(100% + 28px)}._share-tokenizer-with-targets_1l70k_16:not(._share-tokenizer_1l70k_1) ._share-tokenizer-typeahead-container_1l70k_43{transform:translate(-14px)}input._share-tokenizer-text-input_1l70k_20[type=text]{font-family:var(--type__body__standard--fontfamily);font-size:var(--type__body__standard--fontsize);line-height:var(--type__body__standard--lineheight_label);min-height:var(--dig-spacing__dimension__24);min-width:2ch;width:0}input._share-tokenizer-text-input-mobile_1l70k_66[type=text]{font-size:16px}._screen-reader-only_1l70k_70{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}"));const $i="_share-tokenizer_1l70k_1",Fi="_share-tokenizer-with-targets_1l70k_16",Pi="_share-tokenizer-text-input-container_1l70k_20",Hi="_share-tokenizer-typeahead-container_1l70k_43",Ui="_share-tokenizer-text-input_1l70k_20",Vi="_share-tokenizer-text-input-mobile_1l70k_66",Bi="_screen-reader-only_1l70k_70",ji=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),zi=e=>e.formatMessage({id:"Au33+R",defaultMessage:"Successfully connected your contacts from Google"}),Gi=e=>e.formatMessage({id:"sgP44K",defaultMessage:"Failed to connect your contacts from Google"}),qi=e=>e.formatMessage({id:"ZusjWv",defaultMessage:"Suggested people"}),Wi=e=>e.formatMessage({id:"6EE+ph",defaultMessage:"Suggested people list"}),Yi=e=>e.formatMessage({id:"CkYgqG",defaultMessage:"Sign in to import contacts"}),Zi=e=>e.formatMessage({id:"2/+46g",defaultMessage:"Connected"}),Ki=e=>e.formatMessage({id:"JbMFlW",defaultMessage:"Importing contacts"}),Qi=/['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}/gi,Xi=/[,|;>\s]/,Ji="Enter",en="IMPORT_CONTACTS",tn=[en],an="Google",nn="/static/images/index/google-logo-color.svg",on=e=>(e.match(Qi)||[]).map(j),rn=e=>M.useCallback((t=>{const a=t.currentTarget.value,i=(n=a,Xi.test(n)?on(n):[]);var n;l.batch((()=>{e.$isTypeaheadForcedOpen.set(!1),i.length>0?(e.$inviteTargets.set([...e.$inviteTargets.get(),...i]),e.$query.set("")):e.$query.set(a)}))}),[e]),sn=e=>e.map((e=>{if("email"===e[".tag"]||"user"===e[".tag"]){const t=e.email.trim();return t.length===e.email.length?e:{...e,email:t}}return e})),ln=e=>{const t={};return e.filter((e=>{const a=z(e);return!t[a]&&(t[a]=!0,!0)}))},_n=e=>{const t=(e=>{const t=l.useEndpoint(Ci),a=l.useLogger(),i=o.useIntl(),n=_.useShowSharingNotifcation();return M.useCallback((async()=>{const o=e.$query.get(),r=await t({query:o,force_refresh:!1,limit:10});if(e.$query.get()===o){if(a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_START",null),"SUCCESS"!==r.status)return"ERROR"===r.status?a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_ERROR",{response:r}):a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_FATAL",{response:r}),n({type:_.SharingNotificationType.FAILURE,message:ji(i)}),void e.$searchSuggestionsRaw.set([]);a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_SUCCESS",{response:r}),l.batch((()=>{e.$latestSuggestionsQuery.set(o),e.$searchSuggestionsRaw.set(r.output)}))}}),[e,t,a,n,i])})(e);M.useEffect((()=>{const a=[e.$query.obs((e=>{t()}))];return()=>a.forEach((e=>e()))}),[e,t])},dn=e=>{const t=l.useEndpoint(ki);return M.useCallback((async()=>{if(e.$isLinkedServicesUpdating.get())return;const a=await t(null);"SUCCESS"===a.status?l.batch((()=>{e.$linkedServices.set(a.output),e.$isLinkedServicesUpdating.set(!1)})):l.batch((()=>{e.$linkedServices.set(null),e.$isLinkedServicesUpdating.set(!1)}))}),[e,t])},cn=e=>{const t=o.useIntl(),a=_.useShowSharingNotifcation(),i=l.useLogger(),r=dn(e),s=l.useRedirectWindowToken();return M.useCallback((async()=>{if(e.$isConnectingToGoogle.get()||null===s)return;e.$isConnectingToGoogle.set(!0);let o=null;const l=()=>{a({type:_.SharingNotificationType.FAILURE,message:Gi(t)}),null!==o&&clearInterval(o),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)}))},d=new URLSearchParams({service:"1",is_popup:"true",action:"link_contacts",prompt_select:"true",token:s,user_id:e.$user.get().id.toString(),is_desktop:"false"}),c=window.open(`/profile_services/start_auth_flow?${d.toString()}`,"Google","width=600,height=600,resizable=1,scrollbars=1");if(null===c)return l();o=setInterval((()=>{c.closed&&l()}),1e3);const g=s=>{let d;try{d=JSON.parse(s.data)}catch(e){return}if(n.isObjectOf({type:n.isExactly("db:profile_service:auth_complete"),payload:n.isObjectOf({success:n.isBoolean})})(d)){if(d.payload.success)return u=c,i("TEAMS_WEB",{name:A.TeamsWebEventName.ImportContactsComplete,extra:{provider:"google",path:window.location.pathname}}),a({type:_.SharingNotificationType.COMPLETED,message:zi(t)}),null!==o&&clearInterval(o),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)})),void(null==u||u.close());var u;l(),c.close()}};window.addEventListener("message",g)}),[e,t,i,r,s,a])},gn=(e,t)=>"user"===e[".tag"]?_.getUserInitials(e.name,t.locale):"group"===e[".tag"]?_.getGroupInitials(e.name):"email"===e[".tag"]?"":n.exhausts(e,""),un=(e,t)=>"user"===e[".tag"]?t&&t!==e.dbx_team_id?e.email:e.name:"group"===e[".tag"]?e.name:"email"===e[".tag"]?e.email:"",mn=({store:e,target:t,isDisabled:a,maxChars:i})=>{const r=o.useIntl(),s=((e,t)=>M.useCallback((()=>{const a=e.$inviteTargets.get().filter((e=>e!==t));l.batch((()=>{e.$inviteTargets.set(a),e.$query.set("")}))}),[e,t]))(e,t),d=e.$user.get().team_dbtid,c=_.Emstring.em_snippet(un(t,d),null!=i?i:n.SNIPPET_SIZES.EMAIL_SHORT,.6),g="user"===t[".tag"]&&d&&d!==t.dbx_team_id?"":gn(t,r),u=G(t),m=z(t),p=l.useStore(e.$inviteTargetValidation)[m],f=p&&"allowed"===p.result[".tag"]&&"no_warning"!==p.result.allowed[".tag"]&&"not_dropbox_user"!==p.result.allowed[".tag"],h=p&&"disallowed"===p.result[".tag"],v=!!g||!!u,y=v&&M.createElement(n.Avatar,{src:u||"",size:"xsmall",hasNoOutline:!0,"aria-hidden":!0},g),E=((e,t)=>e.formatMessage({id:"cVF7dM",defaultMessage:"Sharing with {label} - press backspace or delete to remove"},{label:t}))(r,c);return M.createElement(n.Chip,{size:"small",onDelete:s,variant:f?"attention":h?"alert":"standard",disabled:a,"aria-label":E},v&&M.createElement(n.Chip.AvatarAccessory,null,y),M.createElement(n.Chip.Content,null,c))};mn.displayName="EmailChip";const pn=({target:e})=>{const t=o.useIntl(),a=z(e),i=gn(e,t),r=un(e),s=q(e,t),l=G(e);return M.createElement(b.Typeahead.Row,{"data-testid":"typeahead-suggestion",className:"targets-tokenizer-suggestion",key:a,value:e,withTitle:r,withSubtitle:s,withLeftAccessory:M.createElement(n.Avatar,{src:l||void 0,hasNoOutline:!0,alt:r,"aria-hidden":"true"},i)})};pn.displayName="Suggestion";const fn=({results:e,suggestionMax:t})=>M.createElement("div",{className:Bi,"aria-live":"polite"},e.slice(0,t).map(((e,t)=>M.createElement("div",{key:t},e!==en&&un(e)))));fn.displayName="ScreenReaderLiveResults";const hn=({store:e})=>{const t=o.useIntl(),a=l.useStore(e.$isConnectingToGoogle),i=l.useStore(e.$isConnectedToGoogle),r=l.useStore(e.$isLinkedServicesUpdating);return l.useRedirectWindowToken()?a?M.createElement(b.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:en,withLeftAccessory:M.createElement(n.Avatar,{src:nn}),value:en,withTitle:an,withSubtitle:Ki(t)}):r?null:i?M.createElement(b.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:en,withLeftAccessory:M.createElement(n.Avatar,{src:nn}),value:en,withTitle:an,withSubtitle:Zi(t)}):M.createElement(b.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:en,withLeftAccessory:M.createElement(n.Avatar,{src:nn}),value:en,withTitle:an,withSubtitle:Yi(t)}):null};hn.displayName="ImportContacts";const vn=e=>{var t;const a=(e=>{const{isNonUserRelativeContext:t}=h.useSharingApiContext();return l.useInitStore({props:e,isNonUserRelativeContext:t},(e=>{var t,a;const i=l.proxy((()=>e.get().props)),o=l.proxy((()=>e.get().isNonUserRelativeContext)),r=l.store(!1),s=l.store(!1),_=l.store(!1),d=l.store(null!==(t=i.get().autoFocus)&&void 0!==t&&t),c=l.store(!1),g=l.store(null),u=l.store(null!==(a=i.get().initialQuery)&&void 0!==a?a:""),m=l.store(""),p=l.proxy((()=>i.get().isActive)),f=l.proxy((()=>i.get().user)),h=l.proxy((()=>i.get().accessLevel)),v=l.proxy((()=>i.get().isEmailSectionActive)),y=l.proxy((()=>i.get().inviteTargets),(e=>i.get().onInviteTargetsChange(sn(ln(e))))),E=l.proxy((()=>i.get().inviteTargetValidation)),S=l.proxy((()=>y.get().length>0)),w=l.proxy((()=>i.get().objectMetadata)),b=l.proxy((()=>n.getCanInvite(w.get(),h.get()))),A=l.proxy((()=>{const e=g.get();return e?Ri(e,{".tag":"google"})&&Mi(e,{".tag":"google"},{".tag":"contacts"}):null})),I=l.proxy((()=>f.get().is_team)),T=l.proxy((()=>n.getIsTeamSharedFolder(w.get()))),R=l.proxy((()=>i.get().autoFocus)),M=l.proxy((()=>_.get())),k=l.store([]),N=l.proxy((e=>{const t=T.get(),a=f.get().email,i=y.get().map(z),n={},r=o.get(),s=k.get().filter((e=>{const o=z(e);return!(n[o]||(n[o]=!0,i.includes(o)||!P(t,f.get().is_tmr_member)&&"group"!==e[".tag"]||!(r||"email"!==e[".tag"]&&"user"!==e[".tag"]||e.email!==a)))}));return null!==e&&e.length===s.length&&e.every(((e,t)=>e===s[t]),!0)?e:s})),C=l.proxy((e=>{const t=T.get(),a=u.get(),i=t||""===a,n=[...N.get().slice(0,9),...i?[]:tn];return null!==e&&e.length===n.length&&e.reduce(((e,t,a)=>e&&t===n[a]),!0)?e:n}));return{$accessLevel:h,$user:f,$canInvite:b,$inviteTargets:y,$inviteTargetValidation:E,$hasInviteTargets:S,$isConnectedToGoogle:A,$isConnectingToGoogle:r,$isFocused:s,$isLinkedServicesUpdating:_,$isTeamAccount:I,$isTeamFolder:T,$isTypeaheadForcedOpen:d,$isTypeaheadOpen:c,$isUpdatingGoogleConnectionStatus:M,$linkedServices:g,$objectMetadata:w,$query:u,$latestSuggestionsQuery:m,$searchSuggestionsRaw:k,$searchSuggestions:N,$suggestions:C,$isEmailSectionActive:v,$autoFocus:R,$isActive:p,$props:i}}))})(e),{isSuggestionsOpen:i,isInviteSending:r,isActionRowTransitionInProgress:s,inbandInputAreaRef:d,inputRef:c,inviteTargets:g,setSuggestionsOpen:u,onTargetsDropdownFocusChange:m}=e,p=o.useIntl(),f=M.useRef(null),v=l.useStore(a.$query),y=l.useStore(a.$inviteTargets),E=l.useStore(a.$hasInviteTargets),S=M.useRef(y.length),A=l.useStore(a.$suggestions),I=l.useStore(a.$canInvite),T=l.useStore(a.$isTypeaheadForcedOpen)&&I,R=null!==(t=l.useStore(a.$autoFocus))&&void 0!==t&&t;_n(a),(e=>{const t=l.useEndpoint(Ci),a=l.useLogger();M.useEffect((()=>{(async()=>{a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_START",null);const i=await t({query:"",force_refresh:!0,limit:10});"SUCCESS"===i.status?a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_SUCCESS",{response:i}):"ERROR"===i.status?a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_ERROR",{response:i}):a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_FATAL",{response:i}),"SUCCESS"===i.status&&e.$searchSuggestionsRaw.set(i.output)})()}),[])})(a),(e=>{const t=dn(e);M.useEffect((()=>{t()}),[t])})(a),(e=>{const t=Oi(),a=l.useStore(e.$searchSuggestions),i=l.useStore(e.$isTypeaheadOpen);M.useEffect((()=>{if(i){const e=a.slice(0,9).length;e>0&&i&&t.select(Li).emit({numSuggestions:e})}}),[a,t,i])})(a);const k=(e=>{const t=Oi(),a=cn(e),i=l.useStore(e.$searchSuggestions);return M.useCallback(((n,o)=>{l.batch((()=>{var r,s;if(n===en){if(e.$isTypeaheadForcedOpen.set(!0),e.$isConnectingToGoogle.get())return;if(e.$isConnectedToGoogle.get())return;return e.$query.set(""),void a()}t.select(xi).emit({index:i.findIndex((e=>e===n)),method:o.nativeEvent instanceof KeyboardEvent?"keyboard":"click"}),e.$query.set(""),e.$inviteTargets.set([...e.$inviteTargets.get(),n]),null===(s=null===(r=e.$props.get().inputRef)||void 0===r?void 0:r.current)||void 0===s||s.focus()}))}),[e,a,t,i])})(a),N=(e=>{const t=Oi();return M.useCallback((a=>{const i=e.$query.get();if(a.key===Ji&&a.shiftKey)return void a.preventDefault();"Backspace"!==a.key&&"Delete"!==a.key||""===i&&e.$inviteTargets.get().length>0&&e.$inviteTargets.set(e.$inviteTargets.get().slice(0,-1));const n=i===e.$latestSuggestionsQuery.get(),o=Qi.test(i);if(a.key===Ji){const a=document.getElementById("targets-tokenizer-input-search");if(a&&"scrollIntoView"in a&&a.scrollIntoView(),n&&!o&&e.$searchSuggestions.get().length>0)t.select(xi).emit({index:0,method:"keyboard"}),l.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),e.$searchSuggestions.get()[0]]),e.$query.set("")}));else if(""!==i){const t=on(i);t.length>0?l.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")})):l.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),j(i)]),e.$query.set("")}))}}}),[e,t])})(a),C=rn(a),{inputPlaceholder:L,truncatedInputPlaceholder:x}=(e=>{var t;const a=o.useIntl(),i=l.useStore(e.$hasInviteTargets),r=l.useStore(e.$isTeamFolder),s=l.useStore(e.$isTeamAccount),d=l.useStore(e.$user).is_tmr_member,c=null===(t=l.useStore(e.$props).shouldTruncatePlaceholder)||void 0===t||t;return M.useMemo((()=>{let e;return e=i?void 0:r&&!d?(e=>e.formatMessage({id:"VMGE6I",defaultMessage:"Group names"}))(a):s?(e=>e.formatMessage({id:"+nKRfb",defaultMessage:"Add an email, name, or group"}))(a):(e=>e.formatMessage({id:"bdV6O3",defaultMessage:"Add an email or name"}))(a),{inputPlaceholder:e,truncatedInputPlaceholder:c&&e?_.Emstring.em_snippet(e,n.SNIPPET_SIZES.TOKENIZER_PLACEHOLDER,1):e}}),[r,s,a,d,i,c])})(a),O=(e=>M.useCallback((({isOpen:t})=>{if(t)e.$isTypeaheadOpen.set(!0);else{const t=on(e.$query.get());l.batch((()=>{t.length>0&&(e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")),e.$isTypeaheadForcedOpen.set(!1),e.$isTypeaheadOpen.set(!1),e.$isFocused.set(!1)}))}}),[e]))(a),D=(e=>M.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onUserInteraction)||void 0===a||a.call(t),e.$isTypeaheadForcedOpen.set(!1),e.$isFocused.set(!0)}),[e]))(a),$=(e=>M.useCallback((t=>t===en?M.createElement(hn,{store:e}):M.createElement(pn,{target:t})),[e]))(a),F=M.useRef(!1),H=M.useRef(void 0),U=r||!I,V=M.useCallback(((e,t)=>{const a=t.includes(en)?t.length-1:t.length,i=e&&a>0;F.current!==i&&(F.current=i,null==m||m(i)),u(e)}),[m,u]);M.useEffect((()=>{const e=H.current;e&&(V(e.isOpen,e.suggestions),H.current=void 0)}));const B=M.useCallback((()=>{i||a.$isTypeaheadForcedOpen.set(!0)}),[a.$isTypeaheadForcedOpen,i]),G=M.useCallback((()=>{var e;null===(e=null==c?void 0:c.current)||void 0===e||e.focus()}),[c]);M.useEffect((()=>{I&&0===g.length&&!s&&G()}),[I,G,g,s]),M.useEffect((()=>{if(S.current<y.length){const e=document.getElementById("targets-tokenizer-input-search");e&&"scrollIntoView"in e&&e.scrollIntoView()}S.current=y.length}),[y.length]);const q=w.is_mobile_or_tablet();return M.createElement(n.DIGContext.Provider,{value:{featureLevel:"experimental"}},M.createElement(b.Typeahead.Wrapper,{className:n.cx($i,$i,{[Fi]:E}),onSelection:k,hasMaxHeight:!0,isPortaled:q,onToggle:O},(({getTriggerProps:e,getContentProps:t})=>{const{open:i,...o}=t({}),r=(i||T)&&A.length>0;return H.current={isOpen:r,suggestions:A},M.createElement(M.Fragment,null,M.createElement(n.TextInput.Container,{className:n.cx(Pi),ref:f,size:"small",onClick:G,"data-uxa-log":"sm24-tokenizer","data-uxa-interactions":"shown"},M.createElement(n.TextInput.ChipsContainer,null,y.map(((e,t)=>M.createElement(mn,{store:a,key:t,target:e,isDisabled:U}))),M.createElement(n.TextInput.Input,{...e({onChange:C,onKeyDown:N,onFocus:D}),className:n.cx(Ui,{[Vi]:q}),ref:c,disabled:U,value:v,"aria-label":L,placeholder:x,"data-testid":"targets-tokenizer-input",id:"targets-tokenizer-input-search",autoComplete:"off",autoFocus:R,onClick:B}))),M.createElement(b.Typeahead.Container,{...o,triggerRef:d,open:r,"data-testid":"typeahead-container",className:Hi,auto:!1,placement:"bottom","aria-label":Wi(p)},M.createElement(fn,{results:A,suggestionMax:3}),M.createElement(b.Typeahead.Results,{title:qi(p),results:A,renderRow:$,initialResults:""===v?3:10,maxResults:10})))})))};vn.displayName="TargetsTokenizer";const yn=M.memo((({isActive:e,objectMetadata:t,accountMetadata:a,inbandInputAreaRef:i,inputRef:n,onFocusChange:o,isActionRowTransitionInProgress:r,initialQuery:s})=>{const d=ma(),c=l.useStore(d.$inviteTargets),g=l.useStore(d.$inviteTargetValidations),u=l.useStore(d.$isInviteSending),m=l.useAtom(d.$sharingAccessLevel),p=(e=>M.useMemo((()=>_.convertAccountMetadataToUser(e)),[e]))(a),f=l.useStore(d.$isSuggestionsOpen),h=M.useCallback((e=>{d.$isSuggestionsOpen.set(e)}),[d.$isSuggestionsOpen]),{shouldStyleForSM21:v}=l.useAtom(d.$props),y=(()=>{const e=l.useLogger(),t=ma();return M.useCallback((a=>{e("SHARE_MODAL_SHARE__INVITE_TARGETS__CHANGE",null),t.$props.get().onInviteTargetsChange(a)}),[t,e])})();return M.createElement(vn,{accessLevel:m,objectMetadata:t,inviteTargets:c,onInviteTargetsChange:y,onTargetsDropdownFocusChange:o,inviteTargetValidation:g,user:p,isInviteSending:u,inbandInputAreaRef:i,inputRef:n,isActive:e,isSuggestionsOpen:f,setSuggestionsOpen:h,shouldTruncatePlaceholder:v,isActionRowTransitionInProgress:r,initialQuery:s})}));yn.displayName="TargetsTokenizer";const En=()=>{const e=o.useIntl();return M.default.createElement(n.Box,{style:{display:"flex",flexDirection:"column",height:"310px"}},M.default.createElement(T.ButtonWrapper,null,M.default.createElement(T.HorizontalButton,{disabled:!0},M.default.createElement(n.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),M.default.createElement(n.Skeleton.Text,{size:"large",width:200}))),M.default.createElement(n.Box,{style:{marginTop:"var(--dig-spacing__dimension__12)"}},M.default.createElement(n.StylelessButton,{disabled:!0,className:T.baseButton,style:{height:"190px",width:"100%",padding:"var(--dig-spacing__dimension__16)"}},M.default.createElement(n.Box,{style:{display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start",rowGap:"var(--dig-spacing__dimension__16)"}},M.default.createElement(n.Skeleton.Text,{width:330,style:{margin:0}}),M.default.createElement(n.Skeleton.Text,{width:330,style:{margin:0}}),M.default.createElement(n.Skeleton.Text,{width:330,style:{margin:0}}))),M.default.createElement(n.Box,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"var(--dig-spacing__dimension__12)"}},M.default.createElement(n.Skeleton.Text,{size:"large",width:200}),M.default.createElement(n.Button,{variant:"primary",size:"medium",fullWidth:!1,disabled:!0},zt(e,!1)))))};En.displayName="LoadingScreen";const Sn=({objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:i,isConfidentialFolderBannerClosed:s})=>{var _;const d=o.useIntl(),c=ma(),g=M.useRef(null),u=M.useRef(null),m=l.usePlatform()===l.Platforms.METASERVER,{shouldStyleForSM21:p,initialInput:f,onInitialInputUsed:h,onConfidentialFolderBannerClose:v}=l.useAtom(c.$props),y=l.useAtom(c.$isInviteSending),E=l.useAtom(c.$inviteTargets),S=l.useAtom(c.$isConfidentialFolder),w=l.useAtom(c.$isInviteMessageTooLong);M.useEffect((()=>{f&&h&&h()}),[f,h]);const b=Ka(e),A=Qa(e,a),T=(()=>{const e=ma();return M.useCallback((t=>{e.$changeConfidentialityData.set({teamName:t})}),[e.$changeConfidentialityData])})(),R=null!==(_=n.getOwnerTeamName(e))&&void 0!==_?_:"",k=l.useAtom(c.$isSuggestionsOpen),N=E.length>0,{shouldTransitionAccessoryAreaEnter:C}=l.useAtom(c.$props),[L,x]=M.useState(!1),[O,D]=M.useState(C),{onStartInband:$}=l.useAtom(c.$props),F=l.useAtom(c.$componentViewTime),P=M.useRef(!1),H=Ya();M.useEffect((()=>{if(!P.current&&F>0){P.current=!0;const e=Date.now()-F;$&&$(),H.select($a).emit({timeSinceView:e})}}),[F,H,$]);const U=M.useCallback((()=>{D(!1)}),[D]);return M.createElement("div",{className:n.cx(mi,{[pi]:C}),onAnimationEnd:U},M.createElement("div",{id:"shareme24-ib-action-container",style:{width:"100%"},"data-testid":"ib-action-area",role:"region"},M.createElement(n.Box,{className:"banner-group",marginBottom:S?"Micro Small":"0"},!s&&S?M.createElement(kt,{teamName:R,parentFolderName:n.getParentFolderName(e),isRestoreAccessEnabled:n.getCanDoAction(e,n.UPDATE_CONFIDENTIALITY_TAG),onRestoreAccessClick:T,onBannerClose:v}):null,M.createElement(ii,{objectMetadata:e})),M.createElement(n.Box,{flexDirection:"column",className:p?n.cx(Ai,{[Ii]:L||k}):n.cx(fi,{[vi]:L||k}),backgroundColor:"Background Base",onClick:()=>{!(null==u?void 0:u.current)||N||k||u.current.focus()}},M.createElement(n.Box,{className:hi},M.createElement(n.Box,{ref:g,display:"flex",flexDirection:"row",style:{minHeight:"var(--dig-spacing__dimension__36)"},alignItems:"center"},M.createElement(n.Box,{className:n.cx(wi,{[Si]:p,[bi]:!p,[Ti]:y}),borderRadius:"Circular",display:"flex",alignItems:"center",justifyContent:"center"},M.createElement(n.UIIcon,{src:n.ShareLine,size:"medium"})),M.createElement(yn,{isActive:L||k,objectMetadata:e,accountMetadata:t,inbandInputAreaRef:g,inputRef:u,onFocusChange:x,isActionRowTransitionInProgress:O,initialQuery:f}))))),M.createElement("div",{className:yi},b&&M.createElement(ni,{message:b.message,variant:b.level}),w&&M.createElement(r.Banner,{type:"alert",withLeftIcon:M.createElement(n.UIIcon,{src:n.FailLine,"data-testid":"ib-message-above-limit-banner"})},M.createElement(r.Banner.Message,null,((e,t)=>e.formatMessage({id:"dH+HYp",defaultMessage:"Message must be under {limit} characters."},{limit:t}))(d,2e3))),M.createElement(ui,null),M.createElement(n.Box,{className:Ei},M.createElement(ya,null),y?(()=>{const e=jt(d);return M.createElement(n.Box,{display:"flex"},M.createElement(n.Box,{marginRight:"Micro XSmall"},M.createElement(n.Spinner,{size:"xsmall","aria-valuetext":null==e?void 0:e.toString(),monochromatic:!0,withTrack:!0})),M.createElement(n.Text,null,e))})():M.createElement(n.Button,{disabled:y||null!=b&&"error"===b.level||!N||w,style:{flexShrink:0,alignSelf:"center"},onClick:()=>{m?I.showOQModalOrContinue({beforeShowModal:()=>{i()},show:I.Show.EnforceRestrictionsOnly,action:"share_add_people",continueCallback:()=>A(),abortCallback:()=>{}}):A()},variant:"primary",size:"medium",fullWidth:!1,"data-uxa-log":"sharing-modal-footer-button-send-email","data-testid":"ib-share-send-email-button"},zt(d,y)))))};Sn.displayName="InbandShare";const wn=()=>{const e=ma(),t=l.useAtom(e.$props),{accountMetadataResult:a,objectMetadataResult:i,sharingPrefsResult:n,onCloseClick:o,isConfidentialFolderBannerClosed:r}=t,s=i.isLoading,_=!i.isLoading&&!i.isError,d=a.isLoading,c=!a.isLoading&&!a.isError,g=n.isLoading,u=!n.isLoading&&!n.isError,m=_&&c&&u;return s||d||g?M.createElement(En,null):m?M.createElement(An,{objectMetadata:i.output,accountMetadata:a.output,sharingPrefs:n.output,onCloseClick:o,isConfidentialFolderBannerClosed:r}):null};wn.displayName="InbandWithStore";const bn=e=>M.createElement(pa,{...e},M.createElement(wn,null));bn.displayName="Inband";const An=({objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:i,isConfidentialFolderBannerClosed:n})=>{const o=ma(),r=l.useAtom(o.$inviteTargets),_=l.useAtom(o.$sharingAccessLevel);return wa(e),M.useEffect((()=>{o.$componentViewTime.set(Date.now())}),[o]),M.createElement(s.AbuseFpjsProvider,{loadingComponent:M.createElement(En,null)},M.createElement(l.MetadataProvider,{sharingInviteTargets:r,sharingAccessLevel:_},M.createElement(Sn,{objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:i,isConfidentialFolderBannerClosed:n})))};An.displayName="InbandInner",t.Context=It,t.EDITOR=Rt,t.Inband=bn,t.LoadingScreen=En,t.PAP_Select_FlexibleSharingEntrypointAction=Mt,t.SharingSettingsUtil=e=>({getLinkPolicy:e=>({link_password:k(e.link_permissions)?void 0:"",expires:e.expires,allow_download:e.link_permissions.allow_download,audience:C(e.link_permissions),require_password:e.link_permissions.require_password}),getModifiedSettings:(t,a,i)=>{if(a===i)return;const n={},o=null!=t.expires&&null==a.expires;if(a.audience!==i.audience&&(n.audience=a.audience),a.allow_download!==i.allow_download&&(n.allow_download=a.allow_download),a.expires&&t.link_permissions.can_set_expiry&&(n.expires=a.expires.toISOString().split(".")[0]+"Z"),a.require_password!==i.require_password&&(n.require_password=a.require_password),"password"===a.audience||a.require_password)if(a.link_password)n.require_password=!0,n.link_password=a.link_password;else if(""===a.link_password)return{error:e.formatMessage({id:"wFrAfD",defaultMessage:"Password can’t be empty"})};return Object.keys(n).length<=0&&!o?void 0:{url:t.url,settings:n,remove_expiration:o}}}),t.VIEWER=Tt,t.canCreateLink=function(e,t,a,i,n,o,r,s,l,_,d,c){switch(e){case"editor":return a?o&&P(i,c)&&!n:P(i,c)&&l;case"viewer":return!("writer"===_&&!d)&&(t?s:P(i,c)&&s||r);default:return!1}},t.canCreateLinksForFolder=P,t.canModifyExpire=function(e){const t=e.link_permissions;return Boolean(t.can_set_expiry)},t.canModifyPassword=function(e){return Boolean(e&&e.can_set_password)||N(e)},t.canToggleExpire=function(e){const t=e.link_permissions;return Boolean(null!=e.expires?t.can_remove_expiry:t.can_set_expiry)},t.canTogglePassword=function(e){return Boolean(e&&e.require_password?e.can_remove_password:e.can_set_password)||N(e)},t.convertContactToInviteTarget=e=>e.type===n.ContactTypes.EMAIL?e.name&&e.name.length?{".tag":"user",dbx_team_id:e.dbx_team_id||"",...void 0!==e.photo_url?{photo_url:e.photo_url}:{},name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}:j(e.email||""):e.type===n.ContactTypes.NEW_STYLE_GROUP?{".tag":"group",dbx_team_id:e.dbx_team_id||"",members:e.members||"",name:e.name,sort_key:e.name,group_id:e.group_id||"",group_size:e.group_size||0}:e.type===n.ContactTypes.DBX_ID?{".tag":"user",dbx_team_id:e.dbx_team_id||"",...void 0!==e.photo_url?{photo_url:e.photo_url}:{},name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}:j(""),t.convertContentInfoToObjectIdentifier=e=>{var t,a,i,n;return e.isSharedFolder()?{".tag":"shared_folder",sharedFolderId:String(e.sharedFolderId()),fileId:null!==(t=e.fileId())&&void 0!==t?t:""}:e.isFileFolder()?{".tag":"file_folder",name:e.name(),path:null!==(a=e.displayPath())&&void 0!==a?a:"",fileId:null!==(i=e.fileId())&&void 0!==i?i:""}:{".tag":"file",fileId:null!==(n=e.fileId())&&void 0!==n?n:""}},t.convertInviteTargetToContact=et,t.convertLinkAccessLevelToSdkLinkAccessLevel=it,t.convertLinksMetadataToSdkLinksMetadata=e=>{if(void 0===e)throw new Error("Adapt error");const t=[];for(const s of e)t.push((i=void 0,o=void 0,r=void 0,{".tag":(a=s).file_type,url:a.url,id:a.id,name:a.name,expires:n.convertExpirationDateToString(a.expires),path_lower:a.path_lower,link_permissions:(o=a.link_permissions,{resolved_visibility:o.resolved_visibility?(r=o.resolved_visibility,"public"===r?Y:"team_only"===r?Z:"password"===r?K:"team_and_password"===r?Q:"shared_folder_only"===r?X:"no_one"===r?J:"only_you"===r?ee:n.exhausts(r,te)):void 0,requested_visibility:o.requested_visibility?nt(o.requested_visibility):void 0,can_revoke:o.can_revoke,visibility_policies:[],can_set_expiry:o.can_set_expiry,can_remove_expiry:o.can_remove_expiry,allow_download:o.allow_download,can_allow_download:o.can_allow_download,can_disallow_download:o.can_disallow_download,restricting_shared_folder_path:o.restricting_shared_folder_path,allow_comments:o.allow_comments,team_restricts_comments:o.team_restricts_comments,effective_audience:o.effective_audience?ot(o.effective_audience):void 0,audience_options:yt(o.audience_options),link_access_level:it(o.link_access_level),can_set_password:o.can_set_password,can_remove_password:o.can_remove_password,require_password:o.require_password,can_use_extended_sharing_controls:o.can_use_extended_sharing_controls,days_to_expire_policy:Et(o.days_to_expire_policy),change_shared_link_expiration_policy:St(o.change_shared_link_expiration_policy),enforce_shared_link_password_policy:wt(o.enforce_shared_link_password_policy)}),team_member_info:a.team_member_info?(i=a.team_member_info,{team_info:bt(i.team_info),display_name:i.display_name,member_id:i.member_id}):void 0,content_owner_team_info:a.content_owner_team_info?bt(a.content_owner_team_info):void 0,preview_type:a.preview_type}));var a,i,o,r;return{links:t,has_more:!1}},t.convertSharingInfoToSdkAccountMetadata=e=>{const t=e.user();return{user_id:t.id,email:t.email,account_id:t.account_id,root_info:{".tag":"user",root_namespace_id:"ns_id",home_namespace_id:"ns_id"},is_paid:!!t.paid,role:t.role,is_family_user:!0===e.isFamilyUser(),is_team_member:!!t.is_team,team_policies:_t(e.teamPolicy()),team_id:t.team_dbtid,is_team_admin:t.is_team_admin,team_name:t.team_name,can_use_extended_sharing_controls:!0===e.canUseExtendedSharingControls(),is_tmr_member:t.is_tmr_member,is_paired:!0===e.isPaired()}},t.convertSharingInfoToSdkInviteTargetValidation=(e,t)=>{const a=t.recipientAccess(),i=t.recipientValidation()[a]||{},n=e.map(et).map((e=>e.getKey())),o=e.map(z),r=o.reduce(((e,t,a)=>({[t]:i[n[a]],...e})),{});return o.reduce(((e,t)=>{const a=r[t];if(!a)return e;const i={member:{".tag":"other"},result:tt(a),target_invite_eligibility:{".tag":"other"}};return{...e,[t]:i}}),{})},t.convertSharingInfoToSdkObjectMetadata=e=>lt(e.metadata(),!0===e.contentInfo().isFolderInsideTeamFolderTree(),!0===e.contentInfo().isTeamSharedFolder()),t.convertSharingInfoToSdkSharingPrefs=e=>{const t=e.sharingPrefs();if(void 0===t)throw new Error("Adapt error");return{invite_after_sharing_modal_variant:At(t.invite_after_sharing_modal_variant),has_seen_esign_post_sharing:t.has_seen_esign_post_sharing,is_in_esign_post_sharing_exclusion_period:t.is_in_esign_post_sharing_exclusion_period,bsx_organize_around_people:t.bsx_organize_around_people,is_showing_file_upload_toolkit_campaign:t.is_showing_file_upload_toolkit_campaign,default_sharing_access_level_setting:t.default_sharing_access_level_setting,default_sharing_link_audience_setting:t.default_sharing_link_audience_setting,last_seen_team_policy_audience:t.last_seen_team_policy_audience,core_act_docsend_advanced_sharing:t.core_act_docsend_advanced_sharing,create_view_folder_link_enabled:t.create_view_folder_link_enabled,num_available_licenses:t.num_available_licenses}},t.convertSharingInfoToSdkUser=e=>{const t=e.user();return{id:t.id,email:t.email,is_team:!!t.is_team,is_team_admin:t.is_team_admin,account_id:t.account_id,team_dbtid:t.team_dbtid,is_tmr_member:t.is_tmr_member}},t.createFromEmail=j,t.createSdkObjectMetadata=lt,t.daysAfterToday=e=>{const t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),((e,t,a,i,n,o)=>(null==t&&(t=0),null==a&&(a=0),null==i&&(i=0),null==n&&(n=0),null==o&&(o=0),e.setFullYear(e.getFullYear()+t),e.setMonth(e.getMonth()+a),e.setDate(e.getDate()+i),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+o),e))(t,0,0,e)},t.daysExpirationPolicyToNumber=L,t.formatSubTitle=q,t.getAudienceForLink=C,t.getAvatarUrl=G,t.getDoesServiceHavePermissionGranted=Mi,t.getInviteAfterSharingUsers=U,t.getIsServiceConnected=Ri,t.getLinkControlPolicyWarningText=function(e,t,a,i){let n="";if(F(e,a)){const e=$(a),t=D(a);n=i.formatMessage({id:"GoACO+",defaultMessage:"Your admin requires {requirements, select, 0 {an expiration and a password} 1 {a password} 2 {an expiration} other{}} for links shared outside the team. To change the link setting, delete the link and create it again."},{requirements:e&&t?0:t?1:2})}else t.display_expiration_warning?n=i.formatMessage({id:"ySRXj8",defaultMessage:"Your admin {show_password_text, select, true {requires a password and } other {}}has set an expiration for all links shared outside the team. This link will expire in {days_to_expire, plural, =365 {1 year} one {# day} other {# days}}.{expiration_enforced, select, true { You can change or remove this expiration.} other {}}"},{days_to_expire:L[a.days_to_expire_policy],expiration_enforced:"allowed"===a.change_shared_link_expiration_policy,show_password_text:!!t.display_password_warning}):t.display_password_warning&&(n=i.formatMessage({id:"lcVbzE",defaultMessage:"Your admin requires to set a password for links shared outside the team."}));return n},t.getUniqueId=z,t.hasLinkPassword=k,t.invalidateSharingPrefs=async function(){return n.sharingPrefsPackage.invalidateQueries(c.queryClient)},t.isExpirationPolicyEnforcedByAdmin=$,t.isExpirationPolicySetByAdmin=O,t.isExternalAudience=x,t.isMemberInviteModal=V,t.isPasswordPolicyEnforcedByAdmin=D,t.isReadOnlyPolicy=F,t.listLinkedServices=ki,t.shouldShowModalVariant=B,t.targetsSearch=Ci,t.useSharingPrefs=_a}));
//# sourceMappingURL=c_inband-screen_internals_share-modal-share.js-vfl3TxVnt.map

//# debugId=aef11fd5-079d-3b67-b33e-443169821217