!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9b9c76e6-5204-3747-b516-875337c66e94")}catch(e){}}();
define(["exports","react","./e_ui_page_files_router","./c_lib_logging","./c_core_i18n","./c_file_transfers_lib_urls","./c_file_transfers_lib_utils","./c_sharing_async_share_modal_util","./e_data_modules_stormcrow","./e_edison","./c_pap-events_replay_shown_modal","./c_bem","./c_action_bar_action_bar_constants","./c_src_sink_index","./c_sharing_common_utils","./c_internals_content-manager-integration_async-show-access-management","./c_common_logging-contexts_desktop-platform-logging-metadata","./c_inband-screen_internals_share-modal-share","./c_stacks_lib_api","./c_src_utils_initials","./c_src_bindings_provider","./c_shareme24_browse_integration_async-show-shareme24","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_pap-events_folder_modal_select_create_folder_modal_create_button","./c_domain_restriction_utils_date_formatting","./c_continuous_onboarding_milestone_api","react-dom","./e_core_exception","./c_ncct_manual_assist_util","./c_core_notify","./c__rollupPluginBabelHelpers","./c_lodash-es_lodash","./c_memoize-one","react/jsx-runtime","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_chat_chat_constants","metaserver/static/js/langpack","./c_fileops_downloads","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_quota_use_query_quota_upsell_info","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_over-quota_utils_use_get_plans","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-components_label_group_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","./c_dig-components_banner_index","./c_dig-icons_pictogram_icon","./c_dig-icons_assets_ui-icon_line_minus","./c_growth-components_over-quota-file-viewer-modal","./c_dig-content-icons_icons_file-generic-large","./c_quota_utils","./c_ui_async_overquota_modal_controller","./c_pap-events_share_copy_shared_link","./c_over-quota_utils_oq_price_decrease_helper","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger","./c_over-quota_utils_logger","./c_pap-events_pdf_edit_select_replace_original_confirmation","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_fingerprintjs_fpjs-pro-static_fp","./c_sharing_settings_utils_link_metadata_types","./c_react_query_api_helpers_queries_seen_state_info","./c_src_bindings_api-context","./c_sharing_ui_util","./c_icon_icon_helper","./c_domain_restriction_hooks_use_domain_restriction","./c_sharing_sharing_pap_logging_common_util","./c_sharing_sharing_pap_logging_send_share_invite_util","./c_dig-components_typeahead_index","./c_flux_action_type","./c_common_components_buttons","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_dig-icons_assets_ui-icon_line_table","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_over-quota_over-quota-sweep-blocking-modal_use_over_quota_sweep_blocking_modal","./c_file_viewer_components_preview","./c_file_viewer_api_ui","./c_file_viewer_hooks_lifecycle_logging","./c_file_viewer_hooks_usePrevious","./c_file_viewer_utils_auto_open","./c_file_viewer_api_navigation","./c_file_viewer_hooks_logging","./c_core_utils_region","./c_file_viewer_keyboard_keyboard_connector","./c_core_utils_browser_detection","./c_file_viewer_api_data","./c_file_viewer_hooks_useExtractedText","./c_file_viewer_loading_indicator","./c_file_viewer_logging_timing","./c_web-vitals","./c_file_viewer_preview_archive_utils","./c_file_viewer_toolbar_utils","./c_dig-icons_assets_ui-icon_line_text-box","./c_dig-icons_assets_ui-icon_line_slides","./c_dig-icons_assets_ui-icon_line_quota-reached","./c_dig-icons_assets_ui-icon_line_show","./c_dig-icons_assets_ui-icon_line_passwords","./c_file_viewer_preview_text","./c_ui_contextual-nudge_atoms","./c_src_common_format_bytes","./c_common_components_layout","./c_react-hookz_web_useIntersectionObserver","./c_sharing_sharing_banned_modal","./c_content-member-list_internals_content-member-list","./c_pass_pass_helpers","./c_flux_base_store","./c_flux_dispatcher","./c_dig-illustrations_spot_bowl-empty","./c_dig-components_metadata_index","./c_dig-icons_assets_ui-icon_line_external-member","./c_extensions_data_selectors","./c_settings-page_internals_settings-page-wrapper","./c_dig-components_tabs_index","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_datepicker-react_hooks_index","./c_date-fns_toDate_index","./c_dig-icons_assets_ui-icon_line_encrypted","./c_sharing_sharing_pap_logging_copy_shared_link_util","./c_sharing_sharing_pap_logging_shared_link_util","./c_sharing_ui_notifications_util","./c_pap-events_duplicate_files_open_duplicate_files_page","./c_dig-icons_assets_ui-icon_line_video","./c_dig-icons_assets_ui-icon_line_link","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_rotate-right","./c_shared-link-attribution-tracking_components_sender_trackey_vendor","./c_ui_modal_dig","./c_gen_api_auth_WebAuthWeb","./c_auth_webauthn"],(function(e,t,i,a,n,o,s,r,_,c,l,d,u,g,p,m,f,h,v,b,y,E,w,S,k,x,M,C,I,O,T,A,L,$,q,P,D,F,R,N,V,j,H,U,W,B,z,Q,G,Y,K,Z,X,J,ee,te,ie,ae,ne,oe,se,re,_e,ce,le,de,ue,ge,pe,me,fe,he,ve,be,ye,Ee,we,Se,ke,xe,Me,Ce,Ie,Oe,Te,Ae,Le,$e,qe,Pe,De,Fe,Re,Ne,Ve,je,He,Ue,We,Be,ze,Qe,Ge,Ye,Ke,Ze,Xe,Je,et,tt,it,at,nt,ot,st,rt,_t,ct,lt,dt,ut,gt,pt,mt,ft,ht,vt,bt,yt,Et,wt,St,kt,xt,Mt,Ct,It,Ot,Tt,At){"use strict";function Lt(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var $t=Lt(t);const qt=(e,t=!0)=>{t?b.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):b.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},Pt=({children:e,onFallback:t,onRequestClose:a})=>{const o=w.useData(),s=$t.useRef(!1),r=(()=>{const e=n.useIntl();return $t.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return b.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return b.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return b.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return qt(e),!0;default:return i.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return qt(e),!0;default:return!1}}),[e])})();return $t.useEffect((()=>{if("error"===o.status&&!s.current){s.current=!0;r(o)?a():t()}}),[o,t,a,r]),$t.createElement($t.Fragment,null,e)};Pt.displayName="DataLoadingErrorWrapper";const Dt=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ft,defaultEmitter:Rt}=a.defineLogger((async({event:e,getContextValue:t})=>{const a=t(f.Context),n=t(f.Context$1),o=t(f.Context$2),s=t(f.Context$3),r={...f.getTags(a),...f.getTags$1(n),...f.getTags$2(o),...f.getTags$3(s),isSm24:"true"},_={...f.getProperties(a),...f.getProperties$1(n),...f.getProperties$2(o),...f.getProperties$3(s)};e.key===Dt&&(i.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:r}),i.UDCL.logEnd(x.PAP_Load_ShareModal({eventState:"canceled",..._}),{eventState:"canceled",key:e.payload.sessionId,tags:r}),i.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:r}))})),Nt=({children:e,sessionId:t,onRequestClose:a})=>{var n,o;const s=Ft(),{viewer:r,isLoading:_}=i.useViewer(),c=!_&&!1===(null===(n=r.active_user)||void 0===n?void 0:n.is_email_verified);return $t.default.useEffect((()=>{c&&s.select(Dt).emit({sessionId:t})}),[c,t,s]),c?$t.default.createElement(S.VerifyEmailModal,{viewer:r,user:r.active_user,reason:k.EmailVerificationReasons.SHMODAL,email:null===(o=r.active_user)||void 0===o?void 0:o.email,onShowChange:()=>{r.active_user&&S.ChangeEmail.show(r,r.active_user,k.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{S.EmailVerification.get_for_user(r,r.active_user).email_sent(void 0,k.EmailVerificationReasons.SHMODAL,!0),a()},onCancel:a}):$t.default.createElement($t.default.Fragment,null,e)};Nt.displayName="EmailVerificationWrapper";const Vt=e=>{var t;const i=(e=>y.useInitStore(e,(e=>{const t=y.proxy((()=>e.get().user)),i=y.proxy((()=>e.get().shareModalExtras)),a=y.proxy((()=>{var t;return null===(t=e.get().shareModalExtras)||void 0===t?void 0:t.origin})),n=y.proxy((()=>e.get().actionSurface)),o=y.proxy((()=>e.get().actionElement)),s=y.proxy((()=>e.get().progressiveInbandVariant)),r=y.store(Date.now()),_=y.store(void 0),c=y.store(e.get().isOpen),l=y.proxy((()=>e.get().sessionId)),d=y.proxy((()=>e.get().displayType)),u=y.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),g=y.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$user:t,$shareModalExtras:i,$isOpen:c,$origin:a,$actionSurface:n,$actionElement:o,$progressiveInbandVariant:s,$openFlexibleEntryPointTimestamp:r,$dwellFlexibleEntryPointActionTimestamp:_,$sessionId:l,$displayType:d,$anchorRef:u,$overlayPlacement:g,$props:e}})))(e);return $t.createElement($t.Fragment,null,$t.createElement(y.SharingSdkProvider,{userApiProps:e.user,origin:null===(t=e.shareModalExtras)||void 0===t?void 0:t.origin,actionInfo:{actionSurface:e.actionSurface}},$t.createElement(jt,{store:i})))};Vt.displayName="ShareMe24Browse";const jt=({store:e})=>{var t,c,l;const{user:d,fileOrFolder:u,actionSurface:g,actionElement:S,onActionClicked:k}=e.$props.get(),[x,I]=$t.useState(p.getObjectIdentifier(u)),O=i.getFilename(u),T=u.is_dir,A=y.useStore(e.$origin),L=y.useStore(e.$sessionId),$=y.useStore(e.$isOpen),q=y.useStore(e.$anchorRef),P=y.useStore(e.$overlayPlacement),D=y.useStore(e.$displayType),F=_.useQueryClient();T&&((e,t)=>{i.listFolderPackage.prefetchQuery(e,{apiArg:{path:t,limit:v.STACK_SIZE_LIMIT}})})(F,u.file_id);const{variant:R}=i.useExperimentVariant("sharing_lego_settings_page"),N="V1"===R;i.useLogExposureOnce("sharing_lego_settings_page");const V=(e=>$t.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),j=(e=>$t.default.useCallback((()=>{var t,i;null===(i=(t=e.$props.get()).onInbandShareCompleted)||void 0===i||i.call(t),e.$isOpen.set(!1)}),[e]))(e),H=$t.useCallback((async e=>{C.markMilestoneAsCompleted(e,M.ActivationTileMilestoneId.SHARE_CONTENT)}),[]);$t.useEffect((()=>{(async()=>{if(!x.fileId||""===x.fileId){const e=await b.fetchLegacySharingObjectMetadataObjectIdentifier(x);I(e)}})()}),[x]);const U=$t.useMemo((()=>u.is_dir?u.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:O,size:u.bytes}),[O,u]),W=$t.useMemo((()=>({actionSurface:g,actionElement:S,contentAction:"share",tiburonOrigin:A,screen:"share_screen",shareModalType:"sm24"})),[g,S,A]),B=y.useStore(e.$progressiveInbandVariant),z=y.useStore(e.$props).onFallback,{data:Q,isLoading:G}=i.useSharingPrefs(),Y=null!==(t=null==Q?void 0:Q.apiData.is_file_transfer_enabled)&&void 0!==t&&t,K=T?s.folderEligibleForTransfer(u):!u.is_cloud_doc,Z=d.is_team_admin,X=G,J=!!(null===(l=null===(c=i.useDashAccess().data)||void 0===c?void 0:c.apiData.feature_attributes)||void 0===l?void 0:l.has_stacks_in_fss);let ee=null,te=$t.useMemo((()=>T?null:[{file_id:u.file_id,fq_path:u.fq_path}]),[T,u]);const ie=((e,t=!1)=>{const a=i.listFolderPackage.useQuery({apiArg:{path:e,limit:v.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return $t.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const i=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;i.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:i}}}),[a])})(u.file_id,T);ie.isLoading||(ie.isError?ee="too_many_contents"===ie.error[".tag"]:(te=ie.output,ee=!1));const ae=E.useShowCopyLinkMiniModalCallback(),ne=$t.useMemo((()=>"centered"===D?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:q,displayModePositioning:P}),[D,q,P]),oe=$t.useCallback((()=>{var t;const{actionSurface:i,actionElement:a,user:n,shareModalExtras:o,...s}=e.$props.get();"anchored"===s.displayType&&(null===(t=s.onHoverLocked)||void 0===t||t.call(s,{isOpen:!0}));let r=()=>{};const _=new Promise((e=>{r=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":_});navigator.clipboard.write([e])}else _.then((e=>navigator.clipboard.writeText(e)));const c={write:e=>r(e)},l="undefined"!=typeof window&&window.innerWidth<=800?"bottom":P;H(n);const d="anchored"===s.displayType?{isCenteredDisplayed:!1,anchorRef:s.anchorRef,placement:l,yOffsetDistance:5,onHoverLocked:s.onHoverLocked}:{isCenteredDisplayed:!0};ae.fn({user:n,filePath:u.file_id,setIsCreatingSharedLink:()=>{},browseFile:u,zIndexOverride:500,actionSurface:i,actionElement:a,origin:null==o?void 0:o.origin,isFromShareMe24Modal:!0,clipboardWriter:c,withLockedStateModal:!1,userActionSource:null==o?void 0:o.userActionSource,...d})}),[e.$props,P,ae,H,u]),se=$t.useCallback((()=>{const e=`sm24_${g}_${S}`,t=[u];o.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>s.redirectToCreateTransferWithFiles(t,e),userId:d.id})}),[S,g,u,d.id]),re=(e=>$t.useCallback((t=>{const a=e.$props.get(),n=a.user,o=a.fileOrFolder,s={...a.shareModalExtras,initialScreen:i.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};r.asyncShowShareModal(n,o,s)}),[e]))(e),_e=(e=>{const t=i.useExperimentVariant("sharing_access_management_entry_point_expansion"),a=t.isLoading?"OFF":t.variant;return $t.useCallback((()=>{const t=e.$props.get(),n=t.user,o=t.fileOrFolder,s={...t.shareModalExtras,initialScreen:i.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};a&&a!==i.Variant.OFF&&i.logExposure({feature:"sharing_access_management_entry_point_expansion",variant:a}),"ON"===a?m.asyncShowAccessManagementBrowse({fileOrFolder:o,user:n,actionSurface:"browse_integration_manage_permissions",actionElement:"access_management",sessionId:Math.random().toString(),onFallback:()=>{r.asyncShowShareModal(n,o,s)}}):r.asyncShowShareModal(n,o,s)}),[e,a])})(e),ce=$t.useCallback((async()=>{if(!te)return;const{actionSurface:t}=e.$props.get(),a=Ut(t),o=T?O:void 0;v.asyncAddToStack(n.intl,F,i.CompatNavigate.navigate,te,a,o)}),[te,O,T,F,e.$props]);return $t.createElement("div",null,$t.createElement(Nt,{sessionId:L,onRequestClose:V},$t.createElement(y.MetadataProvider,{sharingObjectIdentifier:x,shareModalSessionId:L},$t.createElement(a.ContextProvider,{context:h.Context,value:L},$t.createElement(a.ContextProvider,{context:f.Context,value:W},$t.createElement(a.ContextProvider,{context:f.Context$1,value:U},$t.createElement(w.Provider,{objectIdentifier:x,sessionId:L,objMetadataNewApiVariant:"OFF"},$t.createElement(Ht,{sessionId:L,actionElement:S,actionSurface:g,isDir:T},$t.createElement(Pt,{onFallback:z,onRequestClose:V},$t.createElement(w.Main,{...ne,isOpen:$,onRequestClose:V,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:oe,transferMode:"controlled_v1",transferHandler:se,settingsMode:N?"integrated_v1":"controlled_v1",settingsHandler:re,manageAccessHandler:_e,objectIdentifier:x,isEncrypted:u.is_encrypted,fileName:O,fileSize:u.bytes,filePath:u.fq_path,progressiveInbandVariant:B,canUserUseTransfer:Y,canContentUseTransfer:K,canUserEnableTransfer:Z,isTransferEligibilityLoading:X,referrerLoggingMetadata:W,objectLoggingMetadata:U,onActionClicked:k,onInbandShareCompleted:j,canUserCreateStack:J,isFolderFileCountOverLimit:ee,contents:te,createStackHandler:ce,onObjectIdentifierChanged:()=>Promise.resolve()}))))))))))};jt.displayName="ShareMe24BrowseInternals";const Ht=({children:e,sessionId:t,actionElement:i,actionSurface:a,isDir:n})=>{const o=w.useData(),s=$t.useRef(!1);return $t.useEffect((()=>{if(!s.current)return"error"===o.status?(s.current=!0,void E.defaultEmitter.select(E.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:t,actionElement:i,actionSurface:a,isDir:n})):"loaded"===o.status?(s.current=!0,void E.defaultEmitter.select(E.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:t,actionElement:i,actionSurface:a,isDir:n,isSharingBanned:o.accountMetadata.is_sharing_banned})):void 0}),[o.status,t,i,a,n]),$t.useEffect((()=>()=>{s.current||(s.current=!0,E.defaultEmitter.select(E.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:t,actionElement:i,actionSurface:a,isDir:n}))}),[]),$t.createElement($t.Fragment,null,e)};Ht.displayName="DataLoadingLogger";const Ut=e=>{switch(e){case"previews":return"previews";case"search":return"search_results_page";case"quick-view-search":return"search_quick_view";case"browse_screen":return"browse_screen";case"quick-view-browse":return"browse_quick_view";default:return`unknown_${e}`}};e.ShareMe24Browse=Vt}));
//# sourceMappingURL=c_shareme24_browse_integration_index.after-display.js-vflRYu0U-.map

//# debugId=9b9c76e6-5204-3747-b516-875337c66e94