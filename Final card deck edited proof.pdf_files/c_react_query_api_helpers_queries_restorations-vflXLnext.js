!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a94663c8-7900-3397-a9f1-1a7e1d71faca")}catch(e){}}();
define(["exports","react","./e_ui_page_files_router","./e_core_exception","./e_data_modules_stormcrow"],(function(e,t,a,s,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=n(t);function o(e){return e.ns("deleted_files")}const u=e=>Math.floor(e.getTime()/1e3);var d;function l(t){const a=new Date,r=new Date(a),n=t;switch(t){case e.DateOptions.last24Hours:r.setHours(r.getHours()-24);break;case e.DateOptions.last7Days:r.setDate(r.getDate()-7);break;case e.DateOptions.last30Days:r.setDate(r.getDate()-30);break;case e.DateOptions.last12Months:r.setMonth(r.getMonth()-12);break;case e.DateOptions.customRange:default:const a=new Error(`Not supported option: ${t}`);throw s.reportException({err:a,tags:["trash","predefined_date_range"],severity:s.SEVERITY.CRITICAL,exc_extra:{option:t}}),a}return r.setSeconds(0),r.setMilliseconds(0),a.setSeconds(0),a.setMilliseconds(0),{startDate:r,endDate:a,dateRange:n}}e.DateOptions=void 0,(d=e.DateOptions||(e.DateOptions={})).last24Hours="24h",d.last7Days="7d",d.last30Days="30d",d.last12Months="12m",d.customRange="customRange";const c=(e,t,a)=>{const s=new Date;e&&(s.setFullYear(e.getFullYear()),s.setMonth(e.getMonth()),s.setDate(e.getDate()));const[r,n]=t.split(":");return s.setHours(+r),s.setMinutes(+n),s.setSeconds(a?59:0),s.setMilliseconds(0),s},g=(e,t)=>{const a=new Date;return a.setFullYear(e.getFullYear()),a.setMonth(e.getMonth()),a.setDate(e.getDate()),a.setHours(t?23:0),a.setMinutes(t?59:0),a.setSeconds(t?59:0),a.setMilliseconds(0),a};function f({startDate:e,endDate:t,startTime:a,endTime:s}){let r,n;return""!==a&&""!==s?(r=c(e,a,!1),n=c(t,s,!0)):(r=g(e,!1),n=g(t,!0)),[r,n]}const m=/^(2[0-3]|[0-1][\d]):[0-5][\d]$/,p=()=>{const e=l(v);return{minTs:u(e.startDate),maxTs:void 0,dateRange:e.dateRange}},D="na",v=e.DateOptions.last30Days,_=i.default.createContext(void 0);function h(){const e=i.default.useContext(_);if(void 0===e){const e=new Error("useRestorationsContext must be used within a RestorationsContextProvider");throw s.reportException({err:e,tags:["trash","restorations_context_missing"],severity:s.SEVERITY.CRITICAL}),e}return e}const T="list_restores",R=e=>{var t,a,s;const r=new Set,n=[];for(const i of e){const e=null!==(t=i.namespace_id)&&void 0!==t?t:0,o=null!==(s=null===(a=i.actioned_items)||void 0===a?void 0:a.map((e=>{var t;return null!==(t=e.changeset_id)&&void 0!==t?t:0})))&&void 0!==s?s:[],u=`${e}:${[...o].sort(((e,t)=>e-t)).join(",")}`;r.has(u)||(r.add(u),n.push(i))}return n},y=a.createApiv2InfiniteQuery({nsClient:o,rpc:T,continueRpc:T,getQueryKey:a.getApiv2QueryKey(o,T),optionsFn:e=>({getNextPageParam:(e,t)=>{const{has_more:a=!1,cursor:s=""}=e.apiData||{};return a?{continueArg:{apiArg:{cursor:s}}}:null},...e})}),x=(e,t="na")=>{const{isAdminViewAvailable:a,calendarFilterValue:s}=h(),{isFetching:r,isFetchingNextPage:n,isError:o,hasNextPage:u,fetchNextPage:d,data:{pages:l}={pages:[]},isLoading:c,refetch:g}=y.useInfiniteQuery({apiArg:{filter:{status_codes:[{".tag":t}],start_time:null==s?void 0:s.minTs,end_time:null==s?void 0:s.maxTs},limit:25,include_team:a}},{enabled:e,staleTime:0});return{isLoading:c,isError:o,isFetchingNextPage:n,hasNextPage:u,isFetching:r,fetchNextPage:d,data:i.default.useMemo((()=>{const e=l.flatMap((e=>{var t;return(null===(t=e.apiData)||void 0===t?void 0:t.restores)||[]}));return R(e)}),[l]),refetch:g}};e.GetDeletedFilesRoutes=o,e.RestorationsContextProvider=function({children:e,isAdminViewAvailable:t,isTabActiveByDefault:a=!1}){const[s,r]=i.default.useState(a),[n,o]=i.default.useState(D),[u,d]=i.default.useState(null),[l,c]=i.default.useState((()=>p())),g=i.default.useCallback((()=>{o(D),d(null),c(p())}),[]),f=i.default.useMemo((()=>({isAdminViewAvailable:t,isTabActive:s,setIsTabActive:r,setStatusFilterValue:o,statusFilterValue:n,actorFilterValue:u,setActorFilterValue:d,calendarFilterValue:l,setCalendarFilterValue:c,clearFilters:g})),[s,t,n,u,l,g]);return i.default.createElement(_.Provider,{value:f},e)},e.STATUS_FILTER_DEFAULT_VALUE=D,e.buildDate=g,e.constructDateRange=f,e.deduplicateRestorations=R,e.getFormErrors=({startDate:e,endDate:t,startTime:a,endTime:s,renderTimePicker:r})=>{const n=[],i=m.test(a),o=m.test(s);return!i&&r&&n.push({id:"invalid-start-time",fields:["start_time"]}),!o&&r&&n.push({id:"invalid-end-time",fields:["end_time"]}),i&&o&&(({startDate:e,endDate:t,startTime:a,endTime:s})=>{const[r,n]=f({startDate:e,endDate:t,startTime:a,endTime:s});return n<r})({startDate:e,endDate:t,startTime:a,endTime:s})&&n.push({id:"invalid-range",fields:["start_date","end_date","start_time","end_time"]}),{getErrorProps:e=>{const t=n.filter((t=>t.fields.includes(e))),a=t.length>0;return{isInvalid:a,"aria-describedby":a?t.map((e=>e.id)).join(" "):void 0}},errors:n.map((({id:e})=>e))}},e.getFormattedRange=function(e,t,s){return a.format_date(e,s)+" â€“ "+a.format_date(t,s)},e.getPredefinedDateRange=l,e.getTime=function(e){return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},e.jsDateToUnixSeconds=u,e.lastSecondOfDay=e=>{const t=new Date(e.getTime());return t.setDate(t.getDate()+1),new Date(t.getTime()-1)},e.listRestoresRequestPackage=y,e.unixSecondToJsDate=e=>e?new Date(1e3*e):void 0,e.useRestorations=x,e.useRestorationsContext=h,e.useRestorationsProgress=e=>{const t=r.useQueryClient(),a=i.default.useMemo((()=>e.filter((e=>{var t;return"queued"===(null===(t=e.status_code)||void 0===t?void 0:t[".tag"])}))),[e]),s=i.default.useMemo((()=>e.filter((e=>{var t;return"in_progress"===(null===(t=e.status_code)||void 0===t?void 0:t[".tag"])}))),[e]),{refetch:n}=x(!1,"in_progress"),o=i.default.useCallback((async()=>{const e=await n();if(!e.data)return;const r=e.data.pages.flatMap((e=>e.apiData.restores||[])),i=new Set(r.map((e=>e.task_id)));let o=a.some((e=>i.has(e.task_id)));o||(o=a.length>0&&0===i.size||s.length!==i.size||s.some((e=>!i.has(e.task_id))));const u=y.queryRouteFilter,d=e=>{var t,a;return Boolean((null===(a=null===(t=e.queryKey[2].filter)||void 0===t?void 0:t.status_codes)||void 0===a?void 0:a.some((e=>"in_progress"!==e[".tag"])))&&"fetching"!==e.state.fetchStatus)};t.setQueriesData({queryKey:u,predicate:d},(e=>{if(e){const{pages:t,...a}=e;return{pages:t.map((({apiData:e,...t})=>({apiData:{...e,restores:e.restores.map((e=>i.has(e.task_id)&&r.find((t=>t.task_id===e.task_id))||e))},...t}))),...a}}return e})),o&&t.invalidateQueries({queryKey:u,predicate:d})}),[s,t,a,n]);i.default.useEffect((()=>{if(a.length+s.length>0){const e=setInterval(o,5e3);return()=>clearInterval(e)}}),[s,a,o])}}));
//# sourceMappingURL=c_react_query_api_helpers_queries_restorations.js-vflOqDVZY.map

//# debugId=a94663c8-7900-3397-a9f1-1a7e1d71faca