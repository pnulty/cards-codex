!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="78b4bfb9-ce5e-3d30-9c55-f226d59543ef")}catch(e){}}();
define(["require","exports","./e_ui_page_files_router","react","./c_core_i18n","./c_file_viewer_api_ui","./c_file_viewer_hooks_usePrevious","./c_file_viewer_utils_auto_open","./c_file_viewer_hooks_lifecycle_logging","./c_file_viewer_hooks_logging","./c_lodash-es_lodash","./c_action_bar_action_bar_constants","./c_file_viewer_keyboard_keyboard_connector","./e_data_modules_stormcrow","./c_file_viewer_api_data","./c_file_viewer_api_navigation","./c_file_viewer_loading_indicator","./c_file_viewer_logging_timing","./c_file_viewer_preview_archive_utils","./c_file_viewer_toolbar_utils","./c_dig-icons_assets_ui-icon_line_text-box","./c_dig-icons_assets_ui-icon_line_slides","./c_dig-icons_assets_ui-icon_line_quota-reached","./c_dig-icons_assets_ui-icon_line_show","./c_dig-icons_assets_ui-icon_line_passwords","./c_file_viewer_preview_text"],(function(e,t,i,r,n,o,l,a,s,d,c,u,v,f,w,m,_,p,g,h,y,E,b,C,S,P){"use strict";function T(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var A=T(r);const I=({children:e})=>{const t=o.useIsFullscreen(),r="dark"===i.useTheme().mode,n=t||r?"dark":"bright";return A.default.createElement(i.ThemeProvider,{mode:n},A.default.createElement(i.ThemeContainer,null,e))};I.displayName="FileViewerThemeProvider";const x=e=>{const{optionalIOClients:t}=e,{preferencesClient:n}=t,l=r.useMemo((()=>i.createStore$1()),[]);return r.useEffect((()=>{const e=n?((e,t)=>{const r=e.sub(a.volumeAtom,(()=>{var i;const r=e.get(a.volumeAtom);null===(i=t.video)||void 0===i||i.setVolumeState(r)})),n=e.sub(a.mutedAtom,(()=>{var i;const r=e.get(a.mutedAtom);null===(i=t.video)||void 0===i||i.setMuteState(r)})),l=e.sub(o.areLineNumbersHiddenAtom,(()=>{var i;const r=e.get(o.areLineNumbersHiddenAtom);null===(i=t.ui)||void 0===i||i.setLineNumbersAreHidden(r)})),s=e.sub(i.leftSidebarIdAtom,(()=>{var r;const n=e.get(i.leftSidebarIdAtom);null===(r=t.sidebar)||void 0===r||r.setLeftSidebarState(n)})),d=e.sub(i.rightSidebarIdAtom,(()=>{var r;const n=e.get(i.rightSidebarIdAtom);e.get(i.shouldSaveRightSidebarPreferenceAtom)&&(null===(r=t.sidebar)||void 0===r||r.setRightSidebarState(n))}));return()=>{r(),n(),l(),s(),d()}})(l,n):void 0;return()=>{null==e||e()}}),[l,n]),l};i.injectInternalStyle("/static/js/file_viewer/file_viewer.module.out-vflDNwGr-.css",(e=>'._fvsdk-mount-point_2087j_1{height:100%;overflow:hidden}._fullScreenPreview_2087j_6{background:var(--dig-color__background__subtle);height:"100vh";position:fixed;right:0;top:0;width:"100vw";z-index:1000}._fileViewerArea_2087j_17{color-scheme:var(--dig-color-scheme,light dark);display:flex;flex-direction:column;height:100%;width:100%}'));const F={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:i.Key_enum.Key.Unidentified},k=Object.keys(F);function M(e){return k.map((t=>`${t}:${e[t]}`)).join("")}function N(e,t){return function(e,t){return e.reduce(((e,{keyboardEventCriteria:i,callback:r})=>(e[t(i)]=r,e)),{})}(e,(e=>function(e,t){const i=function(e,t){return{altKey:!0===e.altKey,shiftKey:!0===e.shiftKey,key:e.key,ctrlKey:!1,metaKey:!1,[t]:!0===e.osModifierKey}}(e,t);return M(i)}(e,t)))}class R{constructor(e,t){this.bindingDict={},this.bindingDict=N(e,t)}getCallbackForEvent(e){const t=function(e){return{altKey:!0===e.altKey,ctrlKey:!0===e.ctrlKey,metaKey:!0===e.metaKey,shiftKey:!0===e.shiftKey,key:e.key}}(e);return this.bindingDict[M(t)]}}const L="default",V=e=>{const{disableBindings:t,children:i}=e,r=u.mac?"metaKey":"ctrlKey",n=A.useRef({}),o=A.useRef(L),l=A.useRef(null),a=A.useCallback(((e,t,i)=>{var a;if(n.current[i]||(n.current[i]={}),e){if(n.current[i][t])throw new Error(`Keybindings for name ${t} registered twice`);n.current[i][t]=e}else delete n.current[i][t];const s=null!==(a=n.current[o.current])&&void 0!==a?a:{};l.current=new R((e=>c.lodashExports.flatten(Object.values(e)))(s),r)}),[r]),s=A.useCallback(((e,t,i)=>{i&&t!==o.current&&(o.current=t),a(e,t,i?t:L)}),[a]),d=A.useCallback(((e,t)=>{t&&o.current===e&&(o.current=L),a(void 0,e,t?e:L)}),[a]),f=A.useCallback((e=>{var t;if(!function(e){const t=e.target||e.srcElement;if(!t)return!0;const i=t.tagName,r="INPUT"===i||"SELECT"===i||"TEXTAREA"===i,n=t instanceof HTMLInputElement&&("submit"===t.type||"button"===t.type),o="NAV"===i||"menu"===t.role||"menuitem"===t.role;return!(t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase())&&(!r||n)&&!o}(e))return;const i=null===(t=l.current)||void 0===t?void 0:t.getCallbackForEvent(e);i&&i(e)}),[]);A.useEffect((()=>{if(!0!==t){const e=c.lodashExports.throttle(f,0);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[t,f]);const w=A.useMemo((()=>({registerKeyBindings:s,unregisterKeyBindings:d,updateKeyBindings:a})),[s,d,a]);return A.createElement(v.KeyboardBindingContext.Provider,{value:w},i)};V.displayName="KeyboardBindingProvider";const D=e=>{const{children:t,intl:r,featureConfig:a,loggingSessionId:c,apiV2ClientShim:u,optionalIOClients:v,logger:w,className:m,id:_,isLoggedIn:p,sourceSession:g,initialEditorParams:h,deviceType:y,externalTranscriptSearchData:E,logTranscriptSearchMilestone:b,reportTranscriptSearchError:C}=e,S=A.default.useMemo((()=>null!=c?c:s.v4()),[c]),P=x({optionalIOClients:v}),T=A.default.useMemo((()=>({...i.DEFAULT_CONFIG,...a})),[a]);A.default.useEffect((()=>{if(h){const{activeEditPlugin:e,editActivationParams:t}=h;P.set(i.activeEditorIdAtom,e,t)}}),[h,P]),A.default.useEffect((()=>{if(E){const e=function(e){const t=e.segments;return{searchResult:new Map(t.map(((e,t)=>[t,new Set]))),segments:t}}(E);P.set(o.transcriptSearchResultAtom,e)}else P.set(o.transcriptSearchResultAtom,{searchResult:void 0,segments:[]})}),[E,P]);const F=d.useLogUserActionInternal(P,w),k=A.default.useMemo((()=>({...g,was_flipped:!1})),[g]),M=A.default.useMemo((()=>{var e;return{loggingSessionId:S,featureConfig:T,canCloseViewer:!!(null===(e=v.navigationClient)||void 0===e?void 0:e.closeViewer),isLoggedIn:p,deviceType:y||i.DeviceType.desktop,sourceSession:k,apiV2ClientShim:u,optionalIOClients:v,logTranscriptSearchMilestone:b,reportTranscriptSearchError:C,logger:w,logUserAction:F}}),[S,T,v,p,y,k,u,w,F,b,C]),N=P.get(o.isFullScreenAtom);return A.default.createElement("div",{className:m||"_fvsdk-mount-point_2087j_1",id:_||"fvsdk-mount-point"},A.default.createElement(f.QueryClientProvider,{client:f.queryClient},A.default.createElement(i.Provider$1,{store:P},A.default.createElement(n.Provider,{value:r},A.default.createElement(i.FileViewerContextProvider,{value:M},A.default.createElement(l.PreviewControlProvider,null,A.default.createElement(V,{disableBindings:!T.keyboard_shortcuts},A.default.createElement(i.LayerContext.Provider,{value:{zIndex:501}},A.default.createElement(I,null,A.default.createElement("div",{className:i.cx("_fileViewerArea_2087j_17",{_fullScreenPreview_2087j_6:N})},t))))))))))};D.displayName="FileViewer";i.injectInternalStyle("/static/js/file_viewer/components/preview.module.out-vflaOWckQ.css",(e=>"._container_1cr5w_1{align-items:stretch;display:flex;flex:1;font-family:AtlasGrotesk,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--type__body__standard--fontsize);justify-content:flex-end;min-height:0;position:relative;width:100%}._container_1cr5w_1 *,._container_1cr5w_1 :after,._container_1cr5w_1 :before{box-sizing:border-box}._container_1cr5w_1 aside{background:var(--color__standard__background)}._containerV2_1cr5w_35{flex-direction:column;justify-content:flex-start}"));const U=A.default.memo((e=>{const{isDeleteEnabled:t,isFileFlippingEnabled:r,enableFullscreen:n,fileIndex:l,collectionFileCount:a}=e,{logUserAction:d}=i.useFileViewerContext(),c=i.useFileViewerAtomValue(o.isDeleteFileModalOpenAtom),u=i.useFileViewerAtomValue(o.isCurrentPreviewZoomedAtom),f=i.useFileViewerAtomValue(o.isSlideshowAtom),w=s.useRootPreviewKey(),_=!!o.useActiveEditorId(),p=m.useEnterFullScreenCallback(),g=n&&!_?v.getKeyboardBinding({callback:()=>p({actionContext:i.UserActionContext.Keyboard}),key:"f"}):null,h=m.useCloseViewerCallback(),y=v.getKeyboardBinding({key:i.Key_enum.Key.Escape,callback:()=>{h(i.UserActionContext.Keyboard)}}),E=m.useDeleteFileCallback(),b=w&&v.getDeleteFileBindings((e=>{d(i.UserAction.Delete,i.UserActionContext.Keyboard),E(i.UserActionContext.Keyboard,e===i.Key_enum.Key.Delete?"delete":"backspace")})),C=v.useFileFlippingBindings({requireCommandKey:u,fileIndex:l,collectionFileCount:a,isSlideshow:f}),S=[];return g&&S.push(g),r&&!c&&(S.push(...C),S.push(y)),t&&!c&&b&&S.push(...b),A.default.createElement(v.KeyboardBindingConnector,{name:"app",keyboardBindings:S})}));function K(e){return e&&function(e){return!!e&&"editUI"in e}(e)?e:void 0}U.displayName="PreviewKeyboardBindings";const O=(e,t)=>{const i=A.default.lazy((async()=>({default:(await t())[e]}))),r=e=>A.default.createElement(A.default.Suspense,{fallback:null},A.default.createElement(i,{...e}));return r.displayName=`Async${e}`,r},z=O("PreviewArchive",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_archive2"],t,i)})))),B=e=>{const{previewKey:t,previewSessionId:r,setLocalError:n}=e,o=i.useCurrentPreviewMetadata(),l=i.useArchiveDataQuery(t,o);return s.useDownloadSucceeded(r,l.isSuccess),A.default.useEffect((()=>{"NestedArchiveFile"===t.type&&i.ARCHIVE_EXTS.includes(i.getFileExtension(t.subpath))&&n(new i.FVError(i.FVErrorCode.NestedFiletypeNotSupported,i.ErrorLifecycle.Render))}),[t,n]),A.default.createElement(z,{...e,archiveDataResult:l})};B.displayName="AsyncPreviewArchiveWithRivieraFetch";const j=O("PreviewAudioVideo",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_audio_video_preview_video"],t,i)})).then((function(e){return e.preview_video_esnext})))),H=e=>{const{previewKey:t,previewSessionId:r,featureConfig:n,setLocalError:o}=e;A.default.useEffect((()=>{i.isNestedArchiveFilePreviewKey(t)&&o(new i.FVError(i.FVErrorCode.NestedFiletypeNotSupported,i.ErrorLifecycle.Render))}),[t,o]);const l=i.useCurrentPreviewMetadata(),a=f.useQueryClient();return A.default.useMemo((()=>{l&&i.prefetchAudioVideoRivieraData(a,t,l,n.videojs_preload)}),[n.videojs_preload,l,t,a]),A.default.useEffect((()=>{i.PreviewsEventLogger.mark(i.PreviewsTimingEvents.ASYNC_VIDEO_CONTAINER_MOUNT)}),[]),s.useDownloadSucceeded(r,!0),A.default.createElement(j,{...e})};H.displayName="AsyncPreviewAudioVideoWithLifecycleLogging";const W=O("PreviewCloudDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_cloud_doc"],t,i)})))),Q=e=>(s.useDownloadSucceeded(e.previewSessionId,!0),A.default.createElement(W,{...e}));Q.displayName="AsyncPreviewCloudDocWithRivieraFetch";const q=({onSwipeLeft:e,onSwipeRight:t,onSwipeDown:i,onTap:n})=>{const o=r.useRef(0),l=r.useRef(0),a=r.useRef(0),s=r.useRef(!1),d=r.useRef(!1);return{handleTouchStart:r.useCallback((e=>{const t=e.changedTouches[0];o.current=Date.now(),l.current=t.pageX,a.current=t.pageY,e.touches.length>1&&(s.current=!0)}),[o,l,a,s]),handleTouchEnd:r.useCallback((r=>{const n=r.changedTouches[0];if(s.current)return void(0===r.touches.length&&(s.current=!1));if(Date.now()-o.current>500)return;const c=n.pageX-l.current,u=n.pageY-a.current;if(Math.abs(c)>Math.abs(u)){if(c<=-100)return void(null==e||e());if(c>=100)return void(null==t||t())}else if(u>=50)return void(null==i||i());d.current=!0}),[o,l,a,s,e,t,i]),handleClick:r.useCallback((()=>{d.current&&(null==n||n(),d.current=!1)}),[n,d])}},G=()=>{const{featureConfig:e}=i.useFileViewerContext(),t=i.useCurrentPreviewMetadata(),r=e.mobile_web,n=(o=t.previewType,![i.PreviewType.Video,i.PreviewType.Audio,i.PreviewType.Error,i.PreviewType.Loading].includes(o));var o;const l=m.useToggleFullScreenCallback(),a=A.default.useCallback((()=>{l({actionContext:i.UserActionContext.SurfaceGesture})}),[l]);return n&&r?a:void 0};i.injectInternalStyle("/static/js/file_viewer/preview_content/preview_content.module.out-vfl0ohgz_.css",(e=>"._previewContent_1t0x7_1{align-items:stretch;background:var(--dig-color__background__subtle);flex:1;max-height:100%;max-width:100%;position:relative;width:100%}._previewContentWrapper_1t0x7_11{display:flex;height:100%;position:relative;width:100%}._hidden_1t0x7_18{display:none}"));const $=({variant:e})=>{const t=n.useIntl(),r=o.useIsFullscreen(),l=m.useToggleFullScreenCallback(),a=i.useStabilizedCallback((()=>{l({actionContext:i.UserActionContext.PreviewToolbar})})),s=r?t.formatMessage({id:"VOB6G0",defaultMessage:"Exit full screen"}):t.formatMessage({id:"2iLco8",defaultMessage:"Full screen"});return A.createElement(h.ToolbarIcon,{label:s,onClick:a,icon:r?y.FullscreenExitLine:i.FullscreenLine,disabled:!1,variant:e})};$.displayName="FullscreenButton";const Z=(e,t,i,r)=>e&&t&&!i&&!r,Y=n.defineMessage({id:"gMA39w",defaultMessage:"Navigate to the previous slideshow file"}),J=n.defineMessage({id:"/Bi0z4",defaultMessage:"Navigate to the next slideshow file"}),X=n.defineMessage({id:"NJcnxO",defaultMessage:"Pause"}),ee=n.defineMessage({id:"iooQK2",defaultMessage:"Play"}),te=n.defineMessage({id:"+pK+N8",defaultMessage:"Duration Dropdown menu"}),ie=n.defineMessage({id:"Dady56",defaultMessage:"Duration"}),re=[2e3,3e3,5e3,8e3,15e3,3e4,6e4];const ne=({variant:e,previewType:t})=>{const r=n.useIntl(),l=o.useIsFullscreen(),a=o.useIsSlideshow(),s=o.useAreToolsHidden(),d=!!w.useSharedLinkInfo(),c=w.useIsNestedArchiveFile(),{featureConfig:u}=i.useFileViewerContext(),v=m.useToggleSlideshowCallback(),f=m.useHideToolsCallback(i.UserActionContext.PreviewToolbar),_="ON"===u.preview_collection_slideshow,p=i.useStabilizedCallback((()=>{v({actionContext:i.UserActionContext.PreviewToolbar}),s||a||f()})),g=a?r.formatMessage({id:"EIxINn",defaultMessage:"Exit slideshow"}):r.formatMessage({id:"APqiEA",defaultMessage:"Slideshow"}),y=a?r.formatMessage({id:"3xoy9+",defaultMessage:"Exit slideshow"}):r.formatMessage({id:"86x3d6",defaultMessage:"Slideshow"});return((e,t,r,n=!1,o)=>{const l=e===i.PreviewType.Video||e===i.PreviewType.Image;return Z(t,r,n,o)&&l})(t,_,u.file_flipping,c,d)?A.createElement(i.Tooltip,{title:y,placement:"bottom"},A.createElement("span",{"data-tooltip":y},A.createElement(h.ToolbarIcon,{label:g,onClick:p,icon:l&&a?i.SignOutLine:E.SlidesLine,disabled:!1,variant:e}))):null};ne.displayName="SlideShowButton";const oe=({previewType:e})=>{const t=n.useIntl(),{logUserAction:r,featureConfig:l}=i.useFileViewerContext(),a=!!w.useSharedLinkInfo(),s=w.useIsNestedArchiveFile(),{flipToPreviousSlideshowFile:d,flipToNextSlideshowFile:c}=m.useFileFlippingCallbacks(),u=o.useAudioVideoIsPlaying(),[v,f]=i.useFileViewerAtom(o.slideshowDelayMillisecondAtom),[_,p]=i.useFileViewerAtom(o.isSlideshowPausedAtom),[g]=i.useFileViewerAtom(o.isSlideshowAtom),h="ON"===l.preview_collection_slideshow,E=e===i.PreviewType.Error,C=e===i.PreviewType.Video,S=i.useStabilizedCallback((()=>{_?(r(i.UserAction.SlideshowPlay,i.UserActionContext.Slideshow),p(!1)):(r(i.UserAction.SlideshowPause,i.UserActionContext.Slideshow),p(!0))}));return g?((e,t,r,n=!1,o)=>{const l=e===i.PreviewType.Video||e===i.PreviewType.Image;return Z(t,r,n,o)&&(l||e===i.PreviewType.Error)})(e,h,l.file_flipping,s,a)?A.default.createElement(A.default.Fragment,null,A.default.createElement(i.IconButton,{"aria-label":t.formatMessage(Y),onClick:()=>{d(i.UserActionContext.Slideshow)},size:"medium",variant:"borderless"},A.default.createElement(i.UIIcon,{src:b.ArrowLeftLine,width:"20px",height:"20px"})),A.default.createElement(i.IconButton,{"aria-label":_?t.formatMessage(ee):t.formatMessage(X),onClick:S,size:"medium",variant:"borderless",disabled:C||E},A.default.createElement(i.UIIcon,{src:!_||C?y.PauseLine:y.PlayLine})),A.default.createElement(i.IconButton,{"aria-label":t.formatMessage(J),onClick:()=>c(i.UserActionContext.Slideshow),size:"medium",variant:"borderless"},A.default.createElement(i.UIIcon,{src:i.ArrowRightLine,width:"20px",height:"20px"})),A.default.createElement(i.Menu.Wrapper,{shouldPropagateClickOutsideMouseEvents:!0,onSelection:e=>{r(i.UserAction.SlideshowDurationChanged,i.UserActionContext.Slideshow),f(e)}},(({getContentProps:e,getTriggerProps:n})=>A.default.createElement(A.default.Fragment,null,A.default.createElement(i.Button,{...n(),variant:"borderless",disabled:u||E,"aria-label":t.formatMessage(te)},t.formatMessage(ie)),A.default.createElement(i.Menu.Content,{...e(),onContentOpened:()=>{r(i.UserAction.SlideshowDurationDropdownOpened,i.UserActionContext.Slideshow)}},A.default.createElement(i.Menu.Segment,null,re.map((e=>A.default.createElement(i.Menu.SelectItem,{key:`custom-duration-${e}`,value:e,selected:e===v},t.formatNumber(e/1e3,{style:"unit",unit:"second"})))))))))):null:A.default.createElement(ne,{variant:"borderless",previewType:e})};oe.displayName="SlideshowControls";i.injectInternalStyle("/static/js/file_viewer/ui/fullscreen_right_section.module.out-vflUdQoXf.css",(e=>":root{--abovePreviewZIndex:10}._fullscreenRightSection_k1zqn_5{display:flex;gap:var(--dig-spacing__micro__small);padding:var(--dig-spacing__macro__xsmall);position:absolute;right:0;top:0;transition:opacity var(--easing__transition) var(--duration__micro);z-index:var(--abovePreviewZIndex)}._hidden_k1zqn_16{opacity:0}"));const le=()=>{const e=n.useIntl(),{logUserAction:t,optionalIOClients:{preferencesClient:r}}=i.useFileViewerContext(),[l,a]=i.useFileViewerAtom(o.areToolsHiddenAtom),s=l?C.ShowLine:S.HideLine,d=l?e.formatMessage({id:"qJIBhE",defaultMessage:"Show toolbar"}):e.formatMessage({id:"Pwe/D+",defaultMessage:"Hide toolbar"}),c=i.useStabilizedCallback((()=>{var e;l?(t(i.UserAction.ShowTools,i.UserActionContext.PreviewToolbar),a(!1)):(t(i.UserAction.HideTools,i.UserActionContext.PreviewToolbar),a(!0)),null===(e=null==r?void 0:r.ui)||void 0===e||e.setHiddenState({isHidden:!l})}));return A.default.createElement(i.Button,{variant:"opacity",withIconStart:A.default.createElement(i.UIIcon,{src:s}),onClick:c},d)};le.displayName="HideToolbarButton";const ae=()=>{const{isUserInteractingWithElement:e,handleBlur:t,handleFocus:r}=a.useMouseActive(5e3),n=w.useRootPreviewType(),o=n===i.PreviewType.Video||n===i.PreviewType.Audio;return A.default.createElement("div",{className:i.cx("_fullscreenRightSection_k1zqn_5",{_hidden_k1zqn_16:!e}),onBlur:t,onFocus:r},A.default.createElement(oe,{previewType:n}),A.default.createElement(le,null),!o&&A.default.createElement($,{variant:"borderless"}))};ae.displayName="FullscreenRightSection";i.injectInternalStyle("/static/js/file_viewer/ui/show_tools_button.module.out-vflakd9Zc.css",(e=>":root{--abovePreviewZIndex:10}._showTools_10bo0_5{padding:var(--dig-spacing__micro__large);position:absolute;right:0;top:0;transition:opacity var(--easing__transition) var(--duration__micro);z-index:var(--abovePreviewZIndex)}._hidden_10bo0_14{opacity:0}"));const se=()=>{const e=n.useIntl(),t=i.useSetFileViewerAtom(o.areToolsHiddenAtom),{isUserInteractingWithElement:r,handleBlur:l,handleFocus:s}=a.useMouseActive(5e3),d=i.useStabilizedCallback((()=>{t(!1)}));return A.default.createElement("div",{className:i.cx("_showTools_10bo0_5",{_hidden_10bo0_14:!r}),onFocus:s,onBlur:l},A.default.createElement(i.Button,{variant:"opacity",withIconLeft:A.default.createElement(i.UIIcon,{src:C.ShowLine}),onClick:d},e.formatMessage({id:"vQPZmq",defaultMessage:"Show tools"})))};se.displayName="ShowToolsButton";const de=({children:e})=>{const{featureConfig:t}=i.useFileViewerContext(),n=s.useRootPreviewKey(),l=i.useFileViewerAtomValue(o.isSlideshowAtom),a=i.useFileViewerAtomValue(o.effectiveSlideshowDelayAtom),d=o.useIsFullscreen(),c=o.useAreToolsHidden(),u=i.useCurrentPreviewMetadata(),v=u.previewType===i.PreviewType.Loading,f=u.previewType===i.PreviewType.Video,w=t.mobile_web,p=w?{tabIndex:0}:{};(()=>{const{optionalIOClients:{preferencesClient:e},logUserAction:t}=i.useFileViewerContext(),r=i.useSetFileViewerAtom(o.areToolsHiddenAtom),n=o.useIsFullscreen();A.default.useEffect((()=>{var o,l;if(!n)return;const a=null!==(l=null===(o=null==e?void 0:e.ui)||void 0===o?void 0:o.toolsAreHiddenInFullscreen())&&void 0!==l&&l;t(a?i.UserAction.HideTools:i.UserAction.ShowTools,i.UserActionContext.UserPreference),r(a)}),[n,t,null==e?void 0:e.ui,r])})();const g=G(),{flipToNextFile:h,flipToPreviousFile:y,flipToNextSlideshowFile:E}=m.useFileFlippingCallbacks();!function(e,t,i){const n=r.useRef(void 0);r.useEffect((()=>{n.current=e}),[e]),r.useEffect((()=>{if(t&&i){const e=setInterval((function(){(null==n?void 0:n.current)&&n.current()}),t);return()=>clearInterval(e)}return()=>{}}),[t,i])}((()=>{E(i.UserActionContext.Slideshow)}),l&&!f?a:void 0,n);const{handleTouchStart:b,handleTouchEnd:C,handleClick:S}=q({onSwipeLeft:()=>h(i.UserActionContext.SurfaceGesture),onSwipeRight:()=>y(i.UserActionContext.SurfaceGesture),onTap:g});return A.default.createElement("div",{className:"_previewContentWrapper_1t0x7_11",onTouchStart:b,onTouchEnd:C,onClick:S,...p},v?A.default.createElement(_.LoadingIndicator,null):null,A.default.createElement("div",{className:i.cx("_previewContent_1t0x7_1",{_hidden_1t0x7_18:v})},c&&!w?d?A.default.createElement(ae,null):A.default.createElement(se,null):null,e))};de.displayName="PreviewContent";const ce=()=>{const{previewContent:e}=i.useFileViewerSubRegionContext();return A.default.useMemo((()=>{return e?(t=e,e=>A.default.createElement(A.default.Suspense,{fallback:null},A.default.createElement(t,{...e}))):de;var t}),[e])},ue=O("PreviewDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_doc"],t,i)})))),ve=e=>{var t;const{previewKey:r,previewSessionId:n}=e,o=i.useCurrentPreviewMetadata(),l=i.useSsrDocMetadataQuery(r,o),a=null===(t=null==l?void 0:l.data)||void 0===t?void 0:t.apiData.metadata;return s.useDownloadSucceeded(n,!!a&&!(null==a?void 0:a.needsPassword)),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.ASYNC_DOC_CONTAINER_MOUNT),A.default.createElement(ue,{...e})};ve.displayName="AsyncPreviewDocWithRiviera";const fe=O("PreviewError",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_error"],t,i)}))));class we extends A.default.PureComponent{componentDidCatch(e){this.props.onError(e)}static getDerivedStateFromError(){return{}}render(){return this.props.children}}we.displayName="UnconnectedErrorBoundary";const me=({children:e})=>{var t;const r=s.useRootPreviewKey(),n=i.useCurrentPreviewMetadata(),o=w.useRootFileMetadata(),l=i.getFileExtension(null==o?void 0:o.file_name),a=null===(t=i.useFileViewerContext().optionalIOClients.reportExceptionClient)||void 0===t?void 0:t.reportException,d=i.useSetLocalErrorCallback(r),c=i.useStabilizedCallback((e=>{var t;null==a||a(e,(null===(t=null==n?void 0:n.content)||void 0===t?void 0:t[".tag"])||"other",l,"critical"),d(i.isFVError(e)?e:new i.FVError(i.FVErrorCode.Unknown,i.ErrorLifecycle.Render,e.message))}));return A.default.createElement(we,{onError:c},e)};me.displayName="ErrorBoundary";const _e=O("PreviewHTML",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_html"],t,i)})))),pe=e=>(s.useDownloadSucceeded(e.previewSessionId,!0),A.default.createElement(_e,{...e}));pe.displayName="AsyncPreviewHTMLWithRivieraFetch";const ge=O("PreviewImage",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_image"],t,i)})))),he=e=>(s.useDownloadSucceeded(e.previewSessionId,!0),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.ASYNC_IMAGE_CONTAINER_MOUNT),A.default.createElement(ge,{...e})),ye=O("PreviewLinkfile",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_linkfile2"],t,i)})))),Ee=e=>{const{previewKey:t,previewSessionId:r}=e,n=i.useCurrentPreviewMetadata(),o=i.useLinkfileUriQuery(t,n);return s.useDownloadSucceeded(r,o.isSuccess),A.default.createElement(ye,{...e,linkfileResult:o})};Ee.displayName="AsyncPreviewLinkfileWithLifecycleLogging";const be=O("PreviewText",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_text2"],t,i)})).then((function(e){return e.preview_text_esnext})))),Ce=e=>{const t=i.useCurrentPreviewMetadata(),r=i.useTextDataQuery(e.previewKey,t);r.error&&e.setLocalError(new i.FVError(i.FVErrorCode.RivieraDataFetchFailure,i.ErrorLifecycle.Download,r.error.message));const{data:{apiData:n}={},isLoading:o}=r;return s.useDownloadSucceeded(e.previewSessionId,void 0!==n),o?A.default.createElement("div",{className:P.spinnerContainer},A.default.createElement(i.Spinner,{size:"large"})):A.default.createElement(be,{...e,fileContent:n})};Ce.displayName="AsyncPreviewTextWithRivieraFetch";const Se=i.makeRivieraDataQueryPackage({fileTypeSpecificQueryFn:async e=>{var t;const r=null===(t=e.previewMetadata)||void 0===t?void 0:t.content;if("three_dimensional"!==(null==r?void 0:r[".tag"])||!r.model_url)throw new Error("Invalid preview metadata provided for three_dimensional preview");const n=await i.rivieraClient.fetchThreeDimensionalContent(r.model_url);if(n.error)throw n.error;return n.data},fieldName:"model_url"}),Pe=[".3ds",".dae",".fbx",".glb",".obj",".ply",".stl"],Te=O("ThreeJsRenderer",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_three_dimensional_three_js_renderer"],t,i)})))),Ae=e=>{var t;const{previewKey:r,previewSessionId:n,onRenderSucceeded:o,width:l,height:a,fileExtension:d}=e,[c,u]=A.default.useState(!1),v=i.useCurrentPreviewMetadata(),f=((e,t,r=!0)=>{const n=null==t?void 0:t.content,o="three_dimensional"===(null==n?void 0:n[".tag"]),l=Se.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:r&&!!e&&o,retry:!0});return i.useMaybeSetLocalErrorForRivieraError(e,l.error),l})(r,v,!c),w=null===(t=null==f?void 0:f.data)||void 0===t?void 0:t.apiData;return s.useDownloadSucceeded(n,!!w),A.default.useEffect((()=>()=>{u(!0),f.remove()}),[]),A.default.createElement(Te,{previewSessionId:n,onRenderSucceeded:o,width:l,height:a,fileBytes:w,fileExtension:d||v.file_type_extension})},Ie=e=>{const{featureConfig:t,sourceSession:r,isLoggedIn:n,logger:o,apiV2ClientShim:l}=i.useFileViewerContext(),a=w.useRootPreviewMetadata(),s=f.useQueryClient();i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.PREVIEW_COMPONENT_MOUNT);const d=A.useMemo((()=>{var e;return{logDuration:()=>Promise.resolve(null==o?void 0:o.logDuration),tags:i.makeApiLoggerTags(r.source_context,n,null===(e=a.content)||void 0===e?void 0:e[".tag"])}}),[n,null==o?void 0:o.logDuration,a.content,r.source_context]);return i.useFileViewerPrefetch(s,a,e.fileInfo,l,t.videojs_preload,u.is_supported_mobile_browser(),e.sharedLinkInfo,d),A.createElement(xe,null,(({width:t,height:i})=>A.createElement(Fe,{...e,width:t,height:i})))};Ie.displayName="Preview";const xe=e=>{const{children:t}=e,{nodeRef:r,contentRect:n}=a.useContentRect();return A.createElement("div",{className:i.cx("_container_1cr5w_1","_containerV2_1cr5w_35"),ref:r,id:"fvsdk-container"},n&&n&&(null==t?void 0:t(n)))};xe.displayName="PreviewContentRectSizer";const Fe=e=>{var t,r,n,l,s,d;const{featureConfig:c,sourceSession:u}=i.useFileViewerContext(),v=i.useSetFileViewerAtom(i.sharedLinkInfoAtom),f=ce();A.useMemo((()=>{var t;e.fileInfo&&e.prewarmedPreviewMetadata&&(null===(t=e.fileMetadata)||void 0===t?void 0:t.size)&&i.maybeCopyPreviewMetadataIntoQueryClient(e.prewarmedPreviewMetadata,e.fileInfo,e.fileMetadata.size,e.sharedLinkInfo)}),[e.fileInfo,e.prewarmedPreviewMetadata,null===(t=e.fileMetadata)||void 0===t?void 0:t.size,e.sharedLinkInfo]);const[m,p]=i.useFileViewerAtom(i.rootFileInfoAtom),[g,h]=i.useFileViewerAtom(i.rootFileMetadataAtom),y=null!==(r=e.fileInfo)&&void 0!==r?r:m,E=null!==(n=e.fileMetadata)&&void 0!==n?n:g,b=A.useMemo((()=>y?i.getPreviewKeyFromFileInfo(y):void 0),[y]);A.useEffect((()=>{var t;(null===(t=e.fileInfo)||void 0===t?void 0:t.file_id)&&b&&p({...e.fileInfo,previewKey:b})}),[e.fileInfo,b,p]),A.useEffect((()=>{h(e.fileMetadata)}),[e.fileMetadata,h]),A.useEffect((()=>{e.sharedLinkInfo&&v(e.sharedLinkInfo)}),[v,e.sharedLinkInfo]),A.useEffect((()=>{var t;m&&e.fileInfo&&(m.file_id!==(null===(t=e.fileInfo)||void 0===t?void 0:t.file_id)||m.url!==e.fileInfo.url)&&(u.was_flipped=!0)}));const C=A.useMemo((()=>({...i.DEFAULT_FILE_CONFIG,...e.fileConfig})),[e.fileConfig]),S=o.useActiveEditorId(),P=S?K(null===(l=e.editors)||void 0===l?void 0:l[S]):void 0;a.useMaybeOpenEditorBasedOnUrl();const T=w.useRootPreviewMetadata();return A.createElement(A.Fragment,null,A.createElement(f,null,A.createElement(me,null,y&&E?A.createElement(ke,{...e,fileInfo:y,fileMetadata:E,fileConfig:C,activeOverlayEditor:P}):T.error?A.createElement(ke,{...e,error:T.error,fileConfig:C,activeOverlayEditor:P}):A.createElement(_.LoadingIndicator,null))),A.createElement(U,{enableFullscreen:c.enable_fullscreen,isDeleteEnabled:!P&&!(null==E?void 0:E.readOnly),isFileFlippingEnabled:null!=E&&!!E.file_collection_context&&!P,fileIndex:(null===(s=null==E?void 0:E.file_collection_context)||void 0===s?void 0:s.file_index)||0,collectionFileCount:(null===(d=null==E?void 0:E.file_collection_context)||void 0===d?void 0:d.parent_files_count)||0}))};Fe.displayName="PreviewWithSize";const ke=({callbacks:e,...t})=>{var n;const{fileInfo:l,fileMetadata:a,textHighlighters:c,ssrDocJumpToPageIndex:u}=t,{featureConfig:v}=i.useFileViewerContext(),f=i.useCurrentPreviewMetadata(),w=null==f?void 0:f.previewType,h=i.getFileExtension(null==a?void 0:a.file_name),y="V1"===v.previews_three_js&&Pe.includes(h),E=s.useCurrentPreviewKey(),b=s.useInitializePreviewSession(E,l,a,null==e?void 0:e.onPreviewSessionInitialized,f);s.useSupportConfirmed(b,!!w&&w!==i.PreviewType.Loading&&w!==i.PreviewType.Error&&(w!==i.PreviewType.ThreeDimensional||y)),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.PREVIEW_RENDERER_MOUNT),s.useEndSession(b),p.useTimingLogging(w),d.usePurgeQueuedEvents();const C=m.useNavigateToPageCallback(i.UserActionContext.MobileAppToWebPreview);u&&C(u);const S=d.useLogPreviewEvent(),P=((e,t,i=[])=>{const n=r.useRef(null),o=()=>{n.current&&(window.clearTimeout(n.current),n.current=null)};return r.useEffect((()=>o),[...i,t]),()=>{o(),n.current=window.setTimeout(e,t)}})((()=>{S(i.EventType.UserEngaged3SecondsAfterRenderSucceeded)}),3e3,[b]),T=i.useStabilizedCallback((()=>{var t;P(),null===(t=null==e?void 0:e.onRenderSucceeded)||void 0===t||t.call(e)})),I=i.useSetLocalErrorCallback(E);g.useMaybeSetPasswordProtectedArchiveError();const x=A.useMemo((()=>c&&Object.values(c).filter((e=>!!e))),[c]),F=o.useActiveTextHighlighterId(),k=F?null==c?void 0:c[F]:void 0,M=m.getWillCloudDocPreviewAsSsrDoc(v,f);if(!b||!E||!w)return w===i.PreviewType.Error?A.createElement(fe,{error:(null==f?void 0:f.error)||new i.FVError(i.FVErrorCode.Unknown,i.ErrorLifecycle.Render),...t,previewSessionId:"",previewKey:E,onRenderFailed:null==e?void 0:e.onRenderFailed}):null;const N={previewSessionId:b,onRenderSucceeded:T,previewKey:E,textHighlightersInstances:x,activeTextHighlighter:k,featureConfig:v,setLocalError:I};switch(w){case i.PreviewType.Image:return A.createElement(he,{...t,...N,key:E.serialized});case i.PreviewType.SsrDoc:case i.PreviewType.CloudDoc:return M?(null===(n=null==a?void 0:a.file_name)||void 0===n?void 0:n.endsWith(".gsheet"))?A.createElement(pe,{...t,...N,isRawHtml:!0,key:E.serialized}):A.createElement(ve,{...t,...N,key:E.serialized}):A.createElement(Q,{...t,...N,key:E.serialized});case i.PreviewType.Video:case i.PreviewType.Audio:return A.createElement(H,{...t,...N,isAudio:w===i.PreviewType.Audio,key:E.serialized});case i.PreviewType.Excel:case i.PreviewType.RawHTML:return A.createElement(pe,{...t,...N,isRawHtml:w===i.PreviewType.RawHTML,key:E.serialized});case i.PreviewType.Text:return A.createElement(Ce,{...t,...N,key:E.serialized});case i.PreviewType.Archive:return A.createElement(B,{...t,...N,key:E.serialized});case i.PreviewType.Linkfile:return A.createElement(Ee,{...t,...N,key:E.serialized});case i.PreviewType.ThreeDimensional:if(y)return A.createElement(Ae,{previewKey:E,previewSessionId:b,onRenderSucceeded:N.onRenderSucceeded,width:t.width,height:t.height,fileExtension:h,key:E.serialized});break;case i.PreviewType.Error:return A.createElement(fe,{error:(null==f?void 0:f.error)||new i.FVError(i.FVErrorCode.Unknown,i.ErrorLifecycle.Render),...t,...N,onRenderFailed:null==e?void 0:e.onRenderFailed});case i.PreviewType.Loading:return A.createElement(_.LoadingIndicator,null)}return A.createElement(fe,{error:new i.FVError(i.FVErrorCode.UnsupportedPreviewType,i.ErrorLifecycle.Render),...t,...N,onRenderFailed:null==e?void 0:e.onRenderFailed})};ke.displayName="PreviewRenderer",ke.displayName="PreviewRenderer",t.FileViewer=D,t.FullscreenButton=$,t.HideToolbarButton=le,t.Preview=Ie,t.PreviewContent=de,t.SlideshowControls=oe,t.asyncComponent=O,t.parseFullscreenEditor=function(e){return e&&function(e){return!!e&&"fullscreenLayer"in e}(e)?e:void 0},t.parseOverlayEditor=K,t.useTouchInteraction=q}));
//# sourceMappingURL=c_file_viewer_components_preview.js-vflWBce_U.map

//# debugId=78b4bfb9-ce5e-3d30-9c55-f226d59543ef