!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0c5cda6f-6d93-3afb-86f4-c3f788d64b0f")}catch(e){}}();
define(["require","exports","react","./e_ui_page_files_router","./e_core_exception","./c_core_i18n","./c_file_viewer_components_preview","./c_dig-content-icons_icons_file-generic-large","./c_quota_use_query_quota_upsell_info","./c_over-quota_utils_logger"],(function(e,t,i,a,o,r,s,n,_,l){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var c=u(i);a.injectInternalStyle("/static/metaserver/static/js/growth/ui/over-quota/over-quota-sweep-blocking-modal/use_over_quota_sweep_blocking_modal.module.out-vflp66ny5.css",(e=>"._previewPlaceholder_crbhy_1{background:var(--dig-color__background__base);border-radius:8px;display:flex;height:100%;margin:auto;object-fit:contain}._previewContainer_crbhy_11{border-radius:8px;height:100%;max-width:384px;overflow:hidden}"));const d="_previewPlaceholder_crbhy_1",v="_previewContainer_crbhy_11";var E,S;t.SweepStatus=void 0,(E=t.SweepStatus||(t.SweepStatus={})).LOADING="loading",E.OPEN="open",E.FAILURE="failure",E.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL="user_not_eligible_for_over_quota_sweep_modal",E.USER_CONTINUED_ACTION="user_continued_action",E.USER_ABORTED_ACTION="user_aborted_action",E.RESTRICTED="restricted",t.SweepStatusVersion=void 0,(S=t.SweepStatusVersion||(t.SweepStatusVersion={})).SWEEP_M1_OQ_PAINTED_DOOR="sweep_m1_oq_painted_door",S.END_STATE_WEB_OVERQUOTA_RESTRICTIONS="end_state_web_overquota_restrictions";const p=({fileViewerProps:e,previewProps:t})=>{const[i,a]=c.default.useState(!1);return i?c.default.createElement(n.FileGenericLarge,{hasWhitespace:!1,className:d,over:"base"}):c.default.createElement(s.FileViewer,{...e},c.default.createElement(s.Preview,{...t,callbacks:{...null==t?void 0:t.callbacks,onRenderFailed:e=>{var i,o;a(!0),null===(o=null===(i=null==t?void 0:t.callbacks)||void 0===i?void 0:i.onRenderFailed)||void 0===o||o.call(i,e)}}}))};p.displayName="PreviewWrapper";const O=(e,t,i,o,r)=>{if(("file_viewer"===e||"quick_view"===e||"standalone_preview"===e)&&i)return"full_preview"===o?c.default.createElement(a.Box,{className:v},c.default.createElement(p,{fileViewerProps:t,previewProps:r})):"excel"===o?c.default.createElement(a.FileExcelLarge,{hasWhitespace:!1,className:d,over:"base"}):c.default.createElement(n.FileGenericLarge,{hasWhitespace:!1,className:d,over:"base"})},w=e=>{var t,i,o,r;if(!e||!a.isBrowseFile(e))return"generic";switch((null===(i=null===(t=e.browse_preview)||void 0===t?void 0:t.content)||void 0===i?void 0:i[".tag"])||(null===(r=null===(o=e.preview)||void 0===o?void 0:o.content)||void 0===r?void 0:r[".tag"])){case void 0:case"other":case"restricted":case"archive":return"generic";case"excel":return"excel";default:return"full_preview"}},f=["share_link","file_viewer","quick_view","standalone_preview","create","upload","share_qr_code"],T=["share_modal","share_link","file_viewer","quick_view"];t.useOverQuotaSweepBlockingModal=(i,s)=>{var n,u,d,v,E,S;const[p,R]=c.default.useState({status:void 0===i?t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL:t.SweepStatus.LOADING}),{viewer:I,isLoading:V}=a.useViewer(),N=c.default.useRef(p.status);N.current=p.status;const A=a.useExperimentVariant("sweep_m1_oq_painted_door"),g=a.useExperimentVariant("end_state_web_overquota_restrictions"),m=c.default.useCallback((async()=>{await(async(t,i,o)=>{if(!t||i)return;const{downloadSingleFile:r}=await new Promise((function(t,i){e(["./c_file_actions_portable_download"],t,i)})).then((function(e){return e.download_esnext}));r({href:t.href,source:a.SourceContext.OverQuotaBlockingModal,isFswm:!1,user:o.active_user})})(s,V,I)}),[s,I,V]),L=g&&g.variant===a.Variant.V1&&void 0!==i&&f.includes(i),D=g&&g.variant!==a.Variant.V1&&A&&A.variant===a.Variant.V1&&void 0!==i&&T.includes(i),b=(null==A?void 0:A.variant)?A.variant:a.Variant.OFF,h=(null==g?void 0:g.variant)?g.variant:a.Variant.OFF,U=g&&[a.Variant.V1,a.Variant.CONTROL,a.Variant.HOLDOUT].includes(h)&&void 0!==i&&f.includes(i),{quotaUpsellInfo:C,isLoadingQuotaUpsellInfo:P,quotaUpsellInfoError:q}=_.useQuotaUpsellInfo(null==I?void 0:I.active_user,!U),F=L&&((null===(n=null==C?void 0:C.restrictions)||void 0===n?void 0:n.enforce_restrictions)||(null===(u=null==C?void 0:C.restrictions)||void 0===u?void 0:u.show_restrictions_warning)),k=c.default.useMemo((()=>new a.ActiveUserApiV2Client),[]),Q=c.default.useMemo((()=>({...a.DEFAULT_CONFIG,previewContentOnly:!0,preview_types:{[a.PreviewType.SsrDoc]:{scaleToFit:"width_and_height"},[a.PreviewType.Video]:{no_controls:!0},[a.PreviewType.Audio]:{no_controls:!0}}})),[]),x=c.default.useMemo((()=>({intl:r.intl,apiV2ClientShim:a.makeApiV2ClientShim(k),optionalIOClients:{},isLoggedIn:!!(null==I?void 0:I.active_user),sourceSession:{source_context:a.SourceContext.OverQuotaBlockingModal},featureConfig:Q})),[k,Q,null==I?void 0:I.active_user]),B=c.default.useCallback((({action:i,enforceRestrictions:r=!1})=>{const n=s&&{fileMetadata:{file_id:s.file_id,file_name:a.getFilename(s),size:s.bytes,readOnly:!a.isBrowseFile(s)||!!s.read_only},fileInfo:{file_id:s.file_id,ns_id:s.ns_id,sj_id:s.sjid},fileConfig:{enable_print:!1,enable_view_on_dropbox_button:!0,canEdit:!1}},_={action:i,filePreview:O(i,x,s,w(s),n)};L?new Promise((function(t,i){e(["./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal"],t,i)})).then((function(e){return e.open_over_quota_restrictions_modal_esnext})).then((e=>{e.openOverQuotaRestrictionsModal({..._,fileName:s?a.getFilename(s):void 0,downloadFileHandler:m,continueCallback:()=>{R({status:r?t.SweepStatus.RESTRICTED:t.SweepStatus.USER_CONTINUED_ACTION,version:t.SweepStatusVersion.END_STATE_WEB_OVERQUOTA_RESTRICTIONS})},abortCallback:()=>{R({status:r?t.SweepStatus.RESTRICTED:t.SweepStatus.USER_ABORTED_ACTION,version:t.SweepStatusVersion.END_STATE_WEB_OVERQUOTA_RESTRICTIONS})}})})).catch((e=>{R({status:t.SweepStatus.FAILURE,version:t.SweepStatusVersion.END_STATE_WEB_OVERQUOTA_RESTRICTIONS}),o.reportStack(`Error importing open_over_quota_restrictions_modal: ${JSON.stringify(e)}`,{severity:o.SEVERITY.NONCRITICAL,tags:["last-mile","over_quota_restrictions_modal"]})})):new Promise((function(t,i){e(["./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_sweep_blocking_modal"],t,i)})).then((e=>{e.openOverQuotaSweepBlockingModal({..._,continueCallback:()=>{R({status:t.SweepStatus.USER_CONTINUED_ACTION,version:t.SweepStatusVersion.SWEEP_M1_OQ_PAINTED_DOOR})},abortCallback:()=>{R({status:t.SweepStatus.USER_ABORTED_ACTION,version:t.SweepStatusVersion.SWEEP_M1_OQ_PAINTED_DOOR})}})})).catch((e=>{R({status:t.SweepStatus.FAILURE,version:t.SweepStatusVersion.SWEEP_M1_OQ_PAINTED_DOOR}),o.reportException({err:e,tags:["last-mile","over_quota_sweep_blocking_modal"]})}))}),[s,x,L,m]);c.default.useEffect((()=>{var e,o,r,s;if(i&&!(V||A.isLoading||g.isLoading)){if(A.error&&R({status:t.SweepStatus.FAILURE,version:t.SweepStatusVersion.SWEEP_M1_OQ_PAINTED_DOOR}),(g.error||q)&&R({status:t.SweepStatus.FAILURE,version:t.SweepStatusVersion.END_STATE_WEB_OVERQUOTA_RESTRICTIONS}),!I.active_user||I.active_user.is_team)return R({status:t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL});if(g.variant!==a.Variant.V1||!U||!P){if(I.is_paired&&D)return R({status:t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL});if([a.Variant.V1,a.Variant.CONTROL].includes(b)&&i&&T.includes(i)&&![a.Variant.V1].includes(h)&&a.logExposure({feature:"sweep_m1_oq_painted_door",variant:b}),F)[t.SweepStatus.LOADING].includes(p.status)&&(R({status:t.SweepStatus.OPEN,version:t.SweepStatusVersion.END_STATE_WEB_OVERQUOTA_RESTRICTIONS}),B({action:i,enforceRestrictions:null===(e=null==C?void 0:C.restrictions)||void 0===e?void 0:e.enforce_restrictions}));else{if(![a.Variant.V1].includes(b)&&!L)return R({status:t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL});if(D){if([t.SweepStatus.LOADING].includes(p.status)){if(!(!(I.active_user.paid||(null===(o=null==C?void 0:C.quota_ratio)||void 0===o?void 0:o.in_excluded_nses))&&(null===(r=I.active_user)||void 0===r?void 0:r.role)===a.ROLE_PERSONAL&&((null===(s=null==C?void 0:C.quota_ratio)||void 0===s?void 0:s.user_quota_usage_ratio)||0)>1))return R({status:t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL});R({status:t.SweepStatus.OPEN,version:t.SweepStatusVersion.SWEEP_M1_OQ_PAINTED_DOOR}),B({action:i})}}else R({status:t.SweepStatus.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL})}}}}),[i,p.status,I,V,b,A.isLoading,A.error,g.isLoading,g.variant,g.error,q,x,s,null===(d=null==C?void 0:C.restrictions)||void 0===d?void 0:d.enforce_restrictions,null===(v=null==C?void 0:C.restrictions)||void 0===v?void 0:v.show_restrictions_warning,L,F,B,D,P,C,h,U]),c.default.useEffect((()=>{N.current=p.status}),[p.status]),c.default.useEffect((()=>{(null==s?void 0:s.file_id)&&"quick_view"===i&&![t.SweepStatus.OPEN,t.SweepStatus.LOADING].includes(N.current)&&R({status:t.SweepStatus.LOADING})}),[null==s?void 0:s.file_id,i]);const M=g&&[a.Variant.V1,a.Variant.CONTROL,a.Variant.HOLDOUT].includes(h)&&!!i&&f.includes(i)&&!P&&!q&&((null===(E=null==C?void 0:C.restrictions)||void 0===E?void 0:E.enforce_restrictions)||(null===(S=null==C?void 0:C.restrictions)||void 0===S?void 0:S.show_restrictions_warning));return c.default.useEffect((()=>{M&&(a.logExposure({feature:"end_state_web_overquota_restrictions",variant:h}),l.logAdditionalExposureDetails(h,i,C))}),[M,h,i,C]),p}}));
//# sourceMappingURL=c_over-quota_over-quota-sweep-blocking-modal_use_over_quota_sweep_blocking_modal.js-vfllebq0b.map

//# debugId=0c5cda6f-6d93-3afb-86f4-c3f788d64b0f