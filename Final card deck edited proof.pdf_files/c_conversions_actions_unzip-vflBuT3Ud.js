!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="db9f3ebf-df67-33b7-91aa-10a92c324a95")}catch(e){}}();
define(["require","exports","./c_core_i18n","./c_pap-events_previews_select_doc_page","./c_extensions_data_selectors","react","./c_pdf_editor_utils_entry_point_util","./c_unity_features","./e_ui_page_files_router","./c_pap-events_duplicate_files_open_duplicate_files_page","./c_integrations_hellosign_deep_integration_constants","./c_action_bar_action_bar_strings","./c_flows_redux_reducer","./c_flows_utils_browse_logger","./c_flows_redux_store","./c_flows_utils_async_modal_launchers","./c_flows_redux_actions","./c_flows_redux_selectors","./c_dig-icons_assets_ui-icon_line_rewind","./c_bem","./c_flows_logging_flows_loggers","./e_edison","./c_flows_utils_auto_folder_helpers","react-dom","./c_dig-icons_assets_ui-icon_line_zip"],(function(e,t,n,i,o,a,r,s,l,c,u,d,p,_,f,g,m,h,v,y,E,A,T,S,b){"use strict";function M(e){return e&&e.__esModule?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var I=M(a),O=w(S);const N={0:{displayName:n.intl.formatMessage({id:"wYkgel",defaultMessage:"DEFAULT"})},1:{displayName:n.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"}),developerDescription:n.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"})},2:{displayName:n.intl.formatMessage({id:"aIQiHy",defaultMessage:"PDF Editing"}),developerDescription:n.intl.formatMessage({id:"fG5ZbA",defaultMessage:"PDF editing"})},3:{displayName:n.intl.formatMessage({id:"e6EJBF",defaultMessage:"View or Edit"}),developerDescription:n.intl.formatMessage({id:"p+tBI0",defaultMessage:"View or edit"})},4:{displayName:n.intl.formatMessage({id:"gN/zWT",defaultMessage:"Image Editing"}),developerDescription:n.intl.formatMessage({id:"KQT2xh",defaultMessage:"Image editing"})},5:{displayName:n.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"}),developerDescription:n.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"})},6:{displayName:n.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"}),developerDescription:n.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"})},8:{displayName:n.intl.formatMessage({id:"UwFkjc",defaultMessage:"Edit"}),developerDescription:n.intl.formatMessage({id:"RBrgq4",defaultMessage:"Video Editing"})},9:{displayName:n.intl.formatMessage({id:"Ufb68N",defaultMessage:"Send with"}),developerDescription:n.intl.formatMessage({id:"tBDUcB",defaultMessage:"Send Files"})},10:{displayName:n.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"}),developerDescription:n.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"})},11:{displayName:n.intl.formatMessage({id:"gffk/L",defaultMessage:"Send to notary"}),developerDescription:n.intl.formatMessage({id:"O/A0V6",defaultMessage:"Notarize"})},12:{displayName:n.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"}),developerDescription:n.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"})},13:{displayName:n.intl.formatMessage({id:"VlZABW",defaultMessage:"Publish"}),developerDescription:n.intl.formatMessage({id:"itZX4g",defaultMessage:"Publish Video"})},14:{displayName:n.intl.formatMessage({id:"E0v6mC",defaultMessage:"Share with"}),developerDescription:n.intl.formatMessage({id:"uukIVm",defaultMessage:"Share a file"})}};var F;function x(e,t,n){e&&e.event(t,n)}function C(e){return e.link_state[".tag"].indexOf("_linked")>=0}function k(e,t){if(e.priority&&t.priority){const n=t.priority-e.priority;return 0!==n?n:e.description<t.description?-1:e.description>t.description?1:0}return e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0}function D(e,t){s.UnityFeatures.file_browser_display_name((function(n){e.file_browser_display_name=n,t(e)}),(()=>t(e)))}!function(e){function t(e){return N[e]||null}e.DEFAULT=0,e.ESIGNATURE=1,e.PDF_EDITING=2,e.VIEW_OR_EDIT=3,e.IMAGE_EDITING=4,e.VIDEO_COMMENT=5,e.SEND_FAX=6,e.OPEN_WITH_CLOUD_DOC=7,e.VIDEO_EDITING=8,e.SEND_WITH=9,e.CLOUD_EDITORS=10,e.SEND_TO_NOTARY=11,e.EXPENSE=12,e.PUBLISH=13,e.SHARE_WITH=14,e.getDisplayName=function(e){const n=t(e);return n&&n.displayName},e.getDeveloperDescription=function(e){const n=t(e);return n&&n.developerDescription||null}}(F||(F={}));const P={isUnityEnabled:function(){return s.UnityFeatures.isUnitySupported()},isFileInUnityCache:function(e,t){return!!r.UnityCheckFileCache.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return s.UnityFeatures.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return r.UnityCheckFileCache.get(e,t)},fetchUnityFileInfo:function(e,t,n,i,o){s.UnityFeatures.check_file(e,t,n,(e=>{e.is_locally_available?D(e,i):i(e)}),o)},getUnityFileInfo:function(e,t,n,i,o){if(P.isFileInUnityCache(e,t)){const n=P.getFileInfoFromUnityCache(e,t);n.is_locally_available&&null==n.file_browser_display_name?D(n,i):i(n)}else P.fetchUnityFileInfo(e,t,n,i,o)},openFile:function(e,t,n,i){s.UnityFeatures.open_file(e,t,n,s.UnityFeatures.standard_open_file_handler,(()=>s.UnityFeatures.standard_open_file_handler(!1)),i)},isUnityFolderSupported:function(e){return null!=e&&(!!e.is_locally_available||!!e.is_infinite_placeholder)&&P.clientSupportsOpenInFileBrowser()},isUnityFileSupported:function(e){return null!=e&&!!e.is_locally_available&&!1!==e.can_open_directly},getUnityFileInfoIfAppropriate:function(e,t,n,i){!(e instanceof l.FileSharedWithMe)&&l.isBrowseFile(e)&&t&&P.isUnityEnabled()&&P.getUnityFileInfo(e.ns_id,e.ns_path,t.id,n,i)}};var L;!function(e){e[e.NO_TOOLTIP=0]="NO_TOOLTIP",e[e.BIG_ONBOARDING_TOOLTIP=1]="BIG_ONBOARDING_TOOLTIP",e[e.SMALL_TOOLTIP=2]="SMALL_TOOLTIP"}(L||(L={}));class R{constructor(e){this.category="web-app_actions_telemetry",this.user_id=null,this.session_id=null,this.request_id=null,this.url=null,this.telemetry_session_id=e.telemetry_session_id,this.event_name=e.event_name,this.event_start_ts=e.event_start_ts,this.event_extras=e.event_extras,Object.seal(this)}}class U{static generateRandomId(){return Math.random().toString(36).substring(2)}static getCurrentTimestamp(){return(new Date).getTime()}constructor(e,t){this.logger=e,this.context=t,this.sessionId=U.generateRandomId()}event(e,t){const n=U.getCurrentTimestamp(),i={...this.context,...t},o=new R({telemetry_session_id:this.sessionId,event_name:e,event_start_ts:n,event_extras:JSON.stringify(i)});this.logger.log(o)}}class B{constructor(e,t){this.logger=e,this.context=t||{}}session(e){const t={...this.context,...e};return new U(this.logger,t)}}const G=new l.HiveLogger;function V(e){return new B(G,e)}const W=function(e){const t={};for(const n of e)t[n]=!0;return t}(["",".doc",".docx",".pdf",".dwg",".png",".jpg",".jpeg",".tiff",".m4v",".wmv",".mpg",".pptx",".xlsx",".pages",".numbers",".key"]);function z(e){return W[e]?e:"__REDACTED__"}var H,j,X;!function(e){e.SET_EXTENSIONS_FEATURE_FLAGS="EXTENSIONS/SET_EXTENSIONS_FEATURE_FLAGS",e.UPDATE_LINK_STATE="EXTENSIONS/UPDATE_LINK_STATE",e.UPDATE_EXTENSIONS_STATE="EXTENSIONS/UPDATE_EXTENSIONS_STATE"}(H||(H={})),function(e){e[e.LOADING=0]="LOADING",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED"}(j||(j={})),t.TriggerType=void 0,(X=t.TriggerType||(t.TriggerType={})).PrimaryButton="primary_button",X.SecondaryButton="secondary_button",X.SidebarPrimaryButton="sidebar_primary_button",X.ContextualRibbonPrimaryButton="contextual_ribbon_primary_button",X.CollapsedButton="collapsed_button",X.OpacityButton="opacity_button";l.injectInternalStyle("/static/metaserver/static/js/extensions/split_share_button_component.module.out-vflY76eBJ.css",(e=>"._docsend_tooltip_image_166e3_1{height:98px;width:157px}._docsend_lightbulb_icon_166e3_6{color:var(--color__attention__text);height:14px;width:16px}._docsend_badge_166e3_12{background:var(--color__attention__background);height:18px;width:26px}._button-wrapper_166e3_18{display:flex;white-space:nowrap}._button-wrapper_166e3_18._invisible_166e3_23{display:none}._unportaled-menu_166e3_27{white-space:nowrap}"));const q="_button-wrapper_166e3_18",Q="_invisible_166e3_23",K="_unportaled-menu_166e3_27",Y={testFlag:"test_gated_feature",hellosignDeepIntegration:"hellosign_deep_integration_sidebar",fileTransfersAppAction:"file_transfers_app_action"};function Z(e){const t={};return function(){const e=[];for(const t in Y)if(Y.hasOwnProperty(t)){const n=t;e.push([n,Y[n]])}return e}().forEach((([n,i])=>{const o=e[i];void 0!==o&&(t[n]=o)})),t}function J(e){const t={};e.bylines.forEach((e=>{let n=e.extension_id[".tag"];(function(e){return"app_id"in e})(e.extension_id)&&(n=e.extension_id.app_id),t[n]=e.byline}));const n=Z(e.stormcrow_assignments);return{bylines:t,featureFlags:n}}const $=I.default.lazy((async()=>{const{PopoverItems:t}=await new Promise((function(t,n){e(["./c_extensions_split_share_button.after-display"],t,n)}));return{default:t}}));$.displayName="LazyPopoverItems";const ee=()=>{const e=n.intl.formatMessage({id:"DsCb47",defaultMessage:"Loading modal"});return I.default.createElement(l.Menu.Segment,null,I.default.createElement(l.Menu.Row,null,I.default.createElement(l.Spinner,{key:"spinner",size:"small","aria-valuetext":e})))};l.prefetchIntegrationsData();const te=(e,t)=>{const n=I.default.useMemo((()=>V({component:"split-share-btn",...e})),[e]);return I.default.useMemo((()=>{if(e)return n.session({ext:z(t?"."+l.file_extension(l.filename(t.fq_path)):"")})}),[e,n,t])},ne={isVisible:!0,disabled:!1,triggerType:t.TriggerType.PrimaryButton,variant:"opacity"},ie=e=>{const t=e[0],n=I.default.useMemo((()=>e.map((e=>({...e,bytes:0})))),[e]),i=l.useAppActions().data,a=i.actions;return{primaryFile:t,appActions:I.default.useMemo((()=>o.getShareActionsForFiles(a,n)),[a,n]),featureFlags:I.default.useMemo((()=>J(i).featureFlags),[i])}},oe=({children:e,isVisible:n,isSingleFile:i,appActions:o,triggerType:a})=>{const r=a===t.TriggerType.ContextualRibbonPrimaryButton;return I.default.createElement("div",{className:l.cx(q,"extensions-split-share-btn",{[Q]:!n,[l.OAPulsarAction.SHARE_DO]:r,[l.OAPulsarAction.UNIVERSAL_PATHWAY_SHARE]:r})},e)};oe.displayName="ShareWrapper";const ae=l.requireCssWithComponent((t=>{const{user:i,files:o,context:a,isVisible:r,disabled:s,triggerType:d,shouldUsePortalPopover:p,variant:_,onDropdownOpen:f,onDropdownClose:g,actionSurface:m,size:h,showEduTooltip:v,previewsLogUserAction:y}={...ne,...t},{primaryFile:E,appActions:A,featureFlags:T}=ie(o),S=I.default.createRef(),b=te(a,E),[M,w]=I.default.useState(L.NO_TOOLTIP),O=l.useAfterDisplayModule({importer:async()=>({default:await new Promise((function(t,n){e(["./c_extensions_split_share_button.after-display"],t,n)}))})});I.default.useEffect((()=>{v&&T&&(async(e,t,n,i)=>{O&&"split_share_edu"===await O.getTooltipState(e,t,n,i)&&w(L.BIG_ONBOARDING_TOOLTIP)})(i,E,A,T)}),[O]);const N=I.default.useCallback((()=>{b&&b.event("popover_trigger_hover",{trigger_type:d})}),[b,d]),F=I.default.useCallback((e=>{if(e.preventDefault(),M===L.BIG_ONBOARDING_TOOLTIP&&w(L.NO_TOOLTIP),e.stopPropagation(),"digClickOutsideisActiveLayer"===e.target.dataset.testid&&"click"===e.type){const e=new Event("click");document.dispatchEvent(e)}}),[M]),x=I.default.useCallback((({isOpen:e})=>{e&&f?f():!e&&g&&g(),b&&b.event(e?"open_popover":"close_popover",{trigger_type:d}),m===l.ActionSurfaceLogValue.PREVIEW_TITLEBAR&&e?null==y||y(l.UserAction.ShareMenu,l.UserActionContext.PreviewTopNav):l.UDCL.logEvent(c.PAP_Select_ShareMenu({actionSurface:"browse_screen",actionElement:u.getActionElementForPAP(m)}))}),[m,b,g,f,d,y]);return I.default.createElement(oe,{isVisible:r,appActions:A,isSingleFile:!1,triggerType:d},I.default.createElement(l.Menu.Wrapper,{className:l.cx("extensions-split-share__popover",{[K]:!p,"down-arrow-share-button-prompt-select":!0}),onClick:F,onDoubleClick:F,onSelection:e=>{e.handler()},onToggle:x,closeOnSelection:!0,isPortaled:p,"data-tooltip":"split-share-menu",ref:S},(({getContentProps:e,getTriggerProps:i})=>{return I.default.createElement(I.default.Fragment,null,I.default.createElement(l.Button,{disabled:s,...(o=i(),{className:l.cx("extensions-split-share-menu__trigger"),tabIndex:r?void 0:-1,onMouseEnter:N,"aria-label":n.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"}),"data-testid":"share-menu-dropdown",...o}),withIconLeft:I.default.createElement(l.UIIcon,{src:l.ShareArrowLine,className:"extensions-split-share--icon"}),variant:_,withDropdownIcon:!0,size:h},n.intl.formatMessage({id:"DHK0zq",defaultMessage:"Share all selected"})),I.default.createElement(l.Menu.Content,{placement:"bottom-end",className:"rc-action-bar-submenu-content",...e()},I.default.createElement(I.default.Suspense,{fallback:I.default.createElement(ee,null)},I.default.createElement($,{...t,currentSession:b,menuTriggerRef:S,isMenuOnly:!1}))));var o})))}),["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]),re=e=>{const t=te(e.context,e.files[0]);return I.default.createElement(I.default.Suspense,{fallback:I.default.createElement(ee,null)},I.default.createElement($,{...e,currentSession:t,isMenuOnly:!0}))};re.displayName="SplitShareButtonMenuDisplay";const se=l.requireCssWithComponent(re,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]),le=n.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),ce=e=>{const{user:i,files:a,context:r,isVisible:s,disabled:c,triggerType:u,showLeftDigIcon:p,variant:_,onShowShare:f,logShareButtonClick:g,actionSurface:m,isLoading:h,size:v,previewsLogUserAction:y,currentFolderOnly:E,fileActionLoggingFn:A}={...ne,...e},{primaryFile:T,appActions:S}=ie(a),b=I.default.useRef(null),M=te(r,T),w=l.cx("extensions-split-share__share-button",{"primary-action-menu__button":u===t.TriggerType.SidebarPrimaryButton,[l.OAPulsarPrimaryButton]:u===t.TriggerType.ContextualRibbonPrimaryButton}),{variant:O,isLoading:N}=l.useExperimentVariant("sm24_obj_metadata_new_api"),F=!N;I.default.useEffect((()=>{T.is_dir||m!==l.ActionSurfaceLogValue.PREVIEW_TITLEBAR||F&&(l.logExposure({feature:"sm24_obj_metadata_new_api",variant:O}),"V1"===O&&T.file_id&&o.prefetchSharingObjectMetadata(T.file_id))}),[O,F,T,m,i]),I.default.useEffect((()=>{T.is_dir&&m===l.ActionSurfaceLogValue.RIGHT_SIDEBAR&&F&&(l.logExposure({feature:"sm24_obj_metadata_new_api",variant:O}),"V1"===O&&T.target_ns!==i.home_ns_id&&T.target_ns!==i.root_ns_id&&T.file_id&&o.prefetchSharingObjectMetadata(T.file_id))}),[O,F,T,m,i]);const x=I.default.useCallback((e=>{e.preventDefault(),f(b),null==A||A("share"),g&&g(l.ActionSourceValue.SPLIT_SHARE),null==y||y(l.UserAction.Share,l.UserActionContext.PreviewTopNav),M&&M.event("click_share",{trigger_type:u}),e.stopPropagation()}),[f,g,M,u,y]),C=I.default.useCallback((()=>{M&&M.event("share_hover",{trigger_type:u})}),[M,u]),k={"aria-label":le,className:w,onClick:x,tabIndex:s?void 0:-1,onMouseEnter:C};return I.default.createElement(oe,{isVisible:s,appActions:S,isSingleFile:!0,triggerType:u},I.default.createElement(l.Button,{...k,withIconLeft:p&&I.default.createElement(l.UIIcon,{src:l.ShareArrowLine,className:"extensions-split-share--icon"}),variant:_,"data-testid":"share-button",disabled:c||h,size:v,ref:b},h?I.default.createElement(l.Spinner,{size:"small","aria-valuetext":le}):E?n.intl.formatMessage(d.SHARE_FOLDER_ACTION_STRING):u===t.TriggerType.ContextualRibbonPrimaryButton||u===t.TriggerType.SidebarPrimaryButton?n.intl.formatMessage(d.SHARE_SELECTED_ACTION_STRING):le))};ce.displayName="SingleFileShareButtonDisplay";const ue=l.requireCssWithComponent(ce,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]);function de(e){return e?("/"!==e.charAt(0)&&(e=`/${e}`),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""}function pe(e){if(!e)return{name:"",ext:""};const t=e.split("."),n=e.length>0&&"."===e[0];let i=e.indexOf(".")<0;n&&(i=t.length<=2);const o=t.pop();return o&&!i?{name:t.join("."),ext:o}:{name:e,ext:""}}function _e(e){return e.split("/").slice(0,-1).join("/")||"/"}const fe=l.withViewer((e=>{const{text:t,resultPath:n,user:i,viewer:o,clickableFileName:a,loggingFunctions:r,source:s}=e;return a?I.default.createElement(l.Link,{inverse:!0,href:l.get_browse_root(o,i)+y.URI.encode_parts(n),onClick:()=>{null==r||r.logConvertOpen(s)},display:"inline"},t):t}));function ge(e,t){return l.isBrowseFile(e)||(null==t?void 0:t.linkType)===l.SharedLinkType.Content?{identifier:{file_id:e.file_id,".tag":"file_id"}}:{identifier:{shared_link_url:e.href?e.href:"",".tag":"shared_link_url"}}}const me={generic_error:"failGeneric",permission_error:"failGeneric",unsupported_error:"failGeneric",filesystem_error:"failGeneric",filesystem_transient_error:"failRetryable",over_quota_error:"failOverQuota",riviera_permanent_error:"failGeneric",riviera_retryable_error:"failRetryable",riviera_too_large_error:"failTooLarge",riviera_source_corrupt_error:"failCorrupt",riviera_password_protected_error:"failPassword",password_protected_shared_link_error:"failPasswordLink",riviera_internal_failure_error:"failGeneric",riviera_invalid_request_error:"failGeneric",riviera_unsupported_format_error:"failGeneric",other:"failGeneric"};function he(e){const t=null==e?void 0:e.error;return function(e){return e&&e[".tag"]&&e[".tag"]in me}(t)?me[t[".tag"]]:"failGeneric"}function ve(e){return t=>{if(1!==t.length||t[0].is_dir)return!1;const n=l.getExtension(t[0]);return e.includes(n)}}function ye(e,t,n){const i=l.filename(e),o=l.parentDirName(e);return o?t(i,o):n(i)}function Ee(e){return{logConvert:(t,n=1)=>{E.PapLogger.logInitiateFileConversion(e,n,t)},logConvertRetry:(t,n=1)=>{E.PapLogger.logSelectFileConversionRetryButton(e,n,t)},logConvertClose:(t,n=1)=>{E.PapLogger.logDimissFileConversionSnackbar(e,n,t)},logConvertOpen:t=>{E.PapLogger.logSelectFileConversionOpenButton(e,t)}}}function Ae(e,t,n){const i={update_adoption_status_arg:{".tag":"update_automated_adoption_status_arg",conversion_type:e,folder_rule_action:t,do_not_show:n}};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(l.mustGetActiveUserApiV2Properties())).rpc("update_adoption_status",i,{})}const Te={icon:v.AutomationLine,name:"automate_current_folder",text:n.intl.formatMessage({id:"/Z33r/",defaultMessage:"Yes, automate folder"}),onClick:we((async function e(t){Ne();const{filePath:n,conversionArg:i,userId:o,ns_id:a}=t;if(!i)return;const{conversionType:r,folderRuleAction:s}=i;Ae(r,s,!1);const c=l.parent_dir(n),u=l.parentDirName(n);_.showPendingSnackbar({folderName:u,type:"add"});const d=f.getStoreForAutomations(),g=await Fe(i);if(!g)return void _.showErrorSnackbar({folderName:u,onRetry:()=>{e(t)},type:"generic-add"});await p.updateFolderRule({fqPath:c,actions:[{actionType:s,data:g}],enabled:!0,applyToExistingFiles:!1,trigger:p.DEFAULT_CLIENT_FOLDER_TRIGGER}).then((()=>{_.logAutoFolderEvent(l.WebUserActionLogEvent.CONFIRM_ADD_FOLDER_RULES,{user_id:o,file_nsid:a,extra:{rule_type:s,entry_point:"adoption_snackbar"}}),d.dispatch(m.addUserAutomation({actions:[{actionType:s,data:g}],inheritable:!1,fqPath:c,isEnabled:!0,nsId:a,trigger:p.DEFAULT_CLIENT_FOLDER_TRIGGER})),_.showSuccessSnackbar({folderName:u,shouldShowDashboardCta:!0,type:"add"})}),(n=>{var i;_.logAutoFolderEvent(l.WebUserActionLogEvent.CONFIRM_ADD_FOLDER_RULES,{user_id:o,file_nsid:a,extra:{rule_type:s,error:null===(i=n.error)||void 0===i?void 0:i[".tag"],entry_point:"adoption_snackbar"}}),_.showErrorSnackbar({folderName:u,onRetry:()=>{e(t)},type:"generic-add"})}))}),"automate_folder")},Se={name:"show_me_how_to_automate",text:n.intl.formatMessage({id:"Y2ppp4",defaultMessage:"Show me"}),onClick:we(Ie,"show_me")},be={name:"do_not_show_me_this_again",text:n.intl.formatMessage({id:"g74H0b",defaultMessage:"Skip"}),onClick:we(Oe,"dont_show_again")};function Me(e){const{user:t,conversionType:i,folderRuleAction:o,resultPath:a,source:r,nsId:s}=e;if(!function(e){const t=!!l.isInsideFlowsEligibleFolder(l.getStoreForBrowse().getState()),n=null!=h.getUserAutomation(l.parent_dir(e))(f.getStoreForAutomations().getState());return t&&!n}(a))return;const c={user:t,conversionType:i,folderRuleAction:o,fileType:"unzip"===o?void 0:e.fileType,source:r},u={userId:t.id,filePath:a||"",ns_id:s,conversionArg:c},d="unzip"===o?n.intl.formatMessage({id:"+Ath7j",defaultMessage:"Want to automatically unzip files by setting up an automated folder?"}):n.intl.formatMessage({id:"+9Utp7",defaultMessage:"Want to automatically save {fileType} copies by setting up an automated folder?"},{fileType:e.fileType.toUpperCase()});return{actions:[Te,Se,be],helperText:d,clickHandlerArgs:u}}function we(e,t){return n=>{const{userId:i,conversionArg:o,ns_id:a}=n;if(!o)return;const{folderRuleAction:r,source:s}=o;l.logAutoFolderAdoptionSnackbar({user_id:i,action_source:"adoption",event_name:l.WebUserActionLogEvent.AUTOMATED_FOLDER_ADOPTION_SNACKBAR_CLICK,file_nsid:a,trigger_rule:r,snackbar_click_option:t,source:s}),e(n)}}async function Ie({userId:e,filePath:t,ns_id:n,conversionArg:i}){if(!i)return;const{conversionType:o,folderRuleAction:a}=i,r=l.parent_dir(t),s=await Fe(i);Ae(o,a,!1),g.asyncLaunchWorkflowBuilder({operation:"add",folderFqPath:r,surface:"browse",entryPoint:"adoption_snackbar",actionElement:"adoption_snackbar",initialActionType:a,initialActionData:s,initialScreen:"settings",initialTriggerType:"file_add"}),Ne()}function Oe({userId:e,conversionArg:t}){if(!t)return;const{conversionType:n,folderRuleAction:i}=t;Ae(n,i,!0),Ne()}function Ne(){l.Snackbar.close("flows-conversion-snackbar")}async function Fe(t){const{folderRuleAction:n,fileType:i}=t,{loadWorkflowActionUi:o}=await new Promise((function(t,n){e(["./c_workflow_builder_workflow_actions_action_ui_config"],t,n)})).then((function(e){return e.action_ui_config_esnext})),a=o(n),r=null==a?void 0:a.defaultAction.data;if(r)switch(n){case"image_conversion":case"video_conversion":r.format=i}return r}l.injectInternalStyle("/static/metaserver/static/js/flows/conversions/adoption.module.out-vflavgTy9.css",(e=>"._adoptionTooltipContainer_kztpv_1{background-color:var(--color__core__primary);bottom:0;height:210px;margin-bottom:150px;margin-right:50px;padding:15px 15px 10px;position:fixed;right:0;width:220px;z-index:1000}._additionalButton_kztpv_14{margin-left:var(--spacing__unit--2)}._tooltipCloseButton_kztpv_18{margin-right:var(--spacing__unit--1);margin-top:var(--spacing__unit--1);position:absolute;right:0;top:0}@media only screen and (max-width:640px){._adoptionTooltipContainer_kztpv_1{display:none}}"));const xe="_adoptionTooltipContainer_kztpv_1",Ce="flows_adoption_tooltip";function ke(){const e=document.getElementById(Ce);e&&e.remove()}const De=({outputExt:e,folderRuleAction:t,clickHandlerArgs:i})=>{const o="unzip"===t?n.intl.formatMessage({id:"7bOS9k",defaultMessage:"Automatically unzip compressed files"}):n.intl.formatMessage({id:"W0dLEK",defaultMessage:"Automatically convert files to {outputExt}s"},{outputExt:null==e?void 0:e.toUpperCase()}),a="unzip"===t?n.intl.formatMessage({id:"kLjQYK",defaultMessage:"Set up this folder to automatically unzip compressed files as they are added."}):n.intl.formatMessage({id:"r7sQQK",defaultMessage:"Set up this folder to automatically convert files to {outputExt}s as they are added."},{outputExt:null==e?void 0:e.toUpperCase()});return I.default.createElement(I.default.Fragment,null,I.default.createElement(l.Title,{size:"medium",inverse:!0},o),I.default.createElement(l.IconButton,{variant:"borderless",className:"_tooltipCloseButton_kztpv_18",inverse:!0,onClick:ke},I.default.createElement(l.UIIcon,{src:l.CloseLine})),I.default.createElement(l.Text,{inverse:!0,size:"small",tagName:"p"},a),I.default.createElement(l.Button,{onClick:()=>{Ie(i),ke()},variant:"outline",inverse:!0},n.intl.formatMessage({id:"vvt1hU",defaultMessage:"Yes, show me"})),I.default.createElement(l.Button,{className:"_additionalButton_kztpv_14",onClick:()=>{Oe(i),ke()},variant:"transparent",inverse:!0},n.intl.formatMessage({id:"tEEvw9",defaultMessage:"Skip"})))};De.displayName="AdoptionTooltip";const Pe="flows-conversion-snackbar",Le=268435456;async function Re(e){var t;const{file:n,user:i,shareToken:o,conversionFn:a,loggingFunctions:r,conversionType:s,folderRuleAction:c,getAdoptionSnackbarProps:u,source:d,template:m,outputExt:v,asyncThresholdBytes:y}=e;g.logBrowseTTS("workflows_save_as"),r.logConvert(d);const E=y||Le;if(n.bytes>E&&m)return _.updateSnackbar({variant:"sync",title:"Loading"}),void await Ge(n,m,d,o);Ue({...e,state:"saving"});try{const r=await a(n,i,o);if(r){const o=u?u(r):void 0;let a=!1;if(o&&c){const e=await function(e,t){const n={check_adoption_status_arg:{".tag":"check_automation_adoption_status_arg",conversion_type:e,folder_rule_action:t}};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(l.mustGetActiveUserApiV2Properties())).rpc("check_adoption_status",n,{})}(s,c);a="show_automation_adoption_tooltips"===(null===(t=e.check_automation_adoption_status_result)||void 0===t?void 0:t[".tag"])&&e.check_automation_adoption_status_result.show_automation_adoption_tooltips.valueOf()}if(a&&"video-home"!==d){(function(){const e=f.getStoreForAutomations().getState(),t=h.getUserExperiments(e).find((e=>e.feature===p.UI_EXPERIMENTS.ADOPTION_UI_VARIANT));return"V3_TOOLTIP"===(null==t?void 0:t.variant)})()?(Ue({...e,state:"success",resultPath:r}),function(e,t,n){if(!e&&"unzip"!==t||!t||!n)return;let i=document.getElementById(Ce);i&&i.remove(),i=document.createElement("div"),i.className=xe,i.id=Ce,document.body.insertBefore(i,document.body.firstChild);const o=I.default.createElement(De,{outputExt:e,folderRuleAction:t,clickHandlerArgs:n});O.render(o,i)}(v,c,null==o?void 0:o.clickHandlerArgs)):(l.logAutoFolderAdoptionSnackbar({user_id:i.id,action_source:"adoption",event_name:l.WebUserActionLogEvent.AUTOMATED_FOLDER_ADOPTION_SNACKBAR_SHOW,file_nsid:n.ns_id,source:d,trigger_rule:c}),Ue({...e,state:"successAutomatedAdoption",resultPath:r,adoptionSnackbarProps:o}))}else Ue({...e,state:"success",resultPath:r})}else Ue({...e,state:"failGeneric"});return r}catch(t){const n=he(t);return void Ue({...e,state:n})}}function Ue(e){const{user:t,getStrings:i,state:o,resultPath:a,loggingFunctions:r,adoptionSnackbarProps:s,source:c}=e,u={...i(a||"",{clickableFileName:!!s,loggingFunctions:r,source:c}),open:n.intl.formatMessage({id:"+JIEsO",defaultMessage:"Open"}),close:n.intl.formatMessage({id:"In8b64",defaultMessage:"Close"}),retry:n.intl.formatMessage({id:"Y/tkCj",defaultMessage:"Try again"})},d={closeButtonText:u.close,onCloseClick:()=>r.logConvertClose(c)},p={saving:{variant:"sync",syncProgressLoop:!0},failGeneric:{variant:"fail",...d},failOverQuota:{variant:"fail",...d},failTooLarge:{variant:"fail",...d},failCorrupt:{variant:"fail",...d},failPassword:{variant:"fail",...d},failPasswordLink:{variant:"fail",...d},failRetryable:{variant:"fail",onActionClick:()=>{r.logConvertRetry(c),Re(e)},...d},successAutomatedAdoption:{variant:"complete",onActionClick:()=>Be(t,a,r,c),richSnackbarProps:s,...d},success:{variant:"complete",actionButtonText:u.open,onActionClick:()=>Be(t,a,r,c),...d}};l.Snackbar.update(I.default.createElement(l.Snackbar,{id:Pe,title:u[o],...p[o]}))}function Be(e,t,n,i){n.logConvertOpen(i),l.replace_location(l.preview_uri_for_fq_path(e,t))}async function Ge(e,t,n,i){const o=f.getStoreForAutomations();o.dispatch(m.setShouldSubscribeToBolt(!0));const a=T.mapConversionSourceToWorkflowEntrypoint(n),r=ge(e,i);let s;if(r&&r.identifier&&(s="shared_link_url"===r.identifier[".tag"]&&""!==r.identifier.shared_link_url?r.identifier.shared_link_url:void 0),l.isSharedFile(e)){o.dispatch(m.getWorkflowStepsConfig());const n=l.getActiveUserApiV2Properties(),{submitFileWorkflow:i}=l.makeMetaserverFlowsClient(new l.DefaultUserApiV2Client(n));i({template:t,file_ids:[e.file_id],shared_link_url:s},60)}else try{await p.submitFileWorkflow(t,[e.file_id],s),E.PapLogger.logSucceedSubmitManualWorkflow(a,t,1)}catch(e){E.PapLogger.logFailSubmitManualWorkflow(a,t,1,e)}}const Ve=n.defineMessage({id:"u1R/iY",defaultMessage:"Extract all"}),We="unzip",ze={actionText:n.intl.formatMessage(Ve),actionIcon:b.ZipLine,selector:ve(p.SUPPORTED_UNZIP_EXTENSIONS),convert:(e,t,n)=>{const{source:i}=n;return Re({...n,file:e[0],user:t,loggingFunctions:Ee(We),conversionType:We,folderRuleAction:"unzip",getStrings:(e,n)=>He(e,t,n),conversionFn:async(e,n,i)=>{const o=await function(e,t,n){const i={file:t,dest_path:n};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(e)).rpc("unzip",i,{})}(t,ge(e,i));return o.path},getAdoptionSnackbarProps:n=>Me({user:t,conversionType:We,folderRuleAction:"unzip",resultPath:n,source:i,nsId:e[0].ns_id}),template:{sequence:[{workflow_action:{".tag":"unzip"}}]},outputExt:"",asyncThresholdBytes:134217728})}},He=(e,t,i)=>{const o=n.intl.formatMessage({id:"gJnC96",defaultMessage:"Couldn't extract files"}),a=ye(e,((o,a)=>n.intl.formatMessage({id:"oxpxVW",defaultMessage:"Files extracted to <a>{folderName}</a> in {parentFolderName} folder"},{folderName:o,parentFolderName:a,a:n=>I.default.createElement(fe,{user:t,text:n,resultPath:e,clickableFileName:null==i?void 0:i.clickableFileName,loggingFunctions:null==i?void 0:i.loggingFunctions,source:null==i?void 0:i.source})})),(e=>n.intl.formatMessage({id:"TRohxO",defaultMessage:"Files extracted to {folderName} in your main Dropbox folder"},{folderName:e})));return{saving:n.intl.formatMessage({id:"Jk+n/I",defaultMessage:"Extracting files..."}),success:a,successAutomatedAdoption:a,failGeneric:o,failRetryable:o,failOverQuota:n.intl.formatMessage({id:"atcchQ",defaultMessage:"Couldn't extract because your Dropbox account is out of space"}),failTooLarge:n.intl.formatMessage({id:"Hgd1fQ",defaultMessage:"Couldn't extract files. Can only handle files up to {fileSize} MB"},{fileSize:512}),failCorrupt:n.intl.formatMessage({id:"00qMd1",defaultMessage:"Couldn't extract because the file is damaged"}),failPassword:n.intl.formatMessage({id:"xbgxEF",defaultMessage:"Couldn't extract because the file is password protected"}),failPasswordLink:n.intl.formatMessage({id:"UvS9P9",defaultMessage:"Couldn't extract because the file was shared using a password-protected link"})}};var je=Object.freeze({__proto__:null,UNZIP_ACTION_MESSAGE:Ve,UNZIP_MAX_FILESIZE_MB:512,UnzipAction:ze});t.SingleFileShareButton=ue,t.SplitShareButton=ae,t.SplitShareMenu=se,t.UNZIP_ACTION_MESSAGE=Ve,t.UNZIP_MAX_FILESIZE_MB=512,t.UnityHelpers=P,t.UnzipAction=ze,t.actionCompareFn=k,t.canConvertFile=function(e,t){return(l.isBrowseFile(e)||t&&t.canDownloadRoles.length>0)&&!l.isEncryptedFile(e)},t.convertDocToImage=function(e,t,n,i){const o={file:t,format:n,dest_path:i};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(e)).rpc("convert_doc_to_image",o,{})},t.convertFileAndShowSnackbar=Re,t.convertImageFormat=function(e,t,n,i){const o={file:t,format:n,dest_path:i};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(e)).rpc("convert_image_format",o,{})},t.convertSingleFileAsynchronously=Ge,t.convertToPdf=function(e,t,n){const i={file:t,dest_path:n};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(e)).rpc("convert_to_pdf",i,{})},t.convertToSharingServiceInfo=function(e){try{const t={};return e.services.forEach((e=>{const n=e.service_type[".tag"];t[n]=e})),t}catch(e){}return{}},t.createTelemetryClient=V,t.file_extension=function(e){return pe(e).ext.toLowerCase()},t.filename=function(e,t){const n=(e=de(e)).split("/").pop();return n||(t||"Dropbox")},t.getAdoptionSnackbarProps=Me,t.getAppActionExtras=function(e){return{action_id:e.id,encoded_app_id:e.app_id,action_type:C(e)?"select_action":"select_connect"}},t.getConversionLoggingFunctions=Ee,t.getDefaultConversionStrings=function(e,t,i,o){const a=n.intl.formatMessage({id:"WthXj+",defaultMessage:"Couldn't save as {fileType}"},{fileType:e}),r=ye(t,((e,a)=>n.intl.formatMessage({id:"jyMgWg",defaultMessage:"<a>{fileName}</a> saved to {dirName} folder"},{fileName:e,dirName:a,a:e=>I.default.createElement(fe,{user:i,text:e,resultPath:t,clickableFileName:null==o?void 0:o.clickableFileName,loggingFunctions:null==o?void 0:o.loggingFunctions,source:null==o?void 0:o.source})})),(e=>n.intl.formatMessage({id:"ukwwi2",defaultMessage:"{fileName} saved to your main Dropbox folder"},{fileName:e})));return{saving:n.intl.formatMessage({id:"Bdb4J5",defaultMessage:"Saving {fileType}..."},{fileType:e}),success:r,successAutomatedAdoption:r,failGeneric:a,failRetryable:a,failOverQuota:n.intl.formatMessage({id:"QP2WHb",defaultMessage:"Couldn't save as {fileType} because your Dropbox account is out of space"},{fileType:e}),failTooLarge:n.intl.formatMessage({id:"cmnQAC",defaultMessage:"Couldn't save as {fileType} because the file is too large"},{fileType:e}),failCorrupt:n.intl.formatMessage({id:"INKSmo",defaultMessage:"Couldn't save as {fileType} because the file is damaged"},{fileType:e}),failPassword:n.intl.formatMessage({id:"dnnNdt",defaultMessage:"Couldn't save as {fileType} because the file is password protected"},{fileType:e}),failPasswordLink:n.intl.formatMessage({id:"qzTamN",defaultMessage:"Couldn't save as {fileType} because the file was shared using a password-protected link"},{fileType:e})}},t.getFileIdentifier=ge,t.getOpenOptionsWithLogging=function(e,t){return e.map((e=>({...e,handler:()=>{e.handler(),x(t,"select_legacy_action",{type:e.type,userAction:e.userAction})}})))},t.getPiiSafeExtension=z,t.handleShowByline=function(e,t){return()=>{x(t,"show_byline",{extension_id:e})}},t.isLinked=C,t.logEvent=x,t.mediaRemux=function(e,t,n,i){const o={file:t,dest_path:i,container:n};return l.GetFlowsRoutes(new l.DefaultUserApiV2Client(e)).rpc("media_remux",o,{})},t.multiFileWithExtensionSelector=function(e){return t=>!(t.length<1||t.some((e=>e.is_dir)))&&t.every((t=>e.includes(l.getExtension(t))))},t.normalize=de,t.parentDirName=function(e){const t=e.split("/");return t.length>1?t[t.length-2]:""},t.parent_dir=_e,t.parent_dirs=function(e){const t=[];let n=_e(e);for(;"/"!==n;)t.push(n),n=_e(n);return t},t.parseActionsForUserResult=J,t.partitionActions=function(e,t=0){const n=[],i=[],a=[],r=[],s=[];return e.sort(k).forEach((e=>{e.category===F.CLOUD_EDITORS?n.push(e):e.app_id===o.TRANSFER_FP_APP_ID?i.push(e):C(e)||function(e){return"oauth_prelinked"===e.link_state[".tag"]}(e)?a.push(e):void 0!==e.priority&&e.priority>0&&r.length<t?r.push(e):s.push(e)})),{cloudEditors:n,transferActions:i,installedActions:a,promotedActions:r,unpromotedActions:s}},t.partitionOptions=function(e){const t=[],n=[];let o,a,r,s,l,c,u,d,p;return e.forEach((e=>{const{type:_}=e;_===i.OpenButtonAction.UNITY_FILE||_===i.OpenButtonAction.UNITY_FOLDER?t.push(e):_===i.OpenButtonAction.OPEN_WITH||_===i.OpenButtonAction.OPEN_WITH_CLOUD_DOC?n.push(e):_===i.OpenButtonAction.DOWNLOAD?o=e:_===i.OpenButtonAction.PREVIEW_FILE?a=e:_===i.OpenButtonAction.OPEN_IN_REPLAY?r=e:_===i.OpenButtonAction.OPEN_IN_DESKTOP?s=e:_===i.OpenButtonAction.GO_TO_FOLDER?l=e:_===i.OpenButtonAction.OPEN_IN_NEW_TAB?c=e:_===i.OpenButtonAction.QUICK_VIEW?u=e:_===i.OpenButtonAction.INSTALL_DROPBOX_APP?d=e:_===i.OpenButtonAction.MANAGE_AS_ADMIN&&(p=e)})),{unityOptions:t,cloudEditorOptions:n,downloadOption:o,previewOption:a,openInReplayOption:r,openInDesktopOption:s,openInNewTabOption:c,goToFolderOption:l,openInQuickViewOption:u,installDropboxAppOption:d,manageAsAdminOption:p}},t.singleFileWithExtensionAndResolutionSelector=function(e,t){return(n,i,o)=>{if(1!==n.length||n[0].is_dir)return!1;const a=l.getExtension(n[0]),r="video"===(null==o?void 0:o[".tag"])?o.resolution_height:void 0,s="video"===(null==o?void 0:o[".tag"])?o.resolution_width:void 0;return!!(e.includes(a)&&t&&r&&s&&t<Math.min(r,s))}},t.singleFileWithExtensionSelector=ve,t.split_filename=pe,t.strictMultiFileWithExtensionSelector=function(e){return t=>!(t.length<=1||t.some((e=>e.is_dir)))&&t.every((t=>e.includes(l.getExtension(t))))},t.unzip_esnext=je,t.useUnity=(e,t,n)=>{const[i,o]=I.default.useState(),a=I.default.useCallback((()=>{o({local_path:null,resolved_local_path:null,can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1,open_application_identifier:null,open_application_name:null,path_is_dir:!1,error_message:null})}),[]);return I.default.useEffect((()=>{n||P.getUnityFileInfoIfAppropriate(e,t,o,a)}),[a,e,t,n]),i}}));
//# sourceMappingURL=c_conversions_actions_unzip.js-vflSQs9uK.map

//# debugId=db9f3ebf-df67-33b7-91aa-10a92c324a95