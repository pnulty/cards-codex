!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="babcaf2b-c883-3525-802a-74570085393c")}catch(e){}}();
define(["exports","react","./e_ui_page_files_router","./c_action_bar_action_bar_constants","./c_pap-events_folder_modal_select_create_folder_modal_create_button","./e_data_modules_stormcrow","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./e_core_exception","./c_core_i18n","./c_over-quota_over-quota-sweep-blocking-modal_use_over_quota_sweep_blocking_modal","./c_sharing_async_share_modal_util","./c_internals_content-manager-integration_async-show-access-management","./c_internals_access-management-modal_types","./c_bem","./c_pap-events_replay_shown_modal","./c_src_common_format_bytes","./c_lib_logging","./c_flux_action_type","./c_shared-link-attribution-tracking_components_sender_trackey_vendor","./c_sharing_sharing_pap_logging_copy_shared_link_util","./c_sharing_sharing_pap_logging_create_shared_link_util","./c_sharing_sharing_pap_logging_shared_link_util","./c_sharing_ui_notifications_util","./c_sharing_ui_util","./c_share_modal_evolution_utils_logging","./c_dig-icons_assets_ui-icon_line_passwords","./c_dig-icons_assets_ui-icon_line_restore","./c_internals_components_close-button","./c_lodash-es_lodash","./c_dig-icons_assets_ui-icon_line_minus","react-dom","./c_ncct_manual_assist_util","./c_core_notify","./e_edison","./c__rollupPluginBabelHelpers","./c_src_sink_index","./c_pap-events_pdf_edit_select_replace_original_confirmation","./c_memoize-one","react/jsx-runtime","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_chat_chat_constants","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-components_label_group_index","./c_dig-icons_assets_ui-icon_line_tag","./c_dig-icons_assets_ui-icon_line_table","metaserver/static/js/langpack","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_file_viewer_components_preview","./c_file_viewer_api_ui","./c_file_viewer_hooks_lifecycle_logging","./c_file_viewer_hooks_usePrevious","./c_file_viewer_utils_auto_open","./c_file_viewer_api_navigation","./c_file_viewer_hooks_logging","./c_core_utils_region","./c_file_viewer_keyboard_keyboard_connector","./c_core_utils_browser_detection","./c_file_viewer_api_data","./c_file_viewer_hooks_useExtractedText","./c_file_viewer_loading_indicator","./c_file_viewer_logging_timing","./c_web-vitals","./c_file_viewer_preview_archive_utils","./c_file_viewer_toolbar_utils","./c_dig-icons_assets_ui-icon_line_text-box","./c_dig-icons_assets_ui-icon_line_slides","./c_dig-icons_assets_ui-icon_line_quota-reached","./c_dig-icons_assets_ui-icon_line_show","./c_file_viewer_preview_text","./c_dig-content-icons_icons_file-generic-large","./c_quota_use_query_quota_upsell_info","./c_over-quota_utils_logger","./c_quota_utils","./c_ui_async_overquota_modal_controller","./c_pap-events_share_copy_shared_link","./c_common_logging-contexts_desktop-platform-logging-metadata","./c_sharing_sharing_pap_logging_common_util","./c_pap-events_duplicate_files_open_duplicate_files_page","./c_dig-components_banner_index","./c_dig-icons_pictogram_icon","./c_icon_icon_helper","./c_common_components_buttons"],(function(e,t,i,s,o,n,a,r,l,c,d,p,_,h,u,g,m,f,E,S,L,C,I,T,k,A,y,v,O,M,N,R,w,b,P,x,F,D,U,B,H,V,q,W,Y,G,K,z,j,Q,$,X,Z,J,ee,te,ie,se,oe,ne,ae,re,le,ce,de,pe,_e,he,ue,ge,me,fe,Ee,Se,Le,Ce,Ie,Te,ke,Ae,ye,ve,Oe,Me,Ne,Re,we){"use strict";function be(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var Pe=be(t);i.injectInternalStyle("/static/metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal.module.out-vfll5aE9s.css",(e=>"._modal-wrapper_1iria_2{background-color:var(--dig-color__background__subtle);border-radius:var(--dig-radius__xlarge);padding:12px}._modal-body_1iria_8{padding:0}._pending-screen_1iria_13{row-gap:var(--dig-spacing__micro__medium)}._error-screen_1iria_23,._pending-screen_1iria_13{align-items:center;display:flex;flex-direction:column;height:133px;justify-content:center}._error-screen_1iria_23{row-gap:var(--dig-spacing__micro__small)}._error-screen-text_1iria_32{text-align:center;width:80%}._error-screen-text_1iria_32,._error-screen-title-text_1iria_40{align-items:center;display:flex;flex-direction:column}._error-screen-title-text_1iria_40{margin-bottom:0}._header-section_1iria_48{align-items:center;display:flex;padding:0}._drawer-header-section_1iria_55,._drawer-modal-body_1iria_60{padding-left:var(--dig-spacing__micro__large);padding-right:var(--dig-spacing__micro__large)}._header-section-text-container_1iria_65{line-height:18px;max-width:280px;width:100%}._header-section-primary-text_1iria_71{font-family:var(--dig-type__family__title)}._link-container_1iria_76{background-color:var(--dig-color__background__base)}._link-copied-badge_1iria_80{text-wrap:nowrap;align-items:center;background-color:var(--dig-color__success__surface--state-1);border-radius:var(--dig-radius__small);color:var(--dig-color__success__base);display:flex;font-family:var(--dig-type__family__action);font-size:var(--dig-type__size__action__small);letter-spacing:var(--dig-type__letterspacing__action);margin-right:calc(var(--dig-spacing__micro__xsmall)*-1);padding-left:var(--dig-spacing__micro__small);padding-right:var(--dig-spacing__micro__small);white-space:nowrap;width:fit-content}._link-copied-badge-checkmark_1iria_100{padding-right:var(--dig-spacing__micro__xsmall)}._link-accessory-button_1iria_104{margin-right:calc(var(--dig-spacing__micro__xsmall)*-1)}"));const xe="_modal-wrapper_1iria_2",Fe="_modal-body_1iria_8",De="_header-section_1iria_48",Ue="_link-accessory-button_1iria_104",Be="copy-link-mini-modal__footer",He=({linkAccessLevel:e,linkAudience:t,contentType:s,fileInfo:o,fileUploadInfo:n,browseFileInfo:r,user:c,sharedLink:d,openShareModalSettings:p,isDrawerMode:_,onClose:h})=>{const u=()=>{let e;return o?e=o.fq_path:n?e=n.dest+"/"+n.name:r&&(e=r.fq_path),e},g=()=>{i.ShareTibEventLogger.log(c.id,f.TiburonEventName.ClickManageLinkSettings,i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,{...k.buildExtraFromLinkMetadata(d),fq_path:u()}),p(i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL)};return Pe.createElement(i.Box,{className:i.cx(Be,{"drawer-mode-footer":_})},Pe.createElement(i.Box,{className:`${Be}-content`},Pe.createElement(i.Text,{"data-testid":"link-info",style:{display:"flex",alignItems:"flex-start"},color:"subtle",size:_?"medium":"small"},(()=>{let e=null;return"public"===t?e=y.GlobeLine:"team"===t?e=i.TeamLine:"no_one"===t?e=i.LockLine:"password"===t&&(e=A.PasswordsLine),null===e?null:Pe.createElement(i.UIIcon,{"data-testid":"audience-icon",src:e,size:_?"medium":"small",style:{marginRight:"4px",paddingTop:_?"":"4px"}})})(),s?"public"===t?l.intl.formatMessage({id:"8kew9O",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===s}):"team"===t?l.intl.formatMessage({id:"LlzMnS",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===s}):"password"===t?l.intl.formatMessage({id:"2yevNp",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===s}):"no_one"===t?l.intl.formatMessage({id:"iv/o3s",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===s}):"":"public"===t?l.intl.formatMessage({id:"5n50wF",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"team"===t?l.intl.formatMessage({id:"HcnRtr",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"password"===t?l.intl.formatMessage({id:"ego60b",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"no_one"===t?l.intl.formatMessage({id:"VUeAlW",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):""),!C.isShortcutFileType(u())&&Pe.createElement(i.Button,{variant:"transparent",size:_?"medium":"small",style:{marginLeft:"8px",alignSelf:"flex-start",paddingTop:_?"":"2px"},onClick:g},l.intl.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))),Pe.createElement(a.CampaignContextualNudgeSection,{fqPath:u(),onClose:h}))};He.displayName="CopyLinkMiniModalFooterComponent";const Ve=i.requireCssWithComponent(He,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]),qe=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."});class We extends Pe.Component{render(){let e;if(this.props.isTriggeredAsShareModal)e=this.getContentName();else{if(this.props.stageType!==C.ModalStage.COPY&&this.props.stageType!==C.ModalStage.RESULT&&this.props.stageType!==C.ModalStage.ERROR_CLIENT)return null;e=((e,t,s)=>{switch(t){case C.ModalStage.COPY:return e.formatMessage({id:"UBFgfk",defaultMessage:"Copy link to"});case C.ModalStage.RESULT:return e.formatMessage({id:"Og6X3p",defaultMessage:"Link copied to"});case C.ModalStage.ERROR_CLIENT:return s?e.formatMessage({id:"fLNxZU",defaultMessage:"Couldn’t copy link to comment"}):e.formatMessage({id:"pTCiXO",defaultMessage:"Couldn’t copy link to"});default:return i.enforceExhaustive(t)}})(l.intl,this.props.stageType,this.props.isLinkToComment)}const t=!this.props.isTriggeredAsShareModal&&Pe.createElement(Pe.Fragment,null,Pe.createElement(i.Text,{size:"small",color:"subtle"},Pe.createElement(i.Truncate,{location:.5},this.getContentName())));return Pe.createElement("div",{className:"_header-section-text-container_1iria_65","data-testid":"clmm-header"},Pe.createElement(i.Text,{size:"medium",isBold:!0,className:"_header-section-primary-text_1iria_71"},Pe.createElement(i.Truncate,{location:.5},e)),t)}getContentName(){let e;if(this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e){const t=e.split("/");return t[t.length-1]}}}We.displayName="CopyLinkMiniModalHeaderComponent";const Ye=i.requireCssWithComponent(We,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]);class Ge extends Pe.Component{constructor(){super(...arguments),this.handleCopy=()=>{this.props.onCopyToClipboard(C.CopyLinkMethod.MANUAL)},this.renderRightAccessory=()=>this.props.stage===C.ModalStage.RESULT?Pe.createElement(i.Text,{className:"_link-copied-badge_1iria_80",isBold:!0},Pe.createElement(i.UIIcon,{src:i.CheckmarkLine,className:"_link-copied-badge-checkmark_1iria_100"}),l.intl.formatMessage({id:"zGjUch",defaultMessage:"Link copied"})):this.props.stage===C.ModalStage.COPY?Pe.createElement(i.Button,{className:Ue,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},(e=>e.formatMessage({id:"4nKHfq",defaultMessage:"Copy link"}))(l.intl)):this.props.stage===C.ModalStage.ERROR_CLIENT?Pe.createElement(i.Button,{className:Ue,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},(e=>e.formatMessage({id:"d5v7fB",defaultMessage:"Try again"}))(l.intl)):null}componentDidMount(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}render(){return Pe.createElement("div",{className:i.cx("copy-link-mini-modal__link",{"drawer-mode-link":this.props.isDrawerMode})},Pe.createElement(i.TextInput,{onCopy:this.handleCopy,size:"large","aria-label":l.intl.formatMessage({id:"qx4buj",defaultMessage:"Link for copy link click"}),value:this.props.sharedLink.url,readOnly:!0,onClick:this.props.focusOnInput,ref:this.props.inputRef,wrapperProps:{className:i.cx("link-container","_link-container_1iria_76")},withRightAccessory:this.renderRightAccessory()}))}}Ge.displayName="CopyLinkMiniModalLinkComponent";const Ke=i.requireCssWithComponent(Ge,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]);class ze extends Pe.default.Component{constructor(e){super(e),this.onWindowResize=O.throttle((()=>{this.props.isCenteredDisplayed||this.props.anchorRef.current||this.props.closeButtonHandler()}),500),this.handleClick=e=>{e.stopPropagation()},this.overlayRef=Pe.default.createRef(),this.tabRef=Pe.default.createRef(),this.state={tabIndex:0}}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(){var e;null===(e=this.overlayRef.current)||void 0===e||e.update()}render(){const{inputRef:e,stage:t,closeButtonHandler:s,linkAccessLevel:o,sharedLink:n,shouldFocusOnLink:a,focusOnInput:r,actionHandler:c,onCopyToClipboard:d,zIndexOverride:p,fileInfo:_,fileUploadInfo:h,browseFileInfo:u,linkAudience:g,user:m,openShareModalSettings:f,isLinkToComment:E,isTriggeredAsShareModal:S}=this.props,L=C.isDrawerMode(),I=Pe.default.createElement(Ye,{stageType:t,isLinkToComment:E,fileInfo:_,fileUploadInfo:h,browseFileInfo:u,isTriggeredAsShareModal:S});let T=Pe.default.createElement(Pe.default.Fragment,null);n&&r&&e&&(T=Pe.default.createElement(Ke,{sharedLink:n,focusOnInput:r,inputRef:e,onClickCopyLink:c,shouldFocusOnLink:a,onCopyToClipboard:d,stage:t,isDrawerMode:L}));let k=Pe.default.createElement(Pe.default.Fragment,null);if(n&&!S&&(t===C.ModalStage.RESULT||t===C.ModalStage.COPY||t===C.ModalStage.ERROR_CLIENT)){let e;"object"==typeof n&&".tag"in n&&(e=n[".tag"]),e||(e=n.file_type),k=Pe.default.createElement(Ve,{linkAccessLevel:o,linkAudience:g,contentType:e,fileInfo:_,fileUploadInfo:h,browseFileInfo:u,user:m,sharedLink:n,openShareModalSettings:f,isDrawerMode:L,onClose:s})}const A=Pe.default.createElement(Pe.default.Fragment,null,this.renderPendingScreen(),this.renderErrorScreen(),T,k),y=t===C.ModalStage.PENDING?()=>{}:s;if(L)return Pe.default.createElement(i.Drawer.ModalDrawer,{onRequestClose:y,"aria-label":"copy-link-mini-modal-drawer",isOpen:!0,alignment:"bottom",height:"100%",shouldAnimate:!0},Pe.default.createElement(i.Drawer.Container,null,Pe.default.createElement(i.Drawer.Header,{className:"_drawer-header-section_1iria_55"},Pe.default.createElement(i.Drawer.Layout,null,Pe.default.createElement(i.Drawer.LayoutItem,{width:"fill"},Pe.default.createElement(i.Drawer.Layout,null,I,Pe.default.createElement("div",{style:{marginLeft:"auto"}},Pe.default.createElement(v.CloseButton,{props:{onClick:y,ariaLabel:"Close"}})))))),Pe.default.createElement(i.Drawer.Body,{className:"_drawer-modal-body_1iria_60"},A)));if(this.props.isCenteredDisplayed)return Pe.default.createElement(i.Modal$1,{open:!0,isCentered:!0,width:442,onRequestClose:y,withCloseButton:(O=l.intl,O.formatMessage({id:"QKIeC9",defaultMessage:"Close"})),closeButtonProps:{disabled:t===C.ModalStage.PENDING}},Pe.default.createElement("div",{className:xe},Pe.default.createElement(i.Modal$1.Header,{className:De},I),Pe.default.createElement(i.Modal$1.Body,{className:Fe},A)));var O;const M=Pe.default.createElement(i.IconButton,{"aria-label":"close","data-testid":"clmm-close-button",onClick:s,variant:"transparent",style:{position:"absolute",top:"8px",right:"8px"},disabled:t===C.ModalStage.PENDING},Pe.default.createElement(i.UIIcon,{src:i.CloseLine,"aria-label":""}));return Pe.default.createElement(i.LayerContext.Provider,{value:{zIndex:p||20}},Pe.default.createElement(i.ClickOutside,{isActive:!0,onClickOutside:t===C.ModalStage.PENDING?void 0:s,shouldPropagateMouseEvents:!1,isBlock:!0,shouldClickOutsideWhenDefaultPrevented:!0},Pe.default.createElement(i.Overlay,{className:"copy-link-mini-modal__overlay",anchorRef:this.props.anchorRef,placement:this.props.placement||"bottom",auto:!0,offsetDistance:null!=this.props.yOffsetDistance?this.props.yOffsetDistance:4,onClick:this.handleClick,ref:this.overlayRef,style:{width:442,padding:0},onKeyDown:e=>{if(this.overlayRef.current){if("Escape"===e.key)return this.props.closeButtonHandler(),e.preventDefault(),void e.nativeEvent.stopImmediatePropagation();if("Tab"===e.key){if(!this.tabRef||!this.tabRef.current)return;e.preventDefault();const t=this.tabRef.current.querySelectorAll('button:not([disabled]), [href]:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])');let i,s=this.state.tabIndex;for(let e=0;e<t.length;e++){if(t[e]===document.activeElement){s=e;break}}i=e.shiftKey?(s-1+t.length)%t.length:(s+1)%t.length,t[i].focus(),this.setState({tabIndex:i})}}}},Pe.default.createElement("div",{className:xe,ref:this.tabRef},M,Pe.default.createElement(i.Modal$1.Header,{className:De},I),Pe.default.createElement(i.Modal$1.Body,{className:Fe},A)))))}renderPendingScreen(){return this.props.stage===C.ModalStage.PENDING?Pe.default.createElement(i.Box,{className:"_pending-screen_1iria_13"},Pe.default.createElement(i.Spinner,null),Pe.default.createElement(i.Text,{color:"subtle"},l.intl.formatMessage({id:"Fd4Wq1",defaultMessage:"Getting the link"}))):null}renderErrorScreen(){return this.props.stage===C.ModalStage.ERROR_SERVER?Pe.default.createElement(i.Box,{className:"_error-screen_1iria_23"},Pe.default.createElement(i.UIIcon,{src:M.FailPictogram,size:"large"}),Pe.default.createElement(i.Box,{className:"_error-screen-text_1iria_32"},Pe.default.createElement(i.Title,{className:"_error-screen-title-text_1iria_40",weightVariant:"emphasized",size:"small"},l.intl.formatMessage({id:"TffHle",defaultMessage:"Couldn’t copy link"})),Pe.default.createElement(i.Text,{color:"subtle"},this.props.errorMessage))):null}}ze.displayName="CopyLinkMiniModalOverlayComponent";const je=i.requireCssWithComponent(ze,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css","/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css"]);class Qe extends Pe.default.Component{constructor(e){super(e),this.logPAPAsShareModal=e=>{var t,s;const n=this.loggingKey,a="start"===e.loggingAction?i.UDCL.logStart:i.UDCL.logEnd,r="end"===e.loggingAction?e.eventState:void 0,l={actionElement:this.actionElement,actionSurface:null!==(t=this.actionSurface)&&void 0!==t?t:"unknown",isDir:"false",screen:null!==(s=this.screen)&&void 0!==s?s:"unknown"};a("ops.sm24.browse_load",{tags:l,key:n,eventState:r}),a(o.PAP_Load_ShareModal({eventState:r,actionElement:this.actionElement,actionSurface:this.actionSurface,contentAction:"share",sharedObjType:"file",fileExtension:this.props.file?i.getExtension(this.props.file):"",isDir:!1,screen:this.screen}),{tags:l,key:n})},this.getScreen=()=>this.props.isTriggeredAsShareModal?"pointer_modal_screen":this.props.isFromShareMe24Modal?"share_screen":void 0,this.getPAPLoggerContent=()=>this.props.file?C.getContentFromFile(this.props.file):this.props.browseFile?C.getContentFromFile(this.props.browseFile):this.props.fileUpload?C.getContentFromFileUpload(this.props.fileUpload):void 0,this.appendSenderTrackeyToLink=()=>{var e;this.sharedLink&&this.sharedLink.url&&!C.isShortcutFileType(null===(e=this.props.file)||void 0===e?void 0:e.fq_path)&&(this.sharedLink=E.getNewLinkMetadataWithSenderTrackeyURL(this.sharedLink,this.senderTrackey))},this.appendCommentIdToLink=()=>{this.sharedLink&&this.sharedLink.url&&this.props.commentId&&(this.sharedLink=C.getNewLinkMetadataWithUrlFragment(this.sharedLink,"comment_id="+this.props.commentId))},this.handleClipboardWriterCopyLinkToClipboard=()=>{var e;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),null===(e=this.props.clipboardWriter)||void 0===e||e.write(this.sharedLink.url),this.handleClipboardSuccess(C.CopyLinkMethod.CLIPBOARD_API)},this.handleCopyLinkToClipboard=(e=!1)=>{e&&S.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),r.copyToClipboard(this.sharedLink.url,(()=>{this.handleClipboardSuccess(C.CopyLinkMethod.EXEC_COMMAND)}),this.handleClipboardFailure)},this.handleClipboardSuccess=e=>{e!==C.CopyLinkMethod.MANUAL&&(this.setState({stage:C.ModalState.RESULT}),this.focusOnInput(),setTimeout((()=>{this.setState({stage:C.ModalState.COPY})}),5e3)),this.logEvent(f.TiburonEventName.CopySharedLink,{created_new_link:this.isLinkNewlyCreated,copy_method:e,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCopyLinkTime),sender_trackey:this.senderTrackey,commentId:this.props.commentId}),S.logPAPCopySharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})},this.handleOnCopyToClipboard=e=>{S.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.handleClipboardSuccess(e)},this.handleClipboardFailure=()=>{this.copyLinkToClipboardNewAPI()},this.copyLinkToClipboardNewAPI=()=>{if(navigator.clipboard){const e=this.sharedLink.url;navigator.clipboard.writeText(e).then((()=>{this.handleClipboardSuccess(C.CopyLinkMethod.CLIPBOARD_API)}),(()=>{this.handleClipboardFailureNewAPI()}))}else this.handleClipboardFailureNewAPI()},this.handleClipboardFailureNewAPI=()=>{this.exceptionType=C.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,this.failToFetchCopyLinkHelper()},this.getLinkActionTTI=e=>Date.now()-e,this.onClose=()=>{!this.props.isFromShareMe24Modal||"browse_screen"!==this.actionSurface&&"quick-view-browse"!==this.actionSurface&&"file_choose"!==this.actionSurface||T.trackUserLeapEvent(T.SharingUserLeapEvent.SM24_OOB_SHARE_COMPLETE_CLMM_CLOSED,this.origin),this.props.setIsCreatingSharedLink(!1,this.fileIdOrPath),this.props.userActionSource===i.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!1}),this.props.onActionFlowComplete&&this.props.onActionFlowComplete(),this.setState({isOpen:!1})},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.openShareModalSettings=async e=>{const t="editor"===this.getAccessLevel()?"edit_link_settings":"view_link_settings",s={origin:e,initialScreen:"settings",initialTab:t},o=()=>{if(this.props.file)d.asyncShowShareModal(this.props.user,this.props.file,s);else if(this.props.fileUpload)d.asyncShowShareModal(this.props.user,{fqPath:this.props.fileUpload.dest+"/"+this.props.fileUpload.name,isFolder:!1},s);else{if(!this.props.browseFile)return void I.sharingNotificationError(qe(l.intl));d.asyncShowShareModal(this.props.user,this.props.browseFile,s)}this.onClose()};if(!this.props.useSM24SettingsModal)return void o();const n="copy_link_mini_modal";let a;if(this.props.file)a=this.props.file;else if(this.props.fileUpload){const e=this.props.fileUpload.dest+"/"+this.props.fileUpload.name;try{a=await i.getFileInfo({file:{".tag":"fq_path",fq_path:e}})}catch(e){return r.reportStack("Copy Link Mini Modal - get_file_info error",{severity:r.SEVERITY.CRITICAL,tags:["sm24_error","copy_link_mini_modal"],exc_extra:{action_surface:this.actionSurface,action_element:n,file_extension:i.getExtension({filename:this.props.fileUpload.name})}}),void I.sharingNotificationError(qe(l.intl))}}else this.props.browseFile&&(a=this.props.browseFile);a?(p.asyncShowAccessManagementBrowse({fileOrFolder:a,user:this.props.user,actionSurface:this.actionSurface,actionElement:n,sessionId:Math.random().toString(),onFallback:o,initialScreen:_.Screen.SETTINGS,initialSettingsTab:t}),this.onClose()):I.sharingNotificationError(qe(l.intl))},this.inputRef=Pe.default.createRef(),this.state={isOpen:!0,stage:C.ModalState.PENDING},this.fileIdOrPath=this.getFileIdOrPath(),this.loggingKey=i.UUID.v4();const{actionSurface:t,actionElement:s,origin:n,contentAction:a}=this.getOriginAndAction();this.actionSurface=t,this.actionElement=s,this.contentAction=a,this.origin=n,this.requestedAccessLevel="default",this.screen=this.getScreen(),this.senderTrackey=E.vendSenderTrackey()}componentDidMount(){L.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen}),S.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.props.isTriggeredAsShareModal&&this.logPAPAsShareModal({loggingAction:"start"}),this.createSharedLink()}componentDidUpdate(e,t){!this.props.isTriggeredAsShareModal||t.stage!==C.ModalState.PENDING||this.state.stage!==C.ModalState.RESULT&&this.state.stage!==C.ModalState.COPY||this.logPAPAsShareModal({loggingAction:"end",eventState:"success"}),this.props.isTriggeredAsShareModal&&t.stage!==C.ModalState.ERROR&&this.state.stage===C.ModalState.ERROR&&this.logPAPAsShareModal({loggingAction:"end",eventState:"failed"})}createSharedLink(){this.props.setIsCreatingSharedLink(!0,this.fileIdOrPath),this.props.userActionSource===i.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!0}),this.startCreateLinkTime=Date.now();const e=C.getApiClient(this.props.user),t=this.requestedAccessLevel;e.createSharedLinkNonAlpha({fileIdOrPath:this.fileIdOrPath,settings:{access:t}}).then((e=>{this.startCopyLinkTime=Date.now(),this.succeedToFetchLinkHelper(e,!0),this.logEvent(f.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:this.getAccessLevel(),commentId:this.props.commentId})})).catch((e=>{this.startCopyLinkTime=Date.now(),e.error[".tag"]===C.CopyLinkException.SHARED_LINK_ALREADY_EXISTS?this.succeedToFetchLinkHelper(e.error.shared_link_already_exists.metadata,!1,e):e.error[".tag"]===C.CopyLinkException.ACCESS_DENIED?(this.exceptionType=C.CopyLinkException.ACCESS_DENIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===C.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===C.CopyLinkException.NOT_AUTHORIZED?(this.exceptionType=C.CopyLinkException.NOT_AUTHORIZED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===C.CopyLinkException.PATH&&e.error.path[".tag"]===C.CopyLinkException.NOT_FOUND?(this.exceptionType=C.CopyLinkException.NOT_FOUND,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===C.CopyLinkException.EMAIL_NOT_VERIFIED?(this.exceptionType=C.CopyLinkException.EMAIL_NOT_VERIFIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===C.CopyLinkException.BANNED_MEMBER?(this.exceptionType=C.CopyLinkException.BANNED_MEMBER,this.userMessage=e.message,this.failToFetchCopyLinkHelper(e)):(this.exceptionType=e.error[".tag"]?e.error[".tag"]:C.CopyLinkException.UNDEFINED_ERROR,this.failToFetchCopyLinkHelper(e)),this.logEvent(f.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:t,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId})}))}succeedToFetchLinkHelper(e,t,s){var o;this.sharedLink=e,this.isLinkNewlyCreated=t,this.httpCode=t?200:s&&s.raw&&s.raw.status,this.logEvent(f.TiburonEventName.SucceedCreateSharedLinkWithSettings,{created_new_link:t,http_status_code:this.httpCode,response_status:"success",is_alpha:!1,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),L.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen}),t&&this.props.file&&!this.props.isSearchMode&&i.getStoreForSharedWith().dispatch(i.sharedLinkDataOutOfDate(this.props.file.fq_path)),C.isBrowserCopyEnabled()?this.handleCopyLinkToClipboard():this.props.clipboardWriter?this.handleClipboardWriterCopyLinkToClipboard():(this.setState({stage:C.ModalState.COPY}),S.logPAPCopySharedLinkEvent({eventState:"canceled",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}));const n=null!==(o=this.props.file)&&void 0!==o?o:this.props.browseFile;if(n){const e={file_name:i.getFilename(n),file_extension:i.getExtension(n),file_path:n.fq_path};n.is_dir?i.publishEvent(i.CampaignEvents.FOLDER_OUT_OF_BAND_SHARE_SUCCESS,{context:{...e,is_team_folder:n.is_in_team_folder_tree?"true":"false"}}):i.publishEvent(i.CampaignEvents.FILE_OUT_OF_BAND_SHARE_SUCCESS,{context:e})}}failToFetchCopyLinkHelper(e){e&&(this.logEvent(f.TiburonEventName.FailCreateSharedLinkWithSettings,{error_message:this.exceptionType,http_status_code:e.raw&&e.raw.status,is_alpha:!1,timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),L.logPAPCreateSharedLinkEvent({eventState:C.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen})),this.setState({stage:C.ModalState.ERROR}),this.logEvent(f.TiburonEventName.CopySharedLinkFailure,{error:this.exceptionType,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId}),S.logPAPCopySharedLinkEvent({eventState:C.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,metadata:this.sharedLink?this.sharedLink:void 0,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})}getFileIdOrPath(){var e,t;return(null===(e=this.props.file)||void 0===e?void 0:e.file_id)||(null===(t=this.props.file)||void 0===t?void 0:t.fq_path)||this.props.filePath}getAccessLevel(){const e=this.sharedLink?this.sharedLink.link_permissions.link_access_level:void 0;let t="viewer";return e&&(t=e.hasOwnProperty(".tag")?e[".tag"]:e),t}getLinkVisibilityMapping(e){switch(e){case"public":case"password":case"no_one":return e;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}getLinkAudience(){if(!this.sharedLink)return;let e;const t=this.sharedLink.link_permissions;if(t.effective_audience)e=t.effective_audience,"object"==typeof e&&".tag"in e&&(e=e[".tag"]);else{let i;i=t.resolved_visibility,"object"==typeof i&&".tag"in i&&(i=i[".tag"]),e=this.getLinkVisibilityMapping(i)}return e}logEvent(e,t){var o,n;let a=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON;this.props.isFromShareMe24Modal?a=this.props.origin:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.RIGHT_SIDEBAR?a=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS_BUTTON:this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?a=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:this.props.userActionSource===i.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?a=i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.PREVIEW_TITLEBAR?a=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?a=this.props.isSearchMode?i.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?a=this.props.isSearchMode?i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE:i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(a=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR);const r=s.get_browser_info();i.ShareTibEventLogger.log(this.props.user.id,e,a,{...k.buildExtraFromLinkMetadata(this.sharedLink),file_id:null===(o=this.props.file)||void 0===o?void 0:o.file_id,fq_path:(null===(n=this.props.file)||void 0===n?void 0:n.fq_path)||this.props.filePath,browser:r.browser,browser_version:r.version,...t}),e===f.TiburonEventName.CopySharedLink&&T.trackUserLeapEvent(T.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,a)}getOriginAndAction(){let e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,t="browse_screen",s="browse_directory_row";const o=this.props.isTriggeredAsShareModal?"share":"copy_link";return this.props.isFromShareMe24Modal?(e=this.props.origin,t=this.props.actionSurface,s=this.props.actionElement):this.props.isSearchMode?(t="search",s="search_directory_row",this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?s="content_overflow_menu":this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON,s="content_tile"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE&&(e=i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE,t="search_quick_view",s=i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE)):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.RIGHT_SIDEBAR?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,s="action_bar_overflow_menu"):this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,s="context_menu"):(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,s="content_overflow_menu"):this.props.userActionSource===i.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?(e=i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL,s="upload_modal"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.PREVIEW_TITLEBAR?(e=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR,t="previews",s="preview_titlebar"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON,t="browse_screen",s="content_tile"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE,t="browse_quick_view",s=i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(e=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR,t="previews",s="comment"),{origin:e,actionSurface:t,actionElement:s,contentAction:o}}render(){if(!this.state.isOpen)return null;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink();const e=this.props.isCenteredDisplayed?{isCenteredDisplayed:!0}:{isCenteredDisplayed:!1,anchorRef:this.props.anchorRef,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement};switch(this.state.stage){case C.ModalState.PENDING:return Pe.default.createElement(je,{stage:C.ModalStage.PENDING,closeButtonHandler:this.onClose,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...e});case C.ModalState.COPY:return Pe.default.createElement(je,{stage:C.ModalStage.COPY,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!1,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...e});case C.ModalState.ERROR:if(this.exceptionType!==C.CopyLinkException.FAILED_COPY_TO_CLIPBOARD){if(this.exceptionType===C.CopyLinkException.BANNED_MEMBER&&this.userMessage)return this.onClose(),I.failBannerWithHelpCenter((e=>{const t=/^Error in call to API function \/[^:]+: /;return e&&t.test(e)?e.replace(t,""):e})(this.userMessage),T.ABUSE_HELP_ARTICLE_LINK),null;const t=((e,t)=>{switch(t){case C.CopyLinkException.ACCESS_DENIED:case C.CopyLinkException.NOT_AUTHORIZED:return e.formatMessage({id:"kyPbwf",defaultMessage:"You don’t have permission to create a link to this content"});case C.CopyLinkException.NOT_FOUND:return e.formatMessage({id:"Sh48Q6",defaultMessage:"We can’t find this file anymore. Try checking activity or folder history to see what happened."});case C.CopyLinkException.EMAIL_NOT_VERIFIED:return e.formatMessage({id:"JaPuez",defaultMessage:"You can’t share until you verify your email address"});default:return e.formatMessage({id:"Xfj5ph",defaultMessage:"Try reloading the page or asking us for <l>help</l>"},{l:e=>Pe.default.createElement(i.Link,{href:"https://help.dropbox.com",target:"_blank",rel:"noopener noreferrer",display:"inline"},e)})}})(l.intl,this.exceptionType);return Pe.default.createElement(je,{stage:C.ModalStage.ERROR_SERVER,closeButtonHandler:this.onClose,errorMessage:t,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...e})}return Pe.default.createElement(je,{stage:C.ModalStage.ERROR_CLIENT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,...e});case C.ModalState.RESULT:return Pe.default.createElement(je,{stage:C.ModalStage.RESULT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...e})}}}Qe.displayName="CopyLinkMiniModalComponent";const $e=e=>{const{variant:t}=i.useExperimentVariant("sm24_copy_link_mini_modal"),s="ON"===t;return Pe.default.createElement(Qe,{...e,useSM24SettingsModal:s})};$e.displayName="CopyLinkMiniModalWithHooks";const Xe=e=>Pe.default.createElement(n.QueryClientProvider,{client:n.queryClient},Pe.default.createElement(Je,{copyLinkMiniModalProps:e},(t=>Pe.default.createElement(a.ShareBlockingWrapper,{withLockedStateModal:e.withLockedStateModal,action:i.LockedStateModalAction.SHARE_LINK,onStatusChange:t=>{var s,o;if([i.Status.USER_ABORTED_ACTION,c.SweepStatus.RESTRICTED].includes(t)){const t=(null===(s=e.file)||void 0===s?void 0:s.file_id)||(null===(o=e.file)||void 0===o?void 0:o.fq_path)||e.filePath;e.setIsCreatingSharedLink(!1,t),e.onHoverLocked&&e.onHoverLocked({isOpen:!1})}}},Pe.default.createElement($e,{...e,...t})))));Xe.displayName="CopyLinkMiniModalWithProviders";const Ze=i.requireCssWithComponent(Xe,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css","/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css"]);Ze.show=(e,t)=>{i.Modal.showInstance(Pe.default.createElement(Ze,{...e}),!0,t)};const Je=({copyLinkMiniModalProps:e,children:t})=>{const[i,s]=Pe.default.useState(null),o=e.isCenteredDisplayed?void 0:e.anchorRef.current;return Pe.default.useEffect((()=>{if(!o)return;const e=o.getBoundingClientRect(),t=new DOMRect(e.x,e.y,e.width,e.height);s({current:{getBoundingClientRect:()=>t}})}),[o]),e.isCenteredDisplayed?Pe.default.createElement(Pe.default.Fragment,null,t({})):Pe.default.createElement(Pe.default.Fragment,null,i&&t({anchorRef:i}))};Je.displayName="DisplayPropsWrapper",e.CopyLinkMiniModal=Ze,e.CopyLinkMiniModalComponent=Qe}));
//# sourceMappingURL=c_views_copy_link_mini_modal_copy_link_mini_modal.after-display.js-vflgvgBQb.map

//# debugId=babcaf2b-c883-3525-802a-74570085393c