!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0ecb2c27-6fc8-3be8-967a-a8ddd273011a")}catch(e){}}();
define(["require","exports","react","./e_ui_page_files_router","./e_data_modules_stormcrow","./c_over-quota_utils_use_get_plans","./c_core_i18n","./c_dig-components_banner_index","./c_quota_use_query_quota_upsell_info","./c_growth-components_over-quota-file-viewer-modal","./c_quota_utils","./c_over-quota_utils_oq_price_decrease_helper"],(function(e,t,o,a,n,l,i,r,d,s,_,u){"use strict";function c(e){return e&&e.__esModule?e:{default:e}}var m=c(o);a.injectInternalStyle("/static/js/growth-components/auto-layout-modal/index.module.out-vflGbaM3w.css",(e=>"._bannerSection_6ww7a_1{margin-bottom:var(--dig-spacing__macro__small);margin-top:var(--dig-spacing__micro__small)}._sideBySideContentContainer_6ww7a_6{align-items:stretch;column-gap:var(--dig-spacing__macro__small);display:flex;flex-direction:row}._sideBySideContentItem_6ww7a_13{flex:1}._footer_6ww7a_17{display:flex;flex-wrap:wrap-reverse;gap:var(--dig-spacing__dimension__8)}._autoLayoutModalMobile_6ww7a_23{._bannerSection_6ww7a_1{margin:var(--dig-spacing__micro__large) calc(var(--dig-spacing__macro__small)*-1)}._sideBySideContentContainer_6ww7a_6{align-items:stretch;flex-direction:column;margin-top:var(--dig-spacing__macro__xsmall);row-gap:var(--dig-spacing__macro__small)}._sideBySideContentItem_6ww7a_13{flex-grow:0}}._autoLayoutModalMobile_6ww7a_23._mobileCentered_6ww7a_43{._sideBySideContentContainer_6ww7a_6{display:block}._title_6ww7a_48{text-align:center}._sideBySideContentItem_6ww7a_13{align-items:center;display:flex;justify-content:center}._secondSideBySideContentItem_6ww7a_58{margin-top:var(--dig-spacing__dimension__24)}._footer_6ww7a_17{align-items:center;flex-direction:column-reverse}._footerButton_6ww7a_67{margin:auto}}._expandableModal_6ww7a_72{width:fit-content!important}"));const w="_bannerSection_6ww7a_1",v="_sideBySideContentContainer_6ww7a_6",p="_sideBySideContentItem_6ww7a_13",f="_footer_6ww7a_17",C="_autoLayoutModalMobile_6ww7a_23",g="_mobileCentered_6ww7a_43",y="_title_6ww7a_48",M="_secondSideBySideContentItem_6ww7a_58",S="_expandableModal_6ww7a_72",E=({title:e,bannerOptions:t,firstChild:o,secondChild:n,primaryCtaText:l,primaryCtaOnClick:i,primaryCtaProps:d,secondaryCtaText:s,secondaryCtaOnClick:_,secondaryCtaProps:u,showCloseButton:c,onCloseButtonClick:E,width:O=600,centerMobileView:b=!1,minWidth:P=366,maxWidth:h,isPrimaryCtaLoading:L=!1})=>{const[x,q]=m.default.useState(window.innerWidth<=O);m.default.useLayoutEffect((()=>{function e(){q(window.innerWidth<=O)}return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[O]);const I=t&&m.default.createElement(a.Box,{className:w},m.default.createElement(r.Banner,{type:t.type,borderRadius:x?"None":"Large"},m.default.createElement(r.Banner.Message,null,t.text),t.ctaText&&m.default.createElement(r.Banner.Actions,null,m.default.createElement(a.Button,{variant:"transparent",onClick:t.ctaOnClick},t.ctaText)))),T=a.cx({[C]:x,[g]:x&&b,[S]:void 0!==h&&!x});return m.default.createElement(a.Modal$1,{open:!0,withCloseButton:c?"Close":void 0,onRequestClose:e=>null==E?void 0:E(e),width:O,className:T,fullScreen:x,contentStyles:x?void 0:{minWidth:`${P}px`,maxWidth:h?`${h}px`:void 0}},m.default.createElement(a.Modal$1.Header,null,x&&I,m.default.createElement(a.Modal$1.Title,{className:y},e)),m.default.createElement(a.Modal$1.Body,null,!x&&I,m.default.createElement(a.Box,{className:v},m.default.createElement(a.Box,{className:p},o),n&&m.default.createElement(a.Box,{className:a.cx(p,M)},n))),m.default.createElement(a.Modal$1.Footer,{className:f},s&&m.default.createElement(a.Button,{variant:"opacity",onClick:_,...u},s),m.default.createElement(a.Button,{variant:"primary",onClick:i,isLoading:L,...d},l)))};E.displayName="AutoLayoutModal";const O="OVER_QUOTA_RESTRICTIONS_MODAL",b=({action:t,continueCallback:n,abortCallback:r,filePreview:c,fileName:w,downloadFileHandler:v})=>{var p,f,C,g,y,M,S,b,P,h;const[L,x]=m.default.useState(!1),{user:q}=a.useActiveUser(),{quotaUpsellInfo:I,isLoadingQuotaUpsellInfo:T}=d.useQuotaUpsellInfo(q),{shouldUseSmallSkus:k}=u.useOverquotaPriceDecrease(q),{plansInfo:B,isLoadingPlansInfo:N}=l.useGetPlans({planNames:["basic","plus"],revenueContentLocation:"oq_restrictions_modal"}),{plansInfo:R,isLoadingPlansInfo:A}=l.useGetPlans({planNames:["basic","basic500"],revenueContentLocation:"oq_smaller_skus_modal"}),D=k?R:B,U=k?A:N,V=o.useRef(!1),Q="ON"===a.useExperimentVariant("overquota_glide_modal").variant,W=(null===(p=null==I?void 0:I.quota)||void 0===p?void 0:p.used)||0,F=l.getViewMode(t),[$,G]=m.default.useState(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP);m.default.useLayoutEffect((()=>{function e(){G(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP)}return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const H=(null===(g=null===(C=null===(f=null==I?void 0:I.quota)||void 0===f?void 0:f.allocation)||void 0===C?void 0:C.individual)||void 0===g?void 0:g.allocated)||0,z=F!==l.ViewMode.UploadOrCreate&&((null===(y=null==I?void 0:I.restrictions)||void 0===y?void 0:y.show_restrictions_warning)||!1),j=void 0!==(null===(M=null==I?void 0:I.quota)||void 0===M?void 0:M.used)&&void 0!==(null===(S=null==B?void 0:B.PLUS)||void 0===S?void 0:S.quota_bytes)&&I.quota.used<B.PLUS.quota_bytes,K=_.getOverQuotaReason(null==I?void 0:I.overquota_reason),J=null!==(b=u.getOrganicOrChurnedFromString(K))&&void 0!==b?b:"unlabeled",X=null===(P=null==I?void 0:I.restrictions)||void 0===P?void 0:P.overquota_start_time_utc_seconds,Y=X?Date.now()/1e3-X:void 0,Z=(null===(h=null==I?void 0:I.restrictions)||void 0===h?void 0:h.show_restrictions_warning)&&!!X&&0!==X,ee=k?"dropbox500":D&&j?"plus":"none",te=o.useMemo((()=>({overQuotaSweepBlockingModalAction:t,quotaLimit:H,quotaUsed:W,organicOrChurned:J,secondsOverquota:Y,hardblocked:!z,planShown:ee,restrictionsStartDateShown:Z})),[H,W,J,Y,z,t,D,j,Z]);if(o.useEffect((()=>{U||T||V.current||(u.logShownOverquotaRestrictionsModal(te),V.current=!0)}),[te,U,T]),o.useEffect((()=>{U||T||V.current||(new Promise((function(t,o){e(["./c_custom_campaigns_out_of_space_modal_out_of_space_modal_doorman_wrapper"],t,o)})),new Promise((function(t,o){e(["./e_ui_page_files_router"],t,o)})).then((function(e){return e.portable_checkout_frame_esnext})))}),[U,T]),U||T)return null;const oe=()=>{u.logSelectOverquotaRestrictionsModal("view_plans",te),Q?(x(!0),a.openDoormanUpsellModal({modalVersion:"glide-upsell-modal-dp-only",trialCardsLocation:a.TrialCardsLocation.OVERQUOTA_RESTRICTIONS_MODAL,reloadPageAfterPurchase:!0,onClose:()=>{z?n():r()},onDisplayed:()=>{a.unmountModal(void 0,O),x(!1)}})):(r(),a.redirect("/out-of-space?_tk=oq_restrictions_modal"),a.unmountModal(void 0,O))},ae=()=>{u.logSelectOverquotaRestrictionsModal("manage_files",te),a.redirect("/home?_tk=oq_restrictions_modal&pathway=download_and_delete_tooltip_tour&sort_by_size_desc=true"),r(),a.unmountModal(void 0,O)};let ne;v&&(ne=()=>{u.logSelectOverquotaRestrictionsModal("download_file",te),null==v||v()});if(F===l.ViewMode.Preview&&!z&&!j&&!$)return m.default.createElement(i.Provider,{value:i.intl},m.default.createElement(s.OverQuotaFileViewerModal,{open:!0,onClose:()=>{n(),a.unmountModal(void 0,O)},headerText:l.PREVIEW_TITLE(w||""),bodyText:l.OVER_QUOTA_DELETION_WARNING(a.format_bytes$1(i.intl,W),a.format_bytes$1(i.intl,H)),badgeText:l.WARNING_BADGE,ctaText:l.VIEW_PLANS,onCtaClick:oe,filePreview:c,secondaryCtaText:l.MANAGE_FILES,secondaryCtaOnClick:ae,tertiaryCtaText:l.DOWNLOAD_FILE,tertiaryCtaOnClick:ne,showCloseButton:!1,isPrimaryCtaLoading:L}));const le=l.getAutoLayoutModalProps({viewMode:F,isMobileView:$,fileName:w,quotaUpsellInfo:I,warningMode:z,usedLessThanPlusQuota:j,filePreview:c,planContent:D,quotaUsedBytes:W,quotaAllocatedBytes:H,shouldUseSmallSkus:k,onViewPlansClick:oe,onCloseClick:e=>{e.preventDefault(),e.stopPropagation(),u.logSelectOverquotaRestrictionsModal("close_button",te),z?n():r(),a.unmountModal(void 0,O)},onDownloadFileClick:ne,onManageFilesClick:ae,onGetPlanClick:()=>{u.logSelectOverquotaRestrictionsModal("get_plan",te),l.openPortableCheckoutModal({isOpen:!0,productPlanType:k?a.ProductPlanType.BASIC_PLUS:a.ProductPlanType.PLUS,onCloseClick:()=>{z?n():r(),a.unmountModal(void 0,l.PORTABLE_CHECKOUT_MODAL_ID)},onIframeLoadSuccess:()=>{u.logShownPortableCheckoutModalSuccess(),a.unmountModal(void 0,O)},onIframeLoadError:()=>{r(),u.logShownPortableCheckoutModalError(),a.unmountModal(void 0,O),k?a.redirect("/buy/dbx500?_tk=oq_restrictions_modal"):a.redirect("/buy/plus?_tk=oq_restrictions_modal")},onPurchaseSuccess:()=>{r(),u.logSelectPortableCheckoutModalPurchaseSuccess(),a.reload()}})}});return m.default.createElement(i.Provider,{value:i.intl},m.default.createElement(E,{...le,isPrimaryCtaLoading:L}))};b.displayName="FunctionalOverQuotaRestrictionsModal";const P=e=>{a.mountModal(m.default.createElement(n.QueryClientProvider,{client:n.queryClient},m.default.createElement(b,{action:e.action,continueCallback:e.continueCallback,abortCallback:e.abortCallback,filePreview:e.filePreview,fileName:e.fileName,downloadFileHandler:e.downloadFileHandler})),void 0,O)};var h=Object.freeze({__proto__:null,openOverQuotaRestrictionsModal:P});t.AutoLayoutModal=E,t.openOverQuotaRestrictionsModal=P,t.open_over_quota_restrictions_modal_esnext=h}));
//# sourceMappingURL=c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal.js-vflQh-uSl.map

//# debugId=0ecb2c27-6fc8-3be8-967a-a8ddd273011a